!function(a){function b(a){var b=a.relatedTarget;return b?b!=this&&"xul"!=b.prefix&&!/document/.test(this.toString())&&!q(this,b):null===b}var c=1,d={},e={},f=/over|out/,g=/[^\.]*(?=\..*)\.|.*/,h=/\..*/,i="addEventListener",j="attachEvent",k="removeEventListener",l="detachEvent",m=a.document||{},n=m.documentElement||{},o=n[i],p=o?i:j,q=function(a,b){for(var c=b.parentNode;null!==c;){if(c==a)return!0;c=c.parentNode}},r=function(a,b){return a.__uid=b&&b+"::"+c++||a.__uid||c++},s=function(a){var b=r(a);return d[b]=d[b]||{}},t=o?function(a,b,c,d){a[d?i:k](b,c,!1)}:function(a,b,c,d,e){e&&d&&(a["_on"+e]=a["_on"+e]||0),a[d?j:l]("on"+b,c)},u=function(b,c,d){return function(e,f){return e=E(e||((this.ownerDocument||this.document||this).parentWindow||a).event),c.apply(b,[e].concat(d).concat(f))}},v=function(a,b,c,d,e){return function(f){(d?d.apply(this,arguments):!!o||(f&&f.propertyName=="_on"+c||!f))&&b.apply(a,Array.prototype.slice.call(arguments,f?0:1).concat(e))}},w=function(a,b,c,d){var f=b.replace(h,""),i=s(a),j=i[f]||(i[f]={}),k=c,l=r(c,b.replace(g,""));if(j[l])return a;var m=G[f];m&&(c=m.condition?v(a,c,f,m.condition):c,f=m.base||f);var n=F[f];if(c=n?u(a,c,d):v(a,c,f,!1,d),n=o||n,"unload"==f){var q=c;c=function(){x(a,f,c)&&q()}}return a[p]&&t(a,n?f:"propertychange",c,!0,!n&&f),j[l]=c,c.__uid=l,c.__originalFn=k,"unload"==f?a:e[r(a)]=a},x=function(a,b,c){function d(b){if(c=j[k][b],c&&(delete j[k][b],a[p])){k=G[k]?G[k].base:k;var d=o||F[k];t(a,d?k:"propertychange",c,!1,!d&&k)}}var e,f,i,j=s(a),k=b.replace(h,"");if(!j||!j[k])return a;for(e=b.replace(g,""),f=e?e.split("."):[c.__uid],d(e),i=f.length;i--;d(f[i]));return a},y=function(a,b,c){return function(d){for(var e="string"==typeof a?c(a,this):a,f=d.target;f&&f!=this;f=f.parentNode)for(var g=e.length;g--;)if(e[g]==f)return b.apply(f,arguments)}},z=function(a,b,c,d,e){if("object"!=typeof b||c){var f="string"==typeof c,g=(f?c:b).split(" ");c=f?y(b,d,e):c;for(var h=g.length;h--;)w(a,g[h],c,Array.prototype.slice.call(arguments,f?4:3))}else for(var i in b)b.hasOwnProperty(i)&&z(a,i,b[i]);return a},A=function(a,b,c){var d,e,f,i,j,k="string"==typeof b,l=k&&b.replace(g,""),l=l&&l.split("."),m=x,n=s(a);if(k&&/\s/.test(b)){for(b=b.split(" "),j=b.length-1;A(a,b[j])&&j--;);return a}if(i=k?b.replace(h,""):b,!n||l||k&&!n[i]){for(d in n)if(n.hasOwnProperty(d))for(j in n[d])for(e=l.length;e--;)n[d].hasOwnProperty(j)&&new RegExp("^"+l[e]+"::\\d*(\\..*)?$").test(j)&&m(a,[d,j].join("."));return a}if("function"==typeof c)m(a,i,c);else if(l)m(a,b);else{m=i?m:A,f=k&&i,i=i?c||n[i]||i:n;for(d in i)i.hasOwnProperty(d)&&(m(a,f||d,i[d]),delete i[d])}return a},B=function(a,b,c){var d,e,f,i=b.split(" ");for(e=i.length;e--;){b=i[e].replace(h,"");var j=F[b],k=i[e].replace(g,""),l=s(a)[b];if(k)for(k=k.split("."),d=k.length;d--;)for(f in l)l.hasOwnProperty(f)&&new RegExp("^"+k[d]+"::\\d*(\\..*)?$").test(f)&&l[f].apply(a,[!1].concat(c));else if(!c&&a[p])C(j,b,a);else for(d in l)l.hasOwnProperty(d)&&l[d].apply(a,[!1].concat(c))}return a},C=o?function(b,c,d){evt=document.createEvent(b?"HTMLEvents":"UIEvents"),evt[b?"initEvent":"initUIEvent"](c,!0,!0,a,1),d.dispatchEvent(evt)}:function(a,b,c){a?c.fireEvent("on"+b,document.createEventObject()):c["_on"+b]++},D=function(a,b,c){var d,e,f=s(b);r(a);d=c?f[c]:f;for(e in d)d.hasOwnProperty(e)&&(c?z:D)(a,c||b,c?d[e].__originalFn:e);return a},E=function(a){var b={};if(!a)return b;var c=a.type,d=a.target||a.srcElement;b.preventDefault=E.preventDefault(a),b.stopPropagation=E.stopPropagation(a),b.target=d&&3==d.nodeType?d.parentNode:d,~c.indexOf("key")?b.keyCode=a.which||a.keyCode:/click|mouse|menu/i.test(c)&&(b.rightClick=3==a.which||2==a.button,b.pos={x:0,y:0},a.pageX||a.pageY?(b.clientX=a.pageX,b.clientY=a.pageY):(a.clientX||a.clientY)&&(b.clientX=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,b.clientY=a.clientY+document.body.scrollTop+document.documentElement.scrollTop),f.test(c)&&(b.relatedTarget=a.relatedTarget||a[("mouseover"==c?"from":"to")+"Element"]));for(var e in a)e in b||(b[e]=a[e]);return b};E.preventDefault=function(a){return function(){a.preventDefault?a.preventDefault():a.returnValue=!1}},E.stopPropagation=function(a){return function(){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0}};var F={click:1,dblclick:1,mouseup:1,mousedown:1,contextmenu:1,mousewheel:1,DOMMouseScroll:1,mouseover:1,mouseout:1,mousemove:1,selectstart:1,selectend:1,keydown:1,keypress:1,keyup:1,orientationchange:1,touchstart:1,touchmove:1,touchend:1,touchcancel:1,gesturestart:1,gesturechange:1,gestureend:1,focus:1,blur:1,change:1,reset:1,select:1,submit:1,load:1,unload:1,beforeunload:1,resize:1,move:1,DOMContentLoaded:1,readystatechange:1,error:1,abort:1,scroll:1},G={mouseenter:{base:"mouseover",condition:b},mouseleave:{base:"mouseout",condition:b}},H={add:z,remove:A,clone:D,fire:B},I=function(a){var b=A(a).__uid;b&&(delete e[b],delete d[b])};a[j]&&z(a,"unload",function(){for(var b in e)e.hasOwnProperty(b)&&I(e[b]);a.CollectGarbage&&CollectGarbage()});var J=a.bean;H.noConflict=function(){return a.bean=J,this},"undefined"!=typeof module&&module.exports?module.exports=H:a.bean=H}(this);var MASCP=MASCP||{};if(MASCP.Service=function(a,b){},"undefined"!=typeof module&&module.exports){var events=require("events");MASCP.Service.prototype=new events.EventEmitter;var singletonService=new MASCP.Service;MASCP.Service.emit=function(a,b){singletonService.emit(a,b)},MASCP.Service.removeAllListeners=function(a,b){b?singletonService.removeListeners(a,b):singletonService.removeAllListeners(a)},MASCP.Service.addListener=function(a,b){singletonService.addListener(a,b)};var bean={add:function(a,b,c){"error"==b&&(b="MASCP.error"),a.addListener&&a.addListener(b,c)},remove:function(a,b,c){"error"==b&&(b="MASCP.error"),c&&a.removeListener?a.removeListener(b,c):a.removeAllListeners&&"undefined"==typeof c&&a.removeAllListeners(b)},fire:function(a,b,c){"error"==b&&(b="MASCP.error"),a.emit&&a.emit.apply(a,[b].concat(c))}};MASCP.events=new events.EventEmitter,module.exports=MASCP;var parser=require("jsdom").jsdom,XMLHttpRequest=require("xmlhttprequest").XMLHttpRequest;XMLHttpRequest.prototype.__defineGetter__("responseXML",function(){return parser((this.responseText||"").replace(/&/g,"&amp;"))}),XMLHttpRequest.prototype.__defineSetter__("responseXML",function(){}),XMLHttpRequest.prototype.customUA="MASCP Gator crawler (+http://gator.masc-proteomics.org/)"}else{window.MASCP=MASCP;var ie=function(){var a,b=3,c=document.createElement("div"),d=c.getElementsByTagName("i");do c.innerHTML="<!--[if gt IE "+ ++b+"]><i></i><![endif]-->";while(d[0]);return b>4?b:a}();ie&&(7===ie&&(MASCP.IE=!0,MASCP.IE7=!0),8===ie&&(MASCP.IE=!0,MASCP.IE8=!0),MASCP.IE=!0)}if(MASCP.buildService=function(a){var b=function(a,c){return"undefined"!=typeof c?this._endpointURL=c:this._endpointURL=b.SERVICE_URL,this.agi=a,this};return b.Result=function(b){return a.apply(this,[b]),this},b.prototype=MASCP.extend(new MASCP.Service,{__class__:b,__result_class:b.Result,_endpointURL:null}),b.Result.prototype=MASCP.extend(new MASCP.Service.Result,{__class__:b.Result}),b.Result.prototype=MASCP.extend(b.Result.prototype,a.apply({},[])),b.toString=function(){for(var a in MASCP)if(this===MASCP[a])return"MASCP."+a},b},MASCP.cloneService=function(a,b){var c=MASCP.buildService(function(){return this});return c.Result=a.Result,c.prototype=new a,MASCP[b]=c,c.prototype.__class__=c,c},MASCP.extend=function(a,b){for(var c in b)a[c]=b[c];return a},MASCP.extend(MASCP.Service.prototype,{agi:null,result:null,__result_class:null,async:!0}),MASCP.Service.prototype._dataReceived=function(a,b){if(!a)return!1;var c=this.__result_class;if(a&&a.error&&""!=a.error&&null!==a.error)return bean.fire(this,"error",[a.error]),!1;if("[object Array]"===Object.prototype.toString.call(a)){for(var d=0;d<a.length;d++)arguments.callee.call(this,a[d],b);0===d&&(this.result=new c),this.result._raw_data={data:a}}else if(this.result){try{c.call(this.result,a)}catch(e){return bean.fire(this,"error",[e]),!1}this.result._raw_data||(this.result._raw_data=a)}else{var f;try{f=new c(a)}catch(g){return bean.fire(this,"error",[g]),!1}f._raw_data||(f._raw_data=a),this.result=f}return a&&a.retrieved&&(this.result.retrieved=a.retrieved,this.result._raw_data.retrieved=a.retrieved),this.result.agi=this.agi,!0},MASCP.Service.prototype.gotResult=function(){var a=this,b=function(b){b.readers||(b.readers=[]),b.readers.push(a.toString())};bean.add(MASCP,"layerRegistered",b),bean.add(MASCP,"groupRegistered",b),bean.fire(a,"resultReceived");try{bean.remove(MASCP,"layerRegistered",b),bean.remove(MASCP,"groupRegistered",b)}catch(c){}bean.fire(MASCP.Service,"resultReceived")},MASCP.Service.prototype.requestComplete=function(){bean.fire(this,"requestComplete"),bean.fire(MASCP.Service,"requestComplete",[this])},MASCP.Service.registeredLayers=function(a){var b=[];for(var c in MASCP.layers)if(MASCP.layers.hasOwnProperty(c)){var d=MASCP.layers[c];d.readers&&d.readers.indexOf(a.toString())>=0&&b.push(d)}return b},MASCP.Service.registeredGroups=function(a){var b=[];for(var c in MASCP.groups)if(MASCP.groups.hasOwnProperty(c)){var d=MASCP.groups[c];d.readers&&d.readers.indexOf(a.toString())>=0&&b.push(d)}return b},MASCP.Service.prototype.bind=function(a,b){return bean.add(this,a,b),this},MASCP.Service.prototype.unbind=function(a,b){return bean.remove(this,a,b),this},function(a){var b=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c+"="+a[c]);return b.join("&")},c=function(a){var c=null;if(!a.url)return void a.success.call(null,null);var d=new XMLHttpRequest;if("GET"==a.type&&a.data){var e=a.url.indexOf("?");e==a.url.length-1&&(a.url=a.url.slice(0,-1),e=-1);var f=e>=0?"&":"?";a.url=a.url.replace(/\?$/,"")+f+b(a.data)}d.open(a.type,a.url,a.async),"POST"==a.type&&(d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c=b(a.data)),d.customUA&&d.setRequestHeader("User-Agent",d.customUA),d.onreadystatechange=function(b){if(4==d.readyState)if(200==d.status){var c;c="xml"==a.dataType?"undefined"!=typeof document?document.implementation.createDocument(null,"nodata",null):{getElementsByTagName:function(){return[]}}:{};try{d.responseText;c="xml"==a.dataType?d.responseXML||MASCP.importNode(d.responseText):JSON.parse(d.responseText)}catch(e){return"unexpected_eos"==e.type?void a.success.call(null,{},d.status,d):void a.error.call(null,{error:e.type||e.message,stack:e})}a.success.call(null,c,d.status,d),c=null}else a.error.call(null,d.responseText,d,d.status)},d.send(c)},d=function(a){var c=new XDomainRequest,d=!1,e=0;for(c.onerror=a.error,c.onprogress=function(){},c.open("GET",a.url+"?"+b(a.data)),c.onload=function(){if(d=!0,"xml"==a.dataType){var b=new ActiveXObject("Microsoft.XMLDOM");b.async=!1,b.loadXML(c.responseText),a.success(b,"success",c)}else if("json"==a.dataType){var e=null;try{e=JSON.parse(c.responseText)}catch(f){a.error(c,c,{})}e&&a.success(e,"success",c)}else a.success(c.responseText,"success",c)},setTimeout(function(){c.send()},0);!a.async&&!d&&e<3;)alert("This browser does not support synchronous requests, click OK while we're waiting for data"),e+=1;a.async||d||alert("No data")};a.retrieve=function(a,b){var e=this;if(MASCP.Service._current_reqs=MASCP.Service._current_reqs||0,MASCP.Service._waiting_reqs=MASCP.Service._waiting_reqs||0,MASCP.Service.MAX_REQUESTS){var f=arguments.callee;if(MASCP.Service._current_reqs>MASCP.Service.MAX_REQUESTS)return MASCP.Service._waiting_reqs+=1,bean.add(MASCP.Service,"requestComplete",function(){bean.remove(this,"requestComplete",arguments.callee),setTimeout(function(){MASCP.Service._waiting_reqs-=1,f.call(e,a,b)},0)}),this}if(a&&(this.agi=a),a&&b){this.agi=a;var g=!1,h=function(a){bean.remove(e,"resultReceived",h),bean.remove(e,"error",h),bean.remove(e,"requestComplete",h),g||(a?b.call(e,a):b.call(e)),g=!0};bean.add(e,"resultReceived",h),bean.add(e,"error",h),bean.add(e,"requestComplete",h)}var i=this.requestData();if(!i)return this;var j={async:this.async,url:i.url||this._endpointURL,timeout:5e3,error:function(a,b,c){MASCP.Service._current_reqs-=1,"string"==typeof c&&(c={error:c,request:b}),bean.fire(e,"error",[c]),bean.fire(MASCP.Service,"requestComplete"),e.requestComplete()},success:function(a,b,c){return MASCP.Service._current_reqs-=1,c&&null!==c.status&&0===c.status?(bean.fire(e,"error",[{error:"Zero return status from request "}]),void e.requestComplete()):(e._dataReceived(a,b)&&e.gotResult(),void e.requestComplete())}};return MASCP.extend(j,i),MASCP.IE?d(j):c(j),MASCP.Service._current_reqs+=1,this}}(MASCP.Service.prototype),function(a){var b,c,d,e,f,g,h,i,j,k,l=0,m=0;a.BeginCaching=function(){a.CacheService(a.prototype)},a.SetMinimumAge=function(a){m=0===a?0:a.getTime()},a.SetMaximumAge=function(a){l=0===a?0:a.getTime()},a.SweepCache=function(a){a||(a=a.getTime()),h(a.getTime())},a.CacheService=function(a){if(!a.retrieve.caching){var d=a.retrieve;a.retrieve=function(a,e){var f=this,g=a?a:f.agi;return g?(g=g.toLowerCase(),f.agi=g,b(g,f.toString(),function(a,b){if(b)e&&bean.add(f,"resultReceived",function(){bean.remove(f,"resultReceived",arguments.callee),e.call(f)}),f._dataReceived(b,"db")&&f.gotResult(),f.requestComplete();else{var h=f._dataReceived;f._dataReceived=function(){return function(a){var b=h.call(this,a);return b&&this.result&&null!==this.result._raw_data&&c(g,this.toString(),this.result._raw_data||{}),this._dataReceived=null,this._dataReceived=h,a={},b}}();var i=f._endpointURL;0!==l&&(f._endpointURL=null),d.call(f,g,e),f._endpointURL=i}}),f):(d.call(f,g,e),f)},a.retrieve.caching=!0}},a.FindCachedService=function(a,b){var c=a.toString();return d(c,b),!0},a.CachedAgis=function(a,b){var c=a.toString();return i(c,b),!0},a.ClearCache=function(a,b){var c=a.toString();return e(c,b),!0},a.HistoryForService=function(a,b){var c=a.toString();g(c,null,b)},a.BulkOperation=function(){return j(),function(){k()}};var n;if("undefined"!=typeof module&&module.exports){var o=require("sqlite3");n=new o.Database("cached.db")}else if("openDatabase"in window){try{n=openDatabase("cached","","MASCP Gator cache",1048576)}catch(p){throw p}n.all=function(a,b,c){this.exec(a,b,c)},n.exec=function(a,b,c){var d=this,e=b,f=c;"undefined"==typeof f&&e&&"[object Array]"!=Object.prototype.toString.call(e)&&(f=b,e=null),d.transaction(function(b){b.executeSql(a,e,function(a,b){for(var c=[],d=0;d<b.rows.length;d++)c.push(b.rows.item(d));f&&f.call(n,null,c)},function(a,b){f&&f.call(n,b)})})}}if("undefined"!=typeof n){n.all('SELECT version from versions where tablename = "datacache"',function(a,b){var c=b?b[0].version:null;return 1.3==c?void(MASCP.events&&MASCP.events.emit("ready")):((!c||""==c||c<1)&&(n.exec("CREATE TABLE if not exists versions (version REAL, tablename TEXT);"),n.exec('CREATE TABLE if not exists "datacache" (agi TEXT,service TEXT,retrieved REAL,data TEXT);',function(a){if(a&&"Error: not an error"!=a)throw a}),n.exec('DELETE FROM versions where tablename = "datacache"'),n.exec('INSERT INTO versions(version,tablename) VALUES(1.1,"datacache");',function(a,b){}),c=1.1),c<1.2&&(n.exec("DROP TABLE if exists datacache_tmp;"),n.exec("CREATE TABLE if not exists datacache_tmp (acc TEXT,service TEXT,retrieved REAL,data TEXT);"),n.exec("INSERT INTO datacache_tmp(acc,service,retrieved,data) SELECT agi,service,retrieved,data FROM datacache;"),n.exec("DROP TABLE datacache;"),n.exec("ALTER TABLE datacache_tmp RENAME TO datacache;"),n.exec("CREATE INDEX accessions on datacache(acc);"),n.exec("CREATE INDEX accessions_service on datacache(acc,service);"),n.exec('DELETE FROM versions where tablename = "datacache"'),n.exec('INSERT INTO versions(version,tablename) VALUES(1.2,"datacache");',function(a,b){}),c=1.2),void(c<1.3&&(n.exec("CREATE INDEX if not exists services on datacache(service);"),n.exec('DELETE FROM versions where tablename = "datacache"'),n.exec('INSERT INTO versions(version,tablename) VALUES(1.3,"datacache");',function(a,b){a||MASCP.events&&MASCP.events.emit("ready")}),c=1.3)))});var q=b;j=function(){b=function(a,b,c){setTimeout(function(){c.call(null,null)},0)},n.exec("BEGIN TRANSACTION;",function(){})},k=function(){b=q,n.exec("END TRANSACTION;",function(){})},h=function(a){n.all("DELETE from datacache where retrieved <= ? ",[a],function(){})},e=function(a,b){var c=a;c+="%",b?n.all("DELETE from datacache where service like ? and acc = ?",[c,b.toLowerCase()],function(){}):n.all("DELETE from datacache where service like ? ",[c],function(){})},d=function(a,b){n.all("SELECT distinct service from datacache where service like ? ",[a+"%"],function(a,c){var d={};c&&c.length>0&&c.forEach(function(a){d[a.service]=!0});var e=[];for(var f in d)d.hasOwnProperty(f)&&e.push(f);return b.call(MASCP.Service,e),e})},i=function(a,b){n.all("SELECT distinct acc from datacache where service = ?",[a],function(a,c){for(var d=[],e=0;e<c.length;e++)d.push(c[e].acc);b.call(MASCP.Service,d)})},b=function(a,b,c){var d=l?[m,l]:[m,(new Date).getTime()];return f(a,b,d,c)};var r=function(a,b){return function(a,b){}};c=function(a,b,c){if(!("object"!=typeof c||"undefined"!=typeof Document&&c instanceof Document)){var d;try{d=JSON.stringify(c)}catch(e){return}var f=c.retrieved?c.retrieved:new Date;"string"==typeof f&&(f=new Date),f.setUTCHours(0),f.setUTCMinutes(0),f.setUTCSeconds(0),f.setUTCMilliseconds(0);var g=f.getTime();c={},n.all("INSERT INTO datacache(acc,service,retrieved,data) VALUES(?,?,?,?)",[a,b,g,d],r(a,b))}},f=function(a,b,c,d){var e="SELECT * from datacache where acc=? and service=? and retrieved >= ? and retrieved <= ? ORDER BY retrieved DESC LIMIT 1",f=[a,b,c[0],c[1]];n.all(e,f,function(a,b){if(b&&b.length>0&&"undefined"!=typeof b[0]){var c="string"==typeof b[0].data?JSON.parse(b[0].data):b[0].data;c&&(c.retrieved=new Date(b[0].retrieved)),d.call(null,null,c)}else d.call(null,null,null)})},g=function(a,b,c){b&&"object"==typeof b&&b.length||(b=[0,(new Date).getTime()]);var d="SELECT distinct retrieved from datacache where service=? and retrieved >= ? and retrieved <= ? ORDER BY retrieved ASC",e=[a,b[0],b[1]];n.all(d,e,function(a,b){var d=[];if(b&&b.length>0&&"undefined"!=typeof b[0])for(var e=b.length-1;e>=0;e--)d.push(new Date(b[e].retrieved));c.call(null,d)})}}else"localStorage"in window?(h=function(a){if("localStorage"in window){for(var b=[],c=0,d=localStorage.length;c<d;c++)b.push(localStorage.key(c));for(var e=b.shift();e;){if(new RegExp("^MASCP.*").test(e)){var f=localStorage[e];if(f&&"string"==typeof f){var g=JSON.parse(f);g.retrieved=a,localStorage.removeItem(e)}}e=b.shift()}}},e=function(a,b){if("localStorage"in window){for(var c=[],d=0,e=localStorage.length;d<e;d++)c.push(localStorage.key(d));for(var f=c.shift();f;){if(new RegExp("^"+a+".*"+(b?"#"+b.toLowerCase()+"$":"")).test(f)&&(localStorage.removeItem(f),b))return;f=c.shift()}}},d=function(b,c){var d={};if("localStorage"in window)for(var e,f=new RegExp("^"+b+".*"),g=0,h=localStorage.length;g<h;g++)e=localStorage.key(g),f.test(e)&&(d[e.replace(/\.#.*$/g,"")]=!0);var i=[];for(var j in d)d.hasOwnProperty(j)&&i.push(j);return c.call(a,i),i},i=function(b,c){if("localStorage"in window)for(var d,e=new RegExp("^"+b),f=0,g=localStorage.length;f<g;f++)d=localStorage.key(f),e.test(d)&&(d=d.replace(b,""),results[d]=!0);var h=[];for(var i in results)results.hasOwnProperty(i)&&h.push(i);c.call(a,h)},b=function(a,b,c){var d=localStorage[b.toString()+".#"+(a||"").toLowerCase()];if(d&&"string"==typeof d){var e=JSON.parse(d);e.retrieved=new Date(e.retrieved),c.call(null,null,e)}else c.call(null,null,null)},c=function(a,b,c){c&&("object"!=typeof c||c instanceof Document||c.nodeName)||(c.retrieved=(new Date).getTime(),localStorage[b.toString()+".#"+(a||"").toLowerCase()]=JSON.stringify(c))},f=function(a,c,d,e){return b(a,c,e)},g=function(a,b,c){c.call(null,[])},j=function(){},k=function(){}):(h=function(a){},e=function(a,b){},d=function(a,b){},i=function(b,c){c.call(a,[])},b=function(a,b,c){c.call(null,null,null)},c=function(a,b,c){},f=function(a,b,c,d){d.call(null,[])},g=function(a,b,c){c.call(null,[])},j=function(){},k=function(){})}(MASCP.Service),MASCP.Service.prototype.setAsync=function(a){return this.async=a,this},MASCP.Service.prototype.requestData=function(){},MASCP.Service.prototype.toString=function(){for(var a in MASCP)if(this.__class__==MASCP[a])return"MASCP."+a},MASCP.Service.prototype.registerSequenceRenderer=function(a){return this.setupSequenceRenderer&&(this.renderers=this.renderers||[],this.setupSequenceRenderer(a),this.renderers.push(a)),this},MASCP.Service.prototype.setupSequenceRenderer=function(a){return this},MASCP.Service.importNode=function(a){if("undefined"==typeof document)return a;var b;return"string"==typeof a?(b=document.createElement("div"),b.innerHTML=a,b.firstChild):document.importNode?document.importNode(a,!0):(b=document.createElement("div"),b.innerHTML=a.xml,b.firstChild)},MASCP.Service.Result=function(){},MASCP.Service.Result.prototype={agi:null,reader:null},MASCP.Service.Result.prototype.render=function(){},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.AccessionReader=MASCP.buildService(function(a){return this._data=a||{data:["",""]},this}),MASCP.AccessionReader.SERVICE_URL="http://gator.masc-proteomics.org/tair.pl",MASCP.AccessionReader.prototype.requestData=function(){return{type:"GET",dataType:"json",data:{agi:this.agi,accession:this.accession,service:"tair"}}},MASCP.AccessionReader.Result.prototype.getDeletions=function(){return[]},MASCP.AccessionReader.prototype.setupSequenceRenderer=function(a){var b=this;this.bind("resultReceived",function(){var c=b.accession.split(","),d=c.shift(),e=b.result.length?b.result.shift():b.result;for(MASCP.registerGroup("all_insertions"),MASCP.registerGroup("all_deletions"),a.registerLayer("insertions",{fullname:"Accession",color:"#ff0000"}),a.createGroupController&&a.createGroupController("insertions","all_insertions"),console.log(e);e;){var f=a.sequence,g=e.getSequence(),h=(new diff_match_patch).diff_main(f,g),i=1,j=[],k=[];if(h.length<=1)e=b.result.length?b.result.shift():null,d=c.shift();else{var l="all_"+d;a.registerLayer(l,{fullname:d,group:"all_insertions"});var m;for(m=h.length-1;m>=0;m--)m>0&&h[m-1][0]<=0&&(i+=h[m-1][1].length,i>a.sequence.length&&(i=a.sequence.length)),h[m][0]==-1&&k.push({index:i,delta:h[m][1]}),1==h[m][0]&&j.push({insertBefore:i,delta:h[m][1]});for(m=j.length-1;m>=0;m--)a.getAA(j[m].insertBefore-1).addAnnotation(l,1,{border:"rgb(150,0,0)",content:j[m].delta}),a.getAA(j[m].insertBefore-1).addAnnotation("insertions",1,{border:"rgb(150,0,0)",content:j[m].delta});for(m=k.length-1;m>=0;m--)a.getAA(k[m].index).addAnnotation(l,1,{angle:90,border:"rgb(0,0,150)",content:k[m].delta}),a.getAA(k[m].index).addAnnotation("insertions",1,{angle:90,border:"rgb(0,0,150)",content:k[m].delta});e=b.result.length?b.result.shift():null,d=c.shift()}}})},MASCP.AccessionReader.Result.prototype.getDescription=function(){return this._data.data[1]},MASCP.AccessionReader.Result.prototype.getSequence=function(){return"object"==typeof this._data&&this._data.length?this._data[0].data[2]:this._data.data[2]},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.ArbitraryDataReader=MASCP.buildService(function(a){return this._raw_data=a,this}),MASCP.ArbitraryDataReader.SERVICE_URL="http://gator.masc-proteomics.org/datasets.pl?",MASCP.ArbitraryDataReader.prototype.requestData=function(){var a=this.agi,b=this._dataset();return b?{type:"GET",dataType:"json",data:{agi:a,dataset:b,service:"ArbitraryData"}}:{type:"GET",dataType:"json",data:{service:"ArbitraryData"}}},MASCP.ArbitraryDataReader.prototype._extend=function(a){if(null===this||"object"!=typeof this||"undefined"==typeof a||!a)return this;var b=new MASCP.ArbitraryDataReader;return b._endpointURL=this._endpointURL,b.agi=this.agi,b.toString=function(){var c=MASCP.Service.prototype.toString.call(b);return c+"."+a},b._dataset=function(){return a},b.layer=function(){return"arbitrary_"+a},b},MASCP.ArbitraryDataReader.prototype._dataset=function(){return null},MASCP.ArbitraryDataReader.prototype.retrieve=function(a,b){var c=this,d=this.agi||a;if(d&&this._dataset())return void MASCP.Service.prototype.retrieve.call(c,a,b);if(!this._SERVER_DATASETS&&d&&"dummy"!=d){var e=new MASCP.ArbitraryDataReader("",c._endpointURL);return void e.retrieve("dummy",function(){this.result?c._SERVER_DATASETS=this.result._raw_data.data:c._SERVER_DATASETS=[],c.retrieve(a,b)})}return this._SERVER_DATASETS?0==this._SERVER_DATASETS.length?(MASCP.Service.prototype.retrieve.call(c,"dummy",b),void(c.renderers||[]).forEach(function(a){jQuery(a).trigger("resultsRendered",[c])})):void this._SERVER_DATASETS.forEach(function(a){var e=c._extend(a);(c.renderers||[]).forEach(function(a){e.setupSequenceRenderer(a),a.bind("resultsRendered",function(b,d){d==e&&jQuery(a).trigger("resultsRendered",[c])})}),e.bind("resultReceived",function(){c.gotResult()}),e.bind("requestComplete",function(){c.requestComplete()}),e.retrieve(d,b)}):void MASCP.Service.FindCachedService(c.toString(),function(a){if(a.length>=0){var d=[];a.forEach(function(a){d.push(a.replace(c.toString()+".",""))}),c._SERVER_DATASETS=d,c.result={},c.result._raw_data={data:d}}c._endpointURL&&c._endpointURL.length&&MASCP.Service.ClearCache(c),MASCP.Service.prototype.retrieve.call(c,"dummy",b)})},MASCP.ArbitraryDataReader.Result=MASCP.ArbitraryDataReader.Result,MASCP.ArbitraryDataReader.Result.prototype.getPeptides=function(){return this._peptides?this._peptides:this._raw_data&&this._raw_data.data?this._raw_data.data:[]},MASCP.ArbitraryDataReader.prototype.setupSequenceRenderer=function(a){var b=this;if(this._dataset()){var c=".active .overlay { background: #ff5533; } .active a { color: #000000; text-decoration: none !important; }  :indeterminate { background: #ff0000; } .tracks .active { background: #0000ff; } .inactive a { text-decoration: none; } .inactive { display: none; }";return this.bind("resultReceived",function(){var d=this.result.getPeptides();if(d.length<=0)return void jQuery(a).trigger("resultsRendered",[b]);MASCP.registerGroup("arbitrary_datasets",{fullname:"Other data",color:"#ff5533"}),MASCP.registerLayer("arbitrary_controller",{fullname:"Other data",color:"#ff5533",css:c});var e=this.layer();MASCP.registerLayer(e,{group:"arbitrary_datasets",fullname:this._dataset(),color:this.result._raw_data.color||"#ff5533",css:c}),this.result._raw_data.url&&(MASCP.getLayer(e).href=this.result._raw_data.url);for(var f=0;f<d.length;f++){var g,h=d[f];"string"==typeof h?(g=a.getAminoAcidsByPeptide(h),g.addToLayer(e)):2==h.length&&a.getAA(h[0]).addBoxOverlay(e,h[1]-h[0])}a.createGroupController&&a.createGroupController("arbitrary_controller","arbitrary_datasets"),jQuery(a).trigger("resultsRendered",[b])}),this}},MASCP.ArbitraryDataReader.Result.prototype.render=function(){},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.AtChloroReader=MASCP.buildService(function(a){return this._raw_data=a,this}),MASCP.AtChloroReader.SERVICE_URL="http://prabi2.inrialpes.fr/at_chloro/annotation/",MASCP.AtChloroReader.prototype.requestData=function(){var a=this.agi;return{type:"GET",url:this._endpointURL+a.toUpperCase(),dataType:"json",data:{agi:a.toUpperCase(),service:"atchloro"}}},MASCP.AtChloroReader.Result=MASCP.AtChloroReader.Result,MASCP.AtChloroReader.Result.prototype.getPeptides=function(){if(this._peptides)return this._peptides;if(this._long_name_map={},!this._raw_data||!this._raw_data.peptides)return[];for(var a=[],b=0;b<this._raw_data.peptides.length;b++){var c=this._raw_data.peptides[b],d={sequence:this._cleanSequence(c.sequence)};a.push(d)}return this._peptides=a,a},MASCP.AtChloroReader.Result.prototype._cleanSequence=function(a){return a.replace(/[^A-Z]/g,"")},MASCP.AtChloroReader.prototype.setupSequenceRenderer=function(a){var b=this,c=".active .overlay { background: #55ff33; } .active a { color: #000000; text-decoration: none !important; }  :indeterminate { background: #ff0000; } .tracks .active { background: #0000ff; } .inactive a { text-decoration: none; } .inactive { display: none; }";return this.bind("resultReceived",function(){var d=this.result.getPeptides();d.length>0&&(MASCP.registerLayer("atchloro_experimental",{fullname:"AT_CHLORO MS/MS",color:"#55ff33",css:c}),MASCP.getLayer("atchloro_experimental").href="http://prabi2.inrialpes.fr/at_chloro/protein/"+b.agi.toUpperCase());for(var e=0;e<d.length;e++){var f=d[e].sequence,g=a.getAminoAcidsByPeptide(f);g.addToLayer("atchloro_experimental")}jQuery(a).trigger("resultsRendered",[b])}),this},MASCP.AtChloroReader.Result.prototype.render=function(){if(this.getPeptides().length>0){var a=jQuery('<div>MS/MS spectra <input class="group_toggle" type="checkbox"/>AtChloro</div>');return jQuery(this.reader.renderers).each(function(b){this.createGroupCheckbox("atchloro_experimental",jQuery("input.group_toggle",a))}),a}return null},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.AtPeptideReader=MASCP.buildService(function(a){return this._raw_data=a,this}),MASCP.AtPeptideReader.SERVICE_URL="http://gator.masc-proteomics.org/atpeptide.pl?",MASCP.AtPeptideReader.prototype.requestData=function(){var a=this.agi;return{type:"GET",dataType:"json",data:{agi:a,service:"atpeptide"}}},MASCP.AtPeptideReader.Result.prototype.tissues=function(){return this._tissues},MASCP.AtPeptideReader.Result=MASCP.AtPeptideReader.Result,MASCP.AtPeptideReader.Result.prototype.getPeptides=function(){if(this._peptides)return this._peptides;if(this._tissues=[],this.spectra={},this._long_name_map={},!this._raw_data||!this._raw_data.peptides)return[];for(var a=[],b=function(){return this.sequence},c=this._raw_data.peptides.length-1;c>=0;c--){var d=this._raw_data.peptides[c],e={sequence:this._cleanSequence(d.sequence),tissues:[]};e.toString=b,a.push(e);for(var f=d.tissues.length-1;f>=0;f--){var g=d.tissues[f];if(this._tissues.indexOf(g["PO:tissue"])<0){var h=g["PO:tissue"];this._tissues.push(h),h.long_name=g.tissue,this._long_name_map[h]=g.tissue}e.tissues.push(g["PO:tissue"]),this.spectra[g["PO:tissue"]]||(this.spectra[g["PO:tissue"]]=0),this.spectra[g["PO:tissue"]]+=1}}return this._peptides=a,a},MASCP.AtPeptideReader.Result.prototype._cleanSequence=function(a){return a.replace(/[^A-Z]/g,"")},MASCP.AtPeptideReader.prototype.setupSequenceRenderer=function(a){var b=this;return this.bind("resultReceived",function(){MASCP.registerGroup("atpeptide_experimental",{fullname:"AtPeptide MS/MS",hide_member_controllers:!0,hide_group_controller:!0,color:"#ff5533"});var c="atpeptide_controller",d=".active .overlay { background: #ff5533; } .active a { color: #000000; text-decoration: none !important; }  :indeterminate { background: #ff0000; } .tracks .active { background: #0000ff; } .inactive a { text-decoration: none; } .inactive { display: none; }";MASCP.registerLayer(c,{fullname:"AtPeptide MS/MS",color:"#ff5533",css:d}),a.createGroupController&&a.createGroupController("atpeptide_controller","atpeptide_experimental");for(var e=this.result.getPeptides(),f=0;f<this.result.tissues().length;f++){var g=this.result.tissues()[f];MASCP.registerLayer("atpeptide_peptide_"+g,{fullname:this.result._long_name_map[g],group:"atpeptide_experimental",color:"#ff5533",css:d});for(var h=0;h<e.length;h++){var i=e[h].sequence;if(!(e[h].tissues.indexOf(g+"")<0)){var j=a.getAminoAcidsByPeptide(i),k="atpeptide_peptide_"+g;j.addToLayer(k),j.addToLayer(c)}}}jQuery(a).trigger("resultsRendered",[b])}),this},MASCP.AtPeptideReader.Result.prototype.render=function(){if(this.getPeptides().length>0){var a=jQuery('<div>MS/MS spectra <input class="group_toggle" type="checkbox"/>AtPeptide</div>');return jQuery(this.reader.renderers).each(function(b){this.createGroupCheckbox("atpeptide_experimental",jQuery("input.group_toggle",a))}),a}return null},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";
if(MASCP.GelMapReader=MASCP.buildService(function(a){if(this._raw_data=a,!a)return this;if(!a.Maps)return this;for(var b=[],c=a.Maps.length-1;c>=0;c--){var d=a.Maps[c];d.sequence="",b.push(d)}return this.maps=b,this}),MASCP.GelMapReader.SERVICE_URL="http://gelmap.de/gator2.php?",MASCP.GelMapReader.prototype.requestData=function(){var a=this.agi.toUpperCase();return{type:"GET",dataType:"json",data:{agi:a,service:"gelmap"}}},MASCP.GelMapReader.Result=MASCP.GelMapReader.Result,MASCP.GelMapReader.Result.prototype.getPeptides=function(){return this._peptides?this._peptides:(this._peptides=peptides,peptides)},MASCP.GelMapReader.Result.prototype._cleanSequence=function(a){return a.replace(/[^A-Z]/g,"")},MASCP.GelMapReader.prototype.setupSequenceRenderer=function(a){var b=this;MASCP.registerGroup("gelmap_experimental",{fullname:"GelMap",hide_member_controllers:!0,hide_group_controller:!0,color:"#aaaaff"});var c="gelmap_controller",d=".active .overlay { background: #ff5533; } .active a { color: #000000; text-decoration: none !important; }  :indeterminate { background: #ff0000; } .tracks .active { background: #0000ff; } .inactive a { text-decoration: none; } .inactive { display: none; }";MASCP.registerLayer(c,{fullname:"GelMap",color:"#aaaaff",css:d}),a.createGroupController&&a.createGroupController("gelmap_controller","gelmap_experimental");var e=function(a){a=a.sort(function(a,b){return 1*a-1*b});for(var b=[a[0]],c=1;c<a.length;c++)a[c-1]!==a[c]&&b.push(a[c]);return b};return this.bind("resultReceived",function(){for(var f=this.result.maps,g=f.length-1;g>=0;g--){var h=f[g];MASCP.registerLayer("gelmap_map_"+h.id,{fullname:h.title,group:"gelmap_experimental",color:"#aaaaff",css:d}),MASCP.getLayer("gelmap_map_"+h.id).href=h.url;for(var i=e(f[g].peptides),j=i.length-1;j>=0;j--){var k=i[j],l=a.getAminoAcidsByPeptide(k),m="gelmap_map_"+h.id;l.addToLayer(m),l.addToLayer(c)}}jQuery(a).trigger("resultsRendered",[b])}),this},MASCP.GelMapReader.Result.prototype.render=function(){},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.InterproReader=MASCP.buildService(function(a){return a&&(this._raw_data||a.data?this._raw_data=a:(this._raw_data={data:[]},this._raw_data.data.push(a))),this}),MASCP.InterproReader.SERVICE_URL="http://gator.masc-proteomics.org/interpro.pl?",MASCP.InterproReader.prototype.requestData=function(){return{type:"GET",dataType:"json",data:{agi:this.agi,service:"interpro"}}},function(){var a=MASCP.InterproReader.prototype.retrieve;MASCP.InterproReader.prototype.retrieve=function(b,c){var d=this;this.agi||(this.agi=b);var e=arguments.callee,f=c;return null===this.sequence||"undefined"==typeof this.sequence?(new MASCP.TairReader(d.agi).bind("resultReceived",function(){d.sequence=this.result.getSequence()||"",e.call(d,d.agi,f)}).bind("error",function(a){d.trigger("error",[a])}).retrieve(),this):(a!==MASCP.Service.prototype.retrieve&&(a=MASCP.Service.prototype.retrieve),a.call(d,d.agi,f),this)}}(),MASCP.InterproReader.Result=MASCP.InterproReader.Result,MASCP.InterproReader.Result.prototype.getDomains=function(){if(!this._raw_data||0===this._raw_data.data.length)return{};if(this._peptides_by_domain)return this._peptides_by_domain;for(var a={},b={},c=this._raw_data.data,d=0;d<c.length;d++){var e=a[c[d].interpro]||[];e.push(this.sequence.substring(c[d].start,c[d].end)),b[c[d].interpro]=c[d].description,a[c[d].interpro]=e}return this._peptides_by_domain=a,a},MASCP.InterproReader.prototype.setupSequenceRenderer=function(a){var b=this;return this.bind("resultReceived",function(){this.agi;MASCP.registerGroup("interpro_domains",{fullname:"Interpro domains",color:"#000000"});var c="interpro_controller",d=".active .overlay { background: #000000; } .active a { color: #000000; text-decoration: none !important; }  :indeterminate { background: #ff0000; } .tracks .active { background: #0000ff; } .inactive a { text-decoration: none; } .inactive { display: none; }";MASCP.registerLayer(c,{fullname:"Interpro domains",color:"#000000",css:d}),MASCP.getLayer("interpro_controller").href="",this.result.sequence=a.sequence;var e=this.result.getDomains();for(var f in e)if(e.hasOwnProperty(f)){var g=null;g=f;var h=MASCP.registerLayer("interpro_domain_"+g,{fullname:g,group:"interpro_domains",color:"#000000",css:d});h.href="http://www.ebi.ac.uk/interpro/IEntry?ac="+g;for(var i=e[g],j=0;j<i.length;j++){var k=a.getAminoAcidsByPeptide(i[j]),l="interpro_domain_"+g;k.addToLayer(l),k.addToLayer(c)}}a.createGroupController&&a.createGroupController("interpro_controller","interpro_domains"),jQuery(a).trigger("resultsRendered",[b])}),this},MASCP.InterproReader.Result.prototype.render=function(){},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.P3dbReader=MASCP.buildService(function(a){return this._raw_data=a,this}),MASCP.P3dbReader.SERVICE_URL="http://p3db.org/gator.php?",MASCP.P3dbReader.prototype.requestData=function(){var a=this.agi.toLowerCase();return{type:"GET",dataType:"json",data:{agi:a,service:"p3db"}}},MASCP.P3dbReader.Result=MASCP.P3dbReader.Result,MASCP.P3dbReader.Result.prototype.getPeptides=function(){if(this._peptides)return this._peptides;if(this._long_name_map={},!this._raw_data||!this._raw_data.peptides)return[];for(var a=[],b=0;b<this._raw_data.peptides.length;b++){var c=this._raw_data.peptides[b],d={sequence:this._cleanSequence(c)};a.push(d)}return this._peptides=a,a},MASCP.P3dbReader.Result.prototype.getOrthologousPeptides=function(a){var b=this;if(!this._raw_data.orthologs)return[];var c=[];return this._raw_data.orthologs.forEach(function(d){if(d.organism===a&&d.peptides)for(var e=0;e<d.peptides.length;e++){var f=d.peptides[e],g={sequence:b._cleanSequence(f)};c.push(g)}}),c},MASCP.P3dbReader.Result.prototype.getOrganisms=function(){if(!this._raw_data.orthologs)return[];var a=[];return this._raw_data.orthologs.forEach(function(b){a.push({id:b.organism,name:b.name})}),a},MASCP.P3dbReader.Result.prototype._cleanSequence=function(a){return a.replace(/[^A-Z]/g,"")},MASCP.P3dbReader.prototype.setupSequenceRenderer=function(a){var b=this,c="#5533ff";return MASCP.registerGroup("p3db_experimental",{fullname:"P3DB (mod)",color:c}),this.bind("resultReceived",function(){var d=this.result,e=d.getPeptides();e.length>0&&MASCP.registerLayer("p3db_controller",{fullname:"P3DB (mod)",color:c});for(var f=0;f<e.length;f++){var g=e[f].sequence,h=a.getAminoAcidsByPeptide(g);h.addToLayer("p3db_controller")}d.getOrganisms().forEach(function(b){if(3702!==b.id){var e="p3db_tax_"+b.id,f=d.getOrthologousPeptides(b.id);f.length>0&&MASCP.registerLayer(e,{fullname:b.name,group:"p3db_experimental",color:c});for(var g=0;g<f.length;g++){var h=f[g].sequence,i=a.getAminoAcidsByPeptide(h);i.addToLayer(e)}}}),a.createGroupController&&a.createGroupController("p3db_controller","p3db_experimental"),jQuery(a).trigger("resultsRendered",[b])}),this},MASCP.P3dbReader.Result.prototype.render=function(){},MASCP.Pep2ProReader=MASCP.buildService(function(a){return this._raw_data=a,a&&(this._populate_spectra(a),this._populate_peptides(a)),this}),MASCP.Pep2ProReader.prototype.requestData=function(){var a=this.agi;return{type:"GET",dataType:"json",data:{agi:a,service:"pep2pro"}}},MASCP.Pep2ProReader.SERVICE_URL="http://fgcz-pep2pro.uzh.ch/mascp_gator.php?",MASCP.Pep2ProReader.Result=MASCP.Pep2ProReader.Result,MASCP.Pep2ProReader.Result.prototype.tissues=function(){return this._tissues},MASCP.Pep2ProReader.Result.prototype.getPeptides=function(){return this._peptides},MASCP.Pep2ProReader.Result.prototype=MASCP.extend(MASCP.Pep2ProReader.Result.prototype,{spectra:null,peptide_counts_by_tissue:null,sequence:null}),MASCP.Pep2ProReader.Result.prototype._populate_spectra=function(a){if(this.spectra={},this._tissues=[],this._long_name_map={},a&&a.tissues)for(var b=0;b<a.tissues.length;b++)this._tissues[b]=a.tissues[b]["PO:tissue"]||{},this._tissues[b].long_name=a.tissues[b].tissue,this._long_name_map[this._tissues[b]]=a.tissues[b].tissue,this.spectra[a.tissues[b]["PO:tissue"]]=parseInt(a.tissues[b].qty_spectra,10)},MASCP.Pep2ProReader.Result.prototype._populate_peptides=function(a){if(this.peptide_counts_by_tissue={},a&&a.peptides){this.sequence=a.sequence,this._peptides=[];for(var b=0;b<a.peptides.length;b++){var c=a.peptides[b];this._peptides.push(c.sequence);for(var d=c.position+"-"+(parseInt(c.position,10)+parseInt(c.sequence.length,10)),e=0;e<c.tissues.length;e++){var f=c.tissues[e];this.peptide_counts_by_tissue[f["PO:tissue"]]||(this.peptide_counts_by_tissue[f["PO:tissue"]]={}),this.peptide_counts_by_tissue[f["PO:tissue"]][d]=parseInt(f.qty_spectra,10)}}}},MASCP.Pep2ProReader.Result.prototype.render=function(){var a=jQuery.param(this.reader.requestData().data),b=0;for(var c in this.spectra)this.spectra.hasOwnProperty(c)&&(b+=parseInt(this.spectra[c],10));var d=jQuery('<div>MS/MS spectra <input type="checkbox" class="group_toggle"/><a style="display: block; float: right;" href="http://fgcz-pep2pro.unizh.ch/index.php?'+a+'">Pep2Pro</a></div>');return jQuery(this.reader.renderers).each(function(a){this.createGroupCheckbox("pep2pro",jQuery("input.group_toggle",d))}),d},MASCP.Pep2ProReader.prototype._rendererRunner=function(a){for(var b=this.result?this.result.tissues():[],c=b.length-1;c>=0;c--){var d=b[c];if(!(this.result.spectra[d]<1)){var e=this.result.peptide_counts_by_tissue[d],f="pep2pro_by_tissue_"+d,g=" .overlay { display: none; } .tracks .active { fill: #000099; } .inactive { display: none; } .active .overlay { display: block; top: 0px; background: #000099; } ";MASCP.registerLayer(f,{fullname:this.result._long_name_map[d],group:"pep2pro",color:"#000099",css:g,data:{po:d,count:e}});for(var h=this._normalise(this._mergeCounts(e)),i=1,j=null;i<=h.length;)null!==j&&("undefined"!=typeof h[i]&&i!=h.length||(a.getAminoAcidsByPosition([j])[0].addBoxOverlay(f,i-1-j),j=null)),h[i]>0&&null===j&&(j=i),i+=1}}},MASCP.Pep2ProReader.prototype._groupSummary=function(a){var b=this.result?this.result.tissues():[],c=[],d=function(){var a=[];for(var b in this)this.hasOwnProperty(b)&&a.push(b);return a.sort().join(",")};for(var e in b)if(b.hasOwnProperty(e)){var f=b[e];if(this.result.spectra[f]<1)continue;for(var g=this._mergeCounts(this.result.peptide_counts_by_tissue[f]),h=0;h<g.length;h++)g[h]>0&&(c[h]||(c[h]={},c[h].tissue=d),c[h][f]=!0)}var i=0,j=null,k=null,l="pep2pro_controller",m=" .overlay { display: none; } .tracks .active { fill: #000099; } .inactive { display: none; } .active .overlay { display: block; top: 0px; background: #000099; } ";MASCP.registerLayer(l,{fullname:"Pep2Pro MS/MS",color:"#000099",css:m});var n=this.result.agi,o=n.replace(/\.\d/,"");for(MASCP.getLayer("pep2pro_controller").href="http://fgcz-pep2pro.uzh.ch/locus.php?"+o;i<=c.length;)if(i<=0)i+=1;else{if((!c[i]||c[i].tissue()!=k||i==c.length)&&null!==j){var p=i-j;c[i]||(p-=1),a.getAminoAcidsByPosition([j])[0].addBoxOverlay(l,p),j=null}c[i]&&null===j&&(k=c[i].tissue(),j=i),i+=1}a.createGroupController&&a.createGroupController("pep2pro_controller","pep2pro")},MASCP.Pep2ProReader.prototype.setupSequenceRenderer=function(a){var b=this;return this.bind("resultReceived",function(){return MASCP.registerGroup("pep2pro",{fullname:"Pep2Pro data",hide_member_controllers:!0,hide_group_controller:!0,color:"#000099"}),a.sequence!=this.result.sequence&&""!=this.result.sequence?(jQuery(a).bind("sequenceChange",function(){jQuery(a).unbind("sequenceChange",arguments.callee),b._groupSummary(a),b._rendererRunner(a),jQuery(a).trigger("resultsRendered",[b])}),void a.setSequence(this.result.sequence)):(b._groupSummary(a),b._rendererRunner(a),jQuery(a).trigger("resultsRendered",[b]),void 0)}),this},MASCP.Pep2ProReader.prototype._normalise=function(a){var b=0,c=0;for(c=0;c<a.length;c++)a[c]&&a[c]>b&&(b=a[c]);for(c=0;c<a.length;c++)a[c]&&a[c]>0&&(a[c]=1*a[c]/b);return a},MASCP.Pep2ProReader.prototype._mergeCounts=function(a){var b=[];for(var c in a)if(a.hasOwnProperty(c))for(var d=c.split("-"),e=parseInt(d[0],10),f=parseInt(d[1],10),g=e;g<=f;g++)b[g]||(b[g]=0),b[g]+=a[c];return b},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.PhosphatReader=MASCP.buildService(function(a){if(a&&a.result&&!this._sequence)for(var b=0;b<a.result.length;b++)if("Imported protein - no info"==a.result[b].prot_sequence){var c=a.result[b].code;c=c.replace(/\s+$/,""),this._sequence=MASCP.getSequence(c);break}return a&&a.experimental&&a.relatives&&a.predicted?(this._raw_data=a,this):(a&&"getPredictedAa"==a.request_method&&(this._raw_data||(this._raw_data={}),this._raw_data.predicted=a),a&&"getExperimentsModAa"==a.request_method&&(this._raw_data||(this._raw_data={}),this._raw_data.experimental=a),a&&"getRelatives"==a.request_method&&(this._raw_data||(this._raw_data={}),this._raw_data.relatives=a),this)}),MASCP.PhosphatReader.SERVICE_URL="http://gator.masc-proteomics.org/proxy.pl?",MASCP.PhosphatReader.prototype.requestData=function(){var a=[null,this.agi];this.method||this._methods||(this._methods=["getPredictedAa","getExperimentsModAa","getRelatives"]),this.combine&&(this._methods=[]);var b=this._methods[0];return"getRelatives"==b&&(a=[this.agi]),{type:"POST",dataType:"json",data:{id:1,method:b,agi:this.agi,params:encodeURI(a.toJSON?a.toJSON():JSON.stringify(a)),service:"phosphat"}}},function(a){var b=a.prototype._dataReceived;a.prototype._dataReceived=function(a,c){if(null===a)return b.call(this,null,c);a.request_method=this._methods?this._methods[0]:null,this._methods&&this._methods.shift(),a.error&&0===a.error.indexOf("SELECT")&&(a.error=null);var d=b.call(this,a,c);return this.result&&this.result._raw_data&&this.result._raw_data.experimental&&this.result._raw_data.relatives&&this.result._raw_data.predicted?(this._methods=null,d):(d&&this.retrieve(),!1)}}(MASCP.PhosphatReader),MASCP.PhosphatReader.Result=MASCP.PhosphatReader.Result,MASCP.PhosphatReader.Result.prototype.getAllPredictedPositions=function(){var a=[],b=this._raw_data.predicted.result;for(var c in b)if(b.hasOwnProperty(c)){var d=this._raw_data.predicted.result[c];d.prd_score>0&&a.push(d.prd_position)}return a},MASCP.PhosphatReader.Result.prototype.getAllExperimentalPositions=function(){var a={},b=this._raw_data.experimental.result;for(var c in b)if(b.hasOwnProperty(c)){var d=this._raw_data.experimental.result[c],e=d.pep_sequence||"";if(e=e.replace(/[^A-Z]/g,""),"phos"!=d.modificationType)continue;var f=this._sequence||d.prot_sequence,g=f.indexOf(e);if(g<0)continue;g+=d.position,a[g]=1}var h=[];for(var i in a)a.hasOwnProperty(i)&&h.push(parseInt(i,10));return h},MASCP.PhosphatReader.Result.prototype.getAllExperimentalPhosphoPeptides=function(){var a={},b=this._raw_data.experimental.result;for(var c in b)if(b.hasOwnProperty(c)){var d=this._raw_data.experimental.result[c],e=d.pep_sequence||"";if(e=e.replace(/[^A-Z]/g,""),"phos"!=d.modificationType)continue;var f=this._sequence||d.prot_sequence,g=f.indexOf(e);if(g>=0){var h=""+g+"-"+e.length;a[h]=a[h]||[g,e.length],a[h].indexOf(d.position+g,2)<=0&&a[h].push(d.position+g)}}var i=[];for(var j in a)a.hasOwnProperty(j)&&i.push(a[j]);return i},MASCP.PhosphatReader.Result.prototype.getSpectra=function(){if(!this._raw_data.relatives||!this._raw_data.relatives.result)return{};for(var a={},b=this._raw_data.relatives.result,c=0;c<b.length;c++){var d=b[c].Tissue;a[d]||(a[d]=0),a[d]+=1}return a},MASCP.PhosphatReader.Result.prototype.render=function(){return null},MASCP.PhosphatReader.prototype.setupSequenceRenderer=function(a){var b=this;return this.bind("resultReceived",function(){var c=[],d=this.result.getAllExperimentalPhosphoPeptides();return 0===d.length?void jQuery(a).trigger("resultsRendered",[b]):(MASCP.registerLayer("phosphat_experimental",{fullname:"PhosPhAt (mod)",color:"#000000",css:".active { background: #999999; color: #000000; font-weight: bolder; } .tracks .active { background: #000000; fill: #000000; } .inactive { display: none; }"}),MASCP.registerGroup("phosphat_peptides",{fullname:"PhosPhAt peptides"}),a.createGroupController&&a.createGroupController("phosphat_experimental","phosphat_peptides"),jQuery(d).each(function(b){MASCP.registerLayer("phosphat_peptide_"+b,{fullname:"PhosPhAt MS/MS",group:"phosphat_peptides",color:"#000000",css:".active { background: #999999; color: #000000; } .tracks .active { background: #000000; fill: #000000; } .inactive { display: none; }"});var d=this.shift(),e=this.shift(),f=a.getAminoAcidsByPosition([d+1])[0];f&&(f.addBoxOverlay("phosphat_peptide_"+b,e,.5),c.push(f.addBoxOverlay("phosphat_experimental",e,.5))),jQuery(a.getAminoAcidsByPosition(this)).each(function(){this.addToLayer("phosphat_peptide_"+b),c=c.concat(this.addToLayer("phosphat_experimental"))})}),jQuery(MASCP.getGroup("phosphat_peptides")).bind("visibilityChange",function(b,d,e){d==a&&c.forEach(function(a){a.style||a.setAttribute("style",""),a.style.display=e?"none":"inline"})}),MASCP.getLayer("phosphat_experimental")&&(MASCP.getLayer("phosphat_experimental").href="http://phosphat.mpimp-golm.mpg.de/app.html?agi="+this.result.agi),void jQuery(a).trigger("resultsRendered",[b]))}),this},MASCP.PpdbReader=MASCP.buildService(function(a){if(!a)return this;var b=function(){for(var a=this._raw_data.getElementsByTagName("FEATURE"),b=[],c={},d={},e=0;e<a.length;e++){var f=a[e].getElementsByTagName("TYPE")[0],g=f.textContent||f.text||f.nodeValue;if("Peptide"==g){var h=a[e].getAttribute("label");c[h]||(c[h]={experiments:[]});var i=parseInt(a[e].getElementsByTagName("GROUP")[0].getAttribute("id"),10);c[h].experiments.push(i),d[i]=!0}}for(var j in c)if(c.hasOwnProperty(j)){var k={sequence:j,experiments:c[j].experiments};b.push(k)}this._experiments=[];for(var l in d)d.hasOwnProperty(l)&&this._experiments.push(parseInt(l,10));return b};if(this._raw_data=a,a.getElementsByTagName){var c=b.call(this);this._raw_data={experiments:this._experiments,peptides:c}}return this._experiments=this._raw_data.experiments,this._peptides=this._raw_data.peptides,this}),MASCP.PpdbReader.prototype.requestData=function(){var a=(this.agi+"").replace(/\..*$/,""),b="json";return(this._endpointURL||"").indexOf("xml")>=0&&(b="xml"),{type:"GET",dataType:b,data:{segment:a,agi:this.agi,service:"ppdb"}}},MASCP.PpdbReader.SERVICE_URL="http://ppdb.tc.cornell.edu/das/arabidopsis/features/?output=xml",MASCP.PpdbReader.Result=MASCP.PpdbReader.Result,MASCP.PpdbReader.Result.prototype=MASCP.extend(MASCP.PpdbReader.Result.prototype,{spectra:null,peptide_counts_by_tissue:null,sequence:null}),MASCP.PpdbReader.Result.prototype.render=function(){return null},MASCP.PpdbReader.Result.prototype.getExperiments=function(){return this._experiments||[]},MASCP.PpdbReader.Result.prototype.getPeptides=function(){var a=this._peptides||[];return a.forEach(function(a){a.toString=function(a){return function(){return a.sequence}}(a)}),a},MASCP.PpdbReader.prototype.setupSequenceRenderer=function(a){var b=this;return this.bind("resultReceived",function(){MASCP.registerGroup("ppdb",{fullname:"PPDB spectra data",hide_member_controllers:!0,hide_group_controller:!0,color:"#aa9900"});var c="ppdb_controller",d=".active .overlay { background: #aa9900; } .active a { color: #000000; text-decoration: none !important; }  :indeterminate { background: #ff0000; } .tracks .active { background: #0000ff; } .inactive a { text-decoration: none; } .inactive { display: none; }";MASCP.registerLayer(c,{fullname:"PPDB MS/MS",color:"#aa9900",css:d}),a.createGroupController&&a.createGroupController("ppdb_controller","ppdb");for(var e=this.result.getPeptides(),f=this.result.getExperiments(),g=0;g<f.length;g++){var h="ppdb_experiment"+f[g];MASCP.registerLayer(h,{fullname:"Experiment "+f[g],group:"ppdb",color:"#aa9900",css:d}),MASCP.getLayer(h).href="http://ppdb.tc.cornell.edu/dbsearch/searchsample.aspx?exprid="+f[g];for(var i=0;i<e.length;i++){var j=e[i];if(!(e[i].experiments.indexOf(f[g])<0)){var k=a.getAminoAcidsByPeptide(j.sequence);k.addToLayer(h),k.addToLayer(c)}}}jQuery(a).trigger("resultsRendered",[b])}),this},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.ProcessingReader=MASCP.buildService(function(a){return this._raw_data=a,this}),MASCP.ProcessingReader.SERVICE_URL="?",MASCP.ProcessingReader.prototype.requestData=function(){var a=this.agi;return{type:"GET",dataType:"json",data:{agi:a,service:"processing"}}},MASCP.ProcessingReader.Result=MASCP.ProcessingReader.Result,MASCP.ProcessingReader.Result.prototype.getProcessing=function(){return this._raw_data&&this._raw_data.data&&this._raw_data.data.processing?this._raw_data.data.processing:[]},MASCP.ProcessingReader.Result.prototype._cleanSequence=function(a){return a.replace(/[^A-Z]/g,"")},MASCP.ProcessingReader.prototype.setupSequenceRenderer=function(a){var b=this,c=".active .overlay { background: #666666; } .active a { color: #000000; text-decoration: none !important; }  :indeterminate { background: #ff0000; } .tracks .active { background: #0000ff; } .inactive a { text-decoration: none; } .inactive { display: none; }";return this.bind("resultReceived",function(){var d=this.result.getProcessing(),e=a.sequence.indexOf(d);if(!(e<0)){MASCP.registerLayer("processing",{fullname:"N-Terminal (mod)",color:"#ffEEEE",css:c});var f=a.getAA(e+1+d.length);f&&f.addAnnotation("processing",1,{border:"rgb(150,0,0)",content:"Mat",angle:0}),jQuery(a).trigger("resultsRendered",[b])}}),this},MASCP.ProcessingReader.Result.prototype.render=function(){},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.PromexReader=MASCP.buildService(function(a){return this._raw_data=a,this}),MASCP.PromexReader.SERVICE_URL="http://131.130.57.242/json/?",MASCP.PromexReader.prototype.requestData=function(){var a=(this.agi+"").replace(/\..*$/,"");return{type:"GET",dataType:"json",data:{agi:this.agi,ac:a,service:"promex"}}},MASCP.PromexReader.Result=MASCP.PromexReader.Result,MASCP.PromexReader.Result.prototype.getPeptides=function(){if(!this._raw_data||!this._raw_data.peptides)return[];for(var a=[],b=0;b<this._raw_data.peptides.length;b++)a.push(this._cleanSequence(this._raw_data.peptides[b].sequence));return a},MASCP.PromexReader.Result.prototype._cleanSequence=function(a){return a.replace(/[^A-Z]/g,"")},MASCP.PromexReader.prototype.setupSequenceRenderer=function(a){var b=this;MASCP.registerGroup("promex_experimental",{fullname:"ProMex spectra data",hide_member_controllers:!0,hide_group_controller:!0,color:"#ff9900"});var c="promex_controller",d=".active .overlay { background: #ff9900; } .active a { color: #000000; text-decoration: none !important; }  :indeterminate { background: #ff0000; } .tracks .active { background: #0000ff; } .inactive a { text-decoration: none; } .inactive { display: none; }";return MASCP.registerLayer(c,{fullname:"ProMEX MS/MS",color:"#ff9900",css:d}),this.bind("resultReceived",function(){var e=(this.result.agi+"").replace(/\..*$/,"");MASCP.getLayer("promex_controller").href="http://promex.pph.univie.ac.at/promex/?ac="+e;for(var f=this.result.getPeptides(),g=0;g<f.length;g++){MASCP.registerLayer("promex_experimental_spectrum_"+g,{fullname:"Spectrum",group:"promex_experimental",color:"#ff9900",css:d});var h=f[g],i=a.getAminoAcidsByPeptide(h);if(i&&0!==i.length){var j="promex_experimental_spectrum_"+g;i.addToLayer(j),i.addToLayer(c)}}jQuery(a).trigger("resultsRendered",[b]),a.createGroupController&&a.createGroupController("promex_controller","promex_experimental")}),this},MASCP.PromexReader.Result.prototype.render=function(){},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.RippdbReader=MASCP.buildService(function(a){return this._raw_data=a,this}),MASCP.RippdbReader.SERVICE_URL="http://gator.masc-proteomics.org/rippdb.pl?",MASCP.RippdbReader.prototype.requestData=function(){var a=this.agi;return{type:"GET",dataType:"json",data:{agi:a,service:"rippdb"}}},MASCP.RippdbReader.Result=MASCP.RippdbReader.Result,MASCP.RippdbReader.Result.prototype.getSpectra=function(){return this._spectra?this._spectra:this._raw_data&&this._raw_data.spectra?(this._spectra=this._raw_data.spectra,this._spectra):[]},MASCP.RippdbReader.Result.prototype._cleanSequence=function(a){return a.replace(/[^A-Z]/g,"")},MASCP.RippdbReader.prototype.setupSequenceRenderer=function(a){var b=this,c=".active .overlay { background: #666666; } .active a { color: #000000; text-decoration: none !important; }  :indeterminate { background: #ff0000; } .tracks .active { background: #0000ff; } .inactive a { text-decoration: none; } .inactive { display: none; }";return this.bind("resultReceived",function(){var d=this.result.getSpectra(),e="prippdb_experimental",f=[];d.length>0&&(MASCP.registerLayer(e,{fullname:"RIPP-DB (mod)",color:"#666666",css:c}),MASCP.registerGroup("prippdb_peptides",{fullname:"Phosphorylation Rippdb",hide_member_controllers:!0,hide_group_controller:!0,color:"#666666"}),a.createGroupController&&a.createGroupController("prippdb_experimental","prippdb_peptides"),jQuery(MASCP.getGroup("prippdb_peptides")).bind("visibilityChange",function(b,c,d){c==a&&f.forEach(function(a){a.style.display=d?"none":"inline"})}));for(var g=0;g<d.length;g++){var h=d[g],i=h.peptides;if(0!==i.length){var j="prippdb_spectrum_"+h.spectrum_id;MASCP.registerLayer(j,{fullname:"Spectrum "+h.spectrum_id,group:"prippdb_peptides",color:"#666666",css:c});for(var k=0;k<i.length;k++){var l=i[k].sequence,m=a.getAminoAcidsByPeptide(l);if(0!==m.length){m.addToLayer(j),f.push(m.addToLayer("prippdb_experimental"));for(var n=0;n<i[k].positions.length;n++)f=f.concat(m[i[k].positions[n]-1].addToLayer("prippdb_experimental")),m[i[k].positions[n]-1].addToLayer(j)}}}}jQuery(a).trigger("resultsRendered",[b])}),this},MASCP.RippdbReader.Result.prototype.getAllExperimentalPositions=function(){var a=this.getSpectra(),b=[],c={};return a.forEach(function(a){var d=a.peptides;d.forEach(function(a){a.positions.forEach(function(a){c[a]||(b.push(a),c[a]=!0)})})}),b},MASCP.RippdbReader.Result.prototype.render=function(){},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.SnpReader=MASCP.buildService(function(a){return this._raw_data=a||{},this}),MASCP.SnpReader.SERVICE_URL="http://gator.masc-proteomics.org/snps.pl?",MASCP.SnpReader.prototype.requestData=function(){return{type:"GET",dataType:"json",data:{agi:this.agi,service:"nssnps"}}},MASCP.SnpReader.prototype.showSnp=function(a,b){var c=this.result.getSnp(b);if(!(c.length<1)){var d,e="all"+b,f=[],g=[];for(d=c.length-1;d>=0;d--)g.push({index:c[d][0],delta:c[d][1]}),f.push({insertBefore:c[d][0]+1,delta:c[d][2]});for(d=f.length-1;d>=0;d--)a.getAA(f[d].insertBefore-1).addAnnotation(e,1,{border:"rgb(150,0,0)",content:f[d].delta})}},MASCP.SnpReader.ALL_ACCESSIONS=["AGU","BAK2","BAY","BUR0","CDM0","COL0","DEL10","DOG4","DON0","EY152","FEI0","HKT24","ICE1","ICE102","ICE104","ICE106","ICE107","ICE111","ICE112","ICE119","ICE120","ICE127","ICE130","ICE134","ICE138","ICE150","ICE152","ICE153","ICE163","ICE169","ICE173","ICE181","ICE21","ICE212","ICE213","ICE216","ICE226","ICE228","ICE29","ICE33","ICE36","ICE49","ICE50","ICE60","ICE61","ICE63","ICE7","ICE70","ICE71","ICE72","ICE73","ICE75","ICE79","ICE91","ICE92","ICE93","ICE97","ICE98","ISTISU1","KASTEL1","KOCH1","KRO0","LAG22","LEO1","LER1","LERIK13","MER6","NEMRUT1","NIE12","PED0","PRA6","QUI0","RI0","RUE3131","SHA","STAR8","TUESB303","TUESCHA9","TUEV13","TUEWA12","VASH1","VIE0","WALHAESB4","XAN1"],MASCP.SnpReader.prototype.setupSequenceRenderer=function(a){var b=this;b.bind("resultReceived",function(){var c=b.result;MASCP.registerGroup("insertions"),MASCP.registerGroup("deletions"),a.withoutRefresh(function(){for(var d,e=c.getAccessions();e.length>0;){var f=e.shift(),g=f,h=c.getSnp(f);if(!(h.length<1)){d||(d=a.registerLayer("insertions_controller",{fullname:"nsSNPs",color:"#ff0000"}));var i="all"+f,j=f.indexOf("_")>=0?f.split("_")[0].toUpperCase():null;["SALK","MPICAO","GMI","MPISCHNEE","MPICOLLAB","JGI"].indexOf(j)<0?j=null:(j.match(/^MPI/)&&(j="MPI"),g=f.replace(/^[^_]+_/,""));var k=[],l=[];j&&(MASCP.registerGroup(j,{group:"insertions"}),a.registerLayer(j+"_controller",{fullname:j,group:"insertions",color:"#ff0000"}),a.createGroupController&&j&&a.createGroupController(j+"_controller",j));var m=a.registerLayer(i,{fullname:g,group:j||"insertions"});!function(a){return function(){var c=!1,d=i;m.href=function(e){return c="boolean"==typeof e?e:!c,c?(MASCP.getLayer(d).icon="#minus_icon",b.showSnp(MASCP.renderer,a)):(MASCP.getLayer(d).icon="#plus_icon",MASCP.renderer.removeAnnotations(d),MASCP.renderer.redrawAnnotations()),MASCP.renderer.refresh(),!1}}}(f)(),MASCP.getLayer(i).icon=null;var n;for(n=h.length-1;n>=0;n--)l.push({index:h[n][0]+1,delta:h[n][1]}),k.push({insertBefore:h[n][0]+1,delta:h[n][2]});for(n=k.length-1;n>=0;n--){var o=k[n].insertBefore-1;o>a.sequence.length&&(o=a.sequence.length);var p=a.getAA(o).addAnnotation("insertions_controller",1,{border:"rgb(150,0,0)",content:k[n].delta,angle:"auto"});p._click||(p.addEventListener("click",function(c){var d=!1;return function(){d=!d,a.withoutRefresh(function(){b.result.getSnpsForPosition(c).forEach(function(a){b.showSnp(MASCP.renderer,a),MASCP.getLayer("all"+a).href(d)})}),a.refresh()}}(o),!1),p.style.cursor="pointer",p._click=!0)}}}MASCP.getGroup("insertions").size()>0&&a.createGroupController&&a.createGroupController("insertions_controller","insertions")}),a.redrawAnnotations("insertions_controller"),jQuery(a).trigger("resultsRendered",[b])})},MASCP.SnpReader.Result.prototype.getAccessions=function(){var a=this._raw_data.data,b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},MASCP.SnpReader.Result.prototype.getSnp=function(a){var b=this._raw_data.data[a],c=[];for(var d in b)if(b.hasOwnProperty(d)){var e=parseInt(d,10)+1,f=b[d],g=[e,f.charAt(0),f.charAt(1)];c.push(g)}return c},MASCP.SnpReader.Result.prototype.getSnpsForPosition=function(a){var b=this;if(this._cached=this._cached||{},this._cached[a])return this._cached[a];var c=[];return this.getAccessions().forEach(function(d){b.getSnp(d).forEach(function(b){if(b[0]==a)return void c.push(d)})}),this._cached[a]=c,c},MASCP.cloneService(MASCP.SnpReader,"RnaEditReader"),MASCP.RnaEditReader.SERVICE_URL="?",MASCP.RnaEditReader.prototype.requestData=function(){return{type:"GET",dataType:"json",data:{agi:this.agi,service:"rnaedit"}}},MASCP.RnaEditReader.prototype.setupSequenceRenderer=function(a){var b=this;b.bind("resultReceived",function(){var c=b.result;a.withoutRefresh(function(){for(var b=c.getAccessions();b.length>0;){var d=b.shift(),e=c.getSnp(d);if(!(e.length<1)){var f="rnaedit",g=[],h=[];a.registerLayer(f,{fullname:"RNA Edit (mod)"});MASCP.getLayer(f).icon=null;var i;for(i=e.length-1;i>=0;i--)h.push({index:e[i][0]+1,delta:e[i][1]}),g.push({insertBefore:e[i][0]+1,delta:e[i][2]});for(i=g.length-1;i>=0;i--){var j=g[i].insertBefore-1;j>a.sequence.length&&(j=a.sequence.length),a.getAA(j).addAnnotation("rnaedit",1,{border:"rgb(150,0,0)",content:g[i].delta,angle:"auto"})}}}}),jQuery(a).trigger("resultsRendered",[b])})},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.SubaReader=MASCP.buildService(function(a){return this._raw_data=a,this}),MASCP.SubaReader.SERVICE_URL="http://suba.plantenergy.uwa.edu.au/services/byAGI.php?",MASCP.SubaReader.prototype.requestData=function(){return{type:"GET",dataType:"json",data:{agi:this.agi,service:"suba"}}},MASCP.SubaReader.Result=MASCP.SubaReader.Result,MASCP.SUBA_FIELDS={location_gfp:null,location_ipsort:null,location_loctree:null,location_mitopred:null,location_mitoprot2:null,location_ms:null,location_multiloc:null,location_preoxp:null,location_predotar:null,location_subloc:null,location_swissprot:null,location_targetp:null,location_wolfpsort:null},MASCP.SubaReader.Result.prototype._getLocalisation=function(a){
for(var b={},c=!1,d=0;d<this._raw_data.observed.length;d++){var e=this._raw_data.observed[d];e[2]==a&&(b[e[0]]||(b[e[0]]=[]),b[e[0]].push(e[1]),c=!0)}return c?b:null},MASCP.SubaReader.Result.prototype._parseLocalisation=function(a){if(null===a||0===a.length)return null;var b,c=a.split(";"),d={};for(b=c.length-1;b>=0;b--){var e=c[b].split(":");d[e[0]]=d[e[0]]||[],d[e[0]].push(e[1])}return d},MASCP.SubaReader.Result.prototype._sortLocalisation=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b=b.sort(function(b,c){return a[b].length-a[c].length})},MASCP.SubaReader.Result.prototype.getMassSpecLocalisation=function(){return this._getLocalisation("ms")},MASCP.SubaReader.Result.prototype.getGfpLocalisation=function(){return this._getLocalisation("gfp")},MASCP.SubaReader.Result.prototype.getWinnerTakesAllGfp=function(){var a,b=this.getGfpLocalisation(),c=this._sortLocalisation(b),d=[],e=-1;for(a=c.length-1;a>=0;a--)if(e&&b[c[a]]==e)d.push(c[a]);else{if(!(e<0))break;e=b[c[a]],d.push(c[a])}for(d._values=[],a=d.length-1;a>=0;a--)d._values.push(b[d[a]].length);return d},MASCP.SubaReader.Result.prototype.getWinnerTakesAllMassSpec=function(){var a,b=this.getMassSpecLocalisation(),c=this._sortLocalisation(b),d=[],e=-1;for(a=c.length-1;a>=0;a--)if(e&&b[c[a]]==e)d.push(c[a]);else{if(!(e<0))break;e=b[c[a]],d.push(c[a])}for(d._values=[],a=d.length-1;a>=0;a--)d._values.push(b[d[a]].length);return d},MASCP.SubaReader.Result.prototype.getPredictedLocalisations=function(){for(var a={},b=0;b<this._raw_data.predicted.length;b++)a[this._raw_data.predicted[b][0]]||(a[this._raw_data.predicted[b][0]]=[]),a[this._raw_data.predicted[b][0]].push(this._raw_data.predicted[b][1]);return a},MASCP.SubaReader.Result.prototype.mapController=function(a){if(!this._map)return null;var b=this._map;if(a=a?jQuery(a):jQuery('<ul><li class="ms"><div style="position: relative; left: 0px; top: 0px; float: left; background-color: #ff0000; width: 1em; height: 1em;"></div><input class="ms" type="checkbox"/> MS</li><li class="gfp"><div style="position: relative; left: 0px; top: 0px; float: left; background-color: #00ff00; width: 1em; height: 1em;"></div><input class="gfp" type="checkbox"/> GFP</li></ul>'),this.getMassSpecLocalisation()){var c=this._sortLocalisation(this.getMassSpecLocalisation());jQuery("input.ms",a).unbind("change").bind("change",function(){var a;for(a=c.length-1;a>=0;a--)this.checked?b.showKeyword(c[a],"#ff0000"):b.hideKeyword(c[a],"#ff0000")}).attr("checked",c.length>0)}else jQuery("li.ms",a).css({display:"none"});if(this.getGfpLocalisation()){var d=this._sortLocalisation(this.getGfpLocalisation());jQuery("input.gfp",a).unbind("change").bind("change",function(){var a;for(a=d.length-1;a>=0;a--)this.checked?b.showKeyword(d[a],"#00ff00"):b.hideKeyword(d[a],"#00ff00")}).attr("checked",d.length>0)}else jQuery("li.gfp",a).css({display:"none"});return a[0]},MASCP.SubaReader.Result.prototype.render=function(){return null},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.TairReader=MASCP.buildService(function(a){return this._data=a||{},this._data.data||(this._data={data:["",""]}),this}),MASCP.TairReader.SERVICE_URL="http://gator.masc-proteomics.org/tair.pl?",MASCP.TairReader.prototype.requestData=function(){return{type:"GET",dataType:"json",data:{agi:this.agi,service:"tair"}}},MASCP.TairReader.Result.prototype.getDescription=function(){return this._data.data[1]},MASCP.TairReader.Result.prototype.getSequence=function(){return this._data.data[2]},MASCP.getSequence=function(a){var b=arguments.callee;return b._reader||(b._reader=new MASCP.TairReader,b._reader.async=!1),b._reader.result=null,b._reader.agi=a,b._reader.retrieve(),b._reader.result?b._reader.result.getSequence():""},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.UbiquitinReader=MASCP.buildService(function(a){return this._raw_data=a,this}),MASCP.UbiquitinReader.SERVICE_URL="?",MASCP.UbiquitinReader.prototype.requestData=function(){var a=this.agi;return{type:"GET",dataType:"json",data:{agi:a,service:"ubiquitin"}}},MASCP.UbiquitinReader.Result=MASCP.UbiquitinReader.Result,MASCP.UbiquitinReader.Result.prototype.getPeptides=function(){return this._raw_data&&this._raw_data.data&&this._raw_data.data.peptides?this._raw_data.data.peptides:[]},MASCP.UbiquitinReader.Result.prototype._cleanSequence=function(a){return a.replace(/[^A-Z]/g,"")},MASCP.UbiquitinReader.prototype.setupSequenceRenderer=function(a){var b=this,c=".active .overlay { background: #666666; } .active a { color: #000000; text-decoration: none !important; }  :indeterminate { background: #ff0000; } .tracks .active { background: #0000ff; } .inactive a { text-decoration: none; } .inactive { display: none; }";return this.bind("resultReceived",function(){var d=this.result.getPeptides(),e="ubiquitin_experimental",f="ubiquitin_peptides",g=[];d.length>0&&(MASCP.registerLayer(e,{fullname:"UBQ (mod)",color:"#666666",css:c}),MASCP.registerGroup(f,{fullname:"UBQ",hide_member_controllers:!0,hide_group_controller:!0,color:"#666666"}),a.createGroupController&&a.createGroupController(e,f),jQuery(MASCP.getGroup(f)).bind("visibilityChange",function(b,c,d){c==a&&g.forEach(function(a){a.style.display=d?"none":"inline"})}));for(var h=0;h<d.length;h++){var i="ubiquitin_peptide_"+h;MASCP.registerLayer(i,{fullname:"Peptide",group:f,color:"#666666",css:c});var j=d[h].sequence,k=a.getAminoAcidsByPeptide(j);if(0!==k.length){k.addToLayer(i),g.push(k.addToLayer(i));for(var l=0;l<d[h].positions.length;l++)g=g.concat(k[d[h].positions[l]-1].addToLayer(e)),k[d[h].positions[l]-1].addToLayer(i)}}jQuery(a).trigger("resultsRendered",[b])}),this},MASCP.UbiquitinReader.Result.prototype.getAllExperimentalPositions=function(){var a=this.getPeptides(),b=[],c={};return a.forEach(function(a){a.positions.forEach(function(a){c[a]||(b.push(a),c[a]=!0)})}),b},MASCP.UbiquitinReader.Result.prototype.render=function(){},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.UserdataReader=MASCP.buildService(function(a){return a?(this.data=a?a.data:a,function(b){b.getPeptides=function(){return a.data}}(this),this):this}),MASCP.UserdataReader.prototype.toString=function(){return"MASCP.UserdataReader."+this.datasetname},MASCP.UserdataReader.prototype.setupSequenceRenderer=function(a){var b=this,c=function(a){return"[object Array]"==Object.prototype.toString.call(a)};b.bind("resultReceived",function(){for(var d=[].concat(this.result.data);d.length>0;){var e=d.shift();if(e){MASCP.registerLayer(b.datasetname,{fullname:b.datasetname,color:"#00ff00"});var f=function(){return function(c){a.getAminoAcidsByPeptide(c).addToLayer(b.datasetname)}}();c(e)&&!c(e[0])?f=function(){return function(c){var d=parseInt(c[0],10),e=parseInt(c[1],10);isNaN(d)||isNaN(e)?c.forEach(function(c){a.getAminoAcidsByPeptide(c).addToLayer(b.datasetname)}):a.getAA(d).addBoxOverlay(b.datasetname,e-d)}}():c(e)&&c(e[0])?f=function(){return function(c){c.forEach(function(c){var d=parseInt(c[0],10),e=parseInt(c[1],10);a.getAA(d).addBoxOverlay(b.datasetname,e-d)})}}():e===parseInt(e[0],10)&&(f=function(){return function(c){var d=c;a.getAA(d).addAnnotation(b.datasetname,1)}}()),f.call(this,e)}}jQuery(a).trigger("resultsRendered",[b])})},function(){var a=function(a,b){if(!a||a.length<1)return[];var c,d=-1;for(c=0;c<a[0].length;c++)if((a[0][c]||"").toString().toLowerCase().match(/at[\dA-Z]g\d+/)){d=c;break}if(d==-1)return a;var e=[];for(c=0;c<a.length;c++)b||e.push(a[c][d].toLowerCase()),b&&a[c][d].toLowerCase()===b.toLowerCase()&&e.push(a[c]);return e},b=function(a){if(a.length<1)return[];var b,c=null;for(b=0;b<a[0].length;b++){var d=a[0][b],e=b;if(d.toString().match(/\d+-\d+/)&&(c=function(){return function(a){var b=[];return a[e].split(/,/).forEach(function(a){b.push(a.split(/-/))}),b}}(b)),d.toString().match(/^\d+$/)){c=a[0][b+1]&&a[0][b+1].toString().match(/^\d+$/)?function(){return function(a){return[a[e],a[e+1]]}}(b):function(){return function(a){return a[e]}}(b);break}d.toString().match(/^[A-Z]+$/)&&(c=function(){return function(a){return a[e]}}(b))}if(!c)return[];var f=[];for(b=0;b<a.length;b++)f.push(c.call(this,a[b]));return f};MASCP.UserdataReader.prototype.setData=function(c,d){if(d){var e=this;MASCP.Service.CacheService(this),this.datasetname=c,this.data=d;var f=new MASCP.UserdataReader;f.datasetname=c,f.data=d,f.retrieve=function(c,d){this.agi=c,this._dataReceived(b(a(this.data,this.agi))),d.call(this)},MASCP.Service.CacheService(f);var g=a(d),h=this.retrieve;this.retrieve=function(a,b){console.log("Data not ready! Waiting for ready state");var c=this;bean.add(c,"ready",function(){bend.remove(c,"ready",arguments.callee),c.retrieve(a,b)})},function(){if(0===g.length)return e.retrieve=h,void bean.fire(e,"ready");var a=g.shift();f.retrieve(a,arguments.callee)}()}},MASCP.UserdataReader.datasets=function(a){MASCP.Service.FindCachedService(this,function(b){for(var c=[],d=0,e=b.length;d<e;d++)c.push(b[d].replace(/MASCP.UserdataReader./,""));c.forEach&&c.forEach(a)})}}(),MascotToJSON=function(){},function(){var a={file:"",do_export:"1",export_format:"CSV",protein_master:"1",peptide_master:"1",pep_seq:"1",pep_score:"0",REPORT:"AUTO",show_same_sets:"1",_requireboldred:"1",_ignoreionsscorebelow:"0.05",prot_hit_num:"0",pep_end:"0",pep_miss:"0",pep_homol:"0",pep_ident:"0",pep_frame:"0",pep_var_mod:"0",pep_num_match:"0",pep_scan_title:"0",pep_query:"0",pep_rank:"0",pep_isbold:"0",pep_exp_mz:"0",pep_calc_mr:"0",pep_exp_z:"0",pep_exp_mr:"0",pep_delta:"0",_sigthreshold:"0.05",_showallfromerrortolerant:"0",_onlyerrortolerant:"0",_noerrortolerant:"0",_show_decoy_report:"0",_showsubsets:"0",_server_mudpit_switch:"0.000000001"},b=function(a){if(null===a||"object"!=typeof a)return a;var c=a.constructor();for(var d in a)a.hasOwnProperty(d)&&(c[d]=b(a[d]));return c},c=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c+"="+a[c]);return b.join("&")},d=function(a,b){b=b||",";for(var c=new RegExp("(\\"+b+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+b+"\\r\\n]*))","gi"),d=[[]],e=null;null!==(e=c.exec(a));){var f=e[1];f.length&&f!=b&&d.push([]);var g;g=e[2]?e[2].replace(new RegExp('""',"g"),'"'):e[3],d[d.length-1].push(g)}return d},e=function(a){var b=[],c=null,d={};return a.forEach(function(a){a[1]&&""!==a[1]&&(c=a[1]);var e=a[6]+a[7]+a[8];e&&!d[c+e]&&b.push([c,e]),d[c+e]=1}),b};MascotToJSON.prototype.convertReport=function(f,g){var h=this,i=new window.XMLHttpRequest,j=f.replace(/master_results(_2)?.pl.*/,"export_dat_2.pl"),k=(/file=([^&]*)/.exec(f)||[]).shift(),l=b(a);l.file=k,i.onreadystatechange=function(){if(4==i.readyState)if(200==i.status){var a=i.responseText;a=a.replace(/(.+\n)+\n.*\n/m,""),g&&g.call(h,e(d(a)))}else 0===i.status&&g&&g.call(h,[],new Error("Could not load page"))},i.open("GET",j+"?"+c(l),!0),i.send(null)}}(),"undefined"!=typeof module&&module.exports&&(module.exports.MascotToJSON=MascotToJSON),"undefined"==typeof MASCP){MASCP={};var ie=function(){var a,b=3,c=document.createElement("div"),d=c.getElementsByTagName("i");do c.innerHTML="<!--[if gt IE "+ ++b+"]><i></i><![endif]-->";while(d[0]);return b>4?b:a}();ie&&(7===ie&&(MASCP.IE=!0,MASCP.IE7=!0),8===ie&&(MASCP.IE=!0,MASCP.IE8=!0))}MASCP.registerGroup=function(a,b){if(this.groups||(this.groups={}),!this.groups[a]){var c=new MASCP.Group;if(c.name=a,b=b||{},b.hide_member_controllers&&(c.hide_member_controllers=!0),b.hide_group_controller&&(c.hide_group_controller=!0),b.fullname&&(c.fullname=b.fullname),b.color&&(c.color=b.color),b.group){if(c.group=this.getGroup(b.group),!c.group)throw"Cannot register this layer with the given group - the group has not been registered yet";c.group._layers.push(c)}return c._layers=[],c.group_id=(new Date).getMilliseconds(),this.groups[a]=c,bean.fire(MASCP,"groupRegistered",[c]),c}},MASCP.registerLayer=function(a,b){if(this.layers||(this.layers={}),this.layers[a])return this.layers[a].disabled&&(this.layers[a].disabled=!1,bean.fire(MASCP,"layerRegistered",[this.layers[a]])),this.layers[a];var c=new MASCP.Layer;if(c.name=a,b=b||{},b.fullname&&(c.fullname=b.fullname),b.color&&(c.color=b.color),b.group){if(c.group=this.getGroup(b.group),!c.group)throw"Cannot register this layer with the given group - the group has not been registered yet";c.group._layers.push(c)}return b.data&&(c.data=b.data),this.layers[a]=c,b.css&&(layerCss=b.css,layerCss=layerCss.replace(/\.inactive/g,"."+a+"_inactive ."+a),layerCss=layerCss.replace(/\.tracks\s+\.active/g,"."+a+"_active .track ."+a),layerCss=layerCss.replace(/\.active/g,"."+a+"_active ."+a),layerCss=layerCss.replace(/\.overlay/g,"."+a+"_overlay"),jQuery('<style type="text/css">'+layerCss+"</style>").appendTo("head")),c.layer_id=(new Date).getMilliseconds(),bean.fire(MASCP,"layerRegistered",[c]),c},MASCP.Group=function(){},MASCP.Group.prototype.size=function(){for(var a=0,b=0;b<this._layers.length;b++)this._layers[b].disabled||(a+=1);return a},MASCP.Group.prototype.eachLayer=function(a){for(var b=0;b<this._layers.length;b++)this._layers[b].disabled||a.call(this._layers[b],this._layers[b])},MASCP.Layer=function(){},MASCP.SequenceRenderer=function(){var a=function(a){var b=[],c={getTrackOrder:function(){return b},setTrackOrder:function(a){var c=[],d=a;!d instanceof Array&&(d=[a]);for(var e=0;e<d.length;e++){var f=d[e];MASCP.getLayer(f)?c.push(f):MASCP.getGroup(f)&&MASCP.getGroup(d[e]).eachLayer(function(a){d.splice(e+1,0,a.name)})}for(e=(b||[]).length-1;e>=0;e--)c.indexOf(b[e])<0&&(this.hideLayer(b[e]),this.hideGroup(b[e]),jQuery(MASCP.getLayer(b[e])).trigger("removed"),jQuery(MASCP.getGroup(b[e])).trigger("removed"));b=c,this.refresh&&this.refresh(!0)}};a.__defineSetter__&&(a.__defineSetter__("trackOrder",c.setTrackOrder),a.__defineGetter__("trackOrder",c.getTrackOrder)),MASCP.IE&&(a.setTrackOrder=c.setTrackOrder),"function"==typeof Object.defineProperty&&MASCP.IE&&!MASCP.IE8&&Object.defineProperty(a,"trackOrder",{get:c.getTrackOrder,set:c.setTrackOrder})};return function(b){return"undefined"!=typeof b&&(this._container=b,this._container.style.position="relative",jQuery(this).bind("sequenceChange",function(a){jQuery(b).text(""),jQuery(b).append(this._sequence_els),jQuery(b).append(jQuery('<div style="clear: both; float: none; height: 0px; width: 100%;"></div>')),b.style.width=this._sequence_els.length+"em"}),this.setSequence(jQuery(b).text())),a(this),this}}(),MASCP.SequenceRenderer.prototype={sequence:null},MASCP.IE&&(MASCP.SequenceRenderer.prototype.prototype=document.createElement("div")),MASCP.SequenceRenderer.prototype.setSequence=function(a){this.sequence=this._cleanSequence(a);var b=[],c=this;if(this.sequence){for(var d=this.sequence.split(""),e=0;e<d.length;e++){var f=d[e];f.match(/[A-Za-z]/)&&b.push(jQuery("<span>"+f+"</span>")[0])}jQuery(b).each(function(a){this._index=a,this.style.display="block",this.style.cssFloat="left",this.style.styleFloat="left",this.style.height="1.1em",this.style.position="relative",this.addToLayer=MASCP.SequenceRenderer.addElementToLayer,this.addBoxOverlay=MASCP.SequenceRenderer.addBoxOverlayToElement,this.addToLayerWithLink=MASCP.SequenceRenderer.addElementToLayerWithLink,this._renderer=c}),this._sequence_els=b,jQuery(this).trigger("sequenceChange")}},MASCP.SequenceRenderer.prototype.colorResidues=function(a,b){var c=Math.floor(1e3*Math.random()).toString();MASCP.registerLayer(c,{color:b||"#ff0000"});for(var d=this.getAminoAcidsByPosition(a),e=0;e<d.length;e++)d[e].addToLayer(c);return MASCP.getLayer(c)},MASCP.SequenceRenderer.prototype._cleanSequence=function(a){if(!a)return a;var b=a;return b=b.replace(new RegExp(String.fromCharCode(160),"g"),""),b=b.replace(/[\n\t\s\d]+/gim,""),b=b.replace(/\(.*\)/g,"")},MASCP.SequenceRenderer.prototype.getAminoAcidsByPosition=function(a){var b=this._sequence_els;return jQuery.map(a,function(a){return b[a-1]})},MASCP.SequenceRenderer.prototype.getAA=function(a){return this.getAminoAcidsByPosition([a]).shift()},MASCP.SequenceRenderer.prototype.getAminoAcidsByPeptide=function(a){var b=this.sequence.indexOf(a),c=[];return b<0?(c.addToLayer=function(){},c):(c=c.concat(this._sequence_els.slice(b,b+a.length)),c.length?c.addToLayer=function(a,b){return c[0].addBoxOverlay(a,c.length,b)}:c.addToLayer=function(){},c)},MASCP.SequenceRenderer.prototype.showRowNumbers=function(){var a=jQuery('<div style="position: absolute; top: 0px; left: 0px; width: 2em;"></div>');return jQuery(this._sequence_els).each(function(b){b%50===0&&(this.style.marginLeft="3em",a.append(jQuery('<div style="text-align: right; height: 1.1em;">'+(b+1)+"</div>")[0]))}),jQuery(this._container).append(a),this},MASCP.SequenceRenderer.prototype.toggleLayer=function(a,b){var c=a;return"string"!=typeof a?c=a.name:a=MASCP.layers[a],jQuery(this._container).toggleClass(c+"_active"),jQuery(this._container).toggleClass(c+"_inactive"),b||jQuery(a).trigger("visibilityChange",[this,this.isLayerActive(a)]),this},MASCP.SequenceRenderer.prototype.showLayer=function(a,b){var c=MASCP.getLayer(a);if(c&&!c.disabled)return jQuery(this._container).addClass(c.name+"_active"),jQuery(this._container).addClass("active_layer"),jQuery(this._container).removeClass(c.name+"_inactive"),b||jQuery(c).trigger("visibilityChange",[this,!0]),this},MASCP.SequenceRenderer.prototype.hideLayer=function(a,b){var c=MASCP.getLayer(a);if(c&&!c.disabled)return jQuery(this._container).removeClass(c.name+"_active"),jQuery(this._container).removeClass("active_layer"),jQuery(this._container).addClass(c.name+"_inactive"),b||jQuery(c).trigger("visibilityChange",[this,!1]),this},MASCP.SequenceRenderer.prototype.registerLayer=function(a,b){return MASCP.registerLayer(a,b)},MASCP.SequenceRenderer.prototype.setGroupVisibility=function(a,b,c){var d=MASCP.getGroup(a);if(d){var e=(d.name,this);d.eachLayer(function(a){if(MASCP.getGroup(a)!==a)return this.disabled&&b?void e.hideLayer(a.name):void(b===!0?e.showLayer(a.name):b===!1?e.hideLayer(a.name):e.toggleLayer(a.name))}),null===b||c||jQuery(d).trigger("visibilityChange",[e,b])}},MASCP.SequenceRenderer.prototype.hideGroup=function(a,b){this.setGroupVisibility(a,!1,b)},MASCP.SequenceRenderer.prototype.showGroup=function(a,b){this.setGroupVisibility(a,!0,b)},MASCP.SequenceRenderer.prototype.toggleGroup=function(a,b){this.setGroupVisibility(a,b)},MASCP.SequenceRenderer.prototype.isLayerActive=function(a){var b=a;return"string"!=typeof a&&(b=a.name),!a.disabled&&jQuery(this._container).hasClass(b+"_active")},MASCP.SequenceRenderer.prototype._setHighlight=function(a,b){},MASCP.SequenceRenderer.prototype.createLayerController=function(){var a=jQuery('<div style="position: absolute; top: 0px; font-family: Helvetica, Arial, Sans-serif; margin-left: 20px; left: 100%; width: 250px;"></div>'),b=jQuery(this._container);b.append(a),this._controllers||(this._controllers=[]),this._controllers.push(a);var c=this;if(jQuery(MASCP).bind("layerRegistered",function(b){jQuery(a).accordion("destroy"),jQuery(a).accordion({header:"h3",collapsible:!0,autoHeight:!0,active:!1})}),a.add_layer=function(a){var b=jQuery('<div><input type="checkbox"/>'+a.fullname+"</div>");a.group?jQuery(a.group._layer_container).append(b):jQuery(this).append(b),c.createLayerCheckbox(a,jQuery("input",b)[0])},a.add_group=function(a){var b=jQuery('<h3><input style="margin-left: 25px;" type="checkbox"/>'+a.fullname+"</h3>");jQuery(this).append(b);var d=jQuery('<div style="max-height: 200px; overflow: auto;"></div>');jQuery(this).append(d),a._layer_container=d[0],a._controller=b,a._check_intermediate=function(){var d=0;jQuery(a._layers).each(function(a){c.isLayerActive(this.name)&&d++});var e=jQuery("input",b)[0];e.indeterminate=0!==d&&d!=a._layers.length,e.indeterminate||(e.checked=0!==d)},jQuery(jQuery("input",b)[0]).bind("mouseup",function(a){this.indeterminate&&jQuery(this).trigger("change")}),c.createGroupCheckbox(a,jQuery("input",b)[0])},bean.add(MASCP,"layerRegistered",function(b,c){c.group&&c.group.hide_member_controllers||a.add_layer(c)}),bean.add(MASCP,"groupRegistered",function(b,c){c.hide_group_controller||a.add_group(c)}),MASCP.layers)for(var d in MASCP.layers)if(MASCP.layers.hasOwnProperty(d)){var e=MASCP.layers[d];if(e.group&&e.group.hide_member_controllers)continue;a.add_layer(e)}return this},MASCP.SequenceRenderer.prototype.createLayerCheckbox=function(a,b,c){var d=this;if(MASCP.layers[a]){var e=null;if("string"==typeof a&&MASCP.layers?e=MASCP.layers[a]:"object"==typeof a&&(e=a),e){var f=b||jQuery('<input type="checkbox" value="true"/>')[0];f._current_bindings=f._current_bindings||[],c&&this._removeOtherBindings(e,f);for(var g=0;g<f._current_bindings.length;g++)if(f._current_bindings[g].layer==a&&f._current_bindings[g].renderer==d)return;f.removeAttribute("checked"),f.checked=this.isLayerActive(a);var h=null;e&&0===f._current_bindings.length&&(h=function(a,b,c){b==d&&(c?f.checked=c:(f.checked=!1,f.removeAttribute("checked")))},jQuery(e).bind("visibilityChange",h),f.parentNode&&f.parentNode.insertBefore(jQuery('<div style="position: relative; left: 0px; top: 0px; float: left; background-color: '+e.color+'; width: 1em; height: 1em;"></div>')[0],f));var i=function(b){this.checked&&d.showLayer(a,!1),MASCP.getLayer(a).group&&MASCP.getLayer(a).group._check_intermediate&&MASCP.getLayer(a).group._check_intermediate()};return jQuery(f).bind(MASCP.IE?"click":"change",i),f._current_bindings.push({layer:a,renderer:d,input_function:i,object_function:h}),f}}},MASCP.getLayer=function(a){if(MASCP.layers)return"string"==typeof a?MASCP.layers[a]:a},MASCP.getGroup=function(a){if("undefined"!=typeof a&&MASCP.groups)return"string"==typeof a?MASCP.groups[a]:a==MASCP.groups[a.name]?a:null},MASCP.SequenceRenderer.prototype._removeOtherBindings=function(a,b){for(var c=this,d=0;d<b._current_bindings.length;d++)if(b._current_bindings[d].renderer==c){var e=b._current_bindings[d];e.layer&&e.layer!=a.name&&(jQuery(MASCP.getLayer(e.layer)).unbind("visibilityChange",e.object_function),jQuery(b).unbind("change",e.input_function)),e.group&&e.group!=a.name&&(jQuery(MASCP.getGroup(e.group)).unbind("visibilityChange",e.object_function),jQuery(b).unbind("change",e.input_function)),e.group=null,e.layer=null}},MASCP.SequenceRenderer.prototype.createGroupCheckbox=function(a,b,c){var d=this,e=b?jQuery(b):jQuery('<input type="checkbox" value="true"/>'),f=MASCP.getGroup(a);if(f){e[0]._current_bindings=e[0]._current_bindings||[],c&&this._removeOtherBindings(f,e[0]);for(var g=0;g<e[0]._current_bindings.length;g++)if(e[0]._current_bindings[g].group==a&&e[0]._current_bindings[g].renderer==d)return;e[0].removeAttribute("checked");var h=function(b){group_obj=MASCP.getGroup(a),group_obj&&(this.checked?jQuery(group_obj._layers).each(function(a){d.showLayer(this.name,!1)}):jQuery(group_obj._layers).each(function(a){}))};e.bind(MASCP.IE?"click":"change",h);var i=null;return f&&0===e[0]._current_bindings.length&&(i=function(a,b,c){b==d&&(e[0].checked=c,c||e[0].removeAttribute("checked"))},jQuery(MASCP.getGroup(a)).bind("visibilityChange",i),e[0].parentNode&&e[0].parentNode.insertBefore(jQuery('<div style="position: relative; left: 0px; top: 0px; float: left; background-color: '+f.color+'; width: 1em; height: 1em;"></div>')[0],e[0])),e[0]._current_bindings.push({group:a,renderer:d,input_function:h,object_function:i}),e.bind("click",function(a){a.stopPropagation()}),e}},MASCP.SequenceRenderer.prototype.createGroupController=function(a,b){var c=MASCP.getLayer(a),d=MASCP.getGroup(b),e=this;jQuery(c).bind("visibilityChange",function(a,b,c){b==e&&(e.setGroupVisibility(d,c),e.refresh())})},MASCP.SequenceRenderer.addElementToLayer=function(a){return this.addBoxOverlay(a,1),this},MASCP.SequenceRenderer.addElementToLayerWithLink=function(a,b,c){jQuery(this).addClass(a);for(var d=jQuery(this).append(jQuery('<a href="'+b+'" class="'+a+'_overlay" style="display: box; left: 0px; top: 0px; width: 100%; position: absolute; height: 100%;">&nbsp;</a>'))[0];c&&c>0;)this._renderer._sequence_els[this._index+c].addToLayerWithLink(a,b),c-=1;return this._z_indexes&&this._z_indexes[a]&&(d.style.zIndex=this._z_indexes[a]),this},MASCP.SequenceRenderer.addBoxOverlayToElement=function(a,b,c){"undefined"==typeof c&&(c=1),jQuery(this).addClass(a);for(var d=jQuery(this).append(jQuery('<div class="'+a+'_overlay" style="top: 0px; width: 100%; position: absolute; height: 100%; opacity:'+c+';"></div>'))[0];b&&b>1;)this._renderer._sequence_els[this._index+b-1].addBoxOverlay(a,0,c),b-=1;this._z_indexes&&this._z_indexes[a]&&(d.style.zIndex=this._z_indexes[a]);for(var e=["mouseover","mousedown","mousemove","mouseout","click","dblclick","mouseup","mouseenter","mouseleave"],f=0;f<e.length;f++)jQuery(d).bind(e[f],function(){return function(b){jQuery(MASCP.getLayer(a)).trigger(b.type,[b,"SequenceRenderer"])}}(f));return this},MASCP.SequenceRenderer.prototype.reset=function(){jQuery(this._container).attr("class",null);for(var a in MASCP.groups)MASCP.groups.hasOwnProperty(a)&&this.hideGroup(a);for(var b in MASCP.layers)MASCP.layers.hasOwnProperty(b)&&(this.hideLayer(b,!0),MASCP.layers[b].disabled=!0);this.resetAnnotations&&this.resetAnnotations()},MASCP.SequenceRenderer.prototype.withoutRefresh=function(a){var b=this.refresh;this.refresh=function(){},a.apply(this),this.refresh=b},MASCP.SequenceRenderer.prototype.refresh=function(){var a=-2;this._z_indexes||(this._z_indexes={});for(var b=0;b<(this.trackOrder||[]).length;b++)this.isLayerActive(this.trackOrder[b])&&(jQuery("."+this.trackOrder[b]+"_overlay").css("z-index",a),this._z_indexes[this.trackOrder[b]]=a,a-=1)},MASCP.SequenceRenderer.prototype.bind=function(a,b){jQuery(this).bind(a,b)},MASCP.SequenceRenderer.prototype.trigger=function(a){jQuery(this).trigger(a)};var SVGCanvas=SVGCanvas||function(){function a(a,b){var c,d,g,i,k;a.visibility=function(){for(var b="hidden",c=0;c<a.length;c++)if(k=a[c].getAttribute("visibility"),k&&"hidden"!=k){b=k;break}return b},a.currenty=function(){var b;return a[0]&&a[0].getAttribute("transform")&&(b=/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/.exec(a[0].getAttribute("transform")),"undefined"!=typeof b&&(b=b[2])),a[0]?parseInt(b||a[0].getAttribute("y")||0,10):0},a.animate=function(c){if("undefined"==typeof c.y)return void l(c);if(0!==a.length){var d,f={};for(d in c)c.hasOwnProperty(d)&&(f[d]=c[d]);if(j(),a.animating)for(var g=0;g<(e||[]).length;g++)e[g].target_set==a&&(a.animating=!1,e.splice(g,1));var i=a.visibility(),k=f.visibility;if(i==k&&"hidden"==k)return void l(c);var m=a.currenty();if(isNaN(parseInt(m,10)))return void console.log("Have a NaN y value, skipping");var n=parseInt(f.y,10);delete f.y,i==k&&"visible"==k&&(delete f.visibility,k=null,l({visibility:"visible"})),"hidden"==f.visibility&&delete f.visibility,l(f);var o=0;if(n!=m){var p=1*(Math.abs(parseInt((n-m)/(50*b),10)/h)+1),q=(n-m)/p;f.y=m||0;arguments.callee;a.animating=!0,f.y=m+1*q,e.push(function(b){return q<0&&f.y<n&&(f.y=n),q>0&&f.y>n&&(f.y=n),l(f),o+=b||1,f.y!=n?void(f.y=m+q*(o+1)):(a.animating=!1,k&&l({visibility:k}),void e.splice(e.indexOf(arguments.callee),1))}),e[e.length-1].target_set=a}}},a.attr=function(a){return f?this.animate(a):l(a)};var l=function(b){var e,f={};for(e in b)b.hasOwnProperty(e)&&(f[e]=b[e]);a.visibility(),parseInt(f.y,10);i=f.visibility;for(e in f)if(f.hasOwnProperty(e))for(var h=0;h<a.length;h++)if(a[h]){var j=f[e];if("style"==e&&a[h].hasAttribute("style")){var k=a[h].getAttribute("style");k+="; "+f[e],j=k}if("height"==e&&a[h].hasAttribute("transform")){g=a[h].getAttribute("transform");var l=/scale\((-?\d+\.?\d*)\)/.exec(a[h].getAttribute("transform")),m=parseFloat(a[h].getAttribute("height")||1),n=1;null===l?(g+=" scale(1) ",l=1):l=parseFloat(l[1]),n=parseFloat(f[e])/m*l,g=g.replace(/scale\((-?\d+\.?\d*)\)/,"scale("+n+")"),a[h].setAttribute("transform",g)}if((!a[h].hasAttribute("transform")||"y"!=e&&"x"!=e)&&a[h].setAttribute(e,j),"y"==e&&a[h].hasAttribute("d")){var o=a[h].getAttribute("d"),p=/M\s*([\d\.]+) ([\d\.]+)/;if(o=o.replace(p,""),isNaN(parseInt(j,10)))throw"Error "+e+" is "+f[e];a[h].setAttribute("d","M0 "+parseInt(j,10)+" "+o)}if("y"==e&&a[h].hasAttribute("cy")&&a[h].setAttribute("cy",f[e]),"y"==e&&a[h].hasAttribute("transform")){if(g=a[h].getAttribute("transform"),c=/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/.exec(a[h].getAttribute("transform")),null===c)continue;c=c[1],g=g.replace(/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/,"translate("+c+","+j+")"),a[h].setAttribute("transform",g)}if("x"==e&&a[h].hasAttribute("transform")){if(g=a[h].getAttribute("transform"),d=/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/.exec(a[h].getAttribute("transform")),null===d)continue;d=d[2],g=g.replace(/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/,"translate("+j+","+d+")"),a[h].setAttribute("transform",g)}}};return a.hide=function(){this.attr({visibility:"hidden"})},a.show=function(){this.attr({visibility:"visible"})},a.refresh_zoom=function(){for(var b=0;b<a.length;b++)a[b].zoom_level&&"text"==a[b].zoom_level&&(canvas.zoom>3.5?(a[b].setAttribute("display","inline"),a[b].setAttribute("opacity",1)):a[b].setAttribute("display","none")),a[b].zoom_level&&"summary"==a[b].zoom_level&&(canvas.zoom<=3.5?(a[b].setAttribute("display","inline"),a[b].setAttribute("opacity",1)):a[b].setAttribute("display","none"))},a}var b=[],c=1,d="http://www.w3.org/2000/svg",e=null,f=!1,g=null,h=75,i=null,j=function(){null===e?e=[]:(e.forEach(function(a){a._last_step=null}),clearInterval(g)),f||(b.forEach(function(a){jQuery(a).trigger("_anim_begin")}),f=!0);var a=null;g=setInterval(function(){if(!e||0===e.length)return clearInterval(g),g=null,e=null,f=!1,void b.forEach(function(a){jQuery(a).trigger("_anim_end")});var c=[];b.forEach(function(a){c.push(a.suspendRedraw(5e3))});var d=(new Date).getTime();a||(a=(new Date).getTime());for(var k=0;k<(e||[]).length;k++){var l=(new Date).getTime(),m=parseInt((l-a)/h,10);null===i&&m-e[k]._last_step>2&&(i=Math.round(1.6*h)),e[k].apply(null,[m-(e[k]._last_step||m)]),e&&e[k]&&(e[k]._last_step=m)}var n=(new Date).getTime();b.forEach(function(a){a.unsuspendRedraw(c.shift())});var o=n-d;o<h&&null===i&&o>=1?(h=Math.round(1.5*(n-d)),j()):null!==i&&i!=h&&(h=i,j())},h)};return function(e){var f=e.RS||c;e.RS=f,b.push(e),e.makeEl=function(a,b){var c=document.createElementNS(d,a);for(var e in b)b.hasOwnProperty(e)&&c.setAttribute(e,b[e]);return c},e.make_gradient=function(a,b,c,d,e){for(var f=this.makeEl("linearGradient",{id:a,x1:"0%",x2:b,y1:"0%",y2:c}),g=d.length;d.length>0;){var h=Math.round((g-d.length)/g*100),i=d.shift(),j=e.shift();f.appendChild(this.makeEl("stop",{offset:h+"%",style:"stop-color:"+i+";stop-opacity:"+j}))}return f},e.path=function(a){var b=document.createElementNS(d,"path");return b.setAttribute("d",a),b.setAttribute("stroke","#000000"),b.setAttribute("stroke-width","1"),this.appendChild(b),b},e.poly=function(a){var b=document.createElementNS(d,"polygon");return b.setAttribute("points",a),this.appendChild(b),b},e.circle=function(a,b,c){var e=document.createElementNS(d,"circle");return e.setAttribute("cx","string"==typeof a?a:a*f),e.setAttribute("cy","string"==typeof b?b:b*f),e.setAttribute("r","string"==typeof c?c:c*f),this.appendChild(e),e},e.group=function(){var a=document.createElementNS(d,"g");return this.appendChild(a),a.push=function(b){a.appendChild(b)},a},e.line=function(a,b,c,e){var g=document.createElementNS(d,"line");return g.setAttribute("x1","string"==typeof a?a:a*f),g.setAttribute("y1","string"==typeof b?b:b*f),g.setAttribute("x2","string"==typeof c?c:c*f),g.setAttribute("y2","string"==typeof e?e:e*f),this.appendChild(g),g},e.rect=function(a,b,c,e){var g=document.createElementNS(d,"rect");return g.setAttribute("x","string"==typeof a?a:a*f),g.setAttribute("y","string"==typeof b?b:b*f),g.setAttribute("width","string"==typeof c?c:c*f),g.setAttribute("height","string"==typeof e?e:e*f),g.setAttribute("stroke","#000000"),this.appendChild(g),g},e.use=function(a,b,c,e,g){var h=document.createElementNS(d,"use");return h.setAttribute("x","string"==typeof b?b:b*f),
h.setAttribute("y","string"==typeof c?c:c*f),h.setAttribute("width","string"==typeof e?e:e*f),h.setAttribute("height","string"==typeof g?g:g*f),h.setAttributeNS("http://www.w3.org/1999/xlink","href",a),this.appendChild(h),h},e.a=function(a){var b=document.createElementNS(d,"a");return b.setAttribute("target","_new"),b.setAttributeNS("http://www.w3.org/1999/xlink","href",a),this.appendChild(b),b},e.button=function(a,b,c,e,f){var g=document.createElementNS(d,"foreignObject");g.setAttribute("x",0),g.setAttribute("y",0),g.setAttribute("width",a+c),g.setAttribute("height",b+e),g.style.position="absolute",this.appendChild(g);var h=document.createElement("button");return h.style.display="block",h.style.position="relative",h.style.top=b+"px",h.style.left=a+"px",h.textContent=f,g.appendChild(h),h},e.svgbutton=function(a,b,c,d,e){var f=this.group(),g=this.rect(a,b,c,d);g.setAttribute("rx","10"),g.setAttribute("ry","10"),g.setAttribute("stroke","#ffffff"),g.setAttribute("stroke-width","2"),g.setAttribute("fill","url(#simple_gradient)"),a=g.x.baseVal.value,b=g.y.baseVal.value,c=g.width.baseVal.value,d=g.height.baseVal.value;var h=this.text(a+c/2,b+d/3,e);h.setAttribute("text-anchor","middle"),h.firstChild.setAttribute("dy","1.5ex"),h.setAttribute("font-size",.5*d),h.setAttribute("fill","#ffffff"),f.push(g),f.push(h),f.background_element=g,f.text_element=h,f.setAttribute("cursor","pointer");var i=function(){g.setAttribute("fill","#999999"),g.setAttribute("stroke","#000000")};f.addEventListener("mousedown",i,!1),f.addEventListener("touchstart",i,!1);var j=function(){g.setAttribute("stroke","#ffffff"),g.setAttribute("fill","url(#simple_gradient)")};return f.addEventListener("mouseup",j,!1),f.addEventListener("mouseout",j,!1),f.addEventListener("touchend",j,!1),f},e.callout=function(a,b,c,e){var g=this.group(),h=this.rect(-.5*(e.width+4),20,e.width+4,e.height+4);h.setAttribute("fill","#000000");var i=this.rect(-.5*(e.width+1),22,e.width+1,e.height);i.setAttribute("fill","#eeeeee"),g.push(h),g.push(i);var j=this.poly("0,500 500,1000 -500,1000");j.setAttribute("fill","#000000"),g.push(j);var k=document.createElementNS(d,"foreignObject");k.setAttribute("x",-.5*(e.width+1)*f),k.setAttribute("y",21*f),k.setAttribute("width",e.width*f),k.setAttribute("height",e.height*f),g.push(k);var l=document.createElementNS("http://www.w3.org/1999/xhtml","html");l.setAttribute("xmlns","http://www.w3.org/1999/xhtml");var m=document.createElementNS("http://www.w3.org/1999/xhtml","body");return m.style.fontSize=15*f+"px",m.style.margin=5*f+"px",l.appendChild(m),m.appendChild(c),k.appendChild(l),g.setAttribute("transform","translate("+a*f+","+(b+20)*f+")"),g},e.growingMarker=function(a,b,c,e){var g=document.createElementNS(d,"svg");g.setAttribute("viewBox","-50 -100 150 300"),g.setAttribute("preserveAspectRatio","xMinYMin meet"),g.setAttribute("x",a),g.setAttribute("y",b);var h=this.marker(50/f,50/f,50/f,c,e);g.appendChild(h),g.contentElement=h.contentElement;var i=this.group();return i.appendChild(g),i},e.marker=function(a,b,c,d,e){var g=0;if("string"==typeof a){var h=new RegExp(/(\d+)(.*)/g).exec(a);g=h[2],a=parseFloat(h[1]),h=new RegExp(/(\d+)(.*)/g).exec(b),b=parseFloat(h[1]),h=new RegExp(/(\d+)(.*)/g).exec(c),c=parseFloat(h[1])}var i={CX:a+g,CY:b+g,R:c+g,MIN_X:a-c+g,MAX_X:a+c+g,MIN_Y:b-c+g,MAX_Y:b+c+g,MID_X1:a-c/2+g,MID_X2:a+c/2+g,MID_Y1:b-c/2+g,MID_Y2:b+c/2+g},j=this.group(),k=e&&e.border?e.border:"rgb(0,0,0)";j.push(this.circle(0,-.5*c,c)),j.lastChild.style.fill=k,j.push(this.circle(0,1.5*c,c)),j.lastChild.style.fill=k;var l=this.poly(-.9*c*f+","+0*c*f+" 0,"+-2.5*c*f+" "+.9*c*f+","+0*c*f);return l.setAttribute("style","fill:"+k+";stroke-width: 0;"),j.push(l),j.setAttribute("transform","translate("+a*f+","+.5*b*f+") scale(1)"),j.setAttribute("height",i.R*f),"string"==typeof d?(j.contentElement=this.text_circle(0,.5*c,1.75*c,d,e),j.push(j.contentElement)):(j.contentElement=this.group(),d&&j.contentElement.push(d),j.push(j.contentElement)),j},e.text_circle=function(a,b,c,d,e){e||(e={});var g=0;if("string"==typeof a){var h=new RegExp(/(\d+)(.*)/g).exec(a);g=h[2],a=parseFloat(h[1]),h=new RegExp(/(\d+)(.*)/g).exec(b),b=parseFloat(h[1]),h=new RegExp(/(\d+)(.*)/g).exec(c),c=parseFloat(h[1])}var i={CX:a+g,CY:b+g,R:c+g,MIN_X:a-c+g,MAX_X:a+c+g,MIN_Y:b-c+g,MAX_Y:b+c+g,MID_X1:a-c/2+g,MID_X2:a+c/2+g,MID_Y1:b-c/2+g,MID_Y2:b+c/2+g},j=this.group(),k=this.circle(0,i.CY,.9*i.R);k.setAttribute("fill","url(#simple_gradient)"),k.setAttribute("stroke",e.border||"#000000"),k.setAttribute("stroke-width",c/10*f),j.push(k);var l=this.text(0,i.CY-.5*i.R,d);return l.setAttribute("font-size",c*f),l.setAttribute("font-weight","bolder"),l.setAttribute("fill","#ffffff"),l.setAttribute("style","font-family: sans-serif; text-anchor: middle;"),l.firstChild.setAttribute("dy","1.5ex"),l.setAttribute("text-anchor","middle"),j.push(l),j.setAttribute("transform","translate("+i.CX*f+", 1) scale(1)"),j.setAttribute("height",i.R/2*f),j},e.crossed_circle=function(a,b,c){var d=0;if("string"==typeof a){var e=new RegExp(/(\d+)(.*)/g).exec(a);d=e[2],a=parseFloat(e[1]),e=new RegExp(/(\d+)(.*)/g).exec(b),b=parseFloat(e[1]),e=new RegExp(/(\d+)(.*)/g).exec(c),c=parseFloat(e[1])}var f={CX:a+d,CY:b+d,R:c+d,MIN_X:a-c+d,MAX_X:a+c+d,MIN_Y:b-c+d,MAX_Y:b+c+d,MID_X1:a-c/2+d,MID_X2:a+c/2+d,MID_Y1:b-c/2+d,MID_Y2:b+c/2+d},g=this.group(),h=this.circle(f.CX,f.CY,f.R);h.setAttribute("fill","#000000"),h.setAttribute("stroke","#ffffff"),h.setAttribute("stroke-width","2"),g._button=h,g.push(h);var i=this.line(f.MID_X1,f.MID_Y1,f.MID_X2,f.MID_Y2);return i.setAttribute("stroke","#ffffff"),i.setAttribute("stroke-width","2"),g.push(i),i=this.line(f.MID_X1,f.MID_Y2,f.MID_X2,f.MID_Y1),i.setAttribute("stroke","#ffffff"),i.setAttribute("stroke-width","2"),g.push(i),g},e.text=function(a,b,c){var e=document.createElementNS(d,"text"),g=document.createElementNS(d,"tspan");return"string"!=typeof c?e.appendChild(c):(e.appendChild(g),g.textContent=c,g.setAttribute("dy","0")),e.style.fontFamily="Helvetica, Verdana, Arial, Sans-serif",e.setAttribute("x","string"==typeof a?a:a*f),e.setAttribute("y","string"==typeof b?b:b*f),this.appendChild(e),e},e.plus=function(a,b,c){var d=this.group();return d.appendChild(this.makeEl("rect",{x:Math.round(.4*c*f).toString(),y:Math.round(.1*c*f).toString(),"stroke-width":"1",width:Math.round(.2*c*f).toString(),height:Math.round(.8*c*f).toString(),stroke:"#ffffff",fill:"#ffffff"})),d.appendChild(this.makeEl("rect",{x:Math.round(.1*c*f).toString(),y:Math.round(.4*c*f).toString(),"stroke-width":"1",width:Math.round(.8*c*f).toString(),height:Math.round(.2*c*f).toString(),stroke:"#ffffff",fill:"#ffffff"})),d.setAttribute("transform","translate("+a*f+","+b*f+")"),d},e.minus=function(a,b,c){var d=this.group();return d.appendChild(this.makeEl("rect",{x:Math.round(.1*c*f).toString(),y:Math.round(.4*c*f).toString(),"stroke-width":"1",width:Math.round(.8*c*f).toString(),height:Math.round(.2*c*f).toString(),stroke:"#ffffff",fill:"#ffffff"})),d.setAttribute("transform","translate("+a*f+","+b*f+")"),d},e.set=function(){var b=[];return a(b,f),b},e.hide=function(){this.setAttribute("display","none")},e.show=function(){this.setAttribute("display","inline")}}}();if(MASCP.CondensedSequenceRenderer=function(a){this._RS=50,MASCP.SequenceRenderer.apply(this,arguments);var b=this;return MASCP.CondensedSequenceRenderer.Zoom(b),bean.add(MASCP,"layerRegistered",function(a){b.addTrack(a)}),jQuery(this).unbind("sequenceChange"),jQuery(this).bind("sequenceChange",function(){for(var a in MASCP.layers)MASCP.layers.hasOwnProperty(a)&&(MASCP.layers[a].disabled=!0);b.zoom=b.zoom}),this},MASCP.CondensedSequenceRenderer.prototype=new MASCP.SequenceRenderer,function(){var a=document.getElementsByTagName("script"),b=a[a.length-1].src;b=b.replace(/[^\/]+$/,""),MASCP.CondensedSequenceRenderer._BASE_PATH=b}(),function(a){var b=function(){var a=this;this._object&&("undefined"!=typeof svgweb?svgweb.removeChild(this._object,this._object.parentNode):this._object.parentNode.removeChild(this._object),this._canvas=null,this._object=null);var b;if(document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")){var d=document.createElementNS(svgns,"svg");d.setAttribute("width","100%"),d.setAttribute("height","100%"),this._container.appendChild(d),this._canvas=d,b={addEventListener:function(a,b){d.contentDocument={rootElement:d},b.call(d)}}}return b.addEventListener("load",function(){var b=this;SVGCanvas(b);var d=b.makeEl("g"),e=b.makeEl("svg");e.RS=a._RS,SVGCanvas(e),d.appendChild(e),b.appendChild(d);var f=!0;try{e.addEventListener}catch(g){f=!1}var h=(e.makeEl("rect",{x:"-10%",y:"-10%",width:"120%",height:"120%",style:"fill: #ffffff;"}),b.makeEl("rect",{x:"0",y:"0",width:"50",height:"100%",style:"fill: url(#left_fade);"}));b.makeEl("rect",{x:"100%",y:"0",width:"50",height:"100%",transform:"translate(-50,0)",style:"fill: url(#right_fade);"});jQuery(e).bind("pan",function(){e.currentTranslate.x>=0?h.setAttribute("visibility","hidden"):h.setAttribute("visibility","visible")}),jQuery(e).bind("_anim_begin",function(){h.setAttribute("visibility","hidden")}),jQuery(e).bind("_anim_end",function(){jQuery(e).trigger("pan")}),e.currentTranslate.x>=0&&h.setAttribute("visibility","hidden");var i=b.makeEl("g");b.appendChild(i);var j=b.makeEl("svg");i.appendChild(j),e.setCurrentTranslateXY=function(a,b){var c=(d.getAttribute("transform")||"").replace(/translate\([^\)]+\)/,"");c=c+" translate("+a+", "+b+") ",d.setAttribute("transform",c),this.currentTranslate.x=a,this.currentTranslate.y=b},j.setCurrentTranslateXY=function(a,b){var c=(i.getAttribute("transform")||"").replace(/translate\([^\)]+\)/,"");c=c+" translate("+a+", "+b+") ",i.setAttribute("transform",c),this.currentTranslate.x=a,this.currentTranslate.y=b},c.call(a,j);var k=a.navigation,l=k.show,m=k.hide;k.show=function(){l.call(k),e.style.GomapScrollLeftMargin=100*a._RS/a.zoom},k.hide=function(){m.call(k),e.style.GomapScrollLeftMargin=1e3},a._container_canvas=b,b.setAttribute("preserveAspectRatio","xMinYMin meet"),b.setAttribute("width","100%"),b.setAttribute("height","100%"),e.appendChild(e.makeEl("rect",{x:0,y:0,width:"100%",height:"100%","stroke-width":"0",fill:"#ffffff"})),a._object=this,a._canvas=e,a._canvas._canvas_height=0,jQuery(a).trigger("svgready")},!1),b},c=function(a){this.navigation=new MASCP.CondensedSequenceRenderer.Navigation(a,this);var b=this.navigation,c=function(){b.demote()},d=function(){b.promote()};MASCP.IE||(jQuery(this._canvas).bind("panstart",c),jQuery(this._canvas).bind("panend",d),jQuery(this._canvas).bind("_anim_begin",c),jQuery(this._canvas).bind("_anim_end",d))},d=function(a){var b=this._RS,c=this.sequence.split(""),d=this,e=a.set(),f=!1,g=0,h=!0,i=function(){};try{var j=document.createElementNS(svgns,"text");j.setAttribute("textLength",10),i(j.textLength)}catch(k){h=!1}d.select=function(){var a=Array.prototype.slice.call(arguments);a[0],a[1];this.moveHighlight.apply(this,a)};var l;if(h&&"lengthAdjust"in document.createElementNS(svgns,"text")&&"textLength"in document.createElementNS(svgns,"text"))this.sequence.length<=1500?(l=a.text(0,12,document.createTextNode(this.sequence)),l.setAttribute("textLength",b*this.sequence.length)):(l=a.text(0,12,document.createTextNode(this.sequence.substr(0,1500))),l.setAttribute("textLength",1500*b)),l.style.fontFamily="'Lucida Console', 'Courier New', Monaco, monospace",l.setAttribute("lengthAdjust","spacing"),l.setAttribute("text-anchor","start"),l.setAttribute("dx",5),l.setAttribute("font-size",b),l.setAttribute("fill","#000000"),e.push(l);else{for(var m=0;m<c.length;m++)l=a.text(g,12,c[m]),l.firstChild.setAttribute("dy","1.5ex"),e.push(l),l.style.fontFamily="'Lucida Console', Monaco, monospace",g+=1;e.attr({y:-1e3,width:b,"text-anchor":"start",height:b,"font-size":b,fill:"#000000"})}var n=function(){if(!(d.sequence.length<=1500)){var a=parseInt(d.leftVisibleResidue());a-=50,a<0&&(a=0),a+1500>=d.sequence.length&&(a=d.sequence.length-1500-1),l.replaceChild(document.createTextNode(d.sequence.substr(a,1500)),l.firstChild),l.setAttribute("dx",5+a*b)}};a.addEventListener("panstart",function(){f&&e.attr({display:"none"}),jQuery(a).bind("panend",function(){f&&(e.attr({display:"block"}),n()),jQuery(a).unbind("panend",arguments.callee)})},!1),a.addEventListener("zoomChange",function(){a.zoom>3.5?(d._axis_height=14,e.attr({y:12*b,visibility:"visible"}),f=!0,n()):(d._axis_height=30,e.attr({y:-1e3,visibility:"hidden"}),f=!1),d.refresh()},!1)},e=function(a,b){var c=this._RS,d=0,e=0,f=a.set();f.push(a.path("M0 "+15*c+" l0 "+10*c)),f.push(a.path("M"+b*c+" "+14*c+" l0 "+10*c)),this._axis_height=20,f.attr({"pointer-events":"none"});var g=a.set(),h=a.set(),i=a.set(),j=a.set(),k=10,l=20;for(this.sequence.length>5e3&&(k=100,l=200),e=0;e<b/5;e++)d%k===0?g.push(a.path("M"+d*c+" "+14*c+" l 0 "+7*c)):h.push(a.path("M"+d*c+" "+16*c+" l 0 "+4*c)),d%l===0&&0!==d?i.push(a.text(d,5,""+d)):d%k===0&&0!==d&&j.push(a.text(d,7,""+d)),d+=5;for(e=0;e<i.length;e++)i[e].style.textAnchor="middle",i[e].setAttribute("text-anchor","middle"),i[e].firstChild.setAttribute("dy","1.5ex"),i[e].setAttribute("font-size",7*c+"pt");for(e=0;e<j.length;e++)j[e].style.textAnchor="middle",j[e].setAttribute("text-anchor","middle"),j[e].firstChild.setAttribute("dy","1.5ex"),j[e].setAttribute("font-size",2*c+"pt"),j[e].style.fill="#000000";g.attr({"pointer-events":"none"}),h.attr({"pointer-events":"none"}),i.attr({"pointer-events":"none"}),j.attr({"pointer-events":"none"}),h.attr({stroke:"#555555","stroke-width":.5*c+"pt"}),h.hide(),j.hide(),a.addEventListener("zoomChange",function(){this.zoom>3.6?(h.hide(),g.show(),g.attr({"stroke-width":.05*c+"pt",stroke:"#999999",transform:"scale(1,0.1) translate(0,4500)"}),j.attr({"font-size":2*c+"pt"}),i.attr({"font-size":2*c+"pt"}),f.hide(),this._visibleTracers&&this._visibleTracers()&&this._visibleTracers().show()):this.zoom>1.8?(f.show(),g.show(),f.attr({"stroke-width":.5*c+"pt"}),g.attr({"stroke-width":.5*c+"pt",stroke:"#000000",transform:""}),i.show(),i.attr({"font-size":4*c+"pt",y:7*c}),j.attr({"font-size":4*c+"pt"}),h.attr({"stroke-width":.3*c+"pt"}),h.show(),j.show(),this.tracers&&this.tracers.hide()):(this.tracers&&this.tracers.hide(),f.show(),f.attr({"stroke-width":c+"pt"}),g.show(),g.attr({"stroke-width":c+"pt",transform:"",stroke:"#000000"}),i.show(),i.attr({"font-size":7*c+"pt",y:5*c}),h.hide(),j.hide())},!1)};a.prototype.leftVisibleResidue=function(){var a=this;return Math.floor((a.sequence.length+a.padding+2)*(1-(a._canvas.width.baseVal.value+a._canvas.currentTranslate.x)/a._canvas.width.baseVal.value))-1},a.prototype.rightVisibleResidue=function(){var a=this;return Math.floor(a.leftVisibleResidue()+(a.sequence.length+a.padding+2)*(a._container_canvas.parentNode.getBoundingClientRect().width/a._canvas.width.baseVal.value))},a.prototype.setSequence=function(a){var c=this._cleanSequence(a);if(c==this.sequence&&null!==c)return void jQuery(this).trigger("sequenceChange");if(c){this.sequence=c;var f=this.sequence.split(""),g=f.length;if(0!==g){var h=this,i=[];jQuery(f).each(function(a){var b={};b._index=a,b._renderer=h,h._extendElement(b),b.amino_acid=this,i.push(b)}),this._sequence_els=i;var j=this._RS;jQuery(this).unbind("svgready").bind("svgready",function(a){var b=h._canvas;b.RS=j,b.setAttribute("background","#000000"),b.setAttribute("preserveAspectRatio","xMinYMin meet");var c=b.makeEl("defs");h._container_canvas.appendChild(c),c.appendChild(b.make_gradient("track_shine","0%","100%",["#111111","#aaaaaa","#111111"],[.5,.5,.5])),c.appendChild(b.make_gradient("simple_gradient","0%","100%",["#aaaaaa","#888888"],[1,1])),c.appendChild(b.make_gradient("left_fade","100%","0%",["#ffffff","#ffffff"],[1,0])),c.appendChild(b.make_gradient("right_fade","100%","0%",["#ffffff","#ffffff"],[0,1])),c.appendChild(b.make_gradient("red_3d","0%","100%",["#CF0000","#540000"],[1,1]));var f=b.makeEl("filter",{id:"drop_shadow",filterUnits:"objectBoundingBox",x:"0",y:"0",width:"150%",height:"130%"});f.appendChild(b.makeEl("feGaussianBlur",{"in":"SourceGraphic",stdDeviation:"4",result:"blur_out"})),f.appendChild(b.makeEl("feOffset",{"in":"blur_out",result:"the_shadow",dx:"3",dy:"1"})),f.appendChild(b.makeEl("feBlend",{"in":"SourceGraphic",in2:"the_shadow",mode:"normal"})),c.appendChild(f);var i=b.makeEl("svg",{width:"100%",height:"100%",id:"new_link_icon",viewBox:"0 0 100 100",preserveAspectRatio:"xMinYMin meet"});c.appendChild(i),i.appendChild(b.makeEl("rect",{x:"12.5",y:"37.5","stroke-width":"3",width:"50",height:"50",stroke:"#ffffff",fill:"none"})),i.appendChild(b.makeEl("path",{d:"M 50.0,16.7 L 83.3,16.7 L 83.3,50.0 L 79.2,56.2 L 68.8,39.6 L 43.8,66.7 L 33.3,56.2 L 60.4,31.2 L 43.8,20.8 L 50.0,16.7 z","stroke-width":"3",stroke:"#999999",fill:"#ffffff"}));var k=b.makeEl("svg",{width:"100%",height:"100%",id:"plus_icon",viewBox:"0 0 100 100",preserveAspectRatio:"xMinYMin meet"});k.appendChild(b.plus(0,0,100/b.RS)),c.appendChild(k);var l=b.makeEl("svg",{width:"100%",height:"100%",id:"minus_icon",viewBox:"0 0 100 100",preserveAspectRatio:"xMinYMin meet"});l.appendChild(b.minus(0,0,100/b.RS)),c.appendChild(l),e.call(this,b,g),d.call(this,b),h._layer_containers={},jQuery(h).trigger("sequenceChange")});var k=b.call(this);this._canvas?has_canvas=!0:"undefined"!=typeof svgweb?svgweb.appendChild(k,this._container):this._container.appendChild(k);var l=this;this.EnableHighlights();var m=function(a){l._canvas?a.apply():l.bind("sequenceChange",function(){jQuery(l).unbind("sequenceChange",arguments.callee),a.apply()})};return m.ready=function(a){this.call(this,a)},m}}}}(MASCP.CondensedSequenceRenderer),MASCP.CondensedSequenceRenderer.prototype.createHydropathyLayer=function(a){var b=this._RS,c=this._canvas;if(!c){var d=arguments.callee,e=this;return this._renderer.bind("sequencechange",function(){this._renderer.unbind("sequencechange",arguments.callee),d.call(e,a)}),void log("Delaying rendering, waiting for sequence change")}MASCP.registerLayer("hydropathy",{fullname:"Hydropathy plot",color:"#990000"});for(var f={A:1.8,R:-4.5,N:-3.5,D:-3.5,C:2.5,Q:-3.5,E:-3.5,G:-.4,H:-3.2,I:4.5,L:3.8,K:-3.9,M:1.9,F:2.8,P:-1.6,S:-.8,T:-.7,W:-.9,Y:-1.3,V:4.2},g="m"+b*(a-1)+" 0 ",h=null,i=-100,j=null,k=2.5*b,l=[],m=a;m<this._sequence_els.length-a;m++){for(var n=0,o=-1*a;o<=a;o++)n+=f[this._sequence_els[m+o].amino_acid[0]]/(2*a+1);k*n>i&&(i=k*n),(!j||k*n<j)&&(j=k*n),l[m]=n,g+=h?" l"+b+" "+-1*k*(h+n):" m"+b+" "+-1*k*n,h=n*-1}var p=this._canvas.path("M0 0 m0 "+i+" "+g);p.setAttribute("stroke","#ff0000"),p.setAttribute("stroke-width",.35*b),p.setAttribute("fill","none"),p.setAttribute("visibility","hidden");var q=this._canvas.path("M0 0 m0 "+-1*j+" l"+this._sequence_els.length*b+" 0");return q.setAttribute("stroke-width",.2*b),q.setAttribute("visibility","hidden"),p.setAttribute("pointer-events","none"),q.setAttribute("pointer-events","none"),this._layer_containers.hydropathy.push(p),this._layer_containers.hydropathy.push(q),this._layer_containers.hydropathy.fixed_track_height=(-1*j+i)/b,l},function(){var a=function(a){var b=this._renderer._canvas;if(!b){var c=arguments.callee,d=this;return this._renderer.bind("sequencechange",function(){this._renderer.unbind("sequencechange",arguments.callee),c.call(d,a)}),void log("Delaying rendering, waiting for sequence change")}var e=b.circle(this._index+.3,10,.25);e.setAttribute("visibility","hidden"),e.style.opacity="0.4";var f=b.rect(this._index+.3,10,.05,0);f.style.strokeWidth="0",f.style.fill=MASCP.layers[a].color,f.setAttribute("visibility","hidden"),b.insertBefore(f,b.firstChild.nextSibling);var g=this._renderer;this._renderer._layer_containers[a].tracers||(this._renderer._layer_containers[a].tracers=b.set()),b.tracers||(b.tracers=b.set(),b._visibleTracers=function(){return g._visibleTracers()});var h=b.marker(this._index+.3,10,.5,a.charAt(0).toUpperCase());return h.setAttribute("visibility","hidden"),this._renderer._layer_containers[a].tracers.push(f),this._renderer._layer_containers[a].tracers.push(e),this._renderer._layer_containers[a].push(h),b.tracers.push(f),[f,h,e]},b=function(a,b,c){"undefined"==typeof c&&(c=1);var d=this._renderer._canvas;if(!d){var e=arguments.callee,f=this;return this._renderer.bind("sequencechange",function(){this._renderer.unbind("sequencechange",arguments.callee),e.call(f,a,c,b)}),void log("Delaying rendering, waiting for sequence change")}for(var g=d.rect(-.25+this._index,60,b||1,4),h=parseFloat(g.getAttribute("x")),i=h+parseFloat(g.getAttribute("width")),j=this._renderer._layer_containers[a],k=0;k<j.length;k++){var l=parseFloat(j[k].getAttribute("x")),m=l+parseFloat(j[k].getAttribute("width"));if(l<=h&&h<=m||h<=l&&l<=i)return j[k].setAttribute("x",""+Math.min(l,h)),j[k].setAttribute("width",""+(Math.max(m,i)-Math.min(l,h))),g.parentNode.removeChild(g),j[k]}return this._renderer._layer_containers[a].push(g),g.setAttribute("class",a),g.style.strokeWidth="0px",g.setAttribute("visibility","hidden"),g.style.opacity=c,g.setAttribute("fill",MASCP.layers[a].color),g.position_start=this._index,g.position_end=this._index+b,g},c=function(a,b,c){var d=this._renderer._canvas;if(!d){var e=arguments.callee,f=this;return this._renderer.bind("sequencechange",function(){this._renderer.unbind("sequencechange",arguments.callee),e.call(f,a,b,c)}),void log("Delaying rendering, waiting for sequence change")}var g=d.rect(-.25+this._index,60,c||1,4);return this._renderer._layer_containers[a].push(g),g.style.strokeWidth="0px",g.setAttribute("fill",MASCP.layers[a].color),g.setAttribute("visibility","hidden"),g.setAttribute("class",a),g},d=function(a,b,c){var d=this._renderer._canvas,e=this._renderer;if("string"==typeof b){var f=document.createElement("div");f.innerHTML=e.fillTemplate(b,c),b=f}if(!d){var g=arguments.callee,h=this;return this._renderer.bind("sequencechange",function(){this._renderer.unbind("sequencechange",arguments.callee),g.call(h,a,width,c)}),void log("Delaying rendering, waiting for sequence change")}var i=d.callout(this._index+.5,.01,b,{width:c.width||100,height:c.height||100});return i.setAttribute("height",10*this._renderer._RS),this._renderer._canvas_callout_padding=Math.max(c.height||100,this._renderer._canvas_callout_padding||0),this._renderer._layer_containers[a].push(i),i.clear=function(){var b=e._layer_containers[a];b.indexOf(i)>0&&b.splice(b.indexOf(i),1),i.parentNode.removeChild(i)},i},e={},f=8,g=function(a,b,c){var d=this._renderer._canvas,g=this._renderer;if(!d){var h=arguments.callee,i=this;return this._renderer.bind("sequencechange",function(){this._renderer.unbind("sequencechange",arguments.callee),h.call(i,a,b,c)}),void log("Delaying rendering, waiting for sequence change")}"undefined"==typeof c?c={angle:0,border:"rgb(255,0,0)",content:"A"}:"undefined"==typeof c.angle&&(c.angle=0),e[a]||(e[a]={});var j=this._index+"_"+c.angle;"auto"==c.angle&&(e[a][j]||(e[a][j]={}));var k="undefined"!=typeof e[a][j],l=f,m=this._renderer._RS*l/2,n=e[a][j]?e[a][j]:d.growingMarker(0,m,c.content,c);if("auto"==c.angle&&(n.contents?n.contents.indexOf(c.content)<0&&n.contents.push(c.content):n.contents=[c.content],c.angle=1==n.contents.length?0:-45+90*(n.contents.indexOf(c.content)/(n.contents.length-1)),j=this._index+"_"+c.content,k="undefined"!=typeof e[a][j],n=e[a][j]?e[a][j]:d.growingMarker(0,m,c.content,c)),n.setAttribute("transform","translate("+(this._index+.25-.1)*this._renderer._RS+",0.01) scale(1,1) translate(0) rotate("+c.angle+",0.01,"+m+")"),e[a][j]=n,k||(n._value=0,this._renderer._layer_containers[a].push(n),this._renderer._layer_containers[a].fixed_track_height=f),n._value+=b,!k){var o=d.circle(this._index+.3,10+l,.25);o.setAttribute("visibility","hidden"),o.style.opacity="0.4";var p=d.rect(this._index+.25,10+l,.05,0);p.style.strokeWidth="0px",p.style.fill="#777777",p.setAttribute("visibility","hidden"),d.insertBefore(p,d.firstChild.nextSibling),this._renderer._layer_containers[a].tracers||(this._renderer._layer_containers[a].tracers=d.set()),d.tracers||(d.tracers=d.set(),d._visibleTracers=function(){return g._visibleTracers()}),this._renderer._layer_containers[a].tracers.push(p),this._renderer._layer_containers[a].tracers.push(o),d.tracers.push(p)}return this._renderer.redrawAnnotations(a,l),n};MASCP.CondensedSequenceRenderer.prototype._extendElement=function(e){e.addToLayer=a,e.addBoxOverlay=b,e.addToLayerWithLink=c,e.addAnnotation=g,e.callout=d},MASCP.CondensedSequenceRenderer.prototype.renderTextTrack=function(a,b){var c=a;"string"!=typeof c&&(c=a.name);var d=this._canvas;if(d&&"undefined"!=typeof c){var e=this._RS,f=this,g=parseInt(b.length/this.sequence.length),h=[];if(g>1)for(var i=b.match(new RegExp(".{"+g+"}","g")),j=0;j<i.length;j++)for(var k=i[j].length-1;k>=0;)h[k]||(h[k]=""),h[k]+=i[j].charAt(k),k-=1;else h=[b];var l=this._layer_containers[c],m=0,n=!0,o=function(){};try{var p=document.createElementNS(svgns,"text");p.setAttribute("textLength",10),o(p.textLength)}catch(q){n=!1}"ontouchend"in document&&(n=!1);var r;if(n&&"lengthAdjust"in document.createElementNS(svgns,"text")&&"textLength"in document.createElementNS(svgns,"text")){for(var j=0;j<h.length;j++)r=d.text(0,12,document.createTextNode(h[j])),r.style.fontFamily="'Lucida Console', 'Courier New', Monaco, monospace",r.setAttribute("lengthAdjust","spacing"),r.setAttribute("textLength",e*this.sequence.length),r.setAttribute("text-anchor","start"),r.setAttribute("dx",5),r.setAttribute("dy",(j+.25)*e),r.setAttribute("font-size",e),r.setAttribute("fill","#000000"),h.length>1&&r.setAttribute("rotate","90"),l.push(r);l.fixed_track_height=h.length}else{for(var s=b.split(""),j=0;j<s.length;j++)r=d.text(m,12,s[j]),r.firstChild.setAttribute("dy",1.5*(j%h.length)+"ex"),l.push(r),r.style.fontFamily="'Lucida Console', Monaco, monospace",j%h.length==0&&j>0&&(m+=1);l.attr({y:-1e3,width:e,"text-anchor":"start",height:e,"font-size":e,fill:"#000000"})}d.addEventListener("zoomChange",function(){d.zoom>3.5?f.showLayer(a):f.hideLayer(a),f.refresh()},!1)}},MASCP.CondensedSequenceRenderer.prototype.resetAnnotations=function(){e={}},MASCP.CondensedSequenceRenderer.prototype.removeAnnotations=function(a){var b=a;"string"!=typeof b&&(b=a.name);var c=this._canvas;if(c&&"undefined"!=typeof b){for(var d in e[b])if(e[b].hasOwnProperty(d)){var f=e[b][d],g=this._layer_containers[b];if(g.indexOf(f)>=0&&g.splice(g.indexOf(f),1),c.tracers&&g.tracers){for(var h=0;h<g.tracers.length;h++){var i=g.tracers[h];i.parentNode.removeChild(i),c.tracers.indexOf(i)>=0&&c.tracers.splice(c.tracers.indexOf(i),1)}g.tracers=c.set()}f.parentNode&&f.parentNode.removeChild(f),e[b][d]=null}e[b]=null,delete e[b],delete this._layer_containers[b].fixed_track_height}},MASCP.CondensedSequenceRenderer.prototype.redrawAnnotations=function(a){var b=this._canvas,c=null,d=0,g=b.suspendRedraw(1e4),h=0,i=f,j=0;for(d in e[a])if(e[a].hasOwnProperty(d)){if(e[a][d]._value>h&&(h=e[a][d]._value),c=e[a][d].parentNode,!c)continue;c.removeChild(e[a][d]),e[a][d]._parent=c}for(d in e[a])if(e[a].hasOwnProperty(d)){var k=e[a][d];if(!k.getAttribute)continue;var l=(.3+.6*k._value/h)*(this._RS*i*1);j=.5*(this._RS*i*1-l);var m=k.getAttribute("transform"),n=-.315*l,o=1/3*l;k.firstChild.setAttribute("y",j),m=m.replace(/translate\(\s*(-?\d+\.?\d*)\s*\)/,"translate("+n+")"),m=m.replace(/,\s*(-?\d+\.?\d*)\s*,\s*\d+\.?\d*\s*\)/,","+o+","+j+")"),k.setAttribute("transform",m),k.firstChild.setAttribute("width",l),k.firstChild.setAttribute("height",l)}for(d in e[a])if(e[a].hasOwnProperty(d)){if(c=e[a][d]._parent,!c)continue;c.appendChild(e[a][d])}b.unsuspendRedraw(g)},function(a){var b={};a.fillTemplate=function c(a,d){var e=/\W/.test(a)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):b[a]=b[a]||c(document.getElementById(a).innerHTML);return d?e(d):e}}(MASCP.CondensedSequenceRenderer.prototype)}(),MASCP.CondensedSequenceRenderer.prototype.EnableHighlights=function(){var a=this,b=[],c=function(){var c=a._canvas.rect(0,0,0,"100%");c.setAttribute("fill","#ffdddd");var d=c.parentNode;d.insertBefore(c,d.firstChild.nextSibling),b.push(c)};c(),a.moveHighlight=function(){var a=Array.prototype.slice.call(arguments),d=this._RS,e=0,f=0;for(e=0;e<a.length;e+=2){var g=a[e],h=a[e+1],i=b[f];i||(c(),i=b[f]),i.setAttribute("x",(g-.25)*d),i.setAttribute("width",(h-g)*d),i.setAttribute("visibility","visible"),f+=1}for(e=f;e<b.length;e++)b[e].setAttribute("visibility","hidden")}},MASCP.CondensedSequenceRenderer.prototype._visibleTracers=function(){var a=null;for(var b in MASCP.layers)this.isLayerActive(b)&&this._layer_containers[b].tracers&&(a?a.concat(this._layer_containers[b].tracers):a=this._layer_containers[b].tracers);return a},MASCP.CondensedSequenceRenderer.prototype._resizeContainer=function(){this._RS;if(this._container&&this._canvas){var a=2*(this.zoom||1)*this.sequence.length,b=2*(this.zoom||1)*(this._canvas._canvas_height/this._RS);this._canvas_callout_padding&&(b+=this._canvas_callout_padding),this._canvas.setAttribute("width",a),this._canvas.setAttribute("height",b),this.navigation.setDimensions(a,b),this.grow_container?(this._container_canvas.setAttribute("height",b),this._container.style.height=b+"px"):(this._container_canvas.setAttribute("height","100%"),this._container_canvas.setAttribute("width","100%"),this.navigation.setZoom(this.zoom))}},function(a){var b=function(a,b,c){var d=this;!b._layer_containers[d.name]||b._layer_containers[d.name].length<=0||c||b._layer_containers[d.name].tracers&&b._layer_containers[d.name].tracers.hide()};a.prototype.addTrack=function(a){var c=(this._RS,this);if(!this._canvas)return this.bind("sequencechange",function(){this.addTrack(a),this.unbind("sequencechange",arguments.callee)}),void console.log("No canvas, cannot add track, waiting for sequencechange event");var d=this._layer_containers||[];if(!d[a.name]||null===d[a.name]){d[a.name]=this._canvas.set(),d[a.name].track_height||(d[a.name].track_height=4),jQuery(a).unbind("visibilityChange",b).bind("visibilityChange",b);for(var e=["click","mouseover","mousedown","mousemove","mouseout","mouseup","mouseenter","mouseleave"],f=function(b,c,d){jQuery(a).trigger(b.type,[c,d.position_start,d.position_end])},g=0;g<e.length;g++)jQuery(d[a.name]._event_proxy).bind(e[g],f);jQuery(a).unbind("removed").bind("removed",function(){c.removeTrack(this)})}this._layer_containers=d},a.prototype.removeTrack=function(a){if(this._layer_containers){var b=this._layer_containers||[];b[a.name]&&(b[a.name].forEach(function(a){a.parentNode.removeChild(a)}),this.removeAnnotations(a),this._layer_containers[a.name]=null,a.disabled=!0)}},a.prototype.refresh=function(a){if(this._canvas){var b=this._layer_containers||[],c=this._RS,d=0,e=this.trackOrder||[];this.navigation&&this.navigation.reset();for(var f=0;f<e.length;f++){var g=e[f],h=b[g];if(h){var i;if(this.isLayerActive(g)){if(h.attr({opacity:"1"}),h.tracers){var j=this.isLayerActive(g)&&this.zoom>3.6?"visible":"hidden",k=(1.5+d/this.zoom)*c;h.fixed_track_height&&(k+=.5*h.fixed_track_height*c),a?h.tracers.animate({visibility:j,y:(this._axis_height-1.5)*c,height:k}):h.tracers.attr({visibility:j,y:(this._axis_height-1.5)*c,height:k})}if(h.fixed_track_height){var l=h.fixed_track_height;if(i=this._axis_height+(d-.3*l)/this.zoom,a?h.animate({visibility:"visible",y:i*c}):h.attr({visibility:"visible",y:i*c}),this.navigation){var m=this.grow_container?1/this.zoom:1;this.navigation.renderTrack(MASCP.getLayer(g),i*c,c*l,{"font-scale":h.track_height/l*3*m})}d+=this.zoom*l+this.trackGap}else i=this._axis_height+d/this.zoom,a?h.animate({visibility:"visible",y:i*c,height:c*h.track_height/this.zoom}):h.attr({visibility:"visible",y:i*c,height:c*h.track_height/this.zoom}),this.navigation&&(i-=1*h.track_height/this.zoom,this.navigation.renderTrack(MASCP.getLayer(g),i*c,3*c*h.track_height/this.zoom),d+=h.track_height),d+=h.track_height+this.trackGap;
h.refresh_zoom()}else{var n={y:-1*this._axis_height*c,height:c*h.track_height/this.zoom,visibility:"hidden"};if(MASCP.getLayer(g).group){var o=this.navigation.getController(MASCP.getLayer(g).group);o&&this.isLayerActive(o)&&(n.y=b[o.name].currenty())}h.fixed_track_height&&delete n.height,a?h.animate(n):h.attr(n),h.tracers}}}var p=[-1,0,0,0];p[0]=-2*c,p[2]=(this.sequence.split("").length+this.padding+2)*c,p[3]=(this._axis_height+d/this.zoom+this.padding)*c,this._canvas.setAttribute("viewBox",p.join(" ")),this._canvas._canvas_height=p[3];var q=[].concat(p);q[0]=0,q[2]=this.zoom*(2*this.sequence.length)+this.padding,q[3]=2*this.zoom*(this._axis_height+d/this.zoom+this.padding),this.grow_container||this._container_canvas.setAttribute("viewBox",q.join(" ")),this._resizeContainer(),p[0]=0,this.navigation&&(this.navigation.visible()?this._canvas.style.GomapScrollLeftMargin=100*c/this.zoom:this._canvas.style.GomapScrollLeftMargin=1e3,this.navigation.setViewBox(p.join(" "))),this.navigation&&this.navigation.refresh()}}}(MASCP.CondensedSequenceRenderer),MASCP.CondensedSequenceRenderer.Zoom=function(a){var b=null,c=null,d=null,e=null,f=null,g={setZoom:function(g){var h=a.sequence?.15*window.innerWidth/a.sequence.length:.5;if(g<h&&(g=h),g>10&&(g=10),g!=d){var i=this;if(i._canvas){if("center"==i.zoomCenter&&(i.zoomCenter={x:i._RS*(i.leftVisibleResidue()+.5*(i.rightVisibleResidue()-i.leftVisibleResidue()))}),i.zoomCenter&&!e)f=i._canvas.currentTranslate.x||0,e=i.zoomCenter?i.zoomCenter.x:0;else if(e&&!i.zoomCenter)return;b?clearTimeout(b):c=parseFloat(d||1),d=parseFloat(g);var j=i._canvas.parentNode.getAttribute("transform")||"";j=j.replace(/scale\([^\)]+\)/,"");var k=Math.abs(parseFloat(g)/c);if(j="scale("+k+") "+(j||""),i._canvas.parentNode.setAttribute("transform",j),jQuery(i._canvas).trigger("_anim_begin"),e){var l=(c-d)/(25*k)*e;l+=f/k,i._canvas.setCurrentTranslateXY(l,0)}var m=function(){b=null;var a=(Math.abs(parseFloat(d)/c),i._canvas.parentNode.getAttribute("transform")||"");if(a=a.replace(/scale\([^\)]+\)/,""),i._canvas.parentNode.setAttribute("transform",a),jQuery(i._canvas).trigger("_anim_end"),jQuery(i._canvas).one("zoomChange",function(){if("undefined"!=typeof e){var a=(c-d)/25*e;a+=f,i._canvas.shiftPosition?i._canvas.shiftPosition(a,0):i._canvas.setCurrentTranslateXY(a,0)}e=null,f=null}),i._canvas)if(i._canvas.zoom=parseFloat(d),document.createEvent){var g=document.createEvent("Events");g.initEvent("zoomChange",!1,!0),i._canvas.dispatchEvent(g)}else jQuery(i._canvas).trigger("zoomChange");jQuery(i).trigger("zoomChange")};"ontouchend"in document&&i.zoomCenter?(jQuery(i).unbind("gestureend"),jQuery(i).one("gestureend",m),b=1):b=setTimeout(m,100)}}},getZoom:function(){return d||1}};a.__defineSetter__&&(a.__defineSetter__("zoom",g.setZoom),a.__defineGetter__("zoom",g.getZoom)),Object.defineProperty&&!MASCP.IE8&&Object.defineProperty(a,"zoom",{get:g.getZoom,set:g.setZoom})},function(a){var b={getPadding:function(){return this._padding||10},setPadding:function(a){this._padding=a,this.refresh()},getTrackGap:function(){if(!this._track_gap){var a="ontouchend"in document?20:10;this._track_gap=this._track_gap||a}return this._track_gap},setTrackGap:function(a){this._track_gap=a,this.refresh()}};a.prototype.__defineSetter__&&(a.prototype.__defineSetter__("padding",b.setPadding),a.prototype.__defineGetter__("padding",b.getPadding),a.prototype.__defineSetter__("trackGap",b.setTrackGap),a.prototype.__defineGetter__("trackGap",b.getTrackGap)),Object.defineProperty&&!MASCP.IE8&&(Object.defineProperty(a.prototype,"padding",{get:b.getPadding,set:b.setPadding}),Object.defineProperty(a.prototype,"trackGap",{get:b.getTrackGap,set:b.setTrackGap}))}(MASCP.CondensedSequenceRenderer),MASCP.CondensedSequenceRenderer.Navigation=function(){var a=1,b=!1;"ontouchend"in document&&(a=2,b=!0);var c=function(a,b){SVGCanvas(a),f.call(this,a);var c=a.group();a.insertBefore(c,a.lastChild);var e=document.createElementNS(svgns,"svg");g.call(this,e,d.call(this,b)),c.appendChild(e),c.setAttribute("clip-path","url(#nav_clipping)"),this.demote=function(){e.hide()},this.promote=function(){this.visible()?e.show():e.hide()},this.setDimensions=function(b,c){a.setAttribute("width",b),a.setAttribute("height",c)}},d=function(a){var b={},c={},d=a.removeTrack;return a.removeTrack=function(a){d.call(this,a),delete b[a.name],delete c[a.name]},this.isController=function(a){return!!b[a.name]},this.getController=function(a){for(var c in b)if(b.hasOwnProperty(c)&&b[c]==a)return MASCP.getLayer(c);return null},this.isControllerExpanded=function(a){return c[a.name]},a.createGroupController=function(d,e){var f=MASCP.getLayer(d),g=MASCP.getGroup(e);if(f&&g&&!b[f.name]){b[f.name]=g,c[f.name]=!1;var h=this;jQuery(f).bind("removed",function(a,b){h.setGroupVisibility(g)}),jQuery(f).bind("visibilityChange",function(b,d,e){g.size()>0&&(h.setGroupVisibility(g,c[f.name]&&e,!0),a.refresh())}),jQuery(g).bind("visibilityChange",function(a,b,d){d&&(h.showLayer(f,!0),c[f.name]=!0)}),jQuery(f).unbind("_expandevent").bind("_expandevent",function(a){c[f.name]=!c[f.name],h.withoutRefresh(function(){h.setGroupVisibility(g,c[f.name])}),h.refresh(!0)})}},e(function(c,d,e){var f=a.trackOrder;f.trackIndex=function(a){return a?this.indexOf(a.name):this.length},e&&!d&&(d=MASCP.getLayer(f[f.trackIndex(e)+1])),f.splice(f.trackIndex(c),1);var g=[];if(b[c.name]&&MASCP.getGroup(b[c.name]).eachLayer(function(a){MASCP.getGroup(a)===a&&MASCP.getGroup(a).eachLayer(arguments.callee),f.trackIndex(a)>=0&&(g=[f.splice(f.trackIndex(a),1)[0]].concat(g))}),d){f.splice(f.trackIndex(d),1,c.name,d?d.name:void 0);for(var h=0;h<g.length;h++)g[h]&&f.splice(f.trackIndex(d),0,g[h])}else a.hideLayer(c),MASCP.getLayer(c).disabled=!0,g.forEach(function(b){a.hideLayer(b),MASCP.getLayer(b).disabled=!0}),f.push(c.name),f=f.concat(g);a.trackOrder=f})},e=function(a){var c,d,e,f=[],g=!1,h={},i=null,j=function(j,l,m,n){var o=this,p=o.reset;null===i&&(o.reset=function(){f=[],p.call(this)},i=!0);var q=function(){window.clearTimeout(h.anim),window.clearTimeout(h.hover);for(var a=0;a<f.length;a++)f[a]!=c&&(f[a].removeAttribute("transform"),f[a].setAttribute("pointer-events","all"))};f.push(l),l.track=m;var r=function(a){return function(b){b.touches&&1==b.touches.length&&a.call(this,b)}},s=function(h,i,j){if(!k()){var l=n.nearestViewportElement;if(!g){spliceBefore=null,spliceAfter=null;var o=j.nearestViewportElement.createSVGPoint();o.x=h.clientX||window.pageXOffset+h.touches[0].clientX,o.y=h.clientY||window.pageYOffset+h.touches[0].clientY;var p=j.nearestViewportElement.getScreenCTM(),s=p.inverse();o=o.matrixTransform(s);var t=o.x,v=o.y,w=function(a){var b=j.nearestViewportElement.createSVGPoint();b.x=a.clientX||window.pageXOffset+a.touches[0].clientX,b.y=a.clientY||window.pageYOffset+a.touches[0].clientY,b=b.matrixTransform(s);var c=b.x-t,d=b.y-v,e=j.getAttribute("transform")||"";return e=e.replace(/\s?translate\([^\)]+\)/,""),e+=" translate("+c+","+d+") ",e=e.replace(/\s*$/,""),j.setAttribute("transform",e),f.forEach(function(c){var d=c.getBBox();d.y<b.y&&d.y>b.y-d.height&&d.x<b.x&&d.x>b.x-d.width&&u.call(c,a,c.track)}),a.stopPropagation(),a.preventDefault(),!1};b&&(w=r(w));var x=function(b){return!b.relatedTarget||b.relatedTarget!=j&&b.relatedTarget.nearestViewportElement!=j.nearestViewportElement&&b.relatedTarget.nearestViewportElement!=l?(!g||"mouseup"!=b.type&&"touchend"!=b.type||(spliceBefore||spliceAfter)&&a(d,spliceBefore,spliceAfter),l.removeEventListener("touchmove",w,!1),l.removeEventListener("mousemove",w,!1),l.removeEventListener("touchend",arguments.callee,!1),l.removeEventListener("mouseup",arguments.callee,!1),l.removeEventListener("mouseout",arguments.callee,!1),void(g&&(j.setAttributeNS(null,"pointer-events","all"),j.removeAttribute("transform"),q(),g=!1,e=null))):void(g&&f.indexOf(b.relatedTarget)>=0&&q())};j.setAttributeNS(null,"pointer-events","none"),j.addEventListener("touchmove",w,!1),j.addEventListener("touchend",x,!1),l.addEventListener("mousemove",w,!1),l.addEventListener("mouseup",x,!1),l.addEventListener("mouseout",x,!1),g=m,c=j}}},t=function(a){s(a,m,l)},u=function(a,b){var i=b?b:m,j=this?this:l;g&&g!=i&&i!=e&&(e=i,h.hover&&window.clearTimeout(h.hover),h.hover=window.setTimeout(function(){if((g.group||i.group)&&(g.group?i.group:!i.group)){if(g.group.name!=i.group.name)return}else if(g.group||i.group)return;h.anim&&(window.clearInterval(h.anim),h.anim=null),q();for(var a=j,b=[];null!==a&&(a!=c&&f.indexOf(a)>=0&&b.push(a),a=a.nextSibling,a!=c););a=j.previousSibling;for(var e=[];null!==a&&(a!=c&&f.indexOf(a)>=0&&e.push(a),a=a.previousSibling,a!=c););var k=1,l=c.getBBox().height/4;h.anim=window.setInterval(function(){var a,c=0;if(k<5){for(c=0;c<b.length;c++)a=b[c].getAttribute("transform")||"",a=a.replace(/\s?translate\([^\)]+\)/,""),a+=" translate(0,"+k*l+")",b[c].setAttribute("transform",a);for(c=0;b.length>0&&c<e.length;c++)a=e[c].getAttribute("transform")||"",a=a.replace(/\s?translate\([^\)]+\)/,""),a+=" translate(0,"+k*-1*l+")",e[c].setAttribute("transform",a);k+=1}else spliceBefore=i,d=g,window.clearInterval(h.anim),h.anim=null},30)},300))};j.addEventListener("mousedown",t,!1),j.addEventListener("touchstart",r(t),!1)},k=function(){return j.disabled};return j.spliceFunction=a,j},f=function(c){var d=this,e=200+100*(a-1),f=c.group(),g=c.group(),h=c.rect(-10,0,e.toString(),"100%"),i=[12*a,10*a];h.setAttribute("rx",i[0].toString()),h.setAttribute("ry",i[1].toString()),b||h.setAttribute("opacity","0.8"),h.style.stroke="#000000",h.style.strokeWidth="2px",h.style.fill="#000000",h.id="nav_back",f.push(h);var j=document.createElementNS(svgns,"clipPath");j.id="nav_clipping";var k=document.createElementNS(svgns,"use");k.setAttributeNS("http://www.w3.org/1999/xlink","href","#nav_back"),c.insertBefore(j,c.firstChild),j.appendChild(k);var l=c.crossed_circle(e-(10+11*a),12*a,10*a);l.style.cursor="pointer",g.push(l);var m=MASCP.IE?c.svgbutton(10,5,65,25,"Edit"):c.button(10,5,65,25,"Edit");m.id="controls",m.parentNode.setAttribute("clip-path","url(#nav_clipping)"),f.push(MASCP.IE?m:m.parentNode);var n=document.createElementNS(svgns,"foreignObject");n.setAttribute("x","0"),n.setAttribute("y","0"),n.setAttribute("width","100"),n.setAttribute("height","45"),n.setAttribute("clip-path","url(#nav_clipping)"),f.push(n),m.addEventListener("click",function(){jQuery(d).trigger("toggleEdit"),jQuery(d).trigger("click")},!1);var o=!0,p=function(b){o=b===!1||b===!0?b:!o;var c;return o?(d.promote(),f.setAttribute("visibility","visible"),l._button.removeAttribute("filter"),c=l.getAttribute("transform")||" ",c=c.replace(/translate\(.*\)/,""),c=c.replace(/rotate\(.*\)/,""),l.setAttribute("transform",c),n.setAttribute("display","inline"),d.refresh()):(d.demote(),f.setAttribute("visibility","hidden"),l._button.setAttribute("filter","url(#drop_shadow)"),c=l.getAttribute("transform")||" ",c=c+" translate("+-.75*e+",0) rotate(45,"+(e-(10+11*a))+","+12*a+") ",l.setAttribute("transform",c),n.setAttribute("display","none")),!0};d.hide=function(){p.call(this,!1)},d.show=function(){p.call(this,!0)},d.visible=function(){return o},d.setZoom=function(a){l.setAttribute("transform","scale("+a+","+a+") "),h.setAttribute("transform","scale("+a+",1) "),h.setAttribute("ry",(a*i[1]).toString()),d.refresh()},l.addEventListener("click",function(){o?d.hide():d.show()},!1)},g=function(c,d){var e,f,g,h=this,i=0;SVGCanvas(c),c.setAttribute("preserveAspectRatio","xMinYMin meet");var j=[];h.reset=function(){for(;c.firstChild;)c.removeChild(c.firstChild);j=[],k=[]};var k=[];h.refresh=function(){if((e||[]).forEach(function(a){a.setAttribute("visibility",g?"visible":"hidden")}),(f||[]).forEach(function(a){a.setAttribute("visibility",g?"hidden":"visible")}),g?l.call(this,!0):l.call(this,!1),"none"!=c.getAttribute("display")){var a=document.getElementById("nav_back"),b=a.getScreenCTM().inverse().multiply(c.getScreenCTM()).inverse(),d=document.getElementById("nav_back").getBBox().width+document.getElementById("nav_back").getBBox().x,h=c.createSVGPoint();h.x=d,h.y=0,i=h.matrixTransform(b).x,k.forEach(function(a){var b=0;try{b=a.getBBox().width}catch(c){}if(b>0){var d=/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/.exec(a.getAttribute("transform")||"");if("undefined"==typeof d)return;d=d[2];var e=i-1.5*parseInt(a.getAttribute("width"),10);a.setAttribute("transform","translate("+e+","+d+")")}})}};var l=function(a){j&&(j||[]).forEach(function(c){c.setAttribute("opacity",a?"1":b?"0.5":"0.1"),c.setAttribute("pointer-events",a?"all":"none")})};jQuery(h).bind("toggleEdit",function(){g="undefined"==typeof g||!g,d.disabled=!g,l.call(h,g),h.hide(),h.show(),(e||[]).forEach(function(a){a.setAttribute("visibility",g?"visible":"hidden")}),(f||[]).forEach(function(a){a.setAttribute("visibility",g?"hidden":"visible")})}),this.setViewBox=function(a){c.setAttribute("viewBox",a)},c.style.height="100%",c.style.width="100%",c.setAttribute("height","100%"),c.setAttribute("width","100%"),this.renderTrack=function(g,l,m,n){var o=c.group(),p=c.rect(0,l,"100%",m);p.setAttribute("stroke","#000000"),p.setAttribute("stroke-width","2"),p.setAttribute("fill","url(#simple_gradient)"),p.setAttribute("opacity",b?"0.5":"0.1"),p.setAttribute("pointer-events","none"),j=j||[],j.push(p),o.push(p);var q=n&&n["font-scale"]?n["font-scale"]:1,r=4/3*a*m*q,s=c.text(r,l+.5*m,g.fullname);s.setAttribute("height",m),s.setAttribute("width",m),s.setAttribute("font-size",.6*m*q),s.setAttribute("fill","#ffffff"),s.setAttribute("stroke","#ffffff"),s.setAttribute("stroke-width","1"),s.firstChild.setAttribute("dy","0.5ex"),o.push(s),s.setAttribute("pointer-events","none");var t;if(g.href){a_anchor=c.a(g.href);var u=null,v=[.5*m*q,0,m*q*a];v[1]=-.5*(v[2]-m),t=c.circle(v[0]+.5*v[2],.5*m,.5*v[2]),t.setAttribute("fill","#ffffff"),t.setAttribute("opacity","0.1"),a_anchor.appendChild(t);var w=g.href;"string"==typeof w&&w.match(/^javascript\:/)?u="#plus_icon":"function"==typeof w?(u="#plus_icon",a_anchor.setAttribute("href","#"),a_anchor.removeAttribute("target"),a_anchor.addEventListener("click",function(a){return w.call(),a.preventDefault?a.preventDefault():a.returnResult=!1,a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,!1},!1)):u="#new_link_icon",g.icon&&(u=g.icon);var x=c.use(u,v[0],v[1],v[2],v[2]);x.style.cursor="pointer",a_anchor.appendChild(x),a_anchor.setAttribute("transform","translate("+(i-1.5*v[2])+","+l+")"),a_anchor.setAttribute("width",v[2].toString()),k.push(a_anchor)}if(o.addEventListener("touchstart",function(){o.onmouseover=void 0,o.onmouseout=void 0},!1),o.addEventListener("touchend",function(){o.onmouseover=void 0,o.onmouseout=void 0},!1),d.call(this,p,o,g,c),function(){if(!g.group){var b=.5*m*a;e||(e=[]);var f=c.crossed_circle(1.5*b,0,b);f.setAttribute("transform","translate(0,"+(l+.5*m)+") scale("+q+")"),f.firstChild.setAttribute("fill","url(#red_3d)");for(var h=f.childNodes,i=0,j=h.length;i<j;i++)h[i].setAttribute("stroke-width",(b/4).toString());f.addEventListener("click",function(){d.spliceFunction(g)},!1),o.push(f),e.push(f),f.setAttribute("visibility","hidden")}}(),this.isController(g)){f||(f=[]);var y=.5*m*a,z=c.group();t=c.circle(1.5*y,0,y),t.setAttribute("fill","#ffffff"),t.setAttribute("opacity","0.1"),z.push(t);var A=[1.1*y,-1.25*y,2.25*y,-.5*y,1.1*y,.25*y];A[1]+=.5*(y-0*m),A[3]+=.5*(y-0*m),A[5]+=.5*(y-0*m);var B=c.poly(""+A[0]+","+A[1]+" "+A[2]+","+A[3]+" "+A[4]+","+A[5]);this.isControllerExpanded(g)?z.setAttribute("transform","translate(0,"+(l+.5*m)+") scale("+q+") rotate(90,"+1.5*y+","+A[3]+")"):z.setAttribute("transform","translate(0,"+(l+.5*m)+") scale("+q+")"),B.setAttribute("height",1.75*y),B.setAttribute("font-size",1.5*y),B.setAttribute("fill","#ffffff"),B.setAttribute("pointer-events","none"),z.push(B),z.style.cursor="pointer",z.addEventListener("click",function(a){a.stopPropagation(),jQuery(g).trigger("_expandevent"),h.isControllerExpanded(g)?z.setAttribute("transform","translate(0,"+(l+.5*m)+") scale("+q+") rotate(90,"+1.5*y+","+A[3]+")"):z.setAttribute("transform","translate(0,"+(l+.5*m)+") scale("+q+")")},!1),o.push(z),f.push(z),z.setAttribute("visibility","hidden")}}};return c}(),"undefined"==typeof MASCP&&(MASCP={}),"undefined"==typeof MASCP.TagVisualisation&&(MASCP.TagVisualisation={}),MASCP.TagVisualisation=function(a,b){this.datasetName=a,this._buildRichTableView(b)},MASCP.TagVisualisation.prototype={__class__:MASCP.TagVisualisation,visualisations:null,datasetName:"",tagColumn:""},MASCP.TagVisualisation.prototype._buildRichTableView=function(a){var b=this.datasetName,c=document.getElementById(b);if(c.getAttributeNS){var d=parseInt(c.getAttributeNS("MASCP.TagVisualisation","tagcolumn"),10);this.tagColumn=d?d:this._getTagColumn()}else this.tagColumn=this._getTagColumn();var e=c.parentNode,f=null;if("BODY"==e.nodeName){f=e;var g=document.createElement("div");c.parentNode.replaceChild(g,c),g.appendChild(c),e=c.parentNode}else f=e.parentNode;this._dataTableContainer=e;var h=this._buildRichTagInfoContainer(e);f.insertBefore(h,e),this._displayElement=h;for(var i=0;i<a.length;i++)this.addVisualisation(new a[i](this));c.old_style=c.style.display,c.style.display="none"},MASCP.TagVisualisation.prototype._getDisplayWidth=function(a){var b;return void 0!==window.getComputedStyle?b=getComputedStyle(a,""):void 0!==document.defaultView.getComputedStyle&&(b=document.defaultView.getComputedStyle(a,"")),void 0!==b?parseInt(b.getPropertyValue("width").replace(/px/,""),10):void 0},MASCP.TagVisualisation.prototype._buildRichTagInfoContainer=function(a){var b=document.createElement("div");return b.setAttribute("id","rich_"+this.datasetName),b.setAttribute("class","rich_as_data "+a.className),b.style.width=a.style.width,b.style.height=a.style.height,b.style.display=a.style.display,b.style.position=a.style.position,b},MASCP.TagVisualisation.prototype.toggleTagView=function(){var a=document.getElementById(this.datasetName);"none"==a.style.display?(a.style.display=a.old_style,this.getDisplayElement().style.display="none"):(a.style.display="none",this.getDisplayElement().style.display="block")},MASCP.TagVisualisation.prototype.getDisplayElement=function(){return this._displayElement},MASCP.TagVisualisation.prototype.addVisualisation=function(a){this.visualisations||(this.visualisations=[]),this.getDisplayElement().appendChild(a.getDisplayElement()),this.visualisations.push(a)},MASCP.TagVisualisation.prototype.getAllTags=function(){for(var a=document.getElementById(this.datasetName),b=a.getElementsByTagName("tbody")[0].getElementsByTagName("tr"),c={},d=0;d<b.length;d++)tagname=b[d].getElementsByTagName("td")[this.tagColumn].childNodes[0].data,c[b[d].id]=tagname;return c},MASCP.TagVisualisation.prototype._getTagColumn=function(){for(var a=document.getElementById(this.datasetName),b=a.getElementsByTagName("thead")[0].getElementsByTagName("tr")[0].getElementsByTagName("th"),c=0;c<b.length;c++)if("tag"==b[c].childNodes[0].data.toLowerCase())return c;return 1},MASCP.TagVisualisation.prototype._getColumnCount=function(){var a=document.getElementById(this.datasetName),b=a.getElementsByTagName("thead")[0].getElementsByTagName("tr")[0].getElementsByTagName("th");return b.length-this._getTagColumn()-1},void 0===typeof MASCP.TagVisualisation.TagCloud&&(MASCP.TagVisualisation.TagCloud={}),MASCP.TagVisualisation.TagCloud=function(a){this._tagVisualiser=a,this._initElements()},MASCP.TagVisualisation.TagCloud.prototype={__class__:MASCP.TagVisualisation.TagCloud},MASCP.TagVisualisation.TagCloud.ELEMENT_CSS_CLASS="rich_tagcloud",MASCP.TagVisualisation.TagCloud.ELEMENT_ID_PREFIX="rich_tagcloud_",MASCP.TagVisualisation.TagCloud.TAG_ELEMENT_CSS_CLASS="rich_tagcloud_tag",MASCP.TagVisualisation.TagCloud.TAG_ELEMENT_ID_PREFIX="rich_tagcloud_tag_",MASCP.TagVisualisation.TagCloud.prototype._initElements=function(){return this._displayElement=document.createElement("div"),this._displayElement.setAttribute("id",MASCP.TagVisualisation.TagCloud.ELEMENT_ID_PREFIX+this._tagVisualiser.datasetName),this._displayElement.setAttribute("class",MASCP.TagVisualisation.TagCloud.ELEMENT_CSS_CLASS),this._displayElement},MASCP.TagVisualisation.TagCloud.prototype.getDisplayElement=function(){return this._displayElement},MASCP.TagVisualisation.TagCloud.prototype.update=function(a){var b,c=this.getDisplayElement(),d=document.getElementById(this._tagVisualiser.datasetName),e={},f={},g=d.getElementsByTagName("tbody")[0].getElementsByTagName("tr"),h=0,i=[];for(b=0;b<g.length;b++){var j=g[b].getElementsByTagName("td"),k=parseFloat(j[this._tagVisualiser.tagColumn+a].childNodes[0].data);if(0!==j[this._tagVisualiser.tagColumn].childNodes.length){var l=j[this._tagVisualiser.tagColumn].childNodes[0].data;e[l]=k,f[l]=j,h=Math.max(h,k),i[b]=l}}for(i.sort(),b=0;b<i.length;b++){var m=i[b];if(m){var n,o=m.replace(/\s+/,"_");null!==document.getElementById(MASCP.TagVisualisation.TagCloud.TAG_ELEMENT_ID_PREFIX+o)&&(n=document.getElementById(MASCP.TagVisualisation.TagCloud.TAG_ELEMENT_ID_PREFIX+o),n.parentNode.removeChild(n)),n=this.tagFactory(o,m,f[m]),c.appendChild(n);var p=Math.floor(30*Math.log(1.5+e[m]/h));n.style.fontSize=p+"px",n.setAttribute("class",MASCP.TagVisualisation.TagCloud.TAG_ELEMENT_CSS_CLASS)}}if(!c.hasSpacer){var q=document.createElement("div");q.setAttribute("class","spacer"),q.setAttribute("style","width: 100%; height: 0px; clear: both;"),c.appendChild(q),c.hasSpacer=!0}},MASCP.TagVisualisation.TagCloud.prototype.tagFactory=function(a,b,c){var d=document.createElement("span");return d.setAttribute("id",MASCP.TagVisualisation.TagCloud.TAG_ELEMENT_ID_PREFIX+a),d.textContent=b,d},"undefined"==typeof GOMap&&(GOMap={}),function(){var a=function(){var a,b=3,c=document.createElement("div"),d=c.getElementsByTagName("i");do c.innerHTML="<!--[if gt IE "+ ++b+"]><i></i><![endif]-->";while(d[0]);return b>4?b:a}();a&&(7===a&&(GOMap.IE=!0,GOMap.IE7=!0),8===a&&(GOMap.IE=!0,GOMap.IE8=!0))}(),GOMap.IE&&"undefined"==typeof svgweb&&"undefined"==typeof SVGWEB_LOADING&&!window.svgns){var svg_path="svgweb/";"undefined"!=typeof SVGWEB_PATH&&(svg_path=SVGWEB_PATH);var scriptTag=document.createElement("script");scriptTag.src=svg_path+"svg.js",scriptTag.type="text/javascript",scriptTag.setAttribute("data-path",svg_path),document.getElementsByTagName("head")[0].insertBefore(scriptTag,document.getElementsByTagName("head")[0].firstChild),SVGWEB_LOADING=!0}log="undefined"==typeof log?"undefined"==typeof console?function(){}:function(a){return"String"==typeof a&&1==arguments.length?console.log("%s",a):console.log("%o: %o",a,this),this}:log,window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1e3/60)}}(),window.attachEvent?window.onload=function(){GOMap.LOADED=!0}:GOMap.LOADED=!0,GOMap.Diagram=function(a,b){if(null!==a){this._highlighted={},this._styles_cache={},this.enabled=!0;var c=this,d=null;if("string"==typeof a)d=a,a=null;else if(a.nodeName&&"object"==a.nodeName.toLowerCase())d=a.getAttribute("src")||a.getAttribute("data");else if(a.nodeName&&"svg"==a.nodeName.toLowerCase())return void function(){return GOMap.LOADED?(c._container=a.parentNode,c.element=a,c._svgLoaded(),c.loaded=!0,b.load&&b.load.apply(c),void(c.onload&&c.onload.apply(c))):void window.attachEvent("onload",arguments.callee)}();this.element=document.createElement("object",!0),this.element.setAttribute("data",d),this.element.setAttribute("type","image/svg+xml"),this.element.setAttribute("width","100%"),this.element.setAttribute("height","100%"),this.element.setAttribute("style","background: transparent;"),this.element.addEventListener||(this.element.addEventListener=function(a,b){this.attachEvent(a,b)});var e="undefined"!=typeof svgweb;this.element.addEventListener(e?"SVGLoad":"load",function(){var a=this;if(!this.nodeName)return void console.log("The SVG hasn't been loaded properly");null!==a.contentDocument?c.element=a.contentDocument.rootElement:c.element=a.getAttribute("contentDocument").rootElement;var d=a;c.destroy=function(){d&&d.parentNode&&("undefined"!=typeof svgweb?svgweb.removeChild(d,d.parentNode):d.parentNode.removeChild(d))},c._svgLoaded(),c.loaded=!0,b.load&&b.load.apply(c),c.onload&&c.onload.apply(c)},!1),a&&(this.appendTo(a.parentNode),a.parentNode.removeChild(a))}},GOMap.Diagram.prototype.appendTo=function(a){return this._container=a,"undefined"!=typeof svgweb?svgweb.appendChild(this.element,a):a.appendChild(this.element),this},GOMap.Diagram.prototype.showKeyword=function(a,b){var c=this._elementsForKeyword(a);if(0===c.length)return!1;if(this._highlighted[a]&&!b)return!0;b=b||"#ff0000",this._highlighted[a]=!0;for(var d=0;d<c.length;d++)c[d]._highlighted=c[d]._highlighted||{},c[d]._highlighted[b]=!0,"path"!=c[d].nodeName&&"circle"!=c[d].nodeName&&"ellipse"!=c[d].nodeName||this._outlineElement(c[d]);var e=this;return this._recurse(c,function(a){return e._highlightElement(a),!0}),!0},GOMap.Diagram.prototype.zoomToKeyword=function(a){for(var b=this.element,c=this._elementsForKeyword(a),d=null,e=0;e<c.length;e++)if("g"==c[e].nodeName){d=c[e];break}if(!d)return void(b._baseViewBox&&b.setAttribute("viewBox",b._baseViewBox));if(d.getBBox){var f=d.getBBox();b.getBBox();b._baseViewBox||(b._baseViewBox=b.getAttribute("viewBox"));var g=[f.x-10,f.y-10,f.width+20,f.height+20];b.setAttribute("viewBox",g.join(" "))}},GOMap.Diagram.prototype.hideAllKeywords=function(){for(var a in this._highlighted)this._highlighted.hasOwnProperty(a)&&this.hideKeyword(a)},GOMap.Diagram.prototype.hideKeyword=function(a,b){var c=this._elementsForKeyword(a),d=this;this._highlighted[a]=!1,this._recurse(c,function(a){null!==b&&a._highlighted?a._highlighted[b]=!1:a._highlighted={};for(var c in a._highlighted)if(a._highlighted[c]===!0)return"path"!=a.nodeName&&"circle"!=a.nodeName&&"ellipse"!=a.nodeName||d._outlineElement(a),!1;return d._restoreStyle(a),!0})},GOMap.Diagram.prototype.toggleKeyword=function(a,b){return this._highlighted[a]?(this.hideKeyword(a),!1):this.showKeyword(a,b)},GOMap.Diagram.prototype.clearMarkers=function(a){if(this.markers){if(a)return void this._clearMarkers(this.markers[a]);for(var b in this.markers)this.markers.hasOwnProperty(b)&&this._clearMarkers(this.markers[b]);this.markers={}}},GOMap.Diagram.prototype._clearMarkers=function(a){if(a)for(var b=0;b<a.length;b++)a[b].parentNode.removeChild(a[b])},GOMap.Diagram.prototype.addMarker=function(a,b){this.markers||(this.markers={}),b||(b=1);var c,d=this.element;if(this.markers[a])for(this.markers[a].current_radius+=b,c=0;c<this.markers[a].length;c++)this.markers[a][c].setAttribute("r",this.markers[a].current_radius);else{var e=this._elementsForKeyword(a);for(this.markers[a]=[],this.markers[a].current_radius=b,c=0;c<e.length;c++){var f=e[c];if("g"==f.nodeName){var g=f.getBBox(),h=g.x+g.width/2,i=g.y+g.height/2;circle=document.createElementNS(svgns,"circle"),circle.setAttribute("cx",h),circle.setAttribute("cy",i),circle.setAttribute("r",this.markers[a].current_radius),circle.setAttribute("fill","#ff0000"),this.markers[a].push(circle),d.appendChild(circle)}}}},GOMap.Diagram.prototype.addEventListener=function(a,b){this._events||(this._events={}),this._events[a]||(this._events[a]=[]),this._events[a].push(b)},function(){var a=function(){if(this._events&&this._events.zoomChange)for(var a=0;a<this._events.zoomChange.length;a++)this._events.zoomChange[a].apply(this,[{type:"zoomChange"}])},b={setZoom:function(b){b<0&&(b=0),this.element&&(this.element.currentScale=b),a.apply(this)},getZoom:function(){return this.element.currentScale}};GOMap.Diagram.prototype.__defineSetter__&&(GOMap.Diagram.prototype.__defineSetter__("zoom",b.setZoom),GOMap.Diagram.prototype.__defineGetter__("zoom",b.getZoom))}(),GOMap.Diagram.prototype.makeInteractive=function(){var a=this.element,b=this._container;try{a.addEventListener}catch(c){return void console.log("Browser does not support addEventListener")}(new GOMap.Diagram.Dragger).applyToElement(a);var d=GOMap.Diagram.addZoomControls(this,.1,2,.1,1);b.appendChild(d),d.style.position="absolute",d.style.top="0px",d.style.left="0px",d.style.height="30%"},GOMap.Diagram.prototype._svgLoaded=function(){this._forceOpacity()},GOMap.Diagram.prototype._elementsForKeyword=function(a){var b=this.element,c=[];if(GOMap.IE)for(var d=b.ownerDocument.getElementsByTagNameNS(svgns,"*"),e=0;e<d.length;e++){var f=d[e].getAttribute("keyword");f==a&&c.push(d[e])}else c=this._execute_xpath(b,"//*[@keyword = '"+a+"']",b.ownerDocument);return c},GOMap.Diagram.prototype._execute_xpath=function(a,b,c){var d=[],e=0;if(c.evaluate)for(xpath_result=c.evaluate(b,a,null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null);null!==(a_result=xpath_result.snapshotItem(e));)d.push(a_result),e++;else for(xpath_result=a.selectNodes(b),e=0;e<xpath_result.length;e++)d[e]=xpath_result.item(e);return d},GOMap.Diagram.prototype._recurse=function(a,b){for(var c=0;c<a.length;c++){var d=b.call(this,a[c]);d&&a[c].childNodes.length>0&&this._recurse(a[c].childNodes,b)}},GOMap.Diagram.prototype._cacheStyle=function(a){if(!a.id){var b="svg"+(new Date).getTime().toString()+Math.floor(1e3*Math.random());a.setAttribute("id",b)}null===this._styles_cache[a.id]&&a.style&&a.id&&(!a.style.stroke||a.style.strokeWidth||a.style.getPropertyValue("stroke-width")||(a.style.strokeWidth="1"),this._styles_cache[a.id]={stroke:a.style.stroke||a.style.getPropertyValue("stroke"),"stroke-width":a.style.strokeWidth||a.style.getPropertyValue("stroke-width")||"0px",opacity:a.style.getPropertyValue("opacity"),"fill-opacity":a.style.fillOpacity||a.style.getPropertyValue("fill-opacity"),"stroke-opacity":a.style.strokeOpacity||a.style.getPropertyValue("stroke-opacity")})},GOMap.Diagram.prototype._restoreStyle=function(a){if(a.style&&this._styles_cache[a.id]){var b=this._styles_cache[a.id];for(var c in{"stroke-width":null,opacity:null,stroke:null,"fill-opacity":null,"stroke-opacity":null})GOMap.IE&&!b[c]||a.style.setProperty(c,b[c],null)}},GOMap.Diagram.prototype._outlineElement=function(a){if(a.style){this._cacheStyle(a);var b=this._calculateColorForElement(a);a.style.setProperty("stroke",b,null),a.style.setProperty("stroke-width",1,null),a.style.setProperty("stroke-opacity",1,null)}},GOMap.Diagram.prototype._calculateColorForElement=function(a){var b,c="pat",d=0;if(a._animates){for(b=0;b<a._animates.length;b++)a.removeChild(a._animates[b]);a._animates=null}for(var e in a._highlighted)a._highlighted&&a._highlighted[e]===!0&&(c+="_"+e,d++);var f=document.createElementNS(svgns,"animate").beginElement;if(1==d)return c.split(/_/)[1];if(f){var g=this._buildAnimatedColor(c,a.id);for(b=0;b<g.length;b++)a.appendChild(g[b]);return g[0].beginElement(),a._animates=g,c.split(/_/)[1]}return this._buildPattern(c)},GOMap.Diagram.prototype._buildPattern=function(a){var b=a.split("_");b.shift(),this._cached_patterns=this._cached_patterns||{};var c=a.replace(/#/g,"");if(this._cached_patterns[c])return"url(#"+c+")";var d=this.element,e=d.ownerDocument.getElementsByTagNameNS(svgns,"defs")[0];e||(e=document.createElementNS(svgns,"defs"),d.appendChild(e));var f=document.createElementNS(svgns,"pattern");f.setAttribute("x","0"),f.setAttribute("y","0"),f.setAttribute("width","30"),f.setAttribute("height","30"),f.setAttribute("viewBox","0 0 100 100"),f.setAttribute("patternUnits","userSpaceOnUse"),f.setAttribute("patternTransform","rotate(45)"),f.setAttribute("id",c);for(var g=100/b.length,h=0,i=0;i<b.length;i++){var j=document.createElementNS(svgns,"rect");j.setAttribute("x",h),h+=g,j.setAttribute("y",0),j.setAttribute("width",g),j.setAttribute("height",100),j.setAttribute("fill",b[i]),f.appendChild(j)}return e.appendChild(f),this._cached_patterns[c]=!0,"url(#"+c+")"},GOMap.Diagram.prototype._buildAnimatedColor=function(a,b){var c=a.split("_");c.shift(),this._cached_patterns=this._cached_patterns||{};var d=a.replace(/#/g,"");if(this._cached_patterns[d])return"url(#"+d+")";d=b+d;var e=this.element,f=e.ownerDocument.getElementsByTagNameNS(svgns,"defs")[0];
f||(f=document.createElementNS(svgns,"defs"),e.appendChild(f));for(var g=[],h=0;h<c.length;h++){var i=document.createElementNS(svgns,"animate");i.setAttribute("id",d+h),i.setAttribute("from",c[h]);var j="";j=c.length<=h+1?c[0]:c[h+1],i.setAttribute("to",j);var k="";k=0===h?"SVGLoad;indefinite;"+(d+(c.length-1))+".end":d+(h-1)+".end",i.setAttribute("attributeType","CSS"),i.setAttribute("attributeName","stroke"),i.setAttribute("begin",k),i.setAttribute("dur","1s"),g.push(i)}return g},GOMap.Diagram.prototype._highlightElement=function(a){!a.style||"g"!=a.nodeName&&null===a.id||(this._cacheStyle(a),"path"!=a.nodeName&&"circle"!=a.nodeName&&"ellipse"!=a.nodeName||(a.setAttribute("opacity","1"),a.style.setProperty("opacity",1,null)),a.setAttribute("fill-opacity","1"),a.setAttribute("stroke-opacity","1"),a.style.setProperty&&(a.style.setProperty("fill-opacity",1,null),a.style.setProperty("stroke-opacity",1,null)))},GOMap.Diagram.prototype._forceOpacity=function(){for(var a=this.element,b=a.suspendRedraw(5e3),c=a.ownerDocument.getElementsByTagNameNS(svgns,"*"),d=0;d<c.length;d++)"svg"!=c[d].nodeName&&(c[d].parentNode&&c[d].parentNode.parentNode&&"defs"==c[d].parentNode.parentNode.nodeName||"defs"==c[d].nodeName||c[d].parentNode&&"defs"==c[d].parentNode.nodeName||("path"==c[d].nodeName?(c[d].setAttribute("opacity","0.4"),c[d].style.opacity=.4):(c[d].setAttribute("fill-opacity","0.3"),c[d].setAttribute("stroke-opacity","0.2"),c[d].style&&(c[d].style.fillOpacity=.3,c[d].style.strokeOpacity=.2))));a.unsuspendRedraw(b)},GOMap.Diagram.Dragger=function(){this.oX=0,this.oY=0,this.dX=0,this.dY=0,this.dragging=!1,this.targetElement=null},GOMap.Diagram.Dragger.prototype.applyToElement=function(a){var b=this;b.enabled=!0;var c=[];"svg"==a.nodeName?(a.getPosition=function(){var b=a.currentTranslate.x,c=a.currentTranslate.y;return[b,c]},a.shiftPosition=function(c,d){var e,f,g,h,i={x:c,y:d},j=1,k=this.getAttribute("viewBox");if(k){var l=this.getAttribute("viewBox").split(" ");j=parseFloat(this.width.baseVal.value)/parseFloat(l[2]),e=0,f=parseInt(l[1],10),g=parseInt(l[2],10),h=parseInt(l[3],10)}else e=0,f=0,g=a.width,h=a.height;a.style.GomapScrollLeftMargin&&(e+=a.style.GomapScrollLeftMargin),b.dragging&&(i.x=j*(i.x-b.oX),i.y=j*(i.y-b.oY),i.x+=b.dX,i.y+=b.dY,i.y=0),a._snapback&&(clearTimeout(a._snapback),a._snapback=null),i.x>j*e&&(a._snapback=setTimeout(function(){var c;if(Math.abs(a.currentTranslate.x-j*e)>35){var d=.95*(a.currentTranslate.x-j*e);d<j*e&&(d=j*e),a.setCurrentTranslateXY(d,0),window.requestAnimFrame(arguments.callee,a),document.createEvent&&(c=document.createEvent("Events"),c.initEvent("panstart",!1,!0),a.dispatchEvent(c))}else a.setCurrentTranslateXY(j*e,0),document.createEvent&&(c=document.createEvent("Events"),c.initEvent("pan",!1,!0),a.dispatchEvent(c)),document.createEvent&&!b.dragging&&(c=document.createEvent("Events"),c.initEvent("panend",!1,!0),a.dispatchEvent(c)),a._snapback=null},300));var m=j*(g-2*e);if(0===e&&(m*=.9),i.x<0&&Math.abs(i.x)>m&&(a._snapback=setTimeout(function(){var c;if(Math.abs(a.currentTranslate.x- -1*m)>35){var d=.95*a.currentTranslate.x;d>-1*m&&(d=-1*m),a.setCurrentTranslateXY(d,0),window.requestAnimFrame(arguments.callee,a),document.createEvent&&(c=document.createEvent("Events"),c.initEvent("panstart",!1,!0),a.dispatchEvent(c))}else a.setCurrentTranslateXY(-1*m,0),document.createEvent&&(c=document.createEvent("Events"),c.initEvent("pan",!1,!0),a.dispatchEvent(c)),document.createEvent&&!b.dragging&&(c=document.createEvent("Events"),c.initEvent("panend",!1,!0),a.dispatchEvent(c)),a._snapback=null},300)),i.y>j*f&&(i.y=j*f),Math.abs(i.y)>.5*j*h&&(i.y=-.5*j*h),this.setCurrentTranslateXY?this.setCurrentTranslateXY(i.x,i.y):this.currentTranslate.setXY?this.currentTranslate.setXY(i.x,i.y):(this.currentTranslate.x=i.x,this.currentTranslate.y=i.y),document.createEvent){var n=document.createEvent("Events");n.initEvent("pan",!1,!0),this.dispatchEvent(n)}}):(a.getPosition=function(){return[this.scrollLeft,this.scrollTop]},a.shiftPosition=function(a,c){if(this.scrollLeft=b.dX+(b.oX-a),this.scrollTop=b.dY+(b.oY-c),document.createEvent){var d=document.createEvent("Events");d.initEvent("pan",!1,!0),this.dispatchEvent(d)}});var d=function(c){if(!b.enabled)return!0;var d=b.targetElement?b.targetElement:a,f=e(c);if(b.dragging=!0,b.targetElement)return b.oX=f[0],b.oY=f[1],b.dX=b.targetElement.scrollLeft,b.dY=b.targetElement.scrollTop,void c.preventDefault(!0);var g=a.createSVGPoint();f=e(c),g.x=f[0],g.y=f[1];var h=this.getScreenCTM();if(b.matrix=h.inverse(),g=g.matrixTransform(b.matrix),b.dX=a.getPosition()[0],b.dY=a.getPosition()[1],b.oX=g.x,b.oY=g.y,c.preventDefault(!0),document.createEvent){var i=document.createEvent("Events");i.initEvent("panstart",!1,!0),d.dispatchEvent(i)}},e=function(a){var c=0,d=0;return a||(a=window.event),a.pageX||a.pageY?(c=a.pageX,d=a.pageY):(a.clientX||a.clientY)&&(c=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,d=a.clientY+document.body.scrollTop+document.documentElement.scrollTop),b.targetElement&&(c=a.screenX,d=a.screenY),[c,d]},f=function(c){this.style.cursor="url(http://maps.gstatic.com/intl/en_us/mapfiles/openhand_8_8.cur)";var d=e(c);b.dragging&&(this.style.cursor="url(http://maps.gstatic.com/intl/en_us/mapfiles/closedhand_8_8.cur)",a.shiftPosition(d[0],d[1]),c.preventDefault(!0))},g=function(c){b.dragging=!0;var d=e(c);b.oX=d[0],b.oY=d[1],b.dX=a.getPosition()[0],b.dY=a.getPosition()[1],c.preventDefault(!0);var f=b.targetElement?b.targetElement:a;if(document.createEvent){var g=document.createEvent("Events");g.initEvent("panstart",!1,!0),f.dispatchEvent(g)}},h=function(a){return b.enabled?(this.style.cursor="url(http://maps.gstatic.com/intl/en_us/mapfiles/openhand_8_8.cur), move",void(b.dragging&&i.call(this,a))):(this.style.cursor="pointer",!0)},i=function(c){var d=e(c);if(this.style.cursor="url(http://maps.gstatic.com/intl/en_us/mapfiles/closedhand_8_8.cur), -moz-grabbing",b.targetElement)return void b.targetElement.shiftPosition(d[0],d[1]);var f=a._cachedpoint||a.createSVGPoint();a._cachedpoint=f,d=e(c),f.x=d[0],f.y=d[1];var g=a._cachedrctm||a.getScreenCTM();a._cachedrctm=g,f=f.matrixTransform(b.matrix),a.shiftPosition(f.x,f.y)},j=function(c){if(!b.enabled)return!0;b.oX=0,b.oY=0,b.dX=null,b.dY=null,b.dragging=!1,c.preventDefault(!0);var d=b.targetElement?b.targetElement:a;if(document.createEvent&&!d._snapback){var e=document.createEvent("Events");e.initEvent("panend",!1,!0),d.dispatchEvent(e)}},k=function(a){if(!b.dragging||!b.enabled)return!0;if(this==b.targetElement&&j(a),a.target==this||a.currentTarget){for(var c=a.relatedTarget?a.relatedTarget:a.toElement;null!==c;){if(c==this)return;c=c.parentNode}j(a)}};a.setAttribute("cursor","pointer"),a.addEventListener||(a.addEventListener=function(a,b,c){this.attachEvent(a,b)}),a.addEventListener("touchstart",function(d){var f=b.targetElement?b.targetElement:a;if(b.momentum&&(window.clearTimeout(b.momentum),b.momentum=null),1==d.touches.length){var g,h=e(d.touches[0]);if("svg"==f.nodeName){g=f.createSVGPoint(),g.x=h[0],g.y=h[1];var i=this.getScreenCTM();b.matrix=i.inverse(),g=g.matrixTransform(b.matrix)}else g.x=h[0],g.y=h[1];if(b.oX=g.x,b.oY=g.y,b.dragging=!0,b.dX=f.getPosition()[0],b.dY=f.getPosition()[1],b._momentum_shrinker=setInterval(function(){c.shift()},20),document.createEvent){var j=document.createEvent("Events");j.initEvent("panstart",!1,!0),f.dispatchEvent(j)}}},!1),a.addEventListener("touchmove",function(d){b.momentum&&(window.clearTimeout(b.momentum),b.momentum=null),1!=d.touches.length&&(b.dragging=!1);var f,g=b.targetElement?b.targetElement:a,h=e(d.touches[0]);return"svg"==g.nodeName?(f=g.createSVGPoint(),f.x=h[0],f.y=h[1],f=f.matrixTransform(b.matrix)):(f.x=h[0],f.y=h[1]),b.dragging&&6*Math.abs(b.oX-f.x)>Math.abs(b.oY-f.y)&&d.preventDefault(),b.dragging?(c.length>3&&c.splice(2),g.shiftPosition(f.x,f.y),void c.push(g.getPosition()[0]-b.dX)):(b.oX=0,b.oY=0,b.dX=null,void(b.dY=null))},!1);var l=function(d){if(!b.enabled)return!0;if(!b.dragging)return void j(d);var e=b.targetElement?b.targetElement:a,f=0;if(c.length>0){var g=c[0];c.forEach(function(a){"undefined"!=typeof g&&(f+=a-g),g=a}),f/=c.length}var h=e.getPosition()[0],i=f;b.dragging=!1,b.momentum&&window.clearTimeout(b.momentum),b.momentum=window.setTimeout(function(){h=e.getPosition()[0],b.dragging?h+=b.oX-b.dX:(b.oX=0,b.dX=0),e.shiftPosition(h+f,0),h+=f,f=.5*f,Math.abs(i/f)<10?window.requestAnimFrame(arguments.callee,e):(b.momentum=null,clearInterval(b._momentum_shrinker),j(d))},50)};a.addEventListener("touchend",l,!1),"svg"==a.nodeName?(a.addEventListener("mousedown",d,!1),a.addEventListener("mousemove",h,!1),a.addEventListener("mouseup",j,!1),a.addEventListener("mouseout",k,!1),b.targetElement&&b.targetElement.addEventListener("mouseout",k,!1)):(a.addEventListener("mousedown",g,!1),a.addEventListener("mousemove",f,!1),a.addEventListener("mouseup",j,!1),a.addEventListener("mouseout",k,!1))},GOMap.Diagram.addTouchZoomControls=function(a,b){var c=function(a){var b=0,c=0;return a||(a=window.event),a.pageX||a.pageY?(b=a.pageX,c=a.pageY):(a.clientX||a.clientY)&&(b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c=a.clientY+document.body.scrollTop+document.documentElement.scrollTop),self.targetElement&&(b=a.screenX,c=a.screenY),[b,c]};b.addEventListener("touchstart",function(d){if(2==d.touches.length){var e,f=c(d.touches[0]),g=c(d.touches[1]);if("svg"==b.nodeName){e=b.createSVGPoint(),e.x=.5*(f[0]+g[0]),e.y=.5*(f[1]+g[1]);var h=this.getScreenCTM();self.matrix=h.inverse(),e=e.matrixTransform(self.matrix)}else e.x=.5*(f[0]+g[0]),e.y=.5*(f[1]+g[1]);a.zoomCenter=e,d.preventDefault()}},!1),b.addEventListener("gesturestart",function(c){a.zoomLeft=null;var d=a.zoom,e=function(b){a.zoomCenter&&(a.zoom=d*b.scale),b.preventDefault()};this.addEventListener("gesturechange",e,!1),this.addEventListener("gestureend",function(c){b.removeEventListener("gesturechange",e),b.removeEventListener("gestureend",arguments.callee),a.zoomCenter=null,a.zoomLeft=null,a.trigger&&a.trigger("gestureend")},!1),c.preventDefault()},!1)},GOMap.Diagram.addZoomControls=function(a,b,c,d,e){b=b||0,c=c||10,d=d||.5,e=e||a.zoom||b;var f=document.createElement("div"),g=document.createElement("input");g.setAttribute("type","button"),g.setAttribute("value","+");var h=document.createElement("input");h.setAttribute("type","button"),h.setAttribute("value","-");var i=document.createElement("input");i.setAttribute("type","button"),i.setAttribute("value","Reset"),f.appendChild(i),i.addEventListener("click",function(){a.zoom=a.defaultZoom||e},!1);var j=document.createElement("input");if(j.setAttribute("min",b),j.setAttribute("max",c),j.setAttribute("step",d),j.setAttribute("value",e),j.setAttribute("type","range"),j.setAttribute("style","-webkit-appearance: slider-horizontal; width: 100%; position: absolute; top: 0px; bottom: 0px; margin-top: 0.5em; left: 100%; margin-left: -0.5em;"),"range"==j.type){j.addEventListener("change",function(){a.zoom=this.value},!1);var k=null;a.addEventListener?k=a.addEventListener:a.bind&&(k=a.bind),k.apply(a,["zoomChange",function(){j.value=a.zoom},!1]),i.style.margin="0px",i.style.display="block",i.style.position="absolute",i.style.top="0px",f.appendChild(j),f.style.height="100%"}else{if(!g.addEventListener){var l=function(a,b){this.attachEvent(a,b)};g.addEventListener=l,i.addEventListener=l,h.addEventListener=l}g.addEventListener("click",function(){a.zoom+=d},!1),h.addEventListener("click",function(){a.zoom-=d},!1),g.style.margin="0px",g.style.display="block",g.style.position="absolute",g.style.top="0px",g.style.left="29px",h.style.margin="0px",h.style.display="block",h.style.position="absolute",h.style.top="0px",i.style.margin="0px",i.style.display="block",i.style.position="absolute",i.style.top="23px",i.style.left="3px",f.appendChild(h),f.appendChild(g),f.appendChild(i)}return this.addScrollZoomControls(a,f,d),f},GOMap.Diagram.addScrollZoomControls=function(a,b,c){c=c||.5;var d=this,e=function(a,b,c){"string"==typeof a&&(a=document.getElementById(a)),null!==a&&(a.addEventListener?("mousewheel"==b&&a.addEventListener("DOMMouseScroll",c,!1),a.addEventListener(b,c,!1)):a.attachEvent&&a.attachEvent("on"+b,c))},f=function(a){var c=0,e=0;a||(a=window.event),a.pageX||a.pageY?(c=a.pageX,e=a.pageY):(a.clientX||a.clientY)&&(c=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,e=a.clientY+document.body.scrollTop+document.documentElement.scrollTop);var f={};if("svg"==b.nodeName){f=b.createSVGPoint(),f.x=c,f.y=e;var g=b.getScreenCTM();d.matrix=g.inverse(),f=f.matrixTransform(d.matrix)}else f.x=c,f.y=e;return f},g=function(b){b=b?b:window.event;var d=b.detail?b.detail*-1:b.wheelDelta;return a.zoomCenter=f(b),d>0?a.zoom=a.zoom+=c:a.zoom=a.zoom-=c,b.preventDefault&&b.preventDefault(),!1},h=!1;navigator.userAgent.indexOf("Gecko")>=0&&(h=parseFloat(navigator.userAgent.split("Firefox/")[1])||void 0),h&&"undefined"!=typeof svgweb&&"native"==svgweb.getHandlerType()?e(b,"mousewheel",g):e(b,"mousewheel",g),e(b,"mousemove",function(b){a.zoomCenter&&Math.abs(a.zoomCenter.x-f(b).x)>100&&(a.zoomCenter=null,a.zoomLeft=null)})};