!function(a){function b(a){var b=a.relatedTarget;return b?b!=this&&"xul"!=b.prefix&&!/document/.test(this.toString())&&!q(this,b):null===b}var c=1,d={},e={},f=/over|out/,g=/[^\.]*(?=\..*)\.|.*/,h=/\..*/,i="addEventListener",j="attachEvent",k="removeEventListener",l="detachEvent",m=a.document||{},n=m.documentElement||{},o=n[i],p=o?i:j,q=function(a,b){for(var c=b.parentNode;null!==c;){if(c==a)return!0;c=c.parentNode}},r=function(a,b){return a.__uid=b&&b+"::"+c++||a.__uid||c++},s=function(a){var b=r(a);return d[b]=d[b]||{}},t=o?function(a,b,c,d){a[d?i:k](b,c,!1)}:function(a,b,c,d,e){e&&d&&(a["_on"+e]=a["_on"+e]||0),a[d?j:l]("on"+b,c)},u=function(b,c,d){return function(e,f){return e=E(e||((this.ownerDocument||this.document||this).parentWindow||a).event),c.apply(b,[e].concat(d).concat(f))}},v=function(a,b,c,d,e){return function(f){(d?d.apply(this,arguments):o?!0:f&&f.propertyName=="_on"+c||!f)&&b.apply(a,Array.prototype.slice.call(arguments,f?0:1).concat(e))}},w=function(a,b,c,d){var f=b.replace(h,""),i=s(a),j=i[f]||(i[f]={}),k=c,l=r(c,b.replace(g,""));if(j[l])return a;var m=G[f];m&&(c=m.condition?v(a,c,f,m.condition):c,f=m.base||f);var n=F[f];if(c=n?u(a,c,d):v(a,c,f,!1,d),n=o||n,"unload"==f){var q=c;c=function(){x(a,f,c)&&q()}}return a[p]&&t(a,n?f:"propertychange",c,!0,!n&&f),j[l]=c,c.__uid=l,c.__originalFn=k,"unload"==f?a:e[r(a)]=a},x=function(a,b,c){function d(b){if(c=j[k][b],c&&(delete j[k][b],a[p])){k=G[k]?G[k].base:k;var d=o||F[k];t(a,d?k:"propertychange",c,!1,!d&&k)}}var e,f,i,j=s(a),k=b.replace(h,"");if(!j||!j[k])return a;for(e=b.replace(g,""),f=e?e.split("."):[c.__uid],d(e),i=f.length;i--;d(f[i]));return a},y=function(a,b,c){return function(d){for(var e="string"==typeof a?c(a,this):a,f=d.target;f&&f!=this;f=f.parentNode)for(var g=e.length;g--;)if(e[g]==f)return b.apply(f,arguments)}},z=function(a,b,c,d,e){if("object"!=typeof b||c){var f="string"==typeof c,g=(f?c:b).split(" ");c=f?y(b,d,e):c;for(var h=g.length;h--;)w(a,g[h],c,Array.prototype.slice.call(arguments,f?4:3))}else for(var i in b)b.hasOwnProperty(i)&&z(a,i,b[i]);return a},A=function(a,b,c){var d,e,f,i,j,k="string"==typeof b,l=k&&b.replace(g,""),l=l&&l.split("."),m=x,n=s(a);if(k&&/\s/.test(b)){for(b=b.split(" "),j=b.length-1;A(a,b[j])&&j--;);return a}if(i=k?b.replace(h,""):b,!n||l||k&&!n[i]){for(d in n)if(n.hasOwnProperty(d))for(j in n[d])for(e=l.length;e--;)n[d].hasOwnProperty(j)&&new RegExp("^"+l[e]+"::\\d*(\\..*)?$").test(j)&&m(a,[d,j].join("."));return a}if("function"==typeof c)m(a,i,c);else if(l)m(a,b);else{m=i?m:A,f=k&&i,i=i?c||n[i]||i:n;for(d in i)i.hasOwnProperty(d)&&(m(a,f||d,i[d]),delete i[d])}return a},B=function(a,b,c){var d,e,f,i=b.split(" ");for(e=i.length;e--;){b=i[e].replace(h,"");var j=F[b],k=i[e].replace(g,""),l=s(a)[b];if(k)for(k=k.split("."),d=k.length;d--;)for(f in l)l.hasOwnProperty(f)&&new RegExp("^"+k[d]+"::\\d*(\\..*)?$").test(f)&&l[f].apply(a,[!1].concat(c));else if(!c&&a[p])C(j,b,a);else for(d in l)l.hasOwnProperty(d)&&l[d].apply(a,[!1].concat(c))}return a},C=o?function(b,c,d){evt=document.createEvent(b?"HTMLEvents":"UIEvents"),evt[b?"initEvent":"initUIEvent"](c,!0,!0,a,1),d.dispatchEvent(evt)}:function(a,b,c){a?c.fireEvent("on"+b,document.createEventObject()):c["_on"+b]++},D=function(a,b,c){var d,e,f=s(b);r(a);d=c?f[c]:f;for(e in d)d.hasOwnProperty(e)&&(c?z:D)(a,c||b,c?d[e].__originalFn:e);return a},E=function(a){var b={};if(!a)return b;var c=a.type,d=a.target||a.srcElement;b.preventDefault=E.preventDefault(a),b.stopPropagation=E.stopPropagation(a),b.target=d&&3==d.nodeType?d.parentNode:d,c&&c.indexOf("key")?b.keyCode=a.which||a.keyCode:/click|mouse|menu/i.test(c)&&(b.rightClick=3==a.which||2==a.button,b.pos={x:0,y:0},a.pageX||a.pageY?(b.clientX=a.pageX,b.clientY=a.pageY):(a.clientX||a.clientY)&&(b.clientX=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,b.clientY=a.clientY+document.body.scrollTop+document.documentElement.scrollTop),f.test(c)&&(b.relatedTarget=a.relatedTarget||a[("mouseover"==c?"from":"to")+"Element"]));for(var e in a)e in b||(b[e]=a[e]);return b};E.preventDefault=function(a){return function(){a.preventDefault?a.preventDefault():a.returnValue=!1}},E.stopPropagation=function(a){return function(){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0}};var F={click:1,dblclick:1,mouseup:1,mousedown:1,contextmenu:1,mousewheel:1,DOMMouseScroll:1,mouseover:1,mouseout:1,mousemove:1,selectstart:1,selectend:1,keydown:1,keypress:1,keyup:1,orientationchange:1,touchstart:1,touchmove:1,touchend:1,touchcancel:1,gesturestart:1,gesturechange:1,gestureend:1,focus:1,blur:1,change:1,reset:1,select:1,submit:1,load:1,unload:1,beforeunload:1,resize:1,move:1,DOMContentLoaded:1,readystatechange:1,error:0,abort:1,scroll:1},G={mouseenter:{base:"mouseover",condition:b},mouseleave:{base:"mouseout",condition:b}},H={add:z,remove:A,clone:D,fire:B},I=function(a){var b=A(a).__uid;b&&(delete e[b],delete d[b])};a[j]&&z(a,"unload",function(){for(var b in e)e.hasOwnProperty(b)&&I(e[b]);a.CollectGarbage&&CollectGarbage()});var J=a.bean;H.noConflict=function(){return a.bean=J,this},"undefined"!=typeof module&&module.exports?module.exports=H:a.bean=H}(this),function(a){"use strict";function b(){function a(a){b=a}if("function"!=typeof Object.observe||"function"!=typeof Array.observe)return!1;var b=[],c={},d=[];return Object.observe(c,a),Array.observe(d,a),c.id=1,c.id=2,delete c.id,d.push(1,2),d.length=0,Object.deliverChangeRecords(a),5!==b.length?!1:"add"!=b[0].type||"update"!=b[1].type||"delete"!=b[2].type||"splice"!=b[3].type||"splice"!=b[4].type?!1:(Object.unobserve(c,a),Array.unobserve(d,a),!0)}function c(){if("undefined"!=typeof chrome&&chrome.app&&chrome.app.runtime)return!1;if("undefined"!=typeof navigator&&navigator.getDeviceStorage)return!1;try{var a=new Function("","return true;");return a()}catch(b){return!1}}function d(a){return+a===a>>>0&&""!==a}function e(a){return+a}function f(a){return a===Object(a)}function g(a,b){return a===b?0!==a||1/a===1/b:R(a)&&R(b)?!0:a!==a&&b!==b}function h(a){if(void 0===a)return"eof";var b=a.charCodeAt(0);switch(b){case 91:case 93:case 46:case 34:case 39:case 48:return a;case 95:case 36:return"ident";case 32:case 9:case 10:case 13:case 160:case 65279:case 8232:case 8233:return"ws"}return b>=97&&122>=b||b>=65&&90>=b?"ident":b>=49&&57>=b?"number":"else"}function i(){}function j(a){function b(){if(!(m>=a.length)){var b=a[m+1];return"inSingleQuote"==n&&"'"==b||"inDoubleQuote"==n&&'"'==b?(m++,d=b,o.append(),!0):void 0}}for(var c,d,e,f,g,j,k,l=[],m=-1,n="beforePath",o={push:function(){void 0!==e&&(l.push(e),e=void 0)},append:function(){void 0===e?e=d:e+=d}};n;)if(m++,c=a[m],"\\"!=c||!b(n)){if(f=h(c),k=W[n],g=k[f]||k["else"]||"error","error"==g)return;if(n=g[0],j=o[g[1]]||i,d=void 0===g[2]?c:g[2],j(),"afterPath"===n)return l}}function k(a){return V.test(a)}function l(a,b){if(b!==X)throw Error("Use Path.get to retrieve path objects");for(var c=0;c<a.length;c++)this.push(String(a[c]));Q&&this.length&&(this.getValueFrom=this.compiledGetValueFromFn())}function m(a){if(a instanceof l)return a;if(null!=a&&0!=a.length||(a=""),"string"!=typeof a){if(d(a.length))return new l(a,X);a=String(a)}var b=Y[a];if(b)return b;var c=j(a);if(!c)return Z;var b=new l(c,X);return Y[a]=b,b}function n(a){return d(a)?"["+a+"]":'["'+a.replace(/"/g,'\\"')+'"]'}function o(b){for(var c=0;_>c&&b.check_();)c++;return O&&(a.dirtyCheckCycleCount=c),c>0}function p(a){for(var b in a)return!1;return!0}function q(a){return p(a.added)&&p(a.removed)&&p(a.changed)}function r(a,b){var c={},d={},e={};for(var f in b){var g=a[f];void 0!==g&&g===b[f]||(f in a?g!==b[f]&&(e[f]=g):d[f]=void 0)}for(var f in a)f in b||(c[f]=a[f]);return Array.isArray(a)&&a.length!==b.length&&(e.length=a.length),{added:c,removed:d,changed:e}}function s(){if(!aa.length)return!1;for(var a=0;a<aa.length;a++)aa[a]();return aa.length=0,!0}function t(){function a(a){b&&b.state_===fa&&!d&&b.check_(a)}var b,c,d=!1,e=!0;return{open:function(c){if(b)throw Error("ObservedObject in use");e||Object.deliverChangeRecords(a),b=c,e=!1},observe:function(b,d){c=b,d?Array.observe(c,a):Object.observe(c,a)},deliver:function(b){d=b,Object.deliverChangeRecords(a),d=!1},close:function(){b=void 0,Object.unobserve(c,a),ca.push(this)}}}function u(a,b,c){var d=ca.pop()||t();return d.open(a),d.observe(b,c),d}function v(){function a(b,f){b&&(b===d&&(e[f]=!0),h.indexOf(b)<0&&(h.push(b),Object.observe(b,c)),a(Object.getPrototypeOf(b),f))}function b(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.object!==d||e[c.name]||"setPrototype"===c.type)return!1}return!0}function c(c){if(!b(c)){for(var d,e=0;e<g.length;e++)d=g[e],d.state_==fa&&d.iterateObjects_(a);for(var e=0;e<g.length;e++)d=g[e],d.state_==fa&&d.check_()}}var d,e,f=0,g=[],h=[],i={objects:h,get rootObject(){return d},set rootObject(a){d=a,e={}},open:function(b,c){g.push(b),f++,b.iterateObjects_(a)},close:function(a){if(f--,!(f>0)){for(var b=0;b<h.length;b++)Object.unobserve(h[b],c),x.unobservedCount++;g.length=0,h.length=0,d=void 0,e=void 0,da.push(this),$===this&&($=null)}}};return i}function w(a,b){return $&&$.rootObject===b||($=da.pop()||v(),$.rootObject=b),$.open(a,b),$}function x(){this.state_=ea,this.callback_=void 0,this.target_=void 0,this.directObserver_=void 0,this.value_=void 0,this.id_=ia++}function y(a){x._allObserversCount++,ka&&ja.push(a)}function z(a){x._allObserversCount--}function A(a){x.call(this),this.value_=a,this.oldObject_=void 0}function B(a){if(!Array.isArray(a))throw Error("Provided object is not an Array");A.call(this,a)}function C(a,b){x.call(this),this.object_=a,this.path_=m(b),this.directObserver_=void 0}function D(a){x.call(this),this.reportChangesOnOpen_=a,this.value_=[],this.directObserver_=void 0,this.observed_=[]}function E(a){return a}function F(a,b,c,d){this.callback_=void 0,this.target_=void 0,this.value_=void 0,this.observable_=a,this.getValueFn_=b||E,this.setValueFn_=c||E,this.dontPassThroughSet_=d}function G(a,b,c){for(var d={},e={},f=0;f<b.length;f++){var g=b[f];na[g.type]?(g.name in c||(c[g.name]=g.oldValue),"update"!=g.type&&("add"!=g.type?g.name in d?(delete d[g.name],delete c[g.name]):e[g.name]=!0:g.name in e?delete e[g.name]:d[g.name]=!0)):(console.error("Unknown changeRecord type: "+g.type),console.error(g))}for(var h in d)d[h]=a[h];for(var h in e)e[h]=void 0;var i={};for(var h in c)if(!(h in d||h in e)){var j=a[h];c[h]!==j&&(i[h]=j)}return{added:d,removed:e,changed:i}}function H(a,b,c){return{index:a,removed:b,addedCount:c}}function I(){}function J(a,b,c,d,e,f){return sa.calcSplices(a,b,c,d,e,f)}function K(a,b,c,d){return c>b||a>d?-1:b==c||d==a?0:c>a?d>b?b-c:d-c:b>d?d-a:b-a}function L(a,b,c,d){for(var e=H(b,c,d),f=!1,g=0,h=0;h<a.length;h++){var i=a[h];if(i.index+=g,!f){var j=K(e.index,e.index+e.removed.length,i.index,i.index+i.addedCount);if(j>=0){a.splice(h,1),h--,g-=i.addedCount-i.removed.length,e.addedCount+=i.addedCount-j;var k=e.removed.length+i.removed.length-j;if(e.addedCount||k){var c=i.removed;if(e.index<i.index){var l=e.removed.slice(0,i.index-e.index);Array.prototype.push.apply(l,c),c=l}if(e.index+e.removed.length>i.index+i.addedCount){var m=e.removed.slice(i.index+i.addedCount-e.index);Array.prototype.push.apply(c,m)}e.removed=c,i.index<e.index&&(e.index=i.index)}else f=!0}else if(e.index<i.index){f=!0,a.splice(h,0,e),h++;var n=e.addedCount-e.removed.length;i.index+=n,g+=n}}}f||a.push(e)}function M(a,b){for(var c=[],f=0;f<b.length;f++){var g=b[f];switch(g.type){case"splice":L(c,g.index,g.removed.slice(),g.addedCount);break;case"add":case"update":case"delete":if(!d(g.name))continue;var h=e(g.name);if(0>h)continue;L(c,h,[g.oldValue],1);break;default:console.error("Unexpected record type: "+JSON.stringify(g))}}return c}function N(a,b){var c=[];return M(a,b).forEach(function(b){return 1==b.addedCount&&1==b.removed.length?void(b.removed[0]!==a[b.index]&&c.push(b)):void(c=c.concat(J(a,b.index,b.index+b.addedCount,b.removed,0,b.removed.length)))}),c}var O=a.testingExposeCycleCount,P=b(),Q=c(),R=a.Number.isNaN||function(b){return"number"==typeof b&&a.isNaN(b)},S="__proto__"in{}?function(a){return a}:function(a){var b=a.__proto__;if(!b)return a;var c=Object.create(b);return Object.getOwnPropertyNames(a).forEach(function(b){Object.defineProperty(c,b,Object.getOwnPropertyDescriptor(a,b))}),c},T="[$_a-zA-Z]",U="[$_a-zA-Z0-9]",V=new RegExp("^"+T+"+"+U+"*$"),W={beforePath:{ws:["beforePath"],ident:["inIdent","append"],"[":["beforeElement"],eof:["afterPath"]},inPath:{ws:["inPath"],".":["beforeIdent"],"[":["beforeElement"],eof:["afterPath"]},beforeIdent:{ws:["beforeIdent"],ident:["inIdent","append"]},inIdent:{ident:["inIdent","append"],0:["inIdent","append"],number:["inIdent","append"],ws:["inPath","push"],".":["beforeIdent","push"],"[":["beforeElement","push"],eof:["afterPath","push"]},beforeElement:{ws:["beforeElement"],0:["afterZero","append"],number:["inIndex","append"],"'":["inSingleQuote","append",""],'"':["inDoubleQuote","append",""]},afterZero:{ws:["afterElement","push"],"]":["inPath","push"]},inIndex:{0:["inIndex","append"],number:["inIndex","append"],ws:["afterElement"],"]":["inPath","push"]},inSingleQuote:{"'":["afterElement"],eof:["error"],"else":["inSingleQuote","append"]},inDoubleQuote:{'"':["afterElement"],eof:["error"],"else":["inDoubleQuote","append"]},afterElement:{ws:["afterElement"],"]":["inPath","push"]}},X={},Y={};l.get=m,l.prototype=S({__proto__:[],valid:!0,toString:function(){for(var a="",b=0;b<this.length;b++){var c=this[b];a+=k(c)?b?"."+c:c:n(c)}return a},getValueFrom:function(a,b){for(var c=0;c<this.length;c++){if(null==a)return;a=a[this[c]]}return a},iterateObjects:function(a,b){for(var c=0;c<this.length;c++){if(c&&(a=a[this[c-1]]),!f(a))return;b(a,this[c])}},compiledGetValueFromFn:function(){var a="",b="obj";a+="if (obj != null";for(var c,d=0;d<this.length-1;d++)c=this[d],b+=k(c)?"."+c:n(c),a+=" &&\n     "+b+" != null";a+=")\n";var c=this[d];return b+=k(c)?"."+c:n(c),a+="  return "+b+";\nelse\n  return undefined;",new Function("obj",a)},setValueFrom:function(a,b){if(!this.length)return!1;for(var c=0;c<this.length-1;c++){if(!f(a))return!1;a=a[this[c]]}return f(a)?(a[this[c]]=b,!0):!1}});var Z=new l("",X);Z.valid=!1,Z.getValueFrom=Z.setValueFrom=function(){};var $,_=1e3,aa=[],ba=P?function(){return function(a){return Promise.resolve().then(a)}}():function(){return function(a){aa.push(a)}}(),ca=[],da=[],ea=0,fa=1,ga=2,ha=3,ia=1;x.prototype={open:function(a,b){if(this.state_!=ea)throw Error("Observer has already been opened.");return y(this),this.callback_=a,this.target_=b,this.connect_(),this.state_=fa,this.value_},close:function(){this.state_==fa&&(z(this),this.disconnect_(),this.value_=void 0,this.callback_=void 0,this.target_=void 0,this.state_=ga)},deliver:function(){this.state_==fa&&o(this)},report_:function(a){try{this.callback_.apply(this.target_,a)}catch(b){x._errorThrownDuringCallback=!0,console.error("Exception caught during observer callback: "+(b.stack||b))}},discardChanges:function(){return this.check_(void 0,!0),this.value_}};var ja,ka=!P;x._allObserversCount=0,ka&&(ja=[]);var la=!1;a.Platform=a.Platform||{},a.Platform.performMicrotaskCheckpoint=function(){if(!la&&ka){la=!0;var b,c,d=0;do{d++,c=ja,ja=[],b=!1;for(var e=0;e<c.length;e++){var f=c[e];f.state_==fa&&(f.check_()&&(b=!0),ja.push(f))}s()&&(b=!0)}while(_>d&&b);O&&(a.dirtyCheckCycleCount=d),la=!1}},ka&&(a.Platform.clearObservers=function(){ja=[]}),A.prototype=S({__proto__:x.prototype,arrayObserve:!1,connect_:function(a,b){P?this.directObserver_=u(this,this.value_,this.arrayObserve):this.oldObject_=this.copyObject(this.value_)},copyObject:function(a){var b=Array.isArray(a)?[]:{};for(var c in a)b[c]=a[c];return Array.isArray(a)&&(b.length=a.length),b},check_:function(a,b){var c,d;if(P){if(!a)return!1;d={},c=G(this.value_,a,d)}else d=this.oldObject_,c=r(this.value_,this.oldObject_);return q(c)?!1:(P||(this.oldObject_=this.copyObject(this.value_)),this.report_([c.added||{},c.removed||{},c.changed||{},function(a){return d[a]}]),!0)},disconnect_:function(){P?(this.directObserver_.close(),this.directObserver_=void 0):this.oldObject_=void 0},deliver:function(){this.state_==fa&&(P?this.directObserver_.deliver(!1):o(this))},discardChanges:function(){return this.directObserver_?this.directObserver_.deliver(!0):this.oldObject_=this.copyObject(this.value_),this.value_}}),B.prototype=S({__proto__:A.prototype,arrayObserve:!0,copyObject:function(a){return a.slice()},check_:function(a){var b;if(P){if(!a)return!1;b=N(this.value_,a)}else b=J(this.value_,0,this.value_.length,this.oldObject_,0,this.oldObject_.length);return b&&b.length?(P||(this.oldObject_=this.copyObject(this.value_)),this.report_([b]),!0):!1}}),B.applySplices=function(a,b,c){c.forEach(function(c){for(var d=[c.index,c.removed.length],e=c.index;e<c.index+c.addedCount;)d.push(b[e]),e++;Array.prototype.splice.apply(a,d)})},C.prototype=S({__proto__:x.prototype,get path(){return this.path_},connect_:function(){P&&(this.directObserver_=w(this,this.object_)),this.check_(void 0,!0)},disconnect_:function(){this.value_=void 0,this.directObserver_&&(this.directObserver_.close(this),this.directObserver_=void 0)},iterateObjects_:function(a){this.path_.iterateObjects(this.object_,a)},check_:function(a,b){var c=this.value_;return this.value_=this.path_.getValueFrom(this.object_),b||g(this.value_,c)?!1:(this.report_([this.value_,c,this]),!0)},setValue:function(a){this.path_&&this.path_.setValueFrom(this.object_,a)}});var ma={};D.prototype=S({__proto__:x.prototype,connect_:function(){if(P){for(var a,b=!1,c=0;c<this.observed_.length;c+=2)if(a=this.observed_[c],a!==ma){b=!0;break}b&&(this.directObserver_=w(this,a))}this.check_(void 0,!this.reportChangesOnOpen_)},disconnect_:function(){for(var a=0;a<this.observed_.length;a+=2)this.observed_[a]===ma&&this.observed_[a+1].close();this.observed_.length=0,this.value_.length=0,this.directObserver_&&(this.directObserver_.close(this),this.directObserver_=void 0)},addPath:function(a,b){if(this.state_!=ea&&this.state_!=ha)throw Error("Cannot add paths once started.");var b=m(b);if(this.observed_.push(a,b),this.reportChangesOnOpen_){var c=this.observed_.length/2-1;this.value_[c]=b.getValueFrom(a)}},addObserver:function(a){if(this.state_!=ea&&this.state_!=ha)throw Error("Cannot add observers once started.");if(this.observed_.push(ma,a),this.reportChangesOnOpen_){var b=this.observed_.length/2-1;this.value_[b]=a.open(this.deliver,this)}},startReset:function(){if(this.state_!=fa)throw Error("Can only reset while open");this.state_=ha,this.disconnect_()},finishReset:function(){if(this.state_!=ha)throw Error("Can only finishReset after startReset");return this.state_=fa,this.connect_(),this.value_},iterateObjects_:function(a){for(var b,c=0;c<this.observed_.length;c+=2)b=this.observed_[c],b!==ma&&this.observed_[c+1].iterateObjects(b,a)},check_:function(a,b){for(var c,d=0;d<this.observed_.length;d+=2){var e,f=this.observed_[d],h=this.observed_[d+1];if(f===ma){var i=h;e=this.state_===ea?i.open(this.deliver,this):i.discardChanges()}else e=h.getValueFrom(f);b?this.value_[d/2]=e:g(e,this.value_[d/2])||(c=c||[],c[d/2]=this.value_[d/2],this.value_[d/2]=e)}return c?(this.report_([this.value_,c,this.observed_]),!0):!1}}),F.prototype={open:function(a,b){return this.callback_=a,this.target_=b,this.value_=this.getValueFn_(this.observable_.open(this.observedCallback_,this)),this.value_},observedCallback_:function(a){if(a=this.getValueFn_(a),!g(a,this.value_)){var b=this.value_;this.value_=a,this.callback_.call(this.target_,this.value_,b)}},discardChanges:function(){return this.value_=this.getValueFn_(this.observable_.discardChanges()),this.value_},deliver:function(){return this.observable_.deliver()},setValue:function(a){return a=this.setValueFn_(a),!this.dontPassThroughSet_&&this.observable_.setValue?this.observable_.setValue(a):void 0},close:function(){this.observable_&&this.observable_.close(),this.callback_=void 0,this.target_=void 0,this.observable_=void 0,this.value_=void 0,this.getValueFn_=void 0,this.setValueFn_=void 0}};var na={add:!0,update:!0,"delete":!0},oa=0,pa=1,qa=2,ra=3;I.prototype={calcEditDistances:function(a,b,c,d,e,f){for(var g=f-e+1,h=c-b+1,i=new Array(g),j=0;g>j;j++)i[j]=new Array(h),i[j][0]=j;for(var k=0;h>k;k++)i[0][k]=k;for(var j=1;g>j;j++)for(var k=1;h>k;k++)if(this.equals(a[b+k-1],d[e+j-1]))i[j][k]=i[j-1][k-1];else{var l=i[j-1][k]+1,m=i[j][k-1]+1;i[j][k]=m>l?l:m}return i},spliceOperationsFromEditDistances:function(a){for(var b=a.length-1,c=a[0].length-1,d=a[b][c],e=[];b>0||c>0;)if(0!=b)if(0!=c){var f,g=a[b-1][c-1],h=a[b-1][c],i=a[b][c-1];f=i>h?g>h?h:g:g>i?i:g,f==g?(g==d?e.push(oa):(e.push(pa),d=g),b--,c--):f==h?(e.push(ra),b--,d=h):(e.push(qa),c--,d=i)}else e.push(ra),b--;else e.push(qa),c--;return e.reverse(),e},calcSplices:function(a,b,c,d,e,f){var g=0,h=0,i=Math.min(c-b,f-e);if(0==b&&0==e&&(g=this.sharedPrefix(a,d,i)),c==a.length&&f==d.length&&(h=this.sharedSuffix(a,d,i-g)),b+=g,e+=g,c-=h,f-=h,c-b==0&&f-e==0)return[];if(b==c){for(var j=H(b,[],0);f>e;)j.removed.push(d[e++]);return[j]}if(e==f)return[H(b,[],c-b)];for(var k=this.spliceOperationsFromEditDistances(this.calcEditDistances(a,b,c,d,e,f)),j=void 0,l=[],m=b,n=e,o=0;o<k.length;o++)switch(k[o]){case oa:j&&(l.push(j),j=void 0),m++,n++;break;case pa:j||(j=H(m,[],0)),j.addedCount++,m++,j.removed.push(d[n]),n++;break;case qa:j||(j=H(m,[],0)),j.addedCount++,m++;break;case ra:j||(j=H(m,[],0)),j.removed.push(d[n]),n++}return j&&l.push(j),l},sharedPrefix:function(a,b,c){for(var d=0;c>d;d++)if(!this.equals(a[d],b[d]))return d;return c},sharedSuffix:function(a,b,c){for(var d=a.length,e=b.length,f=0;c>f&&this.equals(a[--d],b[--e]);)f++;return f},calculateSplices:function(a,b){return this.calcSplices(a,0,a.length,b,0,b.length)},equals:function(a,b){return a===b}};var sa=new I,ta=a;"undefined"==typeof exports||exports.nodeType||("undefined"!=typeof module&&module.exports&&(exports=module.exports),ta=exports),ta.Observer=x,ta.Observer.runEOM_=ba,ta.Observer.observerSentinel_=ma,ta.Observer.hasObjectObserve=P,ta.ArrayObserver=B,ta.ArrayObserver.calculateSplices=function(a,b){return sa.calculateSplices(a,b)},ta.ArraySplice=I,ta.ObjectObserver=A,ta.PathObserver=C,ta.CompoundObserver=D,ta.Path=l,ta.ObserverTransform=F}("undefined"!=typeof global&&global&&"undefined"!=typeof module&&module?global:this||window);var MASCP=MASCP||{};if(Object.defineProperty&&!MASCP.IE8&&!function(){var a=[],b=!1;Object.defineProperty(MASCP,"ready",{get:function(){return 0!==a.length||b?function(){a.forEach(function(a){a.call()})}:!1},set:function(c){return c===!1||c===!0?(a=[],c&&(b=!0),b):b?void c.call():void a.push(c)}})}(),MASCP.Service=function(a,b){},"undefined"!=typeof module&&module.exports){var events=require("events");singletonemitter=new events.EventEmitter,MASCP.Service.emit=function(a,b){singletonemitter.emit(a,b)},MASCP.Service.removeAllListeners=function(a,b){b?singletonemitter.removeListeners(a,b):singletonemitter.removeAllListeners(a)},MASCP.Service.removeListener=function(a,b){singletonemitter.removeListener(a,b)},MASCP.Service.addListener=function(a,b){singletonemitter.addListener(a,b)};var bean={add:function(a,b,c){if("error"==b&&(b="MASCP.error"),a.addListener)a.addListener(b,c);else{var d=function(){var b=Array.prototype.slice.call(arguments);b[0]===a&&(b.shift(),c.apply(a,b))};a._listeners=a._listeners||{},a._listeners[b]||(a._listeners[b]={}),a._listener||(a._listener=new events.EventEmitter),a._listeners[b][c]&&(d=a._listeners[b][c]),a._listener.addListener(b,d),a._listeners[b][c]=d}},remove:function(a,b,c){"error"==b&&(b="MASCP.error"),c&&a.removeListener?a.removeListener(b,c):c?(a._listeners&&a._listeners[b]&&a._listeners[b][c]&&(a._listener.removeListener(b,a._listeners[b][c]),delete a._listeners[b][c]),0==a._listener.listeners(b).length&&(a._listeners[b]={})):a.removeAllListeners&&"undefined"==typeof c&&a.removeAllListeners(b)},fire:function(a,b,c){"error"==b&&(b="MASCP.error"),a.emit?a.emit.apply(a,[b].concat(c)):a._listener&&a._listener.emit.apply(a._listener,[b,a].concat(c))}};MASCP.events=new events.EventEmitter,module.exports=MASCP;var parser=require("jsdom").jsdom,XMLHttpRequest=require("xmlhttprequest").XMLHttpRequest;Object.defineProperty(XMLHttpRequest.prototype,"responseXML",{get:function(){return parser((this.responseText||"").replace(/&/g,"&amp;"))},set:function(){}}),XMLHttpRequest.prototype.customUA="MASCP Gator crawler (+http://gator.masc-proteomics.org/)"}else{window.MASCP=MASCP;var ie=function(){var a,b=3,c=document.createElement("div"),d=c.getElementsByTagName("i");do c.innerHTML="<!--[if gt IE "+ ++b+"]><i></i><![endif]-->";while(d[0]);return b>4?b:a}();ie&&(7===ie&&(MASCP.IE=!0,MASCP.IE7=!0),8===ie&&(MASCP.IE=!0,MASCP.IE8=!0),9==ie&&(MASCP.IE=!0,MASCP.IE9=!0),MASCP.IE=!0)}if(MASCP.buildService=function(a){var b=function(a,c){return"undefined"!=typeof c?this._endpointURL=c:this._endpointURL=b.SERVICE_URL,this.agi=a,this};return b.Result=function(b){return a.apply(this,[b]),this},b.prototype=MASCP.extend(new MASCP.Service,{__class__:b,__result_class:b.Result,_endpointURL:null}),b.Result.prototype=MASCP.extend(new MASCP.Service.Result,{__class__:b.Result}),b.Result.prototype=MASCP.extend(b.Result.prototype,a.apply({},[])),b.toString=function(){for(var a in MASCP)if(this===MASCP[a])return"MASCP."+a},b},MASCP.cloneService=function(a,b){var c=MASCP.buildService(function(){return this});return c.Result=a.Result,c.prototype=new a,MASCP[b]=c,c.prototype.__class__=c,c},function(){var a={},b=function(b,c,d){if(c){if("liveClass"==c.type){var e=MASCP[b];return void d.call(null,null,c,new e(null,c.url))}if("gatorURL"==c.type){var f=new MASCP.UserdataReader(null,b);return f.datasetname=c.title,f.requestData=function(){var a=this.agi.toLowerCase(),c=b.split("#")[0],d="/"==c.slice(-1)?c+a:c+"/"+a;return{type:"GET",dataType:"json",url:d,data:{agi:a,service:this.datasetname}}},void d.call(null,null,c,f)}if("data"==c.type){var f=new MASCP.UserdataReader;return f.map=function(a){var b={};for(var c in a)"retrieved"!=c&&"title"!=c&&(a[c].data?b[c]=a:b[c]={data:a[c]},b[c].retrieved=a.retrieved,b[c].title=a.title);return b},f.bind("ready",function(){d.call(null,null,c,f)}),void f.setData(b,c.data)}if("reader"==c.type)return void d.call(null,null,c,c.reader);if(c.parser_function){if(!JSandbox)return console.log("No sandbox support - not trying to get data for "+c.title),void d.call(null,{error:"No sandbox support"});var g,h=new JSandbox;h.eval("var sandboxed_parser = "+c.parser_function+";",function(){var e=this;if(g=function(a,b){e.eval({data:"sandboxed_parser(input.datablock)",input:{datablock:a},callback:function(a){b.call(null,a),e.terminate()},onerror:function(a){console.log("Parser error"),b.call(null,null)}})},g.callback=!0,g.terminate=function(){h&&h.terminate()},/^(https?:)?\/?\//.test(b))return void MASCP.Service.request(b,function(e,f){if(e)return void d.call(null,{error:e},c);var h=new MASCP.UserdataReader(null,null);return h.datasetname=c.title,a[b]?(MASCP.Service.CacheService(h),void d.call(null,null,c,h)):(a[b]=!0,h.bind("ready",function(){g&&g.terminate(),d.call(null,null,c,h)}),h.bind("error",function(a){g&&g.terminate(),d.call(null,{error:a},c)}),void MASCP.Service.ClearCache(h,null,function(a){return a?void bean.fire(h,"error",[a]):(h.map=g,void h.setData(c.title,f))}))});var f=(new MASCP.GoogledataReader).createReader(b,g);f.bind("ready",function(){g&&g.terminate(),d.call(null,null,c,f)}),f.bind("error",function(a){d.call(null,{error:a},c)})})}}};MASCP.IterateServicesFromConfig=function(a,c){if(a)for(var d in a)b(d,a[d],c)}}(),MASCP.extend=function(a,b){for(var c in b)a[c]=b[c];return a},MASCP.extend(MASCP.Service.prototype,{agi:null,result:null,__result_class:null,async:!0}),MASCP.Service.prototype._dataReceived=function(a,b){if(!a)return!1;var c=this.__result_class;if(a&&a.error&&""!=a.error&&null!==a.error)return bean.fire(this,"error",[a.error]),!1;if("[object Array]"===Object.prototype.toString.call(a)){for(var d=0;d<a.length;d++)arguments.callee.call(this,a[d],b);0===d&&(this.result=new c),this.result._raw_data={data:a}}else if(this.result){try{c.call(this.result,a)}catch(e){return bean.fire(this,"error",[e]),!1}this.result._raw_data||(this.result._raw_data=a)}else{var f;try{f=new c(a)}catch(g){return bean.fire(this,"error",[g]),!1}f._raw_data||(f._raw_data=a),this.result=f}return a&&a.retrieved&&(this.result.retrieved=a.retrieved,this.result._raw_data.retrieved=a.retrieved),this.result.agi=this.agi,!0},MASCP.Service.prototype.gotResult=function(){var a=this,b=function(b){b.readers||(b.readers=[]),b.readers.push(a.toString())};bean.add(MASCP,"layerRegistered",b),bean.add(MASCP,"groupRegistered",b),bean.fire(a,"resultReceived");try{bean.remove(MASCP,"layerRegistered",b),bean.remove(MASCP,"groupRegistered",b)}catch(c){}bean.fire(MASCP.Service,"resultReceived")},MASCP.Service.prototype.requestComplete=function(){bean.fire(this,"requestComplete"),bean.fire(MASCP.Service,"requestComplete",[this])},MASCP.Service.prototype.requestIncomplete=function(){bean.fire(this,"requestIncomplete"),bean.fire(MASCP.Service,"requestIncomplete",[this])},MASCP.Service.registeredLayers=function(a){var b=[];for(var c in MASCP.layers)if(MASCP.layers.hasOwnProperty(c)){var d=MASCP.layers[c];d.readers&&d.readers.indexOf(a.toString())>=0&&b.push(d)}return b},MASCP.Service.registeredGroups=function(a){var b=[];for(var c in MASCP.groups)if(MASCP.groups.hasOwnProperty(c)){var d=MASCP.groups[c];d.readers&&d.readers.indexOf(a.toString())>=0&&b.push(d)}return b},MASCP.Service.prototype.bind=function(a,b){return bean.add(this,a,b),this},MASCP.Service.prototype.unbind=function(a,b){return bean.remove(this,a,b),this},function(a){var b=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c+"="+a[c]);return b.join("&")},c=function(a){var c=null;if(!a.url)return void a.success.call(null,null);var d=new XMLHttpRequest;if("GET"==a.type&&a.data){var e=a.url.indexOf("?");e==a.url.length-1&&(a.url=a.url.slice(0,-1),e=-1);var f=e>=0?"&":"?";a.url=a.url.replace(/\?$/,"")+f+b(a.data)}d.open(a.type,a.url,a.async),"POST"==a.type&&(d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c=b(a.data)),d.customUA&&d.setRequestHeader("User-Agent",d.customUA);var g=5;return d.onreadystatechange=function(b){if(4==d.readyState){if(d.status>=300&&d.status<400&&g>0){var e=d.getResponseHeader("location").replace(/location:\s+/,"");return g-=1,d.open("GET",e,a.async),void d.send()}if(503==d.status)return d.last_wait=2*(a.last_wait||500),void setTimeout(function(){d.open(a.type,a.url,a.async),"POST"==a.type&&d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.customUA&&d.setRequestHeader("User-Agent",d.customUA),d.send(c)},a.last_wait);if(403==d.status){var f=d.getResponseHeader("Server");if("AmazonS3"===f)return void a.success.call(null,{error:"No data"},403,d)}if(d.status>=200&&d.status<300){var h;h="xml"==a.dataType?"undefined"!=typeof document?document.implementation.createDocument(null,"nodata",null):{getElementsByTagName:function(){return[]}}:{};try{d.responseText;h="xml"==a.dataType?d.responseXML||MASCP.importNode(d.responseText):"txt"==a.dataType?d.responseText:JSON.parse(d.responseText)}catch(i){return"unexpected_eos"==i.type?void a.success.call(null,{},d.status,d):void a.error.call(null,d.responseText,d,{error:i.type||i.message,stack:i})}if(202==d.status&&"RUNNING"==h.status)return void setTimeout(function(){d.open(a.type,a.url,a.async),"POST"==a.type&&d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.customUA&&d.setRequestHeader("User-Agent",d.customUA),d.send(c)},5e3);a.success.call(null,h,d.status,d),h=null}else a.error.call(null,d.responseText,d,d.status)}},MASCP.NETWORK_FAIL&&MASCP.NETWORK_FAIL.enabled?void setTimeout(function(){console.log("Causing network failure"),d={onreadystatechange:d.onreadystatechange},d.readyState=4,d.status=MASCP.NETWORK_FAIL.status||500,d.responseText="Intercepted by Network Failure simulator",d.onreadystatechange()},1e3):void d.send(c)};MASCP.Service.request=function(a,b,e){var f=MASCP.IE?d:c;
MASCP.IE&&!a.match(/^https?\:/)&&(f=c);var g={async:!0,url:a,timeout:5e3,type:"GET",error:function(a,c,d){b.call(null,{status:d})},success:function(a,c,d){b.call(null,null,a)}};e&&(g.dataType="txt","xml"===e&&(g.dataType="xml")),f.call(null,g)};var d=function(a){var c=new XDomainRequest,d=!1,e=0;for(c.onerror=function(b){a.error(c,c,{message:"XDomainRequest error"})},c.onprogress=function(){},c.open("GET",a.url+"?"+b(a.data)),c.onload=function(){if(d=!0,"xml"==a.dataType){var b=new ActiveXObject("Microsoft.XMLDOM");b.async=!1,b.loadXML(c.responseText),a.success(b,"success",c)}else if("json"==a.dataType){var e=null;try{e=JSON.parse(c.responseText)}catch(f){a.error(c,c,{message:"JSON parsing error"})}e&&a.success(e,"success",c)}else a.success(c.responseText,"success",c)},setTimeout(function(){c.send()},0);!a.async&&!d&&3>e;)alert("This browser does not support synchronous requests, click OK while we're waiting for data"),e+=1;a.async||d||alert("No data")};a.retrieve=function(a,b){var e=this;if(MASCP.Service._current_reqs=MASCP.Service._current_reqs||0,MASCP.Service._waiting_reqs=MASCP.Service._waiting_reqs||0,MASCP.Service.MAX_REQUESTS){var f=arguments.callee;if(MASCP.Service._current_reqs>MASCP.Service.MAX_REQUESTS)return MASCP.Service._waiting_reqs+=1,bean.add(MASCP.Service,"requestComplete",function(){bean.remove(this,"requestComplete",arguments.callee),setTimeout(function(){MASCP.Service._waiting_reqs-=1,f.call(e,a,b)},0)}),this}if(a&&(this.agi=a),a&&b){this.agi=a,this.result=null;var g=!1,h=function(a,c){bean.remove(e,"resultReceived",h),bean.remove(e,"error",h),bean.remove(e,"requestComplete",h),g||(a?b.call(e,a):b.call(e)),g=!0};bean.add(e,"resultReceived",h),bean.add(e,"error",h),bean.add(e,"requestComplete",h)}var i=this.requestData();if(i!==!1){if(!i)return bean.fire(e,"error",["No request data"]),bean.fire(MASCP.Service,"requestComplete",[e]),this.requestComplete(),this;var j={async:this.async,url:i.url||this._endpointURL,timeout:5e3,error:function(a,b,c){MASCP.Service._current_reqs-=1,"string"==typeof c&&(c={error:c,request:b}),isNaN(c)||(c={error:"Reqeust error",status:c,request:b}),bean.fire(e,"error",[c]),bean.fire(MASCP.Service,"requestComplete"),e.requestComplete()},success:function(a,b,c){if(MASCP.Service._current_reqs-=1,c&&null!==c.status&&0===c.status)return bean.fire(e,"error",[{error:"Zero return status from request "}]),void e.requestComplete();var d=e._dataReceived(a,b);d&&e.gotResult(),null!==d&&"undefined"!=typeof d?e.requestComplete():e.requestIncomplete()}};return MASCP.extend(j,i),MASCP.IE?d(j):c(j),MASCP.Service._current_reqs+=1,this}}}(MASCP.Service.prototype),function(a){var b,c,d,e,f,g,h,i,j,k,l,m=0,n=0;a.BeginCaching=function(){a.CacheService(a.prototype)},a.SetMinimumAge=function(a){n=0===a?0:a.getTime()},a.SetMaximumAge=function(a){m=0===a?0:a.getTime()},a.SweepCache=function(a){a||(a=new Date),h(a.getTime())},a.CacheService=function(a){if(!(a.prototype&&a.prototype.retrieve.caching||a.retrieve.caching)){var d,e=a.retrieve;a.retrieve=function(a,f){var g=this,h=a?a:g.agi;if(!h)return e.call(g,h,f),g;if(h=h.toLowerCase(),g.agi=h,g.avoid_database){if(d)return;return d=g._dataReceived,g._dataReceived=function(){return function(a){var b=d.call(this,a),e=g.agi;return b&&this.result&&null!==this.result._raw_data&&c(e,this.toString(),this.result._raw_data||{}),a={},b}}(),void f.call(g)}return d&&!g.avoid_database?(g._dataReceived=d,d=null,void f.call(g)):(b(h,g.toString(),function(a,b){if(b){if(f){g.result=null;var d=function(a){bean.remove(g,"resultReceived",arguments.callee),bean.remove(g,"error",arguments.callee),f.call(g,a)};bean.add(g,"resultReceived",d),bean.add(g,"error",d)}var i=g._dataReceived(b,"db");i&&g.gotResult(),null!==i?g.requestComplete():g.requestIncomplete()}else{var j=g._dataReceived;g._dataReceived=function(){return function(a,b){var d=j.call(this,a,b);return d&&this.result&&null!==this.result._raw_data&&c(h,this.toString(),this.result._raw_data||{}),this._dataReceived=null,this._dataReceived=j,a={},d}}();var k=g._endpointURL;0!==m&&(g._endpointURL=null),e.call(g,h,f),g._endpointURL=k}}),g)},a.retrieve.caching=!0}},a.FindCachedService=function(a,b){var c=a.toString();return d(c,b),!0},a.CachedAgis=function(a,b){var c=a.toString();return i(c,b),!0},a.FirstAgi=function(a,b){var c=a.toString();return l(c,b),!0},a.ClearCache=function(a,b,c){var d=a.toString();return c||(c=function(){}),e(d,b,c),!0},a.HistoryForService=function(a,b){var c=a.toString();g(c,null,b)},a.Snapshot=function(a,b,c,d){var e=a.toString();get_snapshot(e,null,c,d)};var o=0,p=[];a.BulkOperation=function(a){o++;var b=function(a){a||(a=function(){}),o--,p.push(a),0==o&&k(function(a){p.forEach(function(b){b(a)}),p=[]})};return j(a,b),b};var q,r,s=function(a){var o,p=[];j=function(a,b){return null!=o?(setTimeout(function(){a.call({transaction:b})},0),!1):(o=c,c=function(a,b,c){p.push([a,b,c])},setTimeout(function(){a.call({transaction:b})},0),!0)},k=function(b){if(null===o)return void b(null);c=o,o=null;var d=a.transaction(["cached"],"readwrite"),e=d.objectStore("cached");for(d.oncomplete=function(a){b(null)},d.onerror=function(a){b(a.target.errorCode)};p.length>0;){var f=p.shift(),g=f[0],h=f[1],i=f[2];if(!("object"!=typeof i||"Object"!==i.constructor.name||"undefined"!=typeof Document&&i instanceof Document)){var j=i.retrieved?i.retrieved:new Date;"string"==typeof j&&(j=new Date(j)),j.setUTCHours(0),j.setUTCMinutes(0),j.setUTCSeconds(0),j.setUTCMilliseconds(0);var k=q(g,h),l=j.getTime();i.id=[g,h,l],i.acc=g,i.service=h,window.msIndexedDB&&(i.serviceacc=h+g),i.retrieved=l;var m=e.put(i);m.onerror=k}}};var q=function(a,b){return function(a,b){}};c=function(b,c,d){var e=a.transaction(["cached"],"readwrite"),f=e.objectStore("cached");if(!("object"!=typeof d||"undefined"!=typeof Document&&d instanceof Document)){var g=d.retrieved?d.retrieved:new Date;"string"==typeof g&&(g=new Date(g)),g.setUTCHours(0),g.setUTCMinutes(0),g.setUTCSeconds(0),g.setUTCMilliseconds(0);var h=q(b,c),i=g.getTime();d.id=[b,c,i],d.acc=b,window.msIndexedDB&&(d.serviceacc=c+b),d.service=c,d.retrieved=i;var j=f.put(d);j.onerror=h}},b=function(a,b,c){var d=m?[n,m]:[n,(new Date).getTime()];return f(a,b,d,c)},f=function(b,c,d,e){if(!b)return void e.call();var f=a.transaction(["cached"],"readonly"),g=f.objectStore("cached"),h=g.index(window.msIndexedDB?"entries-ms":"entries"),i=-1,j=null,k=IDBKeyRange.only(window.msIndexedDB?c+b:[b,c]);h.openCursor(k).onsuccess=function(a){var f=a.target.result;if(f){var g=window.msIndexedDB?f.value.retrieved:f.primaryKey[2],h=window.msIndexedDB?f.value.acc:f.primaryKey[0],k=window.msIndexedDB?f.value.service:f.primaryKey[1];g>=d[0]&&g<=d[1]&&g>i&&h==b&&k==c&&(j=f.value,i=g,j.retrieved=new Date(g)),f["continue"]()}else e.call(null,null,j)}},h=function(b){var c=a.transaction(["cached"],"readwrite"),d=c.objectStore("cached"),e=d.index("timestamps");e.openKeyCursor(null,"nextunique").onsuccess=function(a){var c=a.target.result;c&&(b>=c.key[1]&&d["delete"](c.primaryKey),c["continue"]())}},g=function(b,c,d){c&&"object"==typeof c&&c.length||(c=[0,(new Date).getTime()]);var e=a.transaction(["cached"],"readonly"),f=e.objectStore("cached"),g=f.index("timestamps"),h=[];g.openKeyCursor(null,"nextunique").onsuccess=function(a){var e=a.target.result;e?(e.key[0]==b&&c[0]<=e.key[1]&&c[1]>=e.key[1]&&h.push(new Date(parseInt(e.key[1]))),e["continue"]()):d.call(null,h)}},e=function(b,c,d){var e=a.transaction(["cached"],"readwrite"),f=e.objectStore("cached"),g=f.index("services"),h=IDBKeyRange.only(b);g.openCursor(h).onsuccess=function(a){var b=a.target.result;b&&(c&&b.value.acc!=c||(window.msIndexedDB?f["delete"](b.value.serviceacc):f["delete"](b.value.id?b.value.id:b.primaryKey)),b["continue"]())},e.oncomplete=function(){d.call(MASCP.Service)}},d=function(b,c){var d=a.transaction(["cached"],"readonly"),e=d.objectStore("cached"),f=e.index("services"),g=[],h=IDBKeyRange.only(b);f.openKeyCursor(h,"nextunique").onsuccess=function(a){var b=a.target.result;b?(g.push(b.key),b["continue"]()):c.call(MASCP.Service,g)}},l=function(b,c){var d=a.transaction(["cached"],"readonly"),e=d.objectStore("cached"),f=e.index("services"),g=IDBKeyRange.only(b);f.openCursor(g,"nextunique").onsuccess=function(a){var b=a.target.result;b?c.call(MASCP.Service,b.value.acc):c.call(MASCP.Service,null)}},i=function(b,c){var d=a.transaction(["cached"],"readonly"),e=d.objectStore("cached"),f=e.index("services"),g=[],h=IDBKeyRange.only(b);f.openCursor(h).onsuccess=function(a){var b=a.target.result;b?(g.push(b.value.acc),b["continue"]()):c.call(MASCP.Service,g)}}},t=function(a){if(a.all('SELECT version from versions where tablename = "datacache"',function(b,c){var d=c&&c.length>0?c[0].version:null;return 1.3==d?(MASCP.events&&MASCP.events.emit("ready"),void(MASCP.ready?(MASCP.ready(),MASCP.ready=!0):MASCP.ready=!0)):((!d||""==d||1>d)&&(a.exec("CREATE TABLE if not exists versions (version REAL, tablename TEXT);"),a.exec('CREATE TABLE if not exists "datacache" (agi TEXT,service TEXT,retrieved REAL,data TEXT);',function(a){if(a&&"Error: not an error"!=a)throw a}),a.exec('DELETE FROM versions where tablename = "datacache"'),a.exec('INSERT INTO versions(version,tablename) VALUES(1.1,"datacache");',function(a,b){}),d=1.1),1.2>d&&(a.exec("DROP TABLE if exists datacache_tmp;"),a.exec("CREATE TABLE if not exists datacache_tmp (acc TEXT,service TEXT,retrieved REAL,data TEXT);"),a.exec("INSERT INTO datacache_tmp(acc,service,retrieved,data) SELECT agi,service,retrieved,data FROM datacache;"),a.exec("DROP TABLE datacache;"),a.exec("ALTER TABLE datacache_tmp RENAME TO datacache;"),a.exec("CREATE INDEX accessions on datacache(acc);"),a.exec("CREATE INDEX accessions_service on datacache(acc,service);"),a.exec('DELETE FROM versions where tablename = "datacache"'),a.exec('INSERT INTO versions(version,tablename) VALUES(1.2,"datacache");',function(a,b){}),d=1.2),void(1.3>d&&(a.exec("CREATE INDEX if not exists services on datacache(service);"),a.exec('DELETE FROM versions where tablename = "datacache"'),a.exec('INSERT INTO versions(version,tablename) VALUES(1.3,"datacache");',function(a,b){a||(MASCP.events&&MASCP.events.emit("ready"),MASCP.ready?(MASCP.ready(),MASCP.ready=!0):MASCP.ready=!0)}),d=1.3)))}),"undefined"!=typeof module&&module.exports){var o=null;j=function(c,d){return null!==o?(c.call({transaction:d}),!1):(a.exec("PRAGMA synchronous=OFF; PRAGMA journal_mode=OFF;",function(a){return a?void c.call(null,a):(o=b,b=function(a,b,c){setTimeout(function(){c.call(null,null)},0)},void c.call({transaction:d}))}),!0)},k=function(c){return null===o?void c():void a.exec("PRAGMA synchronous=FULL; PRAGMA journal_mode=DELETE;",function(a){b=o,o=null,c(a)})}}else j=function(a,b){a.call({transaction:b})},k=function(a){a()};h=function(b){a.all("DELETE from datacache where retrieved <= ? ",[b],function(){})},e=function(b,c,d){var e=b;e+="%",c?a.all("DELETE from datacache where service like ? and acc = ?",[e,c.toLowerCase()],function(){d.call(MASCP.Service)}):a.all("DELETE from datacache where service like ? ",[e],function(){d.call(MASCP.Service)})},d=function(b,c){a.all("SELECT distinct service from datacache where service like ? ",[b+"%"],function(a,b){var d={};b&&b.length>0&&b.forEach(function(a){d[a.service]=!0});var e=[];for(var f in d)d.hasOwnProperty(f)&&e.push(f);return c.call(MASCP.Service,e),e})},l=function(b,c){a.all("SELECT distinct acc from datacache where service = ? limit 1",[b],function(a,b){!b||b.length<1?c.call(MASCP.Service,null):c.call(MASCP.Service,b[0].acc)})},i=function(b,c){a.all("SELECT distinct acc from datacache where service = ?",[b],function(a,b){for(var d=[],e=0;e<b.length;e++)d.push(b[e].acc);c.call(MASCP.Service,d)})},get_snapshot=function(b,c,d,e){c&&"object"==typeof c&&c.length||(c=[0,(new Date).getTime()]);var f,g=[b,c[0],c[1]];if(d&&Array.isArray(d)){var h=new Array(d.length+1).join(",?").substring(1);g=g.concat(d),f="SELECT * from datacache where service = ? AND retrieved >= ? AND retrieved <= ? AND acc in ("+h+") ORDER BY retrieved ASC"}else d&&/^\d+$/.test(d.toString())?(f="SELECT * from datacache where service = ? AND retrieved >= ? AND retrieved <= ? LIMIT ? ORDER BY retrieved ASC",g=g.concat(parseInt(d.toString()))):f="SELECT * from datacache where service = ? AND retrieved >= ? AND retrieved <= ? ORDER BY retrieved ASC";a.all(f,g,function(a,b){b=b||[];var c={};b.forEach(function(a){var b="string"==typeof a.data?JSON.parse(a.data):a.data;b&&(b.retrieved=new Date(parseInt(a.retrieved))),c[a.acc]&&c[a.acc].retrieved>a.retrieved||(c[a.acc]=a)}),e.call(null,null,c)})},b=function(a,b,c){var d=m?[n,m]:[n,(new Date).getTime()];return f(a,b,d,c)};var p=function(a,b){return function(a,b){}};c=function(b,c,d){if(!("object"!=typeof d||"undefined"!=typeof Document&&d instanceof Document)){var e;try{e=JSON.stringify(d)}catch(f){return}var g=d.retrieved?d.retrieved:new Date;"string"==typeof g&&(g=new Date),g.setUTCHours(0),g.setUTCMinutes(0),g.setUTCSeconds(0),g.setUTCMilliseconds(0);var h=g.getTime();d={},a.all("INSERT INTO datacache(acc,service,retrieved,data) VALUES(?,?,?,?)",[b,c,h,e],p(b,c))}},f=function(b,c,d,e){var f="SELECT * from datacache where acc=? and service=? and retrieved >= ? and retrieved <= ? ORDER BY retrieved DESC LIMIT 1",g=[b,c,d[0],d[1]];a.all(f,g,function(a,b){if(b&&b.length>0&&"undefined"!=typeof b[0]){var c="string"==typeof b[0].data?JSON.parse(b[0].data):b[0].data;c&&(c.retrieved=new Date(parseInt(b[0].retrieved))),e.call(null,null,c)}else e.call(null,null,null)})},g=function(b,c,d){c&&"object"==typeof c&&c.length||(c=[0,(new Date).getTime()]);var e="SELECT distinct retrieved from datacache where service=? and retrieved >= ? and retrieved <= ? ORDER BY retrieved ASC",f=[b,c[0],c[1]];a.all(e,f,function(a,b){var c=[];if(b&&b.length>0&&"undefined"!=typeof b[0])for(var e=b.length-1;e>=0;e--)c.push(new Date(parseInt(b[e].retrieved)));d.call(null,c)})}},u=function(){h=function(a){if("localStorage"in window){for(var b=[],c=0,d=localStorage.length;d>c;c++)b.push(localStorage.key(c));for(var e=b.shift();e;){if(new RegExp("^MASCP.*").test(e)){var f=localStorage[e];if(f&&"string"==typeof f){var g=JSON.parse(f);g.retrieved=a,localStorage.removeItem(e)}}e=b.shift()}}},e=function(a,b,c){if("localStorage"in window){for(var d=[],e=0,f=localStorage.length;f>e;e++)d.push(localStorage.key(e));for(var g=d.shift();g;){if(new RegExp("^"+a+".*"+(b?"#"+b.toLowerCase()+"$":"")).test(g)&&(localStorage.removeItem(g),b))return;g=d.shift()}c.call(MASCP.Service)}},d=function(b,c){var d={};if("localStorage"in window)for(var e,f=new RegExp("^"+b+".*"),g=0,h=localStorage.length;h>g;g++)e=localStorage.key(g),f.test(e)&&(d[e.replace(/\.#.*$/g,"")]=!0);var i=[];for(var j in d)d.hasOwnProperty(j)&&i.push(j);return c.call(a,i),i},l=function(b,c){if("localStorage"in window)for(var d,e=new RegExp("^"+b),f=0,g=localStorage.length;g>f;f++)if(d=localStorage.key(f),e.test(d))return d=d.replace(b,""),void c.call(a,d);c.call(a,null)},i=function(b,c){if("localStorage"in window)for(var d,e=new RegExp("^"+b),f=0,g=localStorage.length;g>f;f++)d=localStorage.key(f),e.test(d)&&(d=d.replace(b,""),results[d]=!0);var h=[];for(var i in results)results.hasOwnProperty(i)&&h.push(i);c.call(a,h)},b=function(a,b,c){var d=localStorage[b.toString()+".#"+(a||"").toLowerCase()];if(d&&"string"==typeof d){var e=JSON.parse(d);e.retrieved=new Date(parseInt(e.retrieved)),c.call(null,null,e)}else c.call(null,null,null)},c=function(a,b,c){c&&("object"!=typeof c||c instanceof Document||c.nodeName)||(c.retrieved=(new Date).getTime(),localStorage[b.toString()+".#"+(a||"").toLowerCase()]=JSON.stringify(c))},f=function(a,c,d,e){return b(a,c,e)},g=function(a,b,c){c.call(null,[])},j=function(a){setTimeout(function(){a.call()},0)},k=function(a){setTimeout(function(){a()},0)},MASCP.events&&MASCP.events.emit("ready"),setTimeout(function(){MASCP.ready?(MASCP.ready(),MASCP.ready=!0):MASCP.ready=!0},100)};if("undefined"!=typeof window&&(window.indexedDB=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB,window.indexedDB||delete window.indexedDB),"undefined"!=typeof module&&module.exports){var v=require("sqlite3");q=new v.Database("cached.db"),process.env.SKIP_VACUUM||q.exec("VACUUM;")}else if("openDatabase"in window||"indexedDB"in window)if("indexedDB"in window){"webkitIndexedDB"in window&&(window.IDBTransaction=window.webkitIDBTransaction,window.IDBKeyRange=window.webkitIDBKeyRange,window.IDBCursor=window.webkitIDBCursor);var w=function(a,b){var c=b.db;c.objectStoreNames&&c.objectStoreNames.contains("cached")&&c.deleteObjectStore("cached");var d=window.msIndexedDB?"serviceacc":"id",e=c.createObjectStore("cached",{keyPath:d});e.createIndex("entries",["acc","service"],{unique:!1}),window.msIndexedDB&&e.createIndex("entries-ms","serviceacc",{unique:!1}),e.createIndex("timestamps",["service","retrieved"],{unique:!1}),e.createIndex("services","service",{unique:!1}),b.oncomplete=function(){z(c),z=function(){}}};r=!0;var x=2,y=indexedDB.open("datacache",x);y.onupgradeneeded=function(a){var b=y.transaction;w(a.oldVersion,b)};var z=function(a){a&&(r=a),s(r),MASCP.events&&MASCP.events.emit("ready"),MASCP.ready?(MASCP.ready(),MASCP.ready=!0):MASCP.ready=!0};y.onerror=function(a){console.log("Error loading Database"),u()},y.onsuccess=function(a){r=a.target.result;var b=x;if(r.version!=Number(b)){var c=q.setVersion(ver);c.onsuccess=function(a){var b=c.result;w(oldVersion,b)}}else z()}}else{try{q=openDatabase("cached","","MASCP Gator cache",1048576)}catch(A){throw A}q.all=function(a,b,c){this.exec(a,b,c)},q.exec=function(a,b,c){var d=this,e=b,f=c;"undefined"==typeof f&&e&&"[object Array]"!=Object.prototype.toString.call(e)&&(f=b,e=null),d.transaction(function(b){b.executeSql(a,e,function(a,b){for(var c=[],d=0;d<b.rows.length;d++)c.push(b.rows.item(d));f&&f.call(q,null,c)},function(a,b){f&&f.call(q,b)})})}}"undefined"!=typeof r||("undefined"!=typeof q?t(q):"localStorage"in window?u():(h=function(a){},e=function(a,b){},d=function(a,b){},i=function(b,c){c.call(a,[])},b=function(a,b,c){c.call(null,null,null)},c=function(a,b,c){},f=function(a,b,c,d){d.call(null,[])},g=function(a,b,c){c.call(null,[])},j=function(a,b){setTimeout(function(){a({transaction:b})},0)},k=function(a){setTimeout(function(){a()},0)}))}(MASCP.Service),MASCP.Service.prototype.setAsync=function(a){return this.async=a,this},MASCP.Service.prototype.requestData=function(){},MASCP.Service.prototype.toString=function(){for(var a in MASCP)if(this.__class__==MASCP[a])return"MASCP."+a},MASCP.Service.prototype.registerSequenceRenderer=function(a,b){return this.setupSequenceRenderer&&(this.renderers=this.renderers||[],this.setupSequenceRenderer(a,b),this.renderers.push(a)),a.trigger("readerRegistered",[this]),this},MASCP.Service.prototype.resetOnResult=function(a,b,c){var d=this,e=function(){d.unbind("resultReceived",e),a.bind("resultsRendered",f)},f=function(e){e===d&&(a.unbind("resultsRendered",f),b.forEach(function(b){a.remove(c,b)}))};this.bind("resultReceived",e)},MASCP.Service.prototype.setupSequenceRenderer=function(a){return this},MASCP.Service.importNode=function(a){if("undefined"==typeof document)return a;var b;return"string"==typeof a?(b=document.createElement("div"),b.innerHTML=a,b.firstChild):document.importNode?document.importNode(a,!0):(b=document.createElement("div"),b.innerHTML=a.xml,b.firstChild)},MASCP.Service.Result=function(){},MASCP.Service.Result.prototype={agi:null,reader:null},MASCP.Service.Result.prototype.render=function(){},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.AccessionReader=MASCP.buildService(function(a){return this._data=a||{data:["",""]},this}),MASCP.AccessionReader.SERVICE_URL="http://gator.masc-proteomics.org/tair.pl",MASCP.AccessionReader.prototype.requestData=function(){return{type:"GET",dataType:"json",data:{agi:this.agi,accession:this.accession,service:"tair"}}},MASCP.AccessionReader.Result.prototype.getDeletions=function(){return[]},MASCP.AccessionReader.prototype.setupSequenceRenderer=function(a){var b=this;this.bind("resultReceived",function(){var c=b.accession.split(","),d=c.shift(),e=b.result.length?b.result.shift():b.result;for(MASCP.registerGroup("all_insertions"),MASCP.registerGroup("all_deletions"),a.registerLayer("insertions",{fullname:"Accession",color:"#ff0000"}),a.createGroupController&&a.createGroupController("insertions","all_insertions"),console.log(e);e;){var f=a.sequence,g=e.getSequence(),h=(new diff_match_patch).diff_main(f,g),i=1,j=[],k=[];if(h.length<=1)e=b.result.length?b.result.shift():null,d=c.shift();else{var l="all_"+d;a.registerLayer(l,{fullname:d,group:"all_insertions"});var m;for(m=h.length-1;m>=0;m--)m>0&&h[m-1][0]<=0&&(i+=h[m-1][1].length,i>a.sequence.length&&(i=a.sequence.length)),-1==h[m][0]&&k.push({index:i,delta:h[m][1]}),1==h[m][0]&&j.push({insertBefore:i,delta:h[m][1]});for(m=j.length-1;m>=0;m--)a.getAA(j[m].insertBefore-1).addAnnotation(l,1,{border:"rgb(150,0,0)",content:j[m].delta}),a.getAA(j[m].insertBefore-1).addAnnotation("insertions",1,{border:"rgb(150,0,0)",content:j[m].delta});for(m=k.length-1;m>=0;m--)a.getAA(k[m].index).addAnnotation(l,1,{angle:90,border:"rgb(0,0,150)",content:k[m].delta}),a.getAA(k[m].index).addAnnotation("insertions",1,{angle:90,border:"rgb(0,0,150)",content:k[m].delta});e=b.result.length?b.result.shift():null,d=c.shift()}}})},MASCP.AccessionReader.Result.prototype.getDescription=function(){return this._data.data[1]},MASCP.AccessionReader.Result.prototype.getSequence=function(){return"object"==typeof this._data&&this._data.length?this._data[0].data[2]:this._data.data[2]},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.ArbitraryDataReader=MASCP.buildService(function(a){return this._raw_data=a,this}),MASCP.ArbitraryDataReader.SERVICE_URL="http://gator.masc-proteomics.org/datasets.pl?",MASCP.ArbitraryDataReader.prototype.requestData=function(){var a=this.agi,b=this._dataset();return b?{type:"GET",dataType:"json",data:{agi:a,dataset:b,service:"ArbitraryData"}}:{type:"GET",dataType:"json",data:{service:"ArbitraryData"}}},MASCP.ArbitraryDataReader.prototype._extend=function(a){if(null===this||"object"!=typeof this||"undefined"==typeof a||!a)return this;var b=new MASCP.ArbitraryDataReader;return b._endpointURL=this._endpointURL,b.agi=this.agi,b.toString=function(){var c=MASCP.Service.prototype.toString.call(b);return c+"."+a},b._dataset=function(){return a},b.layer=function(){return"arbitrary_"+a},b},MASCP.ArbitraryDataReader.prototype._dataset=function(){return null},MASCP.ArbitraryDataReader.prototype.retrieve=function(a,b){var c=this,d=this.agi||a;if(d&&this._dataset())return void MASCP.Service.prototype.retrieve.call(c,a,b);if(!this._SERVER_DATASETS&&d&&"dummy"!=d){var e=new MASCP.ArbitraryDataReader("",c._endpointURL);return void e.retrieve("dummy",function(){this.result?c._SERVER_DATASETS=this.result._raw_data.data:c._SERVER_DATASETS=[],c.retrieve(a,b)})}return this._SERVER_DATASETS?0==this._SERVER_DATASETS.length?(MASCP.Service.prototype.retrieve.call(c,"dummy",b),void(c.renderers||[]).forEach(function(a){a.trigger("resultsRendered",[c])})):void this._SERVER_DATASETS.forEach(function(a){var e=c._extend(a);(c.renderers||[]).forEach(function(a){e.setupSequenceRenderer(a),a.bind("resultsRendered",function(b){b==e&&a.trigger("resultsRendered",[c])})}),e.bind("resultReceived",function(){c.gotResult()}),e.bind("requestComplete",function(){c.requestComplete()}),e.retrieve(d,b)}):void MASCP.Service.FindCachedService(c.toString(),function(a){if(a.length>=0){var d=[];a.forEach(function(a){d.push(a.replace(c.toString()+".",""))}),c._SERVER_DATASETS=d,c.result={},c.result._raw_data={data:d}}c._endpointURL&&c._endpointURL.length&&MASCP.Service.ClearCache(c),MASCP.Service.prototype.retrieve.call(c,"dummy",b)})},MASCP.ArbitraryDataReader.Result=MASCP.ArbitraryDataReader.Result,MASCP.ArbitraryDataReader.Result.prototype.getPeptides=function(){return this._peptides?this._peptides:this._raw_data&&this._raw_data.data?this._raw_data.data:[]},MASCP.ArbitraryDataReader.prototype.setupSequenceRenderer=function(a){var b=this;if(this._dataset()){var c=".active .overlay { background: #ff5533; } .active a { color: #000000; text-decoration: none !important; }  :indeterminate { background: #ff0000; } .tracks .active { background: #0000ff; } .inactive a { text-decoration: none; } .inactive { display: none; }";return this.bind("resultReceived",function(){var d=this.result.getPeptides();if(d.length<=0)return void a.trigger("resultsRendered",[b]);MASCP.registerGroup("arbitrary_datasets",{fullname:"Other data",color:"#ff5533"}),MASCP.registerLayer("arbitrary_controller",{fullname:"Other data",color:"#ff5533",css:c});var e=this.layer();MASCP.registerLayer(e,{group:"arbitrary_datasets",fullname:this._dataset(),color:this.result._raw_data.color||"#ff5533",css:c}),this.result._raw_data.url&&(MASCP.getLayer(e).href=this.result._raw_data.url);for(var f=0;f<d.length;f++){var g,h=d[f];"string"==typeof h?(g=a.getAminoAcidsByPeptide(h),g.addToLayer(e)):2==h.length&&a.getAA(h[0]).addBoxOverlay(e,h[1]-h[0])}a.createGroupController&&a.createGroupController("arbitrary_controller","arbitrary_datasets"),a.trigger("resultsRendered",[b])}),this}},MASCP.ArbitraryDataReader.Result.prototype.render=function(){},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.AtChloroReader=MASCP.buildService(function(a){return this._raw_data=a,this}),MASCP.AtChloroReader.SERVICE_URL="http://prabi2.inrialpes.fr/at_chloro/annotation/",MASCP.AtChloroReader.prototype.requestData=function(){var a=this.agi;return{type:"GET",url:this._endpointURL+a.toUpperCase(),dataType:"json",data:{agi:a.toUpperCase(),service:"atchloro"}}},MASCP.AtChloroReader.Result=MASCP.AtChloroReader.Result,MASCP.AtChloroReader.Result.prototype.getPeptides=function(){if(this._peptides)return this._peptides;if(this._long_name_map={},!this._raw_data||!this._raw_data.peptides)return[];for(var a=[],b=0;b<this._raw_data.peptides.length;b++){var c=this._raw_data.peptides[b],d={sequence:this._cleanSequence(c.sequence)};a.push(d)}return this._peptides=a,a},MASCP.AtChloroReader.Result.prototype._cleanSequence=function(a){return a.replace(/[^A-Z]/g,"")},MASCP.AtChloroReader.prototype.setupSequenceRenderer=function(a){var b=this,c=".active .overlay { background: #55ff33; } .active a { color: #000000; text-decoration: none !important; }  :indeterminate { background: #ff0000; } .tracks .active { background: #0000ff; } .inactive a { text-decoration: none; } .inactive { display: none; }";return this.bind("resultReceived",function(){var d=this.result.getPeptides();d.length>0&&(MASCP.registerLayer("atchloro_experimental",{fullname:"AT_CHLORO MS/MS",color:"#55ff33",css:c}),MASCP.getLayer("atchloro_experimental").href="http://prabi2.inrialpes.fr/at_chloro/protein/"+b.agi.toUpperCase());for(var e=0;e<d.length;e++){var f=d[e].sequence,g=a.getAminoAcidsByPeptide(f);g.addToLayer("atchloro_experimental")}a.trigger("resultsRendered",[b])}),this},MASCP.AtChloroReader.Result.prototype.render=function(){},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.AtPeptideReader=MASCP.buildService(function(a){return this._raw_data=a,this}),MASCP.AtPeptideReader.SERVICE_URL="http://gator.masc-proteomics.org/atpeptide.pl?",MASCP.AtPeptideReader.prototype.requestData=function(){var a=this.agi;return{type:"GET",dataType:"json",data:{agi:a,service:"atpeptide"}}},MASCP.AtPeptideReader.Result.prototype.tissues=function(){return this._tissues},MASCP.AtPeptideReader.Result=MASCP.AtPeptideReader.Result,MASCP.AtPeptideReader.Result.prototype.getPeptides=function(){if(this._peptides)return this._peptides;if(this._tissues=[],this.spectra={},this._long_name_map={},!this._raw_data||!this._raw_data.peptides)return[];for(var a=[],b=function(){return this.sequence},c=this._raw_data.peptides.length-1;c>=0;c--){var d=this._raw_data.peptides[c],e={sequence:this._cleanSequence(d.sequence),tissues:[]};e.toString=b,a.push(e);for(var f=d.tissues.length-1;f>=0;f--){var g=d.tissues[f];if(this._tissues.indexOf(g["PO:tissue"])<0){var h=g["PO:tissue"];this._tissues.push(h),h.long_name=g.tissue,this._long_name_map[h]=g.tissue}e.tissues.push(g["PO:tissue"]),this.spectra[g["PO:tissue"]]||(this.spectra[g["PO:tissue"]]=0),this.spectra[g["PO:tissue"]]+=1}}return this._peptides=a,a},MASCP.AtPeptideReader.Result.prototype._cleanSequence=function(a){return a.replace(/[^A-Z]/g,"")},MASCP.AtPeptideReader.prototype.setupSequenceRenderer=function(a){var b=this;return this.bind("resultReceived",function(){MASCP.registerGroup("atpeptide_experimental",{fullname:"AtPeptide MS/MS",hide_member_controllers:!0,hide_group_controller:!0,color:"#ff5533"});var c="atpeptide_controller",d=".active .overlay { background: #ff5533; } .active a { color: #000000; text-decoration: none !important; }  :indeterminate { background: #ff0000; } .tracks .active { background: #0000ff; } .inactive a { text-decoration: none; } .inactive { display: none; }";MASCP.registerLayer(c,{fullname:"AtPeptide MS/MS",color:"#ff5533",css:d}),a.createGroupController&&a.createGroupController("atpeptide_controller","atpeptide_experimental");for(var e=this.result.getPeptides(),f=0;f<this.result.tissues().length;f++){var g=this.result.tissues()[f];MASCP.registerLayer("atpeptide_peptide_"+g,{fullname:this.result._long_name_map[g],group:"atpeptide_experimental",color:"#ff5533",css:d});for(var h=0;h<e.length;h++){var i=e[h].sequence;if(!(e[h].tissues.indexOf(g+"")<0)){var j=a.getAminoAcidsByPeptide(i),k="atpeptide_peptide_"+g;j.addToLayer(k),j.addToLayer(c)}}}a.trigger("resultsRendered",[b])}),this},MASCP.AtPeptideReader.Result.prototype.render=function(){},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(function(){var a=function(a){for(var b=a.split("\n"),c=[],d=b.length-1;d>=0;d--)b[d].match(/^#/)||c.push(b[d].replace(/"/g,"").split(/\t/));return c.reverse()};MASCP.CddRunner=MASCP.buildService(function(b){if(this._raw_data=b,b&&"string"==typeof b){var c=this,d=a(b),e=!1;c._raw_data={data:{}},d.forEach(function(a){if(12==a.length){if(!e)return void(e=!0);c._raw_data.data[a[7]]||(c._raw_data.data[a[7]]={peptides:[]});var b=c._raw_data.data[a[7]];b.peptides.push([a[3],a[4]]),b.name=a[8],b.description=a[11]}})}return this})}(),MASCP.CddRunner.SERVICE_URL="http://www.ncbi.nlm.nih.gov/Structure/bwrpsb/bwrpsb.cgi?",MASCP.CddRunner.prototype.requestData=function(){var a=this;bean.fire(a,"error",["CDD live retrieving is disabled"])},function(a){var b=a.prototype._dataReceived;a.prototype._dataReceived=function(a,c){if(null===a)return b.call(this,null,c);if("object"==typeof a){if(a.status&&"RUNNING"==a.status){var d=this;return bean.fire(d,"running"),setTimeout(function(){d.retrieve(d.agi)},5e3),void console.log("Got back running status")}return b.call(this,a,c)}var e,f=/^#cdsid\t([a-zA-Z0-9-]+)/m;if("string"==typeof a&&!this.job_id&&(e=f.exec(a))){var d=this;return this.job_id=e[1],void d.retrieve(this.agi)}if(f=/^#status\tsuccess/m,f.exec(a))return this.job_id=null,b.call(this,a,c);if(f=/#status\t3/m,f.exec(a)){var d=this;return void setTimeout(function(){d.retrieve(d.agi)},5e3)}return b.call(this,a,c)}}(MASCP.CddRunner),"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(function(){var a=!1;MASCP.DomainRetriever=MASCP.buildService(function(a){return this._raw_data=a,this}),MASCP.DomainRetriever.prototype.requestData=function(){var a=this._endpointURL;if(Array.isArray(a))return this.requestDataWithUniprot();var b=this.agi.toLowerCase(),c="/"==a.slice(-1)?a+b:a+"/"+b;return{type:"GET",dataType:"json",url:c,data:{agi:b}}},MASCP.DomainRetriever.prototype.requestDataWithUniprot=function(){var a=this,b=this._endpointURL,c={},d=function(a,b){
var c;for(c in b.data)a.data[c]=b.data[c];return a},e=function(b){return b&&"No data"!==b?(bean.fire(a,"error",[b]),bean.fire(MASCP.Service,"requestComplete"),a.requestComplete(),void(e=function(){})):void(c.uniprot&&c.full&&(a._dataReceived(d(c.uniprot,c.full)),a.gotResult(),a.requestComplete()))};return b.forEach(function(b){var d,f="uniprot";b.indexOf("uniprot")>=0?d=new MASCP.UniprotDomainReader:(f="full",d=new MASCP.DomainRetriever(null,b)),d.retrieve(a.agi,function(a){a?c[f]={}:c[f]=this.result._raw_data,e(a)})}),!1},MASCP.DomainRetriever.getRawData=function(a,b){if("gatorURL"===a.type)return void b.call({error:"Can't get raw data from GATOR URL, missing accession"});if("googleFile"===a.type)return void e(a,function(a,c){return a?void b.call(null,a):void b.call(null,null,c.getData(),c.permissions,c.owner)});if("url"===a.type){sessionStorage.wanted_domains||(sessionStorage.wanted_domains="{}");var c=JSON.parse(sessionStorage.wanted_domains);if(c[a.url])return void b.call(null,null,JSON.parse(c[a.url]));MASCP.Service.request(a.url,function(a,c){return a?void b.call(null,a):void b.call(null,null,c)})}};var b=function(a,c,d){if(a&&Array.isArray(a)){var f=[].concat(a),g=f.shift();return void b(g,c,function(a,e){if(a){if(g=f.shift())return void b(g,c,arguments.callee);d.call(null,a,e)}else d.call(null,a,e)})}if("gatorURL"===a.type){var h=new MASCP.UserdataReader(null,a.url);h.requestData=MASCP.DomainRetriever.prototype.requestData,h.retrieve(c,function(a){if(a)return"string"==typeof a&&(a={error:a}),void d.call(null,a);var b=null;this.result&&(b=this.result._raw_data.data.domains),d.call(null,null,b)})}if("googleFile"===a.type&&e(a,function(a,b){if(a)return void d.call(null,a);var e=b.getData();if(c in e){var f=[],g=JSON.parse(e[c]);for(var h in g)g.hasOwnProperty(h)&&f.push(h.replace("dom:",""));d.call(null,null,g?f:null)}else d.call(null,{error:"No data"},null)}),"url"===a.type){sessionStorage.wanted_domains||(sessionStorage.wanted_domains="{}");var i=JSON.parse(sessionStorage.wanted_domains);if(i[a.url])return void d.call(null,null,JSON.parse(i[a.url])[c]);MASCP.Service.request(a.url,function(a,b){return a?void d.call(null,a):void d.call(null,null,b?b[c]:null)})}},c=function(a,b){return a&&Array.isArray(a)&&(a=a[0]),"googleFile"===a.type?void e(a,function(a,c){return a?void b.call(null,a):void b.call(null,null,c.permissions.write)}):void b.call(null,null,!1)},d={},e=function(a,b){var c="",e="application/json",f={};"string"==typeof a.file?(c=a.file,f=a.file):(c=a.file.file_id,f={id:a.file.file_id},e="application/json; data-type=domaintool-domains");var g=d[c];return g?g.ready?void b.call(null,null,g):void bean.add(g,"ready",function(){bean.remove(g,"ready",arguments.callee),b.call(null,null,g)}):void(d[c]=(new MASCP.GoogledataReader).getSyncableFile(f,b,e))},f=function(a,b){return a&&Array.isArray(a)&&(a=a[0]),"googleFile"===a.type?void e(a,function(a,c){return a?void b.call(null,a):(b.call(null,null,c.getData()),void c.sync())}):void b.call()},g=function(a,c){var d=this,e=function(b){return function(){var e=d.result._raw_data.data;h(e,b,a,function(b){c(a,b)})}};e([]);d.preferences.getPreferences(function(c,d){d&&d.accepted_domains&&b(d.accepted_domains,a,function(a,b){if(a){if(403==a.status)return void e([])();if("No data"!==a.error)return void console.log("Some problem");b=null}e(b)()})})},h=function(a,b,c,d){var e={};if(!b)return d.call(null,a),a;a=a||{};for(var f in a)if(a.hasOwnProperty(f)){var g=f.replace(/\s/g,"_");b.indexOf(g)>=0&&(e[f]=a[f]),g.match(/GlcNAc/)&&(e[f]=a[f])}return a["tmhmm-TMhelix"]&&(e["tmhmm-TMhelix"]=a["tmhmm-TMhelix"]),d.call(null,e),e},i=function(b,c,d,e,f,g,h){var i=e||d.toString();MASCP.registerLayer(i,{fullname:"All domains",color:"#aaaaaa"},[b]);var j=[];for(var k in c)j.push(k);j.sort(function(a,b){return"SIGNALP"==a?1:"SIGNALP"==b?-1:"tmhmm-TMhelix"==a?1:"tmhmm-TMhelix"==b?-1:a.localeCompare(b)});var l={};j.forEach(function(d){var e="dom:"+d;e=e.replace(/\s/g,"_"),"KDEL"==d&&c[d].peptides.push([b.sequence.length-3,b.sequence.length]);var j=c[d].name;if("tmhmm-TMhelix"==d&&(j="TM Transmembrane"),"tmhmm-outside"!=d&&"tmhmm-inside"!=d){MASCP.registerLayer(e,{fullname:j||d,color:"#aaaaaa"},[b]),b.trackOrder.push(e),a&&b.showLayer(e);var k=!1,m={};c[d].peptides.forEach(function(a){var j=parseInt(a[0]),n=parseInt(a[1]);if(!isNaN(j)&&!m[j]){if("tmhmm-TMhelix"==d&&c.SIGNALP){var o=parseInt(c.SIGNALP.peptides[0][1]);if(o>=n||o>=j)return}if(m[j]=!0,l[e]||(l[e]=[]),l[i]||(l[i]=[]),j==n){var p=/N\-linked.*GlcNAc/.test(d)?"glcnac(b1-4)glcnac":/GlcNAc/.test(d)?"glcnac":/GalNAc/.test(d)?"galnac":/Fuc/.test(d)?"fuc":/Man/.test(d)?"man":/Glc\)/.test(d)?"glc":/Gal[\.\)]/.test(d)?"gal":/Hex[\.\)]/.test(d)?"hex":/HexNAc/.test(d)?"hexnac":/Xyl/.test(d)?"xyl":"?",q=8;"glcnac(b1-4)glcnac"!=p&&p!=b.small_galnac&&"xyl"!=p&&p!=b.fuc||(q+=8),/Potential/.test(d)&&"glcnac(b1-4)glcnac"==p&&(p+=".potential"),l[i].push({aa:j,type:"marker",options:{height:q,content:"#"+h+"_"+p,offset:f+12,angle:0,bare_element:!0}}),l[e].push({aa:j,type:"marker",options:{height:8,content:"#"+h+"_"+p,offset:12,bare_element:!0}})}else{c[d].name||(c[d].name=d);var r=c[d].name.replace(/\s/g,"_");if(window.DOMAIN_DEFINITIONS&&window.DOMAIN_DEFINITIONS[r]){var s=window.DOMAIN_DEFINITIONS[r],t=b.gradients.length>0?"url('#grad_"+s[1]+"')":s[1];l[i].push({aa:j,type:"shape",width:n-j+1,options:{offset:f,height:g,shape:s[0],fill:t,rotate:s[2]||0}}),l[e].push({aa:j,type:"shape",width:n-j+1,options:{shape:s[0],fill:'url("#grad_'+s[1]+'")'}})}else l[i].push({aa:j,type:"box",width:n-j+1,options:{offset:f,height:g}}),l[e].push({aa:j,type:"box",width:n-j+1,options:{}});l[i].push({aa:j,type:"text",width:n-j+1,options:{txt:c[d].name,height:g-2,offset:f+1,fill:"#111",stroke:"#999"}})}k=!0}})}}),b.renderObjects(i,l[i]),b.showLayer(i),b.trigger("resultsRendered"),b.zoom-=1e-4},j=function(a,b){var c=a.navigation.isEditing();b||(a.trackOrder.forEach(function(b){b.match(/^dom\:/)&&(c?a.showLayer(b):a.hideLayer(b))}),a.refresh())},k=function(a){var b=this;b.preferences.getPreferences(function(b,c){c&&c.accepted_domains&&f(c.accepted_domains,function(b,c){c[a]=null})})};MASCP.DomainRetriever.prototype.setupSequenceRenderer=function(a,b){var c=this;l.call(c,a),c.bind("resultReceived",function(){c.acc=c.agi,g.call(c,c.agi,function(c,d){var e={gotResult:function(){i(a,d,c,b.track,b.offset,b.height||8,b.icons?b.icons.namespace:null),bean.add(a.navigation,"toggleEdit",function(){j.enabled&&j(a)}),j(a,!0),a.trigger("domainsRendered")},acc:c};a.trigger("readerRegistered",[e]),e.gotResult()})})};var l=function(a){var b=this;b.preferences.getPreferences(function(d,e){a.clearDataFor=function(a){},c(e.accepted_domains,function(c,d){if(d){a.clearDataFor=function(a){k.call(b,a)},j.enabled=!0;var e=function(c){return console.log("Order changed"),c.indexOf((b.acc||"").toUpperCase())==c.length-1&&c.length>0||1==c.length&&c[0]==b.acc.toUpperCase()?(console.log(b.acc),void a.clearDataFor(b.acc)):void(a.trackOrder.length>0&&(console.log("Removed layer"),m.call(b,a,b.acc)))};bean.add(a,"sequenceChange",function(){bean.remove(a,"orderChanged",e)}),bean.add(a,"orderChanged",e)}})})},m=function(a,b){var c=this,d={};a.trackOrder.forEach(function(b){b.match(/^dom\:/)&&a.isLayerActive(b)&&(d[b]=1)});var e=JSON.stringify(d);c.preferences.getPreferences(function(a,c){c&&c.accepted_domains&&f(c.accepted_domains,function(a,c){c[b]=e})})}}(),"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(function(){MASCP.EditableReader=MASCP.buildService(function(a){return this._raw_data=a,this}),MASCP.EditableReader.prototype.retrieve=function(a){a&&(this.acc=a,this.agi=a),bean.fire(this,"resultReceived")};var a=function(a){var b=[];return Object.keys(a).forEach(function(c){if("symbol_map"!==c&&"tag_map"!==c&&a[c]&&Array.isArray(a[c])){a[c];a[c].forEach(function(a){a.acc=c}),b=b.concat(a[c])}}),b},b=function(a){var b={};return a.forEach(function(a){a.acc&&(b[a.acc]||(b[a.acc]=[]),b[a.acc].push(a))}),b},c=function(a){var b=0,c=0;return a||(a=window.event),a.pageX||a.pageY?(b=a.pageX-(document.body.scrollLeft+document.documentElement.scrollLeft),c=a.pageY-(document.body.scrollTop+document.documentElement.scrollTop)):(a.clientX||a.clientY)&&(b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c=a.clientY+document.body.scrollTop+document.documentElement.scrollTop),self.targetElement&&(b=a.screenX,c=a.screenY),[b,c]},d=function(a,b){var d=c(a.changedTouches?a.changedTouches[0]:a),e={};if("svg"==b.nodeName){e=b.createSVGPoint();var f=b.getScreenCTM();e.x=d[0],e.y=d[1],self.matrix=f.inverse(),e=e.matrixTransform(self.matrix)}else e.x=d[0],e.y=d[1];return e},e=function(a){var b=this;if(a.event_data&&a.event_data.annotationid){var c=b.getAnnotation(a.event_data.annotationid);c&&(b.pieMaker(b.getAnnotation(a.event_data.annotationid)).call(a.target,"symbol"!==c.type,a),this.renderer._canvas.addEventListener("mousemove",f,!0))}},f=function(a){a.preventDefault(),a.stopPropagation()},g=function(a){var b=this;if(a.event_data&&a.event_data.annotationid&&"potential"===a.event_data.annotationid){var c=b.potential_annos[0];b.potential_annos=[],c.id=(new Date).getTime(),delete c["class"],b.annotations.push(c),b.renderer.select()}a.preventDefault(),a.stopPropagation()},h=function(a){var b=this;if(a.event_data&&a.event_data.annotationid){var c=b.getAnnotation(a.event_data.annotationid);c&&b.pie_map[c.id]&&(b.pie_map[c.id].end(),delete b.pie_map[c.id]),a.preventDefault()}},i=function(a){var b=this;this.pie_map={},a.addEventListener("mousedown",e.bind(b),!1),a.addEventListener("touchstart",e.bind(b),!1),a.addEventListener("click",g.bind(b),!1),a.addEventListener("touchend",h.bind(b),!1)},j=function(a,b,c){return{symbol:a.symbolTags[c],hover_function:function(){console.log("Set symbol to "+c),b.tag=c}}},k=function(a,b,c){return{text:c,hover_function:function(){b.tag=c}}},l=function(a,b){return{symbol:"#icon_trash",text_alt:"Delete",select_function:function(){a.demoteAnnotation("self",b)}}};MASCP.EditableReader.prototype.generatePieContent=function(a,b,c){var d=this,e=[];return c.forEach(function(c){e.push(a.call(null,d,b,c))}),e.push(l(d,b)),e},MASCP.EditableReader.prototype.pieMaker=function(a){var b=this;return function(c,e){if(e||(e=c,c=null),e.preventDefault(),e.stopPropagation(),!b.pie_map[a.id]){var g,h=b.renderer._canvas;c?g=b.generatePieContent(k,a,Object.keys(b.boxTags)):"symbol"==a.type&&(g=b.generatePieContent(j,a,Object.keys(b.symbolTags)));var i=d(e,h),l=PieMenu.create(h,i.x/h.RS,i.y/h.RS,g,{size:7,ellipse:!0});b.pie_map[a.id]=l;var m=function(c){h.removeEventListener("mouseout",m),h.removeEventListener("mouseup",m),h.removeEventListener("mousemove",f,!0),b.pie_map[a.id]&&(b.pie_map[a.id].destroy(),delete b.pie_map[a.id])};b.pie_map[a.id].end=m,h.addEventListener("mouseup",m,!1)}}},MASCP.EditableReader.prototype.setupSequenceRenderer=function(a,b){var c=this;bean.add(MASCP.getLayer(b.track),"selection",function(a,b){a&&b&&(b+=1,c.potential_annos=[{id:"potential",type:Math.abs(a-b)<=1?"symbol":"box",acc:c.acc,length:Math.abs(a-b),index:Math.min(a,b),"class":"potential"}],bean.fire(c,"resultReceived"))}),a._canvas&&i.call(c,a._canvas),a.bind("sequenceChange",function(){i.call(c,this._canvas)}),c.renderer=a,b.renderer||(b.renderer="var renderData = "+MASCP.EditableReader.renderer.toString())},Object.defineProperty&&(Object.defineProperty(MASCP.EditableReader.prototype,"result",{get:function(){var a=this.data;return this.potential_annos&&this.potential_annos[0]&&(a[this.potential_annos[0].acc]||(a[this.potential_annos[0].acc]=[]),a[this.potential_annos[0].acc].push(this.potential_annos[0])),{_raw_data:{data:a}}}}),Object.defineProperty(MASCP.EditableReader.prototype,"annotations",{get:function(){return this._annotations||(this._annotations=m(this)),this._annotations},set:function(a){this._annotations||(this._annotations=m(this)),a&&Array.prototype.splice.apply(this._annotations,[0,this._annotations.length].concat(a))}}),Object.defineProperty(MASCP.EditableReader.prototype,"data",{get:function(){var a=b(this.annotations);return a.symbol_map=this.symbolTags,a.tag_map=this.boxTags,a},set:function(b){this.annotations=a(b)}}),Object.defineProperty(MASCP.EditableReader.prototype,"symbolTags",{get:function(){return{GalNAc:"#sugar_galnac",Man:"#sugar_man",Xyl:"#sugar_xyl",Fuc:"#sugar_fuc",GlcNAc:"#sugar_glcnac","N-linked":"#sugar_glcnac(b1-4)glcnac"}}}),Object.defineProperty(MASCP.EditableReader.prototype,"boxTags",{get:function(){return this._box_tags||(this._box_tags={Red:"#f00",Green:"#0f0",Blue:"#00f"}),this._box_tags},set:function(a){Object.keys(a).forEach(function(b){this._box_tags[b]=a[b]})}}));var m=function(a){a._annotations||(a._annotations=[]),a.potential_annos||(a.potential_annos=[]);var b=function(b,c){b&&b.pie||c&&"pie"in c||bean.fire(a,"resultReceived")},c=new ArrayObserver(a._annotations);return a._annotations.forEach(function(a){new ObjectObserver(a).open(b)}),c.open(function(c){var d=!1;c.forEach(function(c){for(;c.addedCount>0;){var e=a._annotations[c.index+c.addedCount-1];new ObjectObserver(e).open(b),e.acc==a.acc&&(d=!0),c.addedCount-=1}}),d&&b()}),a._annotations};MASCP.EditableReader.prototype.getAnnotation=function(a){for(var b in this.annotations){var c=this.annotations.filter(function(b){return b.id===a});if(1==c.length)return c[0]}return null},MASCP.EditableReader.renderer=function(a,b,c){var d=function(a,b,c,d){var e,f=[];if("symbol"==a.type||1==a.length)e={aa:a.index,type:"marker",options:{content:b[a.tag]?b[a.tag]:"X",bare_element:!0,border:"#f00",offset:6+d,height:12}},f.push(e);else{e={aa:a.index,type:"shape",width:a.length,options:{shape:"rectangle",height:4,offset:0+d}},c[a.tag]&&(e.options.fill=c[a.tag]),f.push(e),a.tag&&(e={aa:a.index+Math.floor(.5*a.length),type:"marker",options:{content:{type:"text_circle",text:a.tag,options:{stretch:"right",weight:"normal",fill:"#000"},opacity:.8},offset:7.5+d,height:15,no_tracer:!0,bare_element:!0,tag_marker:!0,zoom_level:"text"}},f.push(e))}return f.forEach(function(b){b.options.events=[{type:"click",data:{annotationid:a.id,is_annotation:!b.tag_marker}},{type:"mousedown",data:{annotationid:a.id,is_annotation:!b.tag_marker}},{type:"touchstart",data:{annotationid:a.id,is_annotation:!b.tag_marker}},{type:"touchend",data:{annotationid:a.id,is_annotation:!b.tag_marker}}]}),f},e=function(a){var b=[];return Object.keys(a).forEach(function(c){if("symbol_map"!==c&&"tag_map"!==c&&a[c]&&Array.isArray(a[c])){a[c];a[c].forEach(function(a){a.acc=c}),b=b.concat(a[c])}}),b},f=function(a){var b=a,c=[];return b.forEach(function(a){if("potential"!==a["class"]){var b,d;b=a.index,d=a.index+(a.length||1),c.push({index:b,start:!0,annotation:a}),c.push({index:d,start:!1,annotation:a})}}),c.sort(function(a,b){var c=(a.annotation.acc||"").localeCompare(b.annotation.acc);return 0!==c&&a.annotation.acc&&b.annotation.acc?c:a.index<b.index?-1:a.index>b.index?1:a.index==b.index?a.start?-1:1:void 0}),b.forEach(function(a){if("potential"===a["class"]){var b,d;b=a.index,d=a.index+(a.length||1),c.unshift({index:d,start:!1,annotation:a}),c.unshift({index:b,start:!0,annotation:a})}}),c},g=function(a,b,c,e){for(var g=[e],h=[],i=f(a),j=-1,k=!0,l=0;k;){k=!1;for(var m=0;m<i.length;m++)if(i[m]){var n=i[m].annotation;g.indexOf(n.acc)<0||n.deleted||i[m].start&&(i[m].index>j?(j=n.index+(n.length||1),h=h.concat(d(n,b,c,"potential"==n["class"]?-1:l)),i[m]=null):k=!0)}j=0,l+=10}return h};return g(e(b),b.symbol_map,b.tag_map,c)}}(),"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.ExomeReader=MASCP.buildService(function(a){return this._raw_data=a||{},this}),MASCP.ExomeReader.SERVICE_URL="http://localhost:3000/data/latest/gator",function(a){var b=a.prototype._dataReceived;a.prototype._dataReceived=function(a,c){return null===a?b.call(this,null,c):"object"==typeof a?b.call(this,a,c):"string"==typeof a&&a.match(/^NM/)?(this.agi=a.replace(/(\n|\r)+$/,""),void this.retrieve(this.agi)):void 0}}(MASCP.ExomeReader),MASCP.ExomeReader.prototype.requestData=function(){var a=this.agi||"";return a.match(/NM/)?{type:"GET",dataType:"json",data:{agi:a,service:"exome"}}:{type:"GET",dataType:"txt",url:"http://uniprot.org/mapping/",data:{from:"ACC+ID",to:"REFSEQ_NT_ID",format:"list",query:a}}},MASCP.ExomeReader.prototype.setupSequenceRenderer=function(a){var b=this;b.bind("resultReceived",function(){var c=b.result;a.withoutRefresh(function(){for(var b=c.getAccessions();b.length>0;){var d=b.shift(),e=c.getSnp(d);if(!(e.length<1)){var f="rnaedit",g=[],h=[];a.registerLayer(f,{fullname:"RNA Edit (mod)"});MASCP.getLayer(f).icon=null;var i;for(i=e.length-1;i>=0;i--)h.push({index:e[i][0]+1,delta:e[i][1]}),g.push({insertBefore:e[i][0]+1,delta:e[i][2]});for(i=g.length-1;i>=0;i--){var j=g[i].insertBefore-1;j>a.sequence.length&&(j=a.sequence.length),a.getAA(j).addAnnotation("rnaedit",1,{border:"rgb(150,0,0)",content:g[i].delta,angle:"auto"})}}}}),a.trigger("resultsRendered",[b])})},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.GelMapReader=MASCP.buildService(function(a){if(this._raw_data=a,!a)return this;if(!a.Maps)return this;for(var b=[],c=a.Maps.length-1;c>=0;c--){var d=a.Maps[c];d.sequence="",b.push(d)}return this.maps=b,this}),MASCP.GelMapReader.SERVICE_URL="http://gelmap.de/gator2.php?",MASCP.GelMapReader.prototype.requestData=function(){var a=this.agi.toUpperCase();return{type:"GET",dataType:"json",data:{agi:a,service:"gelmap"}}},MASCP.GelMapReader.Result=MASCP.GelMapReader.Result,MASCP.GelMapReader.Result.prototype.getPeptides=function(){return this._peptides?this._peptides:(this._peptides=peptides,peptides)},MASCP.GelMapReader.Result.prototype._cleanSequence=function(a){return a.replace(/[^A-Z]/g,"")},MASCP.GelMapReader.prototype.setupSequenceRenderer=function(a){var b=this;MASCP.registerGroup("gelmap_experimental",{fullname:"GelMap",hide_member_controllers:!0,hide_group_controller:!0,color:"#aaaaff"});var c="gelmap_controller",d=".active .overlay { background: #ff5533; } .active a { color: #000000; text-decoration: none !important; }  :indeterminate { background: #ff0000; } .tracks .active { background: #0000ff; } .inactive a { text-decoration: none; } .inactive { display: none; }";MASCP.registerLayer(c,{fullname:"GelMap",color:"#aaaaff",css:d}),a.createGroupController&&a.createGroupController("gelmap_controller","gelmap_experimental");var e=function(a){a=a.sort(function(a,b){return 1*a-1*b});for(var b=[a[0]],c=1;c<a.length;c++)a[c-1]!==a[c]&&b.push(a[c]);return b};return this.bind("resultReceived",function(){for(var f=this.result.maps,g=f.length-1;g>=0;g--){var h=f[g];MASCP.registerLayer("gelmap_map_"+h.id,{fullname:h.title,group:"gelmap_experimental",color:"#aaaaff",css:d}),MASCP.getLayer("gelmap_map_"+h.id).href=h.url;for(var i=e(f[g].peptides),j=i.length-1;j>=0;j--){var k=i[j],l=a.getAminoAcidsByPeptide(k),m="gelmap_map_"+h.id;l.addToLayer(m),l.addToLayer(c)}}a.trigger("resultsRendered",[b])}),this},MASCP.GelMapReader.Result.prototype.render=function(){},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.GenomeReader=MASCP.buildService(function(a){return this._raw_data=a,this}),MASCP.GenomeReader.SERVICE_URL="http://mygene.info/v2/query",MASCP.GenomeReader.prototype.requestData=function(){return this.acc=this.agi,this.geneid?(this.acc||(this.acc=this.agi=""+this.geneid),this.exons?{type:"GET",dataType:"txt",url:"http://www.uniprot.org/mapping/",data:{from:"REFSEQ_NT_ID",to:"ACC",format:"tab",query:Object.keys(this.exons).join(" ")}}:{type:"GET",url:"http://mygene.info/v2/gene/"+this.geneid,dataType:"json",data:{fields:"exons_hg19"}}):{type:"GET",dataType:"json",url:"http://mygene.info/v2/query",data:{q:"uniprot:"+this.acc.toUpperCase(),fields:"entrezgene",email:"joshi%40sund.ku.dk"}}},function(a){var b=a.prototype._dataReceived;a.prototype._dataReceived=function(a,c){var d=this;if(a.data&&"db"===c)return d.sequences=[{agi:"genome"}],Object.keys(a.data).forEach(function(a){d.sequences.push({agi:a.toLowerCase()})}),b.call(this,a,c);if(200>c||c>=400)return b.call(this,null,c);if(!this.geneid)return this.geneid=a.hits[0].entrezgene,void this.retrieve(this.acc||this.agi);if(!this.exons){if(this.exons=a.exons_hg19||a.exons,!this.nt_mapping)return void this.retrieve(this.acc||this.agi);a=this.nt_mapping.map(function(a){return a.join("	")}).join("\n")}var e={};return d.sequences=[{agi:"genome"}],(a||"").split("\n").forEach(function(a){var b=a.split("	");if(b[1]){var c=b[1].toLowerCase(),f=b[0];f=f.replace(/\..*$/,""),d.exons[f]&&(d.agi&&d.acc||(d.acc=c,d.agi=c),e[c]||(e[c]=[]),d.exons[f]._id=f,e[c].push(d.exons[f]),d.sequences.push({agi:c.toLowerCase()}))}}),b.call(this,{data:e},c)}}(MASCP.GenomeReader),MASCP.GenomeReader.Result.prototype.getSequences=function(){var a=[],b=this._raw_data.data,c=Object.keys(b),d=max=null;return c.forEach(function(a){var c=b[a].map(function(a){return Array.isArray(a)&&(a=a.filter(function(a){return a.chr.match(/^[\dXx]+$/)})[0]),[a.txstart,a.txend]});c.forEach(function(a){(!d||a[0]<d)&&(d=a[0]),(!max||a[1]>max)&&(max=a[1])})}),a=[Array(Math.floor((max-d)/3)).join(".")],this.min=d,this.max=max,a},MASCP.GenomeReader.Result.prototype.getIntrons=function(a){var b=this,c=[],d=Object.keys(b._raw_data.data);return d.forEach(function(d){var e=b._raw_data.data[d];e.forEach(function(d){if(Array.isArray(d)&&(d=d.filter(function(a){return a.chr.match(/^[\dXx]+$/)})[0],!d))return null;for(var e=d.exons,f=0;f<e.length;f++)0==f?c.push([b.min,e[f][0]-a]):c.push([e[f-1][1]+a,e[f][0]-a]),f==e.length-1&&c.push([e[f][1]+a,b.max]),c.slice(-1)[0][0]>c.slice(-1)[0][1]&&c.splice(c.length-1,1)})}),c},MASCP.GenomeReader.prototype.proteinLength=function(a){for(var b=a.exons,c=0,d=0;d<b.length;d++)if(!(a.cdsstart>b[d][1]&a.cdsstart>b[d][0]||a.cdsend<b[d][0])){var e=a.cdsstart>b[d][0]?a.cdsstart:b[d][0],f=a.cdsend<b[d][1]?a.cdsend:b[d][1];c+=f-e}return Math.floor(c/3)-1},MASCP.GenomeReader.prototype.calculateSequencePositionFromProteinPosition=function(a,b){var c=this,d=a,e=c.result._raw_data.data[d.toLowerCase()];if(!e)return-1;e.txstart||(e=e.map(function(a){return Array.isArray(a)&&(a=a.filter(function(a){return a.chr.match(/^[\dXx]+$/)})[0],!a)?null:a}));var f=e[0]||{},g=f.exons||[],h=(Math.floor(b/3),0);if(b<f.cdsstart&&(h=6,-1==f.strand&&(h=3)),b>f.cdsend&&(h=3*c.proteinLength(f),1==f.strand&&(h+=3)),0==h)for(var i=0;i<g.length;i++)if(!(f.cdsstart>g[i][1]&f.cdsstart>g[i][0])){var j=f.cdsstart>g[i][0]?f.cdsstart:g[i][0],k=f.cdsend<g[i][1]?f.cdsend:g[i][1];if(j>b)break;if(k>=b&&b>=j){h+=b-j;break}h+=k-j}return h=Math.floor(h/3)-1,-1==f.strand&&(h=c.proteinLength(f)-h),h},MASCP.GenomeReader.prototype.calculateProteinPositionForSequence=function(a,b){var c=this,d=a,e=c.result._raw_data.data[d.toLowerCase()];if(!e)return-1;e.txstart||(e=e.map(function(a){return Array.isArray(a)&&(a=a.filter(function(a){return a.chr.match(/^[\dXx]+$/)})[0],!a)?null:a}));var f=e[0]||{},g=f.exons||[];-1==f.strand&&(b=c.proteinLength(f)-b);for(var h,i=3*b,j=0;j<g.length;j++)if(!(f.cdsstart>g[j][1]&f.cdsstart>g[j][0])){var k=f.cdsstart>g[j][0]?f.cdsstart:g[j][0],l=g[j][1]-k;if(l>=i){h=k+i;break}i-=l}return h},MASCP.GenomeReader.prototype.calculatePositionForSequence=function(a,b){var c=this,d=c.sequences[a].agi,e=[],f=b;"genome"==d||(f=c.calculateProteinPositionForSequence(a,b));for(var g=0;g<e.length;g++)b>e[g][1]&&(f-=e[g][1]-e[g][0]),b<e[g][1]&&b>e[g][0]&&(f=-1);return f},function(a){var b=function(a){var b=a._raw_data.data,c=Object.keys(b),d=(a.max,a.min,[]),e=0;return c.forEach(function(a){b[a].map(function(a,b){if(!Array.isArray(a)||(a=a.filter(function(a){return a.chr.match(/^[\dXx]+$/)})[0])){var c=a.exons,f=0==b?"#999":"#f99";c.forEach(function(b){d.push({aa:1+b[0],type:"box",width:b[1]-b[0],options:{offset:e,height_scale:1,fill:f,merge:!1}}),a.strand>0?d.push({aa:b[1]-1,type:"marker",options:{height:4,content:{type:"right_triangle",fill:"#aaa"},offset:e+2,bare_element:!0}}):d.push({aa:b[0]+1,type:"marker",options:{height:4,content:{type:"left_triangle",fill:"#aaa"},offset:e+2,bare_element:!0}})}),d.push({aa:a.cdsstart,type:"box",width:1,options:{fill:"#0000ff",height_scale:2,offset:e-2,merge:!1}}),d.push({aa:a.cdsend,type:"box",width:1,options:{fill:"#0000ff",height_scale:2,offset:e-2,merge:!1}}),e+=1}});e+=2}),d},c=function(a){var b=a.removed_regions||[],c=[],d=(a.max,a.min,a._raw_data.data),e=Object.keys(d),f=e.reduce(function(a,b){return a+d[b].length},0);return b.forEach(function(a){var b=a[0],d=a[1],e=Math.floor(b%1e6/1e3)+"kb",g=Math.floor(d%1e6/1e3)+"kb";c.push({aa:b-3,type:"text",options:{txt:e,fill:"#000",height:4,offset:-5*f,align:"right"}}),c.push({aa:d+3,type:"text",options:{txt:g,fill:"#000",height:4,offset:5*f,align:"left"}}),c.push({aa:b-1,type:"box",width:d-b+3,options:{fill:"#999",height_scale:3*f,offset:-1*f}})}),c},d=function(a,b){var c=a.getIntrons(b),d=[{index:a.min-2,start:!0,idx:-1},{index:a.min,start:!1,idx:-1}];c.forEach(function(a,b){d.push({index:a[0],start:!0,idx:b}),d.push({index:a[1],start:!1,idx:b})}),d.sort(function(a,b){return a.index<b.index?-1:a.index>b.index?1:a.index==b.index?a.start?-1:1:void 0});var e=[];d.forEach(function(b,c){b.start&&d[c+1]&&0==d[c+1].start&&b.index!=d[c+1].index&&d[c+1].index!=a.min&&e.push([b.index,d[c+1].index])}),a.removed_regions=e},e=function(a){return function(b,c,d){var e=b;if(!a.result)return d?3*e:Math.floor(e/3);var f=a.result.removed_regions||[];if(d){e=3*b,j=e;for(var g=0;g<f.length&&e>0;g++){var h=g>0?f[g-1]:[null,a.result.min],i=f[g]||[a.result.max,null];e-=i[0]-h[1],e>0&&(j+=f[g][1]-f[g][0])}return j+a.result.min}for(var j=e-a.result.min,g=0;g<f.length;g++)e>f[g][1]&&(j-=f[g][1]-f[g][0]),e<f[g][1]&&e>f[g][0]&&(j=f[g][1]-a.result.min);return 3>j&&(j=3),Math.floor(j/3)}};Object.defineProperty(a.prototype,"exon_margin",{set:function(a){this._exon_margin=a,this.result&&(d(this.result,a),this.redrawIntrons())},get:function(){return this._exon_margin}});var f=function(a,b,d){var e=[],f=function(){if(!(e.length<1)&&e[0].parentNode){for(var a=!1,b=0;!a&&b<e.length-3;b+=3)e[b].hasAttribute("display")?a=!0:e[b].getBoundingClientRect().right>e[b+3].getBoundingClientRect().left&&(a=!0);e.forEach(function(b){"rect"!=b.nodeName&&(a?b.setAttribute("display","none"):b.removeAttribute("display"))})}};return a.bind("zoomChange",f),function(){var g=this.result;a.sequence=Array(d(g.max)).join("."),e.length>0&&(e.forEach(function(c){a.remove(b,c)}),e=[]);var h={agi:b,gotResult:function(){e=a.renderObjects(b,c(g)),a.refresh(),f()}};MASCP.Service.prototype.registerSequenceRenderer.call(h,a),h.gotResult()}};a.prototype.setupSequenceRenderer=function(a){var c=this;a.addAxisScale("genome",function(a,b,d){return b&&b.genomic?a:d?c.calculateSequencePositionFromProteinPosition(b.name,a):c.calculateProteinPositionForSequence(b.name,a)});var g="cds",h=function(i){i||(i=0),MASCP.registerLayer(g,{fullname:"Exons",color:"#000000"}),MASCP.getLayer(g).genomic=!0,a.trackOrder.indexOf(g)<0&&a.trackOrder.push(g),a.showLayer(g);var j=this.result,k=(j.getSequences(),e(c));if(a.addAxisScale("removeIntrons",k),d(c.result,c.exon_margin||300),!a.sequence)return void a.setSequence(Array(k(j.max)).join("."))(function(){h(i)});a.sequence=Array(k(j.max)).join("."),a.redrawAxis();var l={agi:g,gotResult:function(){a.renderObjects(g,b(j))}};MASCP.Service.prototype.registerSequenceRenderer.call(l,a),l.gotResult(),c.redrawIntrons=f(a,g,k),c.redrawIntrons()};this.bind("resultReceived",h)}}(MASCP.GenomeReader),"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.GoogledataReader=MASCP.buildService(function(a){return this}),function(){function a(b){for(var c=a.options,d=c.parser[c.strictMode?"strict":"loose"].exec(b),e={},f=14;f--;)e[c.key[f]]=d[f]||"";return e[c.q.name]={},e[c.key[12]].replace(c.q.parser,function(a,b,d){b&&(e[c.q.name][b]=d)}),e}var b,c,d,e,f,g,h,i,j,k="https://docs.google.com/feeds/ https://spreadsheets.google.com/feeds/",l=function(a){var b=/.*\/R(\d*)C(\d*)/,c={};c.data=[];for(var d in a.feed.entry){var e,f,g=a.feed.entry[d],h=g.id.$t,i=b.exec(h);null!=i&&(e=i[1]-1,f=i[2]-1);var j=c.data[e];"undefined"==typeof j&&(c.data[e]=[]),c.data[e][f]=g.content.$t}return c.retrieved=new Date(new Date(a.feed.updated.$t).getTime()),c.retrieved.setUTCHours=function(){},c.retrieved.setUTCMinutes=function(){},c.retrieved.setUTCSeconds=function(){},c.retrieved.setUTCMilliseconds=function(){},c.etag=a.feed.gd$etag,c.title=a.feed.title.$t,c};i=function(a,b,c,d){if(!a.match(/^spreadsheet/))return void console.log("No support for retrieving things that aren't spreadsheets yet");var e=a.replace(/^spreadsheet:/,"");h("spreadsheets.google.com","/feeds/list/"+e+"/1/private/full?sq="+encodeURIComponent(b)+"&alt=json",null,function(b,e){if(e.feed.entry){var f,g=e.feed.entry.reverse().shift();g.link.forEach(function(a){"edit"==a.rel&&(f=a.href)});var i=/.+?\:\/\/.+?(\/.+?)(?:#|\?|$)/,k=i.exec(f)[1];h("spreadsheets.google.com",k+"?alt=json",g.gd$etag,function(b,e){b||j(a,c,d)},"DELETE")}else j(a,c,d)})},j=function(a,b,c){if(!a.match(/^spreadsheet/))return void console.log("No support for retrieving things that aren't spreadsheets yet");var d=a.replace(/^spreadsheet:/,""),e=['<entry xmlns="http://www.w3.org/2005/Atom" xmlns:gsx="http://schemas.google.com/spreadsheets/2006/extended">'];for(var f in b)e.push("<gsx:"+f+">"),null===b[f]?e.push(""):e.push(b[f]),e.push("</gsx:"+f+">");e.push("</entry>"),h("spreadsheets.google.com","/feeds/list/"+d+"/1/private/full",null,function(a,b){a?c.call(null,a):c.call(null)},"POST",e.join(""))},c=function(a){h("docs.google.com","/feeds/default/private/full/-/spreadsheet?alt=json",null,function(b,c){var d=[];if(c){var e,f=c.feed.entry;for(e=f.length-1;e>=0;e--)d.push([f[e].title.$t,f[e].gd$resourceId.$t,new Date(f[e].updated.$t)])}a.call(null,null,d)})},e=function(a){h("www.googleapis.com","/drive/v2/about",null,function(b,c){return b?void a.call(null,b):void a.call(null,null,c.permissionId)})},a.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var m={},n={},o=function(a,b,c){if(m[a]&&c&&MASCP.GOOGLE_AUTH_TOKEN)return void c.call(null,null,m[a]);var d=encodeURIComponent("title='"+a+"' and 'appfolder' in parents");h("www.googleapis.com","/drive/v2/files?q="+d,null,function(b,d){if(m[a]&&c)return void c.call(null,null,m[a]);if(b&&401==b.status&&delete MASCP.GOOGLE_AUTH_TOKEN,b)return void(c&&c.call(null,b));if(0==d.items.length)return m[a]={},void(c&&c.call(null,null,m[a]));var e=d.items[0].id;n[a]=d.items[0].etag,c&&q({id:e},null,function(b,d){return m[a]?void c.call(null,null,m[a]):(b&&c.call(null,b),m[a]=d,void c.call(null,null,m[a],e))})})},p=function(a){return gapi&&gapi.auth&&gapi.auth.authorize?(MASCP.GOOGLE_CLIENT_ID||a.call(null,null,!1),void gapi.auth.checkSessionState({client_id:MASCP.GOOGLE_CLIENT_ID,session_state:null},function(b){a.call(null,null,b)})):void a.call(null,{cause:"No google auth library"})},q=function(b,c,d){return gapi&&gapi.auth&&gapi.auth.authorize?void p(function(e,f){if(e)return void d.call(null,e);if(f)return void d.call(null,{cause:"No user event"});if("string"==typeof b)return void o(b,c,d);if(!b.id)return void d.call(null,{error:"No file id"});var g=b.id;h("www.googleapis.com","/drive/v2/files/"+g,b.etag,function(c,e){if(c)return void d.call(null,c);
var f=a(e.downloadUrl);b.etag=e.etag,b.modified=new Date(e.modifiedDate),b.owner=(e.ownerNames||[])[0],h(f.host,f.relative,null,function(a,b){if(a)return void d.call(null,a);b||(b={});var c;c="string"!=typeof b?b:JSON.parse(b),d.call(null,null,c,g)})})}):void d.call(null,{cause:"No google auth library"})},r=function(a,b,c){if(!m[a])return void c.call(null,{error:"No file to save"});var d=encodeURIComponent("title='"+a+"' and 'appdata' in parents and mimeType = '"+b+"' and trashed = false");h("www.googleapis.com","/drive/v2/files?q="+d,null,function(d,e){if(m[a]){if(d)return void c.call(null,d);var f=null;return e.items&&0==e.items.length?void h("www.googleapis.com","/drive/v2/files/",null,arguments.callee,"POST:application/json",JSON.stringify({parents:[{id:"appdata"}],title:a,mimeType:b,description:a})):(f=e.items?e.items[0].id:e.id,n[a]&&e.items&&n[a]!==e.items[0].etag?(m[a]=null,n[a]=null,q(a,b,function(){}),void c.call(null,{cause:"File too old"})):void(m[a]&&t({id:f,content:m[a]},b,function(d,e){return d?(d.status&&412==d.status&&(m[a]=null,n[a]=null,q(a,b,c)),void c.call(null,d)):(n[a]=null,q(a,b,null),void c.call(null,null,m[a]))})))}})},s=function(a,b,c){if("string"==typeof a)return void r(a,b,c);if(a.id)return void t(a,b,c);var d=JSON.stringify({parents:[{id:a.parent}],title:a.name,mimeType:b,description:a.name});h("www.googleapis.com","/drive/v2/files/",null,function(d,e){return d?void c.call(null,d):(a.id=e.id,void t(a,b,c))},"POST:application/json",d)},t=function(a,b,c){const d="-------314159265358979323846",e="\r\n--"+d+"\r\n",f="\r\n--"+d+"--";if("string"==typeof a)return void r(a,b,c);if(!a.id)return void c.call(null,{error:"No file id"});var g,h=a.id;if(!a.content)return void c.call();try{g=JSON.stringify(a.content)}catch(i){return void c.call(null,{status:"JSON error",error:i})}h=a.id;a.etag;var j=e+"Content-Type: application/json\r\n\r\n"+JSON.stringify({mimeType:b})+e+"Content-Type: "+b+"\r\n\r\n"+g+"\r\n"+f,k=gapi.client.request({path:"/upload/drive/v2/files/"+h,method:"PUT",params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/mixed; boundary="'+d+'"'},body:j});k.execute(function(b,d){return b&&b.error&&412==b.error.code?void c.call(null,{status:412,message:"E-tag mismatch"}):b?void c.call(null,null,a.content,a.id):void c.call(null,{status:"Google error",response:response})})};if(d=function(a,b){var c=a.replace(/^file:/,"");e(function(a,d){return a?void b.call(null,a):void h("www.googleapis.com","/drive/v2/files/"+c+"/permissions",null,function(a,c){if(a)return a.cause&&"400"==a.cause.status?void b.call(null,null,{write:!1,read:!1}):void b.call(null,a);var e=!1;return c?(c.items.forEach(function(a){a.id!=d||"owner"!=a.role&&"writer"!=a.role||(e=!0)}),void b.call(null,null,{write:e,read:!0})):void b.call(null,null,{write:!1,read:!1})})})},f=function(a,b){h("www.googleapis.com","/drive/v2/files/"+a+"?fields=mimeType,title,fileExtension",null,function(a,c){var d=(c||{}).mimeType;d&&(d=d.replace(/\s+charset=[^\s]+/i,"")),b.call(null,a,a?null:d,a?null:(c||{}).title,a?null:(c||{}).fileExtension)})},b=function(b,c,d){var e=!0;b.match(/^spreadsheet/)||(e=!1);var f=b.replace(/^spreadsheet:/,""),g="private";e?h("spreadsheets.google.com","/feeds/cells/"+f+"/1/"+g+"/basic?alt=json",c,function(a,b){a?d.call(null,a):b?d.call(null,null,l(b)):d.call(null,{cause:"No data"})}):h("www.googleapis.com","/drive/v2/files/"+f,c,function(b,c){if(b)b.cause&&401==b.cause.status&&delete MASCP.GOOGLE_AUTH_TOKEN,d.call(null,b);else{var e=a(c.downloadUrl),g=c.title,i=c.etag;h(e.host,e.relative,null,function(a,b){a?d.call(null,a):(b.etag=i,b.title=g||f,d.call(null,null,b))})}})},"undefined"!=typeof module&&module.exports){var u=require("nconf");u.env("__").argv(),u.file("config.json");var v=u.get("google:client_id"),w=u.get("google:client_secret"),x=null,y=u.get("google:refresh_token"),z=function(a){return x&&x.expiration<new Date&&(x=null),x?void a(x):y?void B(y,function(b){if(!b)return console.log("Problems with auth details"),void a(null);if(b.error&&"invalid_grant"==b.error)return u.clear("google:refresh_token"),u.save(function(a){a&&console.log("Could not write config")}),y=null,void z(a);var c=new Date;c.setSeconds(c.getSeconds()+b.expires_in),x={token:b.access_token,expiration:c},a(x)}):void A(function(b){if(!b)return console.log("We didn't get back auth details"),void a(null);var c=new Date;c.setSeconds(c.getSeconds()+b.expires_in),x={token:b.access_token,expiration:c},y=b.refresh_token,u.set("google:refresh_token",y),u.save(function(a){a?console.log("Could not write config"):console.log("Successful retrieval of auth details")}),a(x)})},A=function(a){var b,c="https://accounts.google.com/o/oauth2/auth?",d=encodeURIComponent(k),e=encodeURIComponent("urn:ietf:wg:oauth:2.0:oob"),f=encodeURIComponent(v);return v&&w?repl&&repl.repl?repl.repl.running?(console.log("Already asking for auth info"),void a(null)):(console.log("Go to this URL:"),console.log(c+"scope="+d+"&redirect_uri="+e+"&response_type=code&client_id="+f),console.log("Authentication code : "),repl.repl.running=!0,b=repl.repl.eval,void(repl.repl.eval=function(c,d,e,f){repl.repl.eval=b;var g=/\n.*/m;c=c.replace(/\(/,""),c=c.replace(g,"");var h=require("querystring"),i=h.stringify({code:c,client_id:v,client_secret:w,redirect_uri:"urn:ietf:wg:oauth:2.0:oob",grant_type:"authorization_code"}),j=require("https").request({host:"accounts.google.com",path:"/o/oauth2/token",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":i.length}},function(b){b.setEncoding("utf8");var c="";b.on("data",function(a){c+=a}),b.on("end",function(){var b=JSON.parse(c);b.error?(console.log("Error validating authentication code"),delete repl.repl.running,a(null)):(f(null,"Authentication code validated"),delete repl.repl.running,a(b))})});j.write(i),j.end()})):(console.log("Not running in an interactive session - returning"),void a(null)):(console.log("Missing important authorisation information. Check that google:client_id and google:client_secret are set."),repl&&repl.repl?(b=repl.repl.eval,console.log("Set client ID now? : [yN] "),void(repl.repl.eval=function(c,d,e,f){var g=/\n.*/m;c=(c||"").replace(/\(/,""),c=c.replace(g,""),c.match(/[yY]/)?(console.log("Enter client ID: "),repl.repl.eval=function(c){c=(c||"").replace(/\(/,""),c=c.replace(g,""),v=c,console.log("Enter client secret: "),repl.repl.eval=function(c){c=(c||"").replace(/\(/,""),c=c.replace(g,""),repl.repl.eval=b,w=c,u.set("google:client_id",v),u.set("google:client_secret",w),u.save(function(b){b?(console.log("Error saving configuration"),a(null)):A(a)})}}):(repl.repl.prompt="Gator data server > ",repl.repl.eval=b,a(null))})):(console.log("Not running in an interactive session - returning"),void a(null)))},B=function(a,b){var c=require("querystring"),d=c.stringify({client_id:v,client_secret:w,refresh_token:a,grant_type:"refresh_token"}),e=require("https").request({host:"accounts.google.com",path:"/o/oauth2/token",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":d.length}},function(a){a.setEncoding("utf8");var c="";a.on("data",function(a){c+=a}),a.on("end",function(){var a=JSON.parse(c);b(a)})});e.write(d),e.end()};g=function(a){z(function(b){b?(MASCP.GOOGLE_AUTH_TOKEN=b.token,a&&a.call(null)):(console.log("Could not authorize"),a&&a.call(null,{cause:"Could not authorize"}))})},h=function(a,b,c,d,e,f){var h={"GData-Version":"3.0"},i=e||"GET";if("GET"!=i&&(h={}),"POST"==i&&(h["Content-Type"]="application/atom+xml"),i.match(/:/)&&(h["Content-Type"]=i.split(":")[1],i=i.split(":")[0]),!MASCP.GOOGLE_AUTH_TOKEN){var j=arguments.callee;return void g(function(e){e?d.call(null,e):j.call(null,a,b,c,d)})}h.Authorization="Bearer "+MASCP.GOOGLE_AUTH_TOKEN,c&&(h["If-None-Match"]=c);var k=require("https"),l=k.request({host:a,path:b,headers:h,method:i},function(a){a.setEncoding("utf8");var b="";a.on("data",function(a){b+=a}),a.on("end",function(){if(a.statusCode>300)return void d.call(null,{cause:{status:a.statusCode}});var c=b.length>0?a.headers["content-type"].match(/json/)?JSON.parse(b):b:null;d.call(null,null,c)})});f&&l.write(f),l.end(),l.on("error",function(a){d.call(null,{cause:a})})},MASCP.GoogledataReader.authenticate=g}else{k="https://www.googleapis.com/auth/drive.install https://www.googleapis.com/auth/drive.appdata https://www.googleapis.com/auth/drive https://spreadsheets.google.com/feeds/";var C=function(a,b,c){var d=document.getElementsByTagName("head")[0],e=document.createElement("script"),f="public",g="";e.type="text/javascript",e.setAttribute("id","ssheet-"+a),MASCP.GOOGLE_AUTH_TOKEN&&c&&(g="&access_token="+MASCP.GOOGLE_AUTH_TOKEN,f="private"),e.src="https://spreadsheets.google.com/feeds/cells/"+a+"/1/"+f+"/basic?alt=json-in-script&callback=cback"+a+g;var h=function(c){c.target===e&&(window.removeEventListener&&window.removeEventListener("error",h),e.parentNode&&(e.parentNode.removeChild(e),b.call(null,{cause:{status:""},message:"Could not load data via script tag"},a)))};e.addEventListener("error",h,!1),window.addEventListener("error",h,!1),window["cback"+a]=function(c){delete window["cback"+a],window.removeEventListener&&window.removeEventListener("error",h),b.call(null,null,l(c))};try{d.appendChild(e)}catch(i){b.call(null,{cause:{status:""},object:i})}},D=!1,E=[],F=!1;g=function(a,b){if(!("withCredentials"in new XMLHttpRequest))return void a.call(null,{cause:"Browser not supported"});if(MASCP.GOOGLE_AUTH_TOKEN)return void a.call(null);if(D)return void E.push(a);if(!gapi||!gapi.auth||!gapi.auth.authorize)return void a.call(null,{cause:"No google auth library"});if(!MASCP.GOOGLE_CLIENT_ID)return void a.call(null,{cause:"No client ID set (MASCP.GOOGLE_CLIENT_ID)"});var c={client_id:MASCP.GOOGLE_CLIENT_ID,scope:k,immediate:!0,response_type:"token id_token"};D=!0;var d=!0;return b&&(d=!1),window.event&&(d=window.event?window.event.which:null),!window.event&&"event"in window&&(d=!1),!d&&F?(D=!1,void a.call(null,{cause:"No user event"})):void setTimeout(function(){var b=setTimeout(function(){D=!1;var b={cause:"Failed to return from auth"};a.call(null,b),E.forEach(function(c){c!==a&&c.call(null,b)}),E=[]},3e3);gapi.auth.authorize(c,function(e){if(clearTimeout(b),e&&!e.error)return MASCP.GOOGLE_AUTH_TOKEN=e.access_token,window.setTimeout(function(){console.log("Google token has timed out, forcing refresh"),delete MASCP.GOOGLE_AUTH_TOKEN,g(function(){})},1e3*parseInt(e.expires_in)),D=!1,a.call(null),E.forEach(function(b){b!==a&&b.call(null)}),void(E=[]);if(e&&e.error&&"immediate_failed"!==e.error){D=!1;var f={cause:e.error};a.call(null,f),E.forEach(function(b){b!==a&&b.call(null,f)}),E=[]}else if(D=!1,c.immediate){if(!d){var h=function(a){c.immediate=!1,gapi.auth.authorize(c,function(b){b&&!b.error?(MASCP.GOOGLE_AUTH_TOKEN=b.access_token,window.setTimeout(function(){console.log("Google token has timed out, forcing refresh"),delete MASCP.GOOGLE_AUTH_TOKEN,g(function(){})},1e3*parseInt(b.expires_in)),a.call(null)):a.call(null,{cause:b?b.error:"No auth result"})})};return F=!0,a.call(null,{cause:"No user event",authorize:h}),void(E&&(E.forEach(function(b){b!==a&&b.call(null,{cause:"No user event",authorize:h})}),E=[]))}return c.immediate=!1,void gapi.auth.authorize(c,arguments.callee)}})},1)},h=function(a,b,c,d,e,f,i){g(function(g){if(g)return void d.call(null,g);var j=new XMLHttpRequest;if(!("withCredentials"in j))return void d.call(null,{cause:"Browser not supported"});var k=e||"GET";try{j.open(k.replace(/:.*/,""),"https://"+a+b)}catch(l){return void d.call(null,{cause:"Access is denied.",error:l,status:0})}j.setRequestHeader("Authorization","Bearer "+MASCP.GOOGLE_AUTH_TOKEN),"GET"==k&&j.setRequestHeader("GData-Version","3.0"),"POST"==k&&j.setRequestHeader("Content-Type","application/atom+xml"),k.match(/:/)&&(j.setRequestHeader("Content-Type",k.split(":")[1]),k=k.split(":")[0]),c&&"PUT"!==k&&j.setRequestHeader("If-None-Match",c),c&&"PUT"==k&&j.setRequestHeader("If-Match",c),j.onreadystatechange=function(g){if(4==j.readyState)if(j.status<300&&j.status>=200){var k=j.responseText.length>0?j.getResponseHeader("Content-Type").match(/json/)?JSON.parse(j.responseText):j.responseText:null;null!==d&&d.call(null,null,k),d=null}else j.status>=500&&(!i||1e3>i)?(i=i?2*i:100,setTimeout(function(){h(a,b,c,d,e,f,i)},i)):(null!==d&&d.call(null,{cause:{status:j.status}}),d=null)},j.onerror=function(a){d&&d.call(null,{cause:{status:j.status}})},j.send(f)})};var G=b;b=function(a,b,c){if(!a&&c)return void g(c,!0);var d=!0;a.match(/^spreadsheet/)||(d=!1);var e=a.replace(/^spreadsheet:/g,"");!d||b||MASCP.GOOGLE_AUTH_TOKEN?G(a,b,function(a,b){if(a){if(a.cause&&304==a.cause.status)return void c.call(null,a);d?C(e,function(a,b){a?C(e,c,!0):c.call(null,a,b)},!1):c.call(null,a)}else c.call(null,null,b)}):C(e,function(d,f){d?p(function(d,f){return d?void c.call(null,d):void(0==f?G(a,b,function(a,b){if(a){if("No user event"==a.cause||"Access is denied."==a.cause)return void c.call(null,a);C(e,c,!0)}else c.call(null,null,b)}):c.call(null,{cause:"Google session timed out"}))}):c.call(null,null,f)})}}var H=function(a){var b=this,c=b.result._raw_data.data.sites||[],d=0,e=null;for(MASCP.registerLayer(b.datasetname,{fullname:b.result._raw_data.title}),d=c.length-1;d>=0;d--)(e=c[d].match(/(\d+)/g))&&a.getAminoAcidsByPosition([parseInt(e[0])])[0].addToLayer(b.datasetname)},I=function(a){var b=this,c=b.result._raw_data.data.peptides||[],d=0,e=null;for(MASCP.registerLayer(b.datasetname,{fullname:b.result._raw_data.title}),d=c.length-1;d>=0;d--)(e=c[d].match(/(\d+)/g))&&a.getAminoAcidsByPosition(parseInt(e[0])).addToLayer(b.datasetname)},J=function(a){this.bind("resultReceived",function(b){I.call(this,a),H.call(this,a)})};MASCP.GoogledataReader.isLoggedOut=p,MASCP.GoogledataReader.prototype.getDocumentList=c,MASCP.GoogledataReader.prototype.getDocument=b,MASCP.GoogledataReader.prototype.getPermissions=d,MASCP.GoogledataReader.prototype.getMimetype=f,MASCP.GoogledataReader.prototype.updateOrInsertRow=i,MASCP.GoogledataReader.prototype.getPreferences=function(a,b){return a||(a="MASCP GATOR PREFS"),q(a,"application/json+domaintool-session",b)},MASCP.GoogledataReader.prototype.writePreferences=function(a,b){return t(a,"application/json+domaintool-session",b)},MASCP.GoogledataReader.prototype.createPreferences=function(a,b){return s({parent:a,content:{},name:"New annotation session.domaintoolsession"},"application/json+domaintool-session",function(a,c,d){b.call(null,a,c,d,"New annotation session")})},MASCP.GoogledataReader.prototype.createFile=function(a,b,c,d,e){return s({parent:a,content:b,name:c},d,function(a,b,d){e.call(null,a,b,d,c)})},MASCP.GoogledataReader.prototype.getSyncableFile=function(a,b,c){c||(c="application/json");var e={getData:function(){return"Not ready"},ready:!1};return q(a,c,function(f,g,h){if(f)return void b.call(null,f);e.getData=function(){return g};var i,j=null;e.sync=function(){j&&(clearTimeout(j),j=null),j=setTimeout(function(){var b=!1;e.sync=function(){b=!0},"string"!=typeof a&&(a.content=g),t(a,c,function(a){j=null,e.sync=i,b&&e.sync()})},1e3)},i=e.sync,e.owner=a.owner,"string"!=typeof a&&h?d(h,function(c,d){a.permissions=d,e.permissions=d,bean.fire(e,"ready"),e.ready=!0,b.call(null,null,e)}):(e.permissions={read:!0,write:!0},bean.fire(e,"ready"),e.ready=!0,b.call(null,null,e))}),e},MASCP.GoogledataReader.prototype.addWatchedDocument=function(a,b,c,d){var e=this;c||(c=function(a){for(var b in a.data)if(""==b||b.match(/\s/))delete a.data[b];else{var c=a.data[b];delete a.data[b],a.data[b.toLowerCase()]={data:c,retrieved:a.retrieved,etag:a.etag,title:a.title}}return delete a.retrieved,delete a.etag,delete a.title,a.data});var f=(new MASCP.GoogledataReader).createReader(b,c);f.bind("error",function(a){d.call(null,a)}),f.bind("ready",function(b){var g=this.title;e.getPreferences(a,function(h,i){if(h)return void d.call(null,{status:"preferences",original_error:h});i.user_datasets||(i.user_datasets={});var j=!1;b&&b.liveClass&&(j=!0,i.user_datasets[b.liveClass]=i.user_datasets[b.liveClass]||{},i.user_datasets[b.liveClass].render_options={},i.user_datasets[b.liveClass].title=g,i.user_datasets[b.liveClass].type="liveClass"),b&&b.gatorURL&&(j=!0,i.user_datasets[b.gatorURL]=i.user_datasets[b.gatorURL]||{},i.user_datasets[b.gatorURL].title=g,i.user_datasets[b.gatorURL].type="gatorURL",b&&b.defaults&&(i.user_datasets[b.gatorURL].render_options=b.defaults)),b&&b.metadata&&b.metadata.length>0&&b.metadata[0]["msdata-version"]&&(j=!0,i.user_datasets[f.datasetname]=i.user_datasets[f.datasetname]||{},i.user_datasets[f.datasetname].parser_function=c.toString(),i.user_datasets[f.datasetname].title=g,i.user_datasets[f.datasetname].type="dataset",b&&b.defaults?i.user_datasets[f.datasetname].render_options=b.defaults:i.user_datasets[f.datasetname].render_options={renderer:"msdata:default:"+b.metadata[0]["msdata-version"],track:g,icons:"/sugars.svg"}),j||(i.user_datasets[f.datasetname]=i.user_datasets[f.datasetname]||{},i.user_datasets[f.datasetname].parser_function=c.toString(),i.user_datasets[f.datasetname].title=g,i.user_datasets[f.datasetname].type="dataset",b&&b.defaults&&(i.user_datasets[f.datasetname].render_options=b.defaults)),e.writePreferences(a,function(a,b){return a?void d.call(null,{status:"preferences",original_error:a}):void d.call(null,null,g)})})})},MASCP.GoogledataReader.prototype.removeWatchedDocument=function(a,b,c){var d=this;d.getPreferences(a,function(e,f){return e?void c.call(null,{status:"preferences",original_error:e}):(f.user_datasets||(f.user_datasets={}),b in f.user_datasets?delete f.user_datasets[b]:c.call(),void d.writePreferences(a,function(a,b){return a?void c.call(null,{status:"preferences",original_error:a}):void c.call()}))})},MASCP.GoogledataReader.prototype.listWatchedDocuments=function(a,b){this.getPreferences(a,function(a,c){if(a)return"No user event"===a.cause?void console.log("Consuming no user event"):void b.call(null,{status:"preferences",original_error:a});var d=c.user_datasets;b.call(null,null,d)})},MASCP.GoogledataReader.prototype.readWatchedDocuments=function(a,b){var c=this;c.getPreferences(a,function(a,c){return a?"No user event"===a.cause?void console.log("Consuming no user event"):"Browser not supported"==a.cause?void console.log("Consuming no browser support"):void b.call(null,{status:"preferences",original_error:a}):void MASCP.IterateServicesFromConfig(c.user_datasets,b)})},MASCP.GoogledataReader.prototype.createReader=function(a,b){var c=this,d=new MASCP.UserdataReader(null,null);d.datasetname=a,d.setupSequenceRenderer=J,MASCP.Service.CacheService(d);var e=function(e){var f={};("undefined"==typeof module||!module.exports&&"undefined"!=typeof window)&&window.sessionStorage&&(f=JSON.parse(window.sessionStorage.getItem("update_timestamps")||"{}")),f[a]=(new Date).getTime(),("undefined"==typeof module||!module.exports&&"undefined"!=typeof window)&&window.sessionStorage&&(f=window.sessionStorage.setItem("update_timestamps",JSON.stringify(f))),c.getDocument(a,e,function(c,e){return c?304==c.cause.status?(console.log("Matching e-tag for "+a),void bean.fire(d,"ready")):(d.retrieve=null,void bean.fire(d,"error",[c])):void(b&&(console.log("Wiping out data on "+e.title+" ("+a+")"),MASCP.Service.ClearCache(d,null,function(c){return c?void bean.fire(d,"error",[c]):(d.map=b,void d.setData(a,e))})))})};return function(){var b=new MASCP.UserdataReader;b.datasetname=a,MASCP.Service.CacheService(b),MASCP.Service.FirstAgi(b,function(c){if(!c)return void e(null);var f={};return("undefined"==typeof module||!module.exports&&"undefined"!=typeof window)&&window.sessionStorage&&(f=JSON.parse(window.sessionStorage.getItem("update_timestamps")||"{}")),f[a]&&(new Date).getTime()-f[a]<72e5?(console.log("Update timestamp < 2 hours, not refreshing data for "+a),void bean.fire(d,"ready")):void b.retrieve(c,function(){e(this.result&&this.result._raw_data?this.result._raw_data.etag:null)})})}(),d}}(),"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.InterproReader=MASCP.buildService(function(a){return a&&(this._raw_data||a.data?this._raw_data=a:(this._raw_data={data:[]},this._raw_data.data.push(a))),this}),MASCP.InterproReader.SERVICE_URL="http://gator.masc-proteomics.org/interpro.pl?",MASCP.InterproReader.prototype.requestData=function(){return{type:"GET",dataType:"json",data:{agi:this.agi,service:"interpro"}}},function(){var a=MASCP.InterproReader.prototype.retrieve;MASCP.InterproReader.prototype.retrieve=function(b,c){var d=this;this.agi||(this.agi=b);var e=arguments.callee,f=c;return null===this.sequence||"undefined"==typeof this.sequence?(new MASCP.TairReader(d.agi).bind("resultReceived",function(){d.sequence=this.result.getSequence()||"",e.call(d,d.agi,f)}).bind("error",function(a){d.trigger("error",[a])}).retrieve(),this):(a!==MASCP.Service.prototype.retrieve&&(a=MASCP.Service.prototype.retrieve),a.call(d,d.agi,f),this)}}(),MASCP.InterproReader.Result=MASCP.InterproReader.Result,MASCP.InterproReader.Result.prototype.getDomains=function(){if(!this._raw_data||0===this._raw_data.data.length)return{};if(this._peptides_by_domain)return this._peptides_by_domain;for(var a={},b={},c=this._raw_data.data,d=0;d<c.length;d++){var e=a[c[d].interpro]||[];e.push(this.sequence.substring(c[d].start,c[d].end)),b[c[d].interpro]=c[d].description,a[c[d].interpro]=e}return this._peptides_by_domain=a,a},MASCP.InterproReader.prototype.setupSequenceRenderer=function(a){var b=this;return this.bind("resultReceived",function(){this.agi;MASCP.registerGroup("interpro_domains",{fullname:"Interpro domains",color:"#000000"});var c="interpro_controller",d=".active .overlay { background: #000000; } .active a { color: #000000; text-decoration: none !important; }  :indeterminate { background: #ff0000; } .tracks .active { background: #0000ff; } .inactive a { text-decoration: none; } .inactive { display: none; }";MASCP.registerLayer(c,{fullname:"Interpro domains",color:"#000000",css:d}),MASCP.getLayer("interpro_controller").href="",this.result.sequence=a.sequence;var e=this.result.getDomains();for(var f in e)if(e.hasOwnProperty(f)){var g=null;g=f;var h=MASCP.registerLayer("interpro_domain_"+g,{fullname:g,group:"interpro_domains",color:"#000000",css:d});h.href="http://www.ebi.ac.uk/interpro/IEntry?ac="+g;for(var i=e[g],j=0;j<i.length;j++){var k=a.getAminoAcidsByPeptide(i[j]),l="interpro_domain_"+g;k.addToLayer(l),k.addToLayer(c)}}a.createGroupController&&a.createGroupController("interpro_controller","interpro_domains"),a.trigger("resultsRendered",[b])}),this},MASCP.InterproReader.Result.prototype.render=function(){},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.P3dbReader=MASCP.buildService(function(a){return this._raw_data=a,this}),MASCP.P3dbReader.SERVICE_URL="http://p3db.org/gator.php?",MASCP.P3dbReader.prototype.requestData=function(){var a=this.agi.toLowerCase();return{type:"GET",dataType:"json",data:{agi:a,service:"p3db"}}},MASCP.P3dbReader.Result=MASCP.P3dbReader.Result,MASCP.P3dbReader.Result.prototype.getPeptides=function(){if(this._peptides)return this._peptides;if(this._long_name_map={},!this._raw_data||!this._raw_data.peptides)return[];for(var a=[],b=0;b<this._raw_data.peptides.length;b++){var c=this._raw_data.peptides[b],d={sequence:this._cleanSequence(c)};a.push(d)}return this._peptides=a,a},MASCP.P3dbReader.Result.prototype.getOrthologousPeptides=function(a){var b=this;if(!this._raw_data.orthologs)return[];var c=[];return this._raw_data.orthologs.forEach(function(d){if(d.organism===a&&d.peptides)for(var e=0;e<d.peptides.length;e++){var f=d.peptides[e],g={sequence:b._cleanSequence(f)};c.push(g)}}),c},MASCP.P3dbReader.Result.prototype.getOrganisms=function(){if(!this._raw_data.orthologs)return[];var a=[];return this._raw_data.orthologs.forEach(function(b){a.push({id:b.organism,name:b.name})}),a},MASCP.P3dbReader.Result.prototype._cleanSequence=function(a){return a.replace(/[^A-Z]/g,"")},MASCP.P3dbReader.prototype.setupSequenceRenderer=function(a){var b=this,c="#5533ff";return MASCP.registerGroup("p3db_experimental",{fullname:"P3DB (mod)",color:c}),this.bind("resultReceived",function(){var d=this.result,e=d.getPeptides();e.length>0&&MASCP.registerLayer("p3db_controller",{fullname:"P3DB (mod)",color:c});for(var f=0;f<e.length;f++){var g=e[f].sequence,h=a.getAminoAcidsByPeptide(g);h.addToLayer("p3db_controller")}d.getOrganisms().forEach(function(b){if(3702!==b.id){var e="p3db_tax_"+b.id,f=d.getOrthologousPeptides(b.id);f.length>0&&MASCP.registerLayer(e,{fullname:b.name,group:"p3db_experimental",color:c});for(var g=0;g<f.length;g++){var h=f[g].sequence,i=a.getAminoAcidsByPeptide(h);i.addToLayer(e)}}}),a.createGroupController&&a.createGroupController("p3db_controller","p3db_experimental"),a.trigger("resultsRendered",[b])}),this},MASCP.P3dbReader.Result.prototype.render=function(){},MASCP.Pep2ProReader=MASCP.buildService(function(a){return this._raw_data=a,a&&(this._populate_spectra(a),this._populate_peptides(a)),this}),MASCP.Pep2ProReader.prototype.requestData=function(){var a=this.agi;return{type:"GET",dataType:"json",data:{agi:a,service:"pep2pro"}}},MASCP.Pep2ProReader.SERVICE_URL="http://fgcz-pep2pro.uzh.ch/mascp_gator.php?",MASCP.Pep2ProReader.Result=MASCP.Pep2ProReader.Result,MASCP.Pep2ProReader.Result.prototype.tissues=function(){return this._tissues},MASCP.Pep2ProReader.Result.prototype.getPeptides=function(){return this._peptides},MASCP.Pep2ProReader.Result.prototype=MASCP.extend(MASCP.Pep2ProReader.Result.prototype,{spectra:null,peptide_counts_by_tissue:null,sequence:null}),MASCP.Pep2ProReader.Result.prototype._populate_spectra=function(a){if(this.spectra={},this._tissues=[],this._long_name_map={},a&&a.tissues)for(var b=0;b<a.tissues.length;b++)this._tissues[b]=a.tissues[b]["PO:tissue"]||{},this._tissues[b].long_name=a.tissues[b].tissue,this._long_name_map[this._tissues[b]]=a.tissues[b].tissue,this.spectra[a.tissues[b]["PO:tissue"]]=parseInt(a.tissues[b].qty_spectra,10)},MASCP.Pep2ProReader.Result.prototype._populate_peptides=function(a){if(this.peptide_counts_by_tissue={},a&&a.peptides){this.sequence=a.sequence,this._peptides=[];for(var b=0;b<a.peptides.length;b++){var c=a.peptides[b];this._peptides.push(c.sequence);for(var d=c.position+"-"+(parseInt(c.position,10)+parseInt(c.sequence.length,10)),e=0;e<c.tissues.length;e++){var f=c.tissues[e];this.peptide_counts_by_tissue[f["PO:tissue"]]||(this.peptide_counts_by_tissue[f["PO:tissue"]]={}),this.peptide_counts_by_tissue[f["PO:tissue"]][d]=parseInt(f.qty_spectra,10)}}}},MASCP.Pep2ProReader.Result.prototype.render=function(){},MASCP.Pep2ProReader.prototype._rendererRunner=function(a){for(var b=this.result?this.result.tissues():[],c=b.length-1;c>=0;c--){var d=b[c];if(!(this.result.spectra[d]<1)){var e=this.result.peptide_counts_by_tissue[d],f="pep2pro_by_tissue_"+d,g=" .overlay { display: none; } .tracks .active { fill: #000099; } .inactive { display: none; } .active .overlay { display: block; top: 0px; background: #000099; } ";MASCP.registerLayer(f,{fullname:this.result._long_name_map[d],group:"pep2pro",color:"#000099",css:g,data:{po:d,count:e}});for(var h=this._normalise(this._mergeCounts(e)),i=1,j=null;i<=h.length;)null!==j&&("undefined"!=typeof h[i]&&i!=h.length||(a.getAminoAcidsByPosition([j])[0].addBoxOverlay(f,i-1-j),j=null)),h[i]>0&&null===j&&(j=i),i+=1}}},MASCP.Pep2ProReader.prototype._groupSummary=function(a){var b=this.result?this.result.tissues():[],c=[],d=function(){var a=[];for(var b in this)this.hasOwnProperty(b)&&a.push(b);return a.sort().join(",")};for(var e in b)if(b.hasOwnProperty(e)){var f=b[e];if(this.result.spectra[f]<1)continue;for(var g=this._mergeCounts(this.result.peptide_counts_by_tissue[f]),h=0;h<g.length;h++)g[h]>0&&(c[h]||(c[h]={},c[h].tissue=d),c[h][f]=!0)}var i=0,j=null,k=null,l="pep2pro_controller",m=" .overlay { display: none; } .tracks .active { fill: #000099; } .inactive { display: none; } .active .overlay { display: block; top: 0px; background: #000099; } ";MASCP.registerLayer(l,{fullname:"Pep2Pro MS/MS",color:"#000099",css:m});var n=this.result.agi,o=n.replace(/\.\d/,"");for(MASCP.getLayer("pep2pro_controller").href="http://fgcz-pep2pro.uzh.ch/locus.php?"+o;i<=c.length;)if(0>=i)i+=1;else{if((!c[i]||c[i].tissue()!=k||i==c.length)&&null!==j){var p=i-j;c[i]||(p-=1),a.getAminoAcidsByPosition([j])[0].addBoxOverlay(l,p),j=null}c[i]&&null===j&&(k=c[i].tissue(),j=i),i+=1}a.createGroupController&&a.createGroupController("pep2pro_controller","pep2pro")},MASCP.Pep2ProReader.prototype.setupSequenceRenderer=function(a){var b=this;return this.bind("resultReceived",function(){return MASCP.registerGroup("pep2pro",{fullname:"Pep2Pro data",hide_member_controllers:!0,hide_group_controller:!0,color:"#000099"}),a.sequence!=this.result.sequence&&""!=this.result.sequence?(a.bind("sequenceChange",function(){a.unbind("sequenceChange",arguments.callee),b._groupSummary(a),b._rendererRunner(a),a.trigger("resultsRendered",[b])}),void a.setSequence(this.result.sequence)):(b._groupSummary(a),b._rendererRunner(a),a.trigger("resultsRendered",[b]),void 0)}),this},MASCP.Pep2ProReader.prototype._normalise=function(a){var b=0,c=0;for(c=0;c<a.length;c++)a[c]&&a[c]>b&&(b=a[c]);for(c=0;c<a.length;c++)a[c]&&a[c]>0&&(a[c]=1*a[c]/b);return a},MASCP.Pep2ProReader.prototype._mergeCounts=function(a){var b=[];for(var c in a)if(a.hasOwnProperty(c))for(var d=c.split("-"),e=parseInt(d[0],10),f=parseInt(d[1],10),g=e;f>=g;g++)b[g]||(b[g]=0),b[g]+=a[c];return b},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.PhosphatReader=MASCP.buildService(function(a){if(a&&a.result&&!this._sequence)for(var b=0;b<a.result.length;b++)if("Imported protein - no info"==a.result[b].prot_sequence){var c=a.result[b].code;c=c.replace(/\s+$/,""),this._sequence=MASCP.getSequence(c);break}return a&&a.experimental&&a.relatives&&a.predicted?(this._raw_data=a,this):(a&&"getPredictedAa"==a.request_method&&(this._raw_data||(this._raw_data={}),this._raw_data.predicted=a),a&&"getExperimentsModAa"==a.request_method&&(this._raw_data||(this._raw_data={}),this._raw_data.experimental=a),a&&"getRelatives"==a.request_method&&(this._raw_data||(this._raw_data={}),this._raw_data.relatives=a),this)}),MASCP.PhosphatReader.SERVICE_URL="http://gator.masc-proteomics.org/proxy.pl?",MASCP.PhosphatReader.prototype.requestData=function(){var a=[null,this.agi];this.method||this._methods||(this._methods=["getPredictedAa","getExperimentsModAa","getRelatives"]),this.combine&&(this._methods=[]);var b=this._methods[0];return"getRelatives"==b&&(a=[this.agi]),{type:"POST",dataType:"json",data:{id:1,method:b,agi:this.agi,params:encodeURI(a.toJSON?a.toJSON():JSON.stringify(a)),service:"phosphat"}}},function(a){var b=a.prototype._dataReceived;a.prototype._dataReceived=function(a,c){if(null===a)return b.call(this,null,c);a.request_method=this._methods?this._methods[0]:null,this._methods&&this._methods.shift(),a.error&&0===a.error.indexOf("SELECT")&&(a.error=null);var d=b.call(this,a,c);return this.result&&this.result._raw_data&&this.result._raw_data.experimental&&this.result._raw_data.relatives&&this.result._raw_data.predicted?(this._methods=null,d):void(d&&this.retrieve())}}(MASCP.PhosphatReader),MASCP.PhosphatReader.Result=MASCP.PhosphatReader.Result,MASCP.PhosphatReader.Result.prototype.getAllPredictedPositions=function(){var a=[],b=this._raw_data.predicted.result;for(var c in b)if(b.hasOwnProperty(c)){var d=this._raw_data.predicted.result[c];d.prd_score>0&&a.push(d.prd_position)}return a},MASCP.PhosphatReader.Result.prototype.getAllExperimentalPositions=function(){var a={},b=this._raw_data.experimental.result;for(var c in b)if(b.hasOwnProperty(c)){var d=this._raw_data.experimental.result[c],e=d.pep_sequence||"";if(e=e.replace(/[^A-Z]/g,""),"phos"!=d.modificationType)continue;var f=this._sequence||d.prot_sequence,g=f.indexOf(e);if(0>g)continue;g+=d.position,
a[g]=1}var h=[];for(var i in a)a.hasOwnProperty(i)&&h.push(parseInt(i,10));return h},MASCP.PhosphatReader.Result.prototype.getAllExperimentalPhosphoPeptides=function(){var a={},b=this._raw_data.experimental.result;for(var c in b)if(b.hasOwnProperty(c)){var d=this._raw_data.experimental.result[c],e=d.pep_sequence||"";if(e=e.replace(/[^A-Z]/g,""),"phos"!=d.modificationType)continue;var f=this._sequence||d.prot_sequence,g=f.indexOf(e);if(g>=0){var h=""+g+"-"+e.length;a[h]=a[h]||[g,e.length],a[h].indexOf(d.position+g,2)<=0&&a[h].push(d.position+g)}}var i=[];for(var j in a)a.hasOwnProperty(j)&&i.push(a[j]);return i},MASCP.PhosphatReader.Result.prototype.getSpectra=function(){if(!this._raw_data.relatives||!this._raw_data.relatives.result)return{};for(var a={},b=this._raw_data.relatives.result,c=0;c<b.length;c++){var d=b[c].Tissue;a[d]||(a[d]=0),a[d]+=1}return a},MASCP.PhosphatReader.Result.prototype.render=function(){return null},MASCP.PhosphatReader.prototype.setupSequenceRenderer=function(a){var b=this;return this.bind("resultReceived",function(){var c=[],d=this.result.getAllExperimentalPhosphoPeptides();return 0===d.length?void a.trigger("resultsRendered",[b]):(MASCP.registerLayer("phosphat_experimental",{fullname:"PhosPhAt (mod)",color:"#000000",css:".active { background: #999999; color: #000000; font-weight: bolder; } .tracks .active { background: #000000; fill: #000000; } .inactive { display: none; }"}),MASCP.registerGroup("phosphat_peptides",{fullname:"PhosPhAt peptides"}),a.createGroupController&&a.createGroupController("phosphat_experimental","phosphat_peptides"),d.forEach(function(b,d){MASCP.registerLayer("phosphat_peptide_"+d,{fullname:"PhosPhAt MS/MS",group:"phosphat_peptides",color:"#000000",css:".active { background: #999999; color: #000000; } .tracks .active { background: #000000; fill: #000000; } .inactive { display: none; }"});var e=b.shift(),f=b.shift(),g=a.getAminoAcidsByPosition([e+1])[0];g&&(g.addBoxOverlay("phosphat_peptide_"+d,f,.5),c.push(g.addBoxOverlay("phosphat_experimental",f,.5))),a.getAminoAcidsByPosition(this).forEach(function(a){a.addToLayer("phosphat_peptide_"+d,{height:20,offset:-2.5}),c=c.concat(a.addToLayer("phosphat_experimental",{height:20,offset:-2.5}))})}),bean.add(MASCP.getGroup("phosphat_peptides"),"visibilityChange",function(b,d){b==a&&c.forEach(function(a){a.style||a.setAttribute("style",""),a.style.display=d?"none":"inline"})}),MASCP.getLayer("phosphat_experimental")&&(MASCP.getLayer("phosphat_experimental").href="http://phosphat.mpimp-golm.mpg.de/app.html?agi="+this.result.agi),void a.trigger("resultsRendered",[b]))}),this},MASCP.PpdbReader=MASCP.buildService(function(a){if(!a)return this;var b=function(){for(var a=this._raw_data.getElementsByTagName("FEATURE"),b=[],c={},d={},e=0;e<a.length;e++){var f=a[e].getElementsByTagName("TYPE")[0],g=f.textContent||f.text||f.nodeValue;if("Peptide"==g){var h=a[e].getAttribute("label");c[h]||(c[h]={experiments:[]});var i=parseInt(a[e].getElementsByTagName("GROUP")[0].getAttribute("id"),10);c[h].experiments.push(i),d[i]=!0}}for(var j in c)if(c.hasOwnProperty(j)){var k={sequence:j,experiments:c[j].experiments};b.push(k)}this._experiments=[];for(var l in d)d.hasOwnProperty(l)&&this._experiments.push(parseInt(l,10));return b};if(this._raw_data=a,a.getElementsByTagName){var c=b.call(this);this._raw_data={experiments:this._experiments,peptides:c}}return this._experiments=this._raw_data.experiments,this._peptides=this._raw_data.peptides,this}),MASCP.PpdbReader.prototype.requestData=function(){var a=(this.agi+"").replace(/\..*$/,""),b="json";return(this._endpointURL||"").indexOf("xml")>=0&&(b="xml"),{type:"GET",dataType:b,data:{segment:a,agi:this.agi,service:"ppdb"}}},MASCP.PpdbReader.SERVICE_URL="http://ppdb.tc.cornell.edu/das/arabidopsis/features/?output=xml",MASCP.PpdbReader.Result=MASCP.PpdbReader.Result,MASCP.PpdbReader.Result.prototype=MASCP.extend(MASCP.PpdbReader.Result.prototype,{spectra:null,peptide_counts_by_tissue:null,sequence:null}),MASCP.PpdbReader.Result.prototype.render=function(){return null},MASCP.PpdbReader.Result.prototype.getExperiments=function(){return this._experiments||[]},MASCP.PpdbReader.Result.prototype.getPeptides=function(){var a=this._peptides||[];return a.forEach(function(a){a.toString=function(a){return function(){return a.sequence}}(a)}),a},MASCP.PpdbReader.prototype.setupSequenceRenderer=function(a){var b=this;return this.bind("resultReceived",function(){MASCP.registerGroup("ppdb",{fullname:"PPDB spectra data",hide_member_controllers:!0,hide_group_controller:!0,color:"#aa9900"});var c="ppdb_controller",d=".active .overlay { background: #aa9900; } .active a { color: #000000; text-decoration: none !important; }  :indeterminate { background: #ff0000; } .tracks .active { background: #0000ff; } .inactive a { text-decoration: none; } .inactive { display: none; }";MASCP.registerLayer(c,{fullname:"PPDB MS/MS",color:"#aa9900",css:d}),a.createGroupController&&a.createGroupController("ppdb_controller","ppdb");for(var e=this.result.getPeptides(),f=this.result.getExperiments(),g=0;g<f.length;g++){var h="ppdb_experiment"+f[g];MASCP.registerLayer(h,{fullname:"Experiment "+f[g],group:"ppdb",color:"#aa9900",css:d}),MASCP.getLayer(h).href="http://ppdb.tc.cornell.edu/dbsearch/searchsample.aspx?exprid="+f[g];for(var i=0;i<e.length;i++){var j=e[i];if(!(e[i].experiments.indexOf(f[g])<0)){var k=a.getAminoAcidsByPeptide(j.sequence);k.addToLayer(h),k.addToLayer(c)}}}a.trigger("resultsRendered",[b])}),this},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.ProcessingReader=MASCP.buildService(function(a){return this._raw_data=a,this}),MASCP.ProcessingReader.SERVICE_URL="?",MASCP.ProcessingReader.prototype.requestData=function(){var a=this.agi;return{type:"GET",dataType:"json",data:{agi:a,service:"processing"}}},MASCP.ProcessingReader.Result=MASCP.ProcessingReader.Result,MASCP.ProcessingReader.Result.prototype.getProcessing=function(){return this._raw_data&&this._raw_data.data&&this._raw_data.data.processing?this._raw_data.data.processing:[]},MASCP.ProcessingReader.Result.prototype._cleanSequence=function(a){return a.replace(/[^A-Z]/g,"")},MASCP.ProcessingReader.prototype.setupSequenceRenderer=function(a){var b=this,c=".active .overlay { background: #666666; } .active a { color: #000000; text-decoration: none !important; }  :indeterminate { background: #ff0000; } .tracks .active { background: #0000ff; } .inactive a { text-decoration: none; } .inactive { display: none; }";return this.bind("resultReceived",function(){var d=this.result.getProcessing(),e=a.sequence.indexOf(d);if(!(0>e)){MASCP.registerLayer("processing",{fullname:"N-Terminal (mod)",color:"#ffEEEE",css:c});var f=a.getAA(e+1+d.length);f&&f.addAnnotation("processing",1,{border:"rgb(150,0,0)",content:"Mat",angle:0}),a.trigger("resultsRendered",[b])}}),this},MASCP.ProcessingReader.Result.prototype.render=function(){},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.PromexReader=MASCP.buildService(function(a){return this._raw_data=a,this}),MASCP.PromexReader.SERVICE_URL="http://131.130.57.242/json/?",MASCP.PromexReader.prototype.requestData=function(){var a=(this.agi+"").replace(/\..*$/,"");return{type:"GET",dataType:"json",data:{agi:this.agi,ac:a,service:"promex"}}},MASCP.PromexReader.Result=MASCP.PromexReader.Result,MASCP.PromexReader.Result.prototype.getPeptides=function(){if(!this._raw_data||!this._raw_data.peptides)return[];for(var a=[],b=0;b<this._raw_data.peptides.length;b++)a.push(this._cleanSequence(this._raw_data.peptides[b].sequence));return a},MASCP.PromexReader.Result.prototype._cleanSequence=function(a){return a.replace(/[^A-Z]/g,"")},MASCP.PromexReader.prototype.setupSequenceRenderer=function(a){var b=this;MASCP.registerGroup("promex_experimental",{fullname:"ProMex spectra data",hide_member_controllers:!0,hide_group_controller:!0,color:"#ff9900"});var c="promex_controller",d=".active .overlay { background: #ff9900; } .active a { color: #000000; text-decoration: none !important; }  :indeterminate { background: #ff0000; } .tracks .active { background: #0000ff; } .inactive a { text-decoration: none; } .inactive { display: none; }";return MASCP.registerLayer(c,{fullname:"ProMEX MS/MS",color:"#ff9900",css:d}),this.bind("resultReceived",function(){var e=(this.result.agi+"").replace(/\..*$/,"");MASCP.getLayer("promex_controller").href="http://promex.pph.univie.ac.at/promex/?ac="+e;for(var f=this.result.getPeptides(),g=0;g<f.length;g++){MASCP.registerLayer("promex_experimental_spectrum_"+g,{fullname:"Spectrum",group:"promex_experimental",color:"#ff9900",css:d});var h=f[g],i=a.getAminoAcidsByPeptide(h);if(i&&0!==i.length){var j="promex_experimental_spectrum_"+g;i.addToLayer(j),i.addToLayer(c)}}a.trigger("resultsRendered",[b]),a.createGroupController&&a.createGroupController("promex_controller","promex_experimental")}),this},MASCP.PromexReader.Result.prototype.render=function(){},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.RippdbReader=MASCP.buildService(function(a){return this._raw_data=a,this}),MASCP.RippdbReader.SERVICE_URL="http://gator.masc-proteomics.org/rippdb.pl?",MASCP.RippdbReader.prototype.requestData=function(){var a=this.agi;return{type:"GET",dataType:"json",data:{agi:a,service:"rippdb"}}},MASCP.RippdbReader.Result=MASCP.RippdbReader.Result,MASCP.RippdbReader.Result.prototype.getSpectra=function(){return this._raw_data&&this._raw_data.spectra?this._raw_data.spectra:[]},MASCP.RippdbReader.Result.prototype._cleanSequence=function(a){return a.replace(/[^A-Z]/g,"")},MASCP.RippdbReader.prototype.setupSequenceRenderer=function(a){var b=this,c=".active .overlay { background: #666666; } .active a { color: #000000; text-decoration: none !important; }  :indeterminate { background: #ff0000; } .tracks .active { background: #0000ff; } .inactive a { text-decoration: none; } .inactive { display: none; }";return this.bind("resultReceived",function(){var d=this.result.getSpectra(),e="prippdb_experimental",f=[];d.length>0&&(MASCP.registerLayer(e,{fullname:"RIPP-DB (mod)",color:"#666666",css:c}),MASCP.registerGroup("prippdb_peptides",{fullname:"Phosphorylation Rippdb",hide_member_controllers:!0,hide_group_controller:!0,color:"#666666"}),a.createGroupController&&a.createGroupController("prippdb_experimental","prippdb_peptides"),bean.add(MASCP.getGroup("prippdb_peptides"),"visibilityChange",function(b,c){b==a&&f.forEach(function(a){a.style.display=c?"none":"inline"})}));for(var g=0;g<d.length;g++){var h=d[g],i=h.peptides;if(0!==i.length){var j="prippdb_spectrum_"+h.spectrum_id;MASCP.registerLayer(j,{fullname:"Spectrum "+h.spectrum_id,group:"prippdb_peptides",color:"#666666",css:c});for(var k=0;k<i.length;k++){var l=i[k].sequence,m=a.getAminoAcidsByPeptide(l);if(0!==m.length){m.addToLayer(j),f.push(m.addToLayer("prippdb_experimental"));for(var n=0;n<i[k].positions.length;n++)f=f.concat(m[i[k].positions[n]-1].addToLayer("prippdb_experimental",{height:20,offset:-2.5})),m[i[k].positions[n]-1].addToLayer(j,{height:20,offset:-2.5})}}}}a.trigger("resultsRendered",[b])}),this},MASCP.RippdbReader.Result.prototype.getAllExperimentalPositions=function(){var a=this.getSpectra(),b=[],c={};return a.forEach(function(a){var d=a.peptides;d.forEach(function(a){a.positions.forEach(function(a){c[a]||(b.push(a),c[a]=!0)})})}),b},MASCP.RippdbReader.Result.prototype.render=function(){},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.SnpReader=MASCP.buildService(function(a){return this._raw_data=a||{},this}),MASCP.SnpReader.SERVICE_URL="http://gator.masc-proteomics.org/snps.pl?",MASCP.SnpReader.prototype.requestData=function(){return{type:"GET",dataType:"json",data:{agi:this.agi,service:"nssnps"}}},MASCP.SnpReader.prototype.showSnp=function(a,b){var c=this.result.getSnp(b);if(!(c.length<1)){var d,e="all"+b,f=[],g=[];for(d=c.length-1;d>=0;d--)g.push({index:c[d][0],delta:c[d][1]}),f.push({insertBefore:c[d][0]+1,delta:c[d][2]});for(d=f.length-1;d>=0;d--)a.getAA(f[d].insertBefore-1).addAnnotation(e,1,{border:"rgb(150,0,0)",content:f[d].delta})}},MASCP.SnpReader.ALL_ACCESSIONS=["AGU","BAK2","BAY","BUR0","CDM0","COL0","DEL10","DOG4","DON0","EY152","FEI0","HKT24","ICE1","ICE102","ICE104","ICE106","ICE107","ICE111","ICE112","ICE119","ICE120","ICE127","ICE130","ICE134","ICE138","ICE150","ICE152","ICE153","ICE163","ICE169","ICE173","ICE181","ICE21","ICE212","ICE213","ICE216","ICE226","ICE228","ICE29","ICE33","ICE36","ICE49","ICE50","ICE60","ICE61","ICE63","ICE7","ICE70","ICE71","ICE72","ICE73","ICE75","ICE79","ICE91","ICE92","ICE93","ICE97","ICE98","ISTISU1","KASTEL1","KOCH1","KRO0","LAG22","LEO1","LER1","LERIK13","MER6","NEMRUT1","NIE12","PED0","PRA6","QUI0","RI0","RUE3131","SHA","STAR8","TUESB303","TUESCHA9","TUEV13","TUEWA12","VASH1","VIE0","WALHAESB4","XAN1"],MASCP.SnpReader.prototype.setupSequenceRenderer=function(a){var b=this;b.bind("resultReceived",function(){var c=b.result;MASCP.registerGroup("insertions"),MASCP.registerGroup("deletions"),a.withoutRefresh(function(){for(var d,e=c.getAccessions();e.length>0;){var f=e.shift(),g=f,h=c.getSnp(f);if(!(h.length<1)){d||(d=a.registerLayer("insertions_controller",{fullname:"nsSNPs",color:"#ff0000"}));var i="all"+f,j=f.indexOf("_")>=0?f.split("_")[0].toUpperCase():null;["SALK","MPICAO","GMI","MPISCHNEE","MPICOLLAB","JGI"].indexOf(j)<0?j=null:(j.match(/^MPI/)&&(j="MPI"),g=f.replace(/^[^_]+_/,""));var k=[],l=[];j&&(MASCP.registerGroup(j,{group:"insertions"}),a.registerLayer(j+"_controller",{fullname:j,group:"insertions",color:"#ff0000"}),a.createGroupController&&j&&a.createGroupController(j+"_controller",j));var m=a.registerLayer(i,{fullname:g,group:j||"insertions"});!function(a){return function(){var c=!1,d=i;m.href=function(e){return c="boolean"==typeof e?e:!c,c?(MASCP.getLayer(d).icon="#minus_icon",b.showSnp(MASCP.renderer,a)):(MASCP.getLayer(d).icon="#plus_icon",MASCP.renderer.removeAnnotations(d),MASCP.renderer.redrawAnnotations()),MASCP.renderer.refresh(),!1}}}(f)(),MASCP.getLayer(i).icon=null;var n;for(n=h.length-1;n>=0;n--)l.push({index:h[n][0]+1,delta:h[n][1]}),k.push({insertBefore:h[n][0]+1,delta:h[n][2]});for(n=k.length-1;n>=0;n--){var o=k[n].insertBefore-1;o>a.sequence.length&&(o=a.sequence.length);var p=a.getAA(o).addAnnotation("insertions_controller",1,{border:"rgb(150,0,0)",content:k[n].delta,angle:0});p._click||(p.addEventListener("click",function(c){var d=!1;return function(){d=!d,a.withoutRefresh(function(){b.result.getSnpsForPosition(c).forEach(function(a){b.showSnp(MASCP.renderer,a),MASCP.getLayer("all"+a).href(d)})}),a.refresh()}}(o),!1),p.style.cursor="pointer",p._click=!0)}}}MASCP.getGroup("insertions").size()>0&&a.createGroupController&&a.createGroupController("insertions_controller","insertions")}),a.redrawAnnotations("insertions_controller"),a.trigger("resultsRendered",[b])})},MASCP.SnpReader.Result.prototype.getAccessions=function(){var a=this._raw_data.data,b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},MASCP.SnpReader.Result.prototype.getSnp=function(a){var b=this._raw_data.data[a],c=[];for(var d in b)if(b.hasOwnProperty(d)){var e=parseInt(d,10)+1,f=b[d],g=[e,f.charAt(0),f.charAt(1)];c.push(g)}return c},MASCP.SnpReader.Result.prototype.getSnpsForPosition=function(a){var b=this;if(this._cached=this._cached||{},this._cached[a])return this._cached[a];var c=[];return this.getAccessions().forEach(function(d){b.getSnp(d).forEach(function(b){return b[0]==a?void c.push(d):void 0})}),this._cached[a]=c,c},MASCP.cloneService(MASCP.SnpReader,"RnaEditReader"),MASCP.RnaEditReader.SERVICE_URL="?",MASCP.RnaEditReader.prototype.requestData=function(){return{type:"GET",dataType:"json",data:{agi:this.agi,service:"rnaedit"}}},MASCP.RnaEditReader.prototype.setupSequenceRenderer=function(a){var b=this;b.bind("resultReceived",function(){var c=b.result;a.withoutRefresh(function(){for(var b=c.getAccessions();b.length>0;){var d=b.shift(),e=c.getSnp(d);if(!(e.length<1)){var f="rnaedit",g=[],h=[];a.registerLayer(f,{fullname:"RNA Edit (mod)"});MASCP.getLayer(f).icon=null;var i;for(i=e.length-1;i>=0;i--)h.push({index:e[i][0]+1,delta:e[i][1]}),g.push({insertBefore:e[i][0]+1,delta:e[i][2]});for(i=g.length-1;i>=0;i--){var j=g[i].insertBefore-1;j>a.sequence.length&&(j=a.sequence.length),a.getAA(j).addAnnotation("rnaedit",1,{border:"rgb(150,0,0)",content:g[i].delta,angle:"auto"})}}}}),a.trigger("resultsRendered",[b])})},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.SubaReader=MASCP.buildService(function(a){return this._raw_data=a,this}),MASCP.SubaReader.SERVICE_URL="http://suba.plantenergy.uwa.edu.au/services/byAGI.php?",MASCP.SubaReader.prototype.requestData=function(){return{type:"GET",dataType:"json",data:{agi:this.agi,service:"suba"}}},MASCP.SubaReader.Result=MASCP.SubaReader.Result,MASCP.SUBA_FIELDS={location_gfp:null,location_ipsort:null,location_loctree:null,location_mitopred:null,location_mitoprot2:null,location_ms:null,location_multiloc:null,location_preoxp:null,location_predotar:null,location_subloc:null,location_swissprot:null,location_targetp:null,location_wolfpsort:null},MASCP.SubaReader.Result.prototype._getLocalisation=function(a){for(var b={},c=!1,d=0;d<this._raw_data.observed.length;d++){var e=this._raw_data.observed[d];e[2]==a&&(b[e[0]]||(b[e[0]]=[]),b[e[0]].push(e[1]),c=!0)}return c?b:null},MASCP.SubaReader.Result.prototype._parseLocalisation=function(a){if(null===a||0===a.length)return null;var b,c=a.split(";"),d={};for(b=c.length-1;b>=0;b--){var e=c[b].split(":");d[e[0]]=d[e[0]]||[],d[e[0]].push(e[1])}return d},MASCP.SubaReader.Result.prototype._sortLocalisation=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b=b.sort(function(b,c){return a[b].length-a[c].length})},MASCP.SubaReader.Result.prototype.getMassSpecLocalisation=function(){return this._getLocalisation("ms")},MASCP.SubaReader.Result.prototype.getGfpLocalisation=function(){return this._getLocalisation("gfp")},MASCP.SubaReader.Result.prototype.getWinnerTakesAllGfp=function(){var a,b=this.getGfpLocalisation(),c=this._sortLocalisation(b),d=[],e=-1;for(a=c.length-1;a>=0;a--)if(e&&b[c[a]]==e)d.push(c[a]);else{if(!(0>e))break;e=b[c[a]],d.push(c[a])}for(d._values=[],a=d.length-1;a>=0;a--)d._values.push(b[d[a]].length);return d},MASCP.SubaReader.Result.prototype.getWinnerTakesAllMassSpec=function(){var a,b=this.getMassSpecLocalisation(),c=this._sortLocalisation(b),d=[],e=-1;for(a=c.length-1;a>=0;a--)if(e&&b[c[a]]==e)d.push(c[a]);else{if(!(0>e))break;e=b[c[a]],d.push(c[a])}for(d._values=[],a=d.length-1;a>=0;a--)d._values.push(b[d[a]].length);return d},MASCP.SubaReader.Result.prototype.getPredictedLocalisations=function(){for(var a={},b=0;b<this._raw_data.predicted.length;b++)a[this._raw_data.predicted[b][0]]||(a[this._raw_data.predicted[b][0]]=[]),a[this._raw_data.predicted[b][0]].push(this._raw_data.predicted[b][1]);return a},MASCP.SubaReader.Result.prototype.mapController=function(a){console.log("Deprecated mapController")},MASCP.SubaReader.Result.prototype.render=function(){return null},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.TairReader=MASCP.buildService(function(a){return this._data=a||{},this._data.data||(this._data={data:["",""]}),this}),MASCP.TairReader.SERVICE_URL="http://gator.masc-proteomics.org/tair.pl?",MASCP.TairReader.prototype.requestData=function(){return{type:"GET",dataType:"json",data:{agi:this.agi,service:"tair"}}},MASCP.TairReader.Result.prototype.getDescription=function(){return this._data.data[1]},MASCP.TairReader.Result.prototype.getSequence=function(){return this._data.data[2]},MASCP.getSequence=function(a){var b=arguments.callee;return b._reader||(b._reader=new MASCP.TairReader,b._reader.async=!1),b._reader.result=null,b._reader.agi=a,b._reader.retrieve(),b._reader.result?b._reader.result.getSequence():""},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.UbiquitinReader=MASCP.buildService(function(a){return this._raw_data=a,this}),MASCP.UbiquitinReader.SERVICE_URL="?",MASCP.UbiquitinReader.prototype.requestData=function(){var a=this.agi;return{type:"GET",dataType:"json",data:{agi:a,service:"ubiquitin"}}},MASCP.UbiquitinReader.Result=MASCP.UbiquitinReader.Result,MASCP.UbiquitinReader.Result.prototype.getPeptides=function(){return this._raw_data&&this._raw_data.data&&this._raw_data.data.peptides?this._raw_data.data.peptides:[]},MASCP.UbiquitinReader.Result.prototype._cleanSequence=function(a){return a.replace(/[^A-Z]/g,"")},MASCP.UbiquitinReader.prototype.setupSequenceRenderer=function(a){var b=this,c=".active .overlay { background: #666666; } .active a { color: #000000; text-decoration: none !important; }  :indeterminate { background: #ff0000; } .tracks .active { background: #0000ff; } .inactive a { text-decoration: none; } .inactive { display: none; }";return this.bind("resultReceived",function(){var d=this.result.getPeptides(),e="ubiquitin_experimental",f="ubiquitin_peptides",g=[];d.length>0&&(MASCP.registerLayer(e,{fullname:"UBQ (mod)",color:"#666666",css:c}),MASCP.registerGroup(f,{fullname:"UBQ",hide_member_controllers:!0,hide_group_controller:!0,color:"#666666"}),a.createGroupController&&a.createGroupController(e,f),bean.add(MASCP.getGroup(f),"visibilityChange",function(b,c,d){c==a&&g.forEach(function(a){a.style.display=d?"none":"inline"})}));for(var h=0;h<d.length;h++){var i="ubiquitin_peptide_"+h;MASCP.registerLayer(i,{fullname:"Peptide",group:f,color:"#666666",css:c});var j=d[h].sequence,k=a.getAminoAcidsByPeptide(j);if(0!==k.length){k.addToLayer(i),g.push(k.addToLayer(i));for(var l=0;l<d[h].positions.length;l++)g=g.concat(k[d[h].positions[l]-1].addToLayer(e)),k[d[h].positions[l]-1].addToLayer(i)}}a.trigger("resultsRendered",[b])}),this},MASCP.UbiquitinReader.Result.prototype.getAllExperimentalPositions=function(){var a=this.getPeptides(),b=[],c={};return a.forEach(function(a){a.positions.forEach(function(a){c[a]||(b.push(a),c[a]=!0)})}),b},MASCP.UbiquitinReader.Result.prototype.render=function(){},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.UnionDomainReader=MASCP.buildService(function(a){if(a){this._raw_data||(this._raw_data={data:{}});for(var b in a.data)this._raw_data.data[b]=a.data[b]}return this}),MASCP.UnionDomainReader.prototype.requestData=function(){var a=this,b=new MASCP.UniprotDomainReader,c=new MASCP.CddRunner;MASCP.Service.CacheService(c);var d,e;c.bind("running",function(){bean.fire(a,"running")});var f=function(a,b){var c=Object.keys(b.data);return c.forEach(function(c){"tmhmm-TMhelix"==c&&a.data["uniprot-TMhelix"]&&delete a.data["uniprot-TMhelix"],a.data[c]=b.data[c]}),a.data["uniprot-TMhelix"]&&(a.data["tmhmm-TMhelix"]=a.data["uniprot-TMhelix"],delete a.data["uniprot-TMhelix"]),a},g=function(b){return b?(bean.fire(a,"error",[b]),bean.fire(MASCP.Service,"requestComplete"),a.requestComplete(),void(g=function(){})):void(d&&e&&(a._dataReceived(f(d,e)),a.gotResult(),a.requestComplete()))};return b.retrieve(this.agi,function(a){a||(d=this.result._raw_data),g(a)}),c.retrieve(this.agi,function(a){a||(e=this.result._raw_data),g(a)}),!1},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.UniprotReader=MASCP.buildService(function(a){if(a&&"string"==typeof a){var b,c=MASCP.UniprotReader.parseFasta(a);for(b in c)c.hasOwnProperty(b)&&(a={data:c[b]},this._raw_data=a)}return this._data=a||{},this._data.data||(this._data={data:["",""]}),this}),MASCP.UniprotReader.SERVICE_URL="http://gator.masc-proteomics.org/uniprot.pl?",MASCP.UniprotReader.prototype.requestData=function(){return{type:"GET",dataType:"txt",url:"http://www.uniprot.org/uniprot/"+this.agi.toUpperCase()+".fasta",data:{acc:this.agi,service:"uniprot"}}},MASCP.UniprotReader.Result.prototype.getDescription=function(){return this._data.data[1]},MASCP.UniprotReader.Result.prototype.getSequence=function(){return this._data.data[0]},MASCP.UniprotReader.parseFasta=function(a){var b=a.split(">"),c={};return b.forEach(function(a){var b=a.split(/\n/);if(!(b.length<=1)){var d=b.shift(),e=b.join(""),f=d.split("|"),g=f[1],h=f[2];c[g]=[e,h]}}),c},MASCP.UniprotReader.readFastaFile=function(a,b){var c=MASCP.UniprotReader.parseFasta(a),d=new MASCP.UserdataReader;return d.toString=function(){return"MASCP.UniprotReader"},d.map=function(a){return a.data},d.datasetname="UniprotReader",b(d),setTimeout(function(){d.avoid_database=!0,d.setData("UniprotReader",{data:c})},0),d},MASCP.UniprotReader.parseDomains=function(a){var b={};a=a.split(/\n/);var c=/FT\s+DOMAIN\s+(\d+)\s+(\d+)\s+(.*)/m,d=/FT\s+CARBOHYD\s+(\d+)\s+(\d+)\s+(.*)/m,e=/FT\s+SIGNAL\s+(\d+)\s+(\d+)\s+(.*)/m,f=/FT\s+TRANSMEM\s+(\d+)\s+(\d+)\s+(.*)/m;return a.forEach(function(a){var g=d.exec(a);if(g){var h=g[3];h=h.replace("...",".."),b[h]||(b[h]={peptides:[],name:h}),b[h].peptides.push([g[1],g[2]])}var g=c.exec(a);if(g){var h=g[3];h=h.replace(/;.*/,""),h=h.replace(/\.\s+\{.*\}?/,""),h=h.replace(/\.$/,""),h=h.replace(/\s+\d+$/,""),b[h]||(b[h]={peptides:[],name:h}),b[h].peptides.push([g[1],g[2]])}g=e.exec(a),g&&(b.SIGNALP||(b.SIGNALP={peptides:[],name:"SIGNALP"}),b.SIGNALP.peptides.push([g[1],g[2]])),g=f.exec(a),g&&(b["uniprot-TMhelix"]||(b["uniprot-TMhelix"]={peptides:[],name:"TMhelix"}),b["uniprot-TMhelix"].peptides.push([g[1],g[2]]))}),b},MASCP.UniprotReader.parseSecondaryStructure=function(a){var b;return a=a.split(/\n/),a.forEach(function(a){var c=/FT\s+(STRAND)\s+(\d+)\s+(\d+)/m,d=/FT\s+(HELIX)\s+(\d+)\s+(\d+)/m,e=/FT\s+(TURN)\s+(\d+)\s+(\d+)/m;[c,d,e].forEach(function(c){var d=c.exec(a);d&&(b&&b[d[1]]||(b={STRAND:{peptides:[]},HELIX:{peptides:[]},TURN:{peptides:[]}}),d&&b[d[1]].peptides.push([d[2],d[3]]))})}),b},MASCP.UniprotDomainReader=MASCP.buildService(function(a){if(a&&"string"==typeof a){var b=MASCP.UniprotReader.parseDomains(a);a={data:b},this._raw_data=a}return this}),MASCP.UniprotDomainReader.prototype.requestData=function(){return{type:"GET",dataType:"txt",url:"http://www.uniprot.org/uniprot/"+this.agi.toUpperCase()+".txt",data:{acc:this.agi,service:"uniprot"}}},MASCP.UniprotSecondaryStructureReader=MASCP.buildService(function(a){if(a&&"string"==typeof a){var b=MASCP.UniprotReader.parseSecondaryStructure(a);if(!b)return null;a={data:b},this._raw_data=a}else a&&(this._raw_data=a);return this}),MASCP.UniprotSecondaryStructureReader.prototype.requestData=function(){return{type:"GET",dataType:"txt",url:"http://www.uniprot.org/uniprot/"+this.agi.toUpperCase()+".txt",data:{acc:this.agi,service:"uniprot"}}},MASCP.UniprotSecondaryStructureReader.prototype.setupSequenceRenderer=function(a,b){this.bind("resultReceived",function(){this.result&&this.result._raw_data.data&&(b.track||MASCP.registerLayer("secstructure",{fullname:"Secondary structure",color:"#0f0"}),this.result._raw_data.data.STRAND.peptides.forEach(function(c){var d=parseInt(c[0]),e=parseInt(c[1]);a.getAA(d).addBoxOverlay(b.track||"secstructure",e-d,1,{fill:"#9AFF9A"})}),this.result._raw_data.data.HELIX.peptides.forEach(function(c){var d=parseInt(c[0]),e=parseInt(c[1]);a.getAA(d).addBoxOverlay(b.track||"secstructure",e-d,1,{fill:"#7EB6FF"})}),this.result._raw_data.data.TURN.peptides.forEach(function(c){var d=parseInt(c[0]),e=parseInt(c[1]);a.getAA(d).addBoxOverlay(b.track||"secstructure",e-d,1,{fill:"#F0A"})})),a.trigger("resultsRendered",[this])})},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.UserdataReader=MASCP.buildService(function(a){return a?(this._raw_data=a,this):this}),MASCP.UserdataReader.prototype.toString=function(){return"MASCP.UserdataReader."+this.datasetname},MASCP.UserdataReader.prototype.requestData=function(){var a=this.agi.toUpperCase();return{type:"GET",dataType:"json",data:{agi:a,service:this.datasetname}}},MASCP.UserdataReader.prototype.setupSequenceRenderer=function(a){},function(){var a=function(a){var b=this.map,c=a.data,d=c.shift(),e={},f=d.indexOf(b.id),g=[];for(var h in b)"id"!=h&&b.hasOwnProperty(h)&&g.push({name:h,index:d.indexOf(b[h])});for(;c.length>0;){var i=c.shift(),j=i[f].toLowerCase();e[j]||(e[j]={data:{}});var k,l=e[j];for(k=g.length-1;k>=0;k--)l.data[g[k].name]||(l.data[g[k].name]=[]),l.data[g[k].name]=l.data[g[k].name].concat((i[g[k].index]||"").split(","));l.retrieved=a.retrieved,l.title=a.title,a.etag&&(l.etag=a.etag)}return e};MASCP.UserdataReader.prototype.setData=function(b,c){if(c){var d=this;MASCP.Service.CacheService(this),this.datasetname=b,c.retrieved||(c.retrieved=new Date),c.title||(c.title=b),d.title=c.title;var e={};if("object"==typeof this.map&&(e=a.call(this,c)),"function"==typeof this.map){if(this.map.callback){var f=arguments.callee;return void this.map(c,function(a){d.map=function(a){return a},f.call(d,b,a)})}e=this.map(c)}if(this.map){this.data=e;var g=new MASCP.UserdataReader;g.toString=function(){return d.toString()},g.data=e,g.retrieve=function(a,b){this.agi=a,b.call(this)},MASCP.Service.CacheService(g);var h,i=[];for(h in e)e.hasOwnProperty(h)&&(h.match(/[A-Z]/)&&(e[h.toLowerCase()]=e[h],delete e[h],h=h.toLowerCase()),i.push(h));var j=i.length,k=this.retrieve;return this.retrieve=function(a,b){console.log("Data not ready! Waiting for ready state");var c=this;bean.add(c,"ready",function(){bean.remove(c,"ready",arguments.callee),c.retrieve(a,b)})},i.length<1?void setTimeout(function(){d.retrieve=k,bean.fire(d,"ready",[c])},0):void MASCP.Service.BulkOperation(function(a){if(a)return void bean.fire(d,"error",[a]);var b=this.transaction;g.avoid_database=!0,g.retrieve(i[0],function(){for(;i.length>0;){var a=i.shift();if(bean.fire(d,"progress",[100*((j-i.length)/j),j-i.length,j]),g.agi=a,g._dataReceived(e[a]),0===i.length)return d.retrieve=k,void b(function(a){a?bean.fire(d,"error"):bean.fire(d,"ready",[c])})}})})}}},MASCP.UserdataReader.datasets=function(a,b){MASCP.Service.FindCachedService(this,function(c){for(var d=[],e=0,f=c.length;f>e;e++)d.push(c[e].replace(/MASCP.UserdataReader./,""));d.forEach&&d.forEach(a),b&&b()})}}(),"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.ClustalRunner=MASCP.buildService(function(a){return this._raw_data=a,a&&"string"==typeof a&&(this._raw_data={data:{sequences:this.getSequences(),alignment:this.getAlignment()}}),this}),MASCP.ClustalRunner.SERVICE_URL="http://www.ebi.ac.uk/Tools/services/rest/clustalw2/run/",MASCP.ClustalRunner.hash=function(a){var b=0;for(i=0;i<a.length;i++)char=a.charCodeAt(i),b=char+(b<<6)+(b<<16)-b;return b},MASCP.ClustalRunner.prototype.requestData=function(){var a=[].concat(this.sequences||[]),b=this;if(this.agi=MASCP.ClustalRunner.hash(this.sequences.join(","))+"",!MASCP.ClustalRunner.SERVICE_URL.match(/ebi/))return{type:"POST",dataType:"json",data:{sequences:a.join(",")}};if(bean.fire(b,"running"),this.job_id)return{type:"GET",dataType:"txt",url:"http://www.ebi.ac.uk/Tools/services/rest/clustalw2/status/"+this.job_id};if(this.result_id)return{type:"GET",dataType:"txt",url:"http://www.ebi.ac.uk/Tools/services/rest/clustalw2/result/"+this.result_id+"/aln-clustalw"};for(var c=0;c<a.length;c++)a[c]=">seq"+c+"\n"+a[c];return{type:"POST",dataType:"txt",data:{sequence:escape(a.join("\n")+"\n"),email:"joshi%40sund.ku.dk"}}},function(a){var b=a.prototype._dataReceived;a.prototype._dataReceived=function(a,c){if(null===a)return b.call(this,null,c);if("object"==typeof a){if(a.status&&"RUNNING"==a.status){var d=this;return bean.fire(d,"running"),setTimeout(function(){d.retrieve(d.agi)},5e3),void console.log("Got back running status")}return b.call(this,a,c)}if("string"==typeof a&&a.match(/^clustalw/))return this.job_id=a,
void this.retrieve(this.agi);if(a.match(/FINISHED/)){this.result_id=this.job_id,this.job_id=null;var d=this;return void setTimeout(function(){d.retrieve(d.agi)},500)}if(a.match(/RUNNING/)){var d=this;return void setTimeout(function(){d.retrieve(d.agi)},500)}return b.call(this,a,c)}}(MASCP.ClustalRunner),function(){var a=function(a){var b,c=[],d={};for(b in a)a.hasOwnProperty(b)&&parseInt(b)>=-1&&c.push(parseInt(b));c=c.sort(function(a,b){return a-b});for(var e=c.length-1;e>=0;e--){var f=e-1;b=parseInt(c[e]);for(var g=a[b];f>=0;)b-=a[c[f]].length,f--;g.match(/^\s+$/)||(d[b+1]=g+(d[b+1]||""))}return d},b=function(a,b,c){for(var d=0;d<a.length;d++){var e=a[d].toString();"-"!=e.charAt(b)?(c[d]||(c[d]={},c[d][-1]=""),c[d][b-1]=e.charAt(b),c[d][b]&&c[d][b].match(/\w/)&&(c[d][b-1]+=c[d][b],delete c[d][b])):c[d]&&(c[d][b-1]=" ",(c[d][b]||"").match(/^\s+$/)&&(c[d][b-1]+=c[d][b],delete c[d][b])),a[d]=e.slice(0,b)+e.slice(b+1)}};MASCP.ClustalRunner.Result.prototype.alignToSequence=function(c){this._orig_raw_data?this._raw_data=JSON.parse(this._orig_raw_data):this._orig_raw_data=JSON.stringify(this._raw_data);var d=this._raw_data.data.sequences.concat([this._raw_data.data.alignment]),e=[],f=d[c],g=f.length-1;for(g;g>=0;g--)"-"==f.charAt(g)&&b(d,g,e);for(g=0;g<d.length;g++)if(e[g]&&g!=c){e[g]=a(e[g]);var h=d[g];d[g]={sequence:h,insertions:e[g]},d[g].toString=function(){return this.sequence}}this._raw_data.data.alignment=d.pop(),this._raw_data.data.sequences=d},MASCP.ClustalRunner.Result.prototype.calculatePositionForSequence=function(a,b){for(var c=this._raw_data.data.sequences[a].insertions||{},d=0,e=this._raw_data.data.sequences[a].toString(),f=0;f<e.length;f++)if(c[f]&&(d+=c[f].length),d+=1,"-"==e.charAt(f)&&(d-=1),d>=b)return b==d?f+1:(0==f&&(f=1),-1*f);return-1*e.length},MASCP.ClustalRunner.Result.prototype.calculateSequencePositionFromPosition=function(a,b){for(var c=this._raw_data.data.sequences[a].insertions||{},d=0,e=this._raw_data.data.sequences[a].toString(),f=0;b>f;f++)c[f]&&(d+=c[f].length),d+=1,"-"==e.charAt(f)&&(d-=1);return 0==d&&(d+=1),d}}(),MASCP.ClustalRunner.prototype.setupSequenceRenderer=function(a){var b=this;a.sequences=b.sequences,a.addAxisScale("clustal",function(a,c,d){var e=b.sequences.map(function(a){return a.agi}).indexOf(c.name.toLowerCase());return 0>e?a:d?b.result.calculateSequencePositionFromPosition(e,a):b.result.calculatePositionForSequence(e,a)}),a.forceTrackAccs=!0;var c=[],d="isoform_controller",e="isoforms",f=function(a,b){var c,d=-3,e=-2,f=a.group();c=a.line(e+1,d+4,e+3,d+1),c.setAttribute("stroke","#fcc"),c.setAttribute("stroke-width","10"),f.push(c),c=a.line(e+1,d+6,e+3,d+3),c.setAttribute("stroke","#fcc"),c.setAttribute("stroke-width","10"),f.push(c),c=a.line(e+1,d+4,e+3,d+3),c.setAttribute("stroke","#fcc"),c.setAttribute("stroke-width","5"),f.push(c),c=a.line(e+1,d+5.3,e+1,d+5.8),c.setAttribute("stroke","#fcc"),c.setAttribute("stroke-width","10"),f.push(c),c=a.line(e+1,d+5.9,e+1.5,d+5.9),c.setAttribute("stroke","#fcc"),c.setAttribute("stroke-width","10"),f.push(c);var g=a.circle(e+2.8,d+1.75,1);g.setAttribute("fill","#fff"),g.setAttribute("stroke","#ccc"),g.setAttribute("stroke-width","10"),f.push(g);var h=a.text(e+2.25,d+2.25,(b||"")+"");return h.setAttribute("fill","#ccc"),h.setAttribute("font-size",75),f.push(h),a.firstChild.nextSibling.appendChild(f),f},g=function(h){for(var i=b.result;c.length>0;){var j=c.shift();a.remove(j.layer,j)}i.alignToSequence(h||0);var k=i.getSequences();if(!a.sequence)return void a.setSequence(k[h])(function(){a.sequences=b.sequences,MASCP.registerGroup(e,"Aligned"),MASCP.registerLayer(d,{fullname:"Conservation",color:"#000000"}),a.trackOrder.indexOf(d)<0&&(a.trackOrder=a.trackOrder.concat([d])),a.showLayer(d),a.createGroupController(d,e),g(h)});a.sequence=k[h],a.redrawAxis();var l=i.getAlignment().split("");c=c.concat(a.renderTextTrack(d,i.getAlignment().replace(/ /g,""))),c.slice(-1)[0].setAttribute("data-spaces","true"),c.slice(-1)[0].layer=d;for(var m=["*",":","."," "].reverse(),n=0;n<l.length;n++)c.push(a.getAA(n+1,d).addBoxOverlay(d,1,m.indexOf(l[n])/4,{merge:!0})),c.slice(-1)[0].layer=d;for(var n=0;n<k.length;n++){var o=b.sequences[n].agi.toUpperCase()||"missing"+n,p=MASCP.registerLayer(o,{fullname:b.sequences[n].name||o.toUpperCase(),group:e,color:"#ff0000"});p.fullname=b.sequences[n].name||o.toUpperCase();var q=a.renderTextTrack(o,k[n].toString());q[0].setAttribute("dy","-1ex"),c=c.concat(q),c.slice(-1)[0].layer=o,a.trackOrder.indexOf(o.toUpperCase())<0&&(console.log("Adding ",o," to renderer"),a.trackOrder=a.trackOrder.concat([e]));if(k[n].insertions)for(var r in k[n].insertions){var s=k[n].insertions;if(!(0==r&&""==s[r]||s[r].length<1)){var t=s[r].length;0==r&&(r=1);var u=f(a._canvas,t);u.setAttribute("fill","#ffff00");var v=a.getAA(r,d).addToLayer(o,{content:u,bare_element:!0,height:10,offset:-5,no_tracer:!0})[1];v.container.setAttribute("height","300"),v.container.setAttribute("viewBox","-50 -100 200 300"),c.push(v),c.slice(-1)[0].layer=o}}}a.zoom=1,a.showGroup(e),a.refresh()};this.bind("resultReceived",function(){var b=this;g(0),b.result.aligned_idx=0;var c=[];b.sequences.forEach(function(a){c.push(a.agi.toUpperCase())}),a.bind("orderChanged",function(e){b.result&&(b.result.aligned_idx=c.indexOf(e[e.indexOf(d)+1]),g(b.result.aligned_idx),a.refreshScale())})})},MASCP.ClustalRunner.Result.prototype.getSequences=function(){if(this._raw_data&&this._raw_data.data&&this._raw_data.data.sequences)return[].concat(this._raw_data.data.sequences);for(var a=this._raw_data.match(/seq\d+(.*)/g),b=[],c=0;c<a.length;c++){var d=a[c].match(/seq(\d+)\s+(.*)/);b[d[1]]||(b[d[1]]=""),b[d[1]]+=d[2]}return b},MASCP.ClustalRunner.Result.prototype.getAlignment=function(){if(this._raw_data&&this._raw_data.data&&this._raw_data.data.alignment)return this._raw_data.data.alignment.toString();this._text_data=this._raw_data;for(var a=/ {16}(.*)/g,b="",c=a.exec(this._raw_data);null!==c;)b+=c[1],c=a.exec(this._raw_data);return b},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";if(MASCP.HydropathyRunner=MASCP.buildService(function(a){return this._raw_data=a,this}),MASCP.HydropathyRunner.prototype.retrieve=function(){bean.fire(this,"resultReceived")},MASCP.HydropathyRunner.prototype.setupSequenceRenderer=function(a,b){this.bind("resultReceived",function(){var c=5;b=b||{};for(var d={A:1.8,R:-4.5,N:-3.5,D:-3.5,C:2.5,Q:-3.5,E:-3.5,G:-.4,H:-3.2,I:4.5,L:3.8,K:-3.9,M:1.9,F:2.8,P:-1.6,S:-.8,T:-.7,W:-.9,Y:-1.3,V:4.2},e=[],f=0;c>f;f++)e[f]=0;for(var f=c;f<a._sequence_els.length-c;f++){for(var g=0,h=-1*c;c>=h;h++)g+=d[a._sequence_els[f+h].amino_acid[0]]/(2*c+1);e.push(g)}b.track||MASCP.registerLayer("hydropathy",{fullname:"Hydropathy plot",color:"#f00"}),a.addValuesToLayer(b.track||"hydropathy",e,b),a.trigger("resultsRendered",[this])})},"undefined"==typeof MASCP||"undefined"==typeof MASCP.Service)throw"MASCP.Service is not defined, required class";MASCP.PrideRunner=MASCP.buildService(function(a){return this._raw_data=a,this}),MASCP.PrideRunner.SERVICE_URL="http://www.ebi.ac.uk/pride/biomart/martservice",MASCP.PrideRunner.prototype.requestData=function(){var a=([].concat(this.identifiers||[]),this);if(!this._endpointURL.match(/ebi\.ac/))return{type:"GET",dataType:"json",data:{agi:a.agi,service:"pride"}};return bean.fire(a,"running"),{type:"GET",dataType:"txt",data:{query:encodeURIComponent('<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE Query><Query  virtualSchemaName = "default" formatter = "CSV" header = "0" uniqueRows = "0" count = "" datasetConfigVersion = "0.6" ><Dataset name = "pride" interface = "default" ><Filter name = "submitted_accession_option" value = "'+a.agi+'"/><Attribute name = "peptide_sequence" /><Attribute name = "start_coord" /><Attribute name = "end_coord" /></Dataset></Query>')}}},MASCP.PrideRunner.prototype.setupSequenceRenderer=function(a,b){b||(b={}),this.bind("resultReceived",function(){var c=[],d=0;this.result._raw_data.data.forEach(function(b){if(!(b.peptide.length<1)){var e=a.getAminoAcidsByPeptide(b.peptide);!e||e.length<b.peptide.length||a.getAminoAcidsByPeptide(b.peptide).forEach(function(a){c[a._index]=c[a._index]||0,c[a._index]+=b.count,c[a._index]>d&&(d=c[a._index])})}});for(var e=[],f=0;f<a.sequence.length;f++)c[f]?e.push(c[f]/d):e.push(0);var g=a.addValuesToLayer(b.track||this.agi,e,{height:12,offset:isNaN(b.offset)?0:b.offset,label:{max:d+" PRIDE peptides"}});g.setAttribute("stroke","#00f"),a.trigger("resultsRendered",[this])})},function(a){var b=a.prototype._dataReceived;a.prototype._dataReceived=function(a,c){if(null===a)return b.call(this,null,c);if("object"==typeof a&&a.status&&"RUNNING"==a.status){var d=this;return bean.fire(d,"running"),setTimeout(function(){d.retrieve(d.agi)},5e3),void console.log("Got back running status")}if("string"==typeof a){var e=[],f={};a.split("\n").forEach(function(a){var b=a.split(",");b.length<1||(f[b[0]]?(f[b[0]].count++,b[1]&&(f[b[0]].start=b[1],f[b[0]].end=b[2])):(f[b[0]]={peptide:b[0],start:b[1],end:b[2],count:1},e.push(f[b[0]])))}),a=e}return b.call(this,a,c)}}(MASCP.PrideRunner),MascotToJSON=function(){},function(){var a={file:"",do_export:"1",export_format:"CSV",protein_master:"1",peptide_master:"1",pep_seq:"1",pep_score:"0",REPORT:"AUTO",show_same_sets:"1",_requireboldred:"1",_ignoreionsscorebelow:"0.05",prot_hit_num:"0",pep_end:"0",pep_miss:"0",pep_homol:"0",pep_ident:"0",pep_frame:"0",pep_var_mod:"0",pep_num_match:"0",pep_scan_title:"0",pep_query:"0",pep_rank:"0",pep_isbold:"0",pep_exp_mz:"0",pep_calc_mr:"0",pep_exp_z:"0",pep_exp_mr:"0",pep_delta:"0",_sigthreshold:"0.05",_showallfromerrortolerant:"0",_onlyerrortolerant:"0",_noerrortolerant:"0",_show_decoy_report:"0",_showsubsets:"0",_server_mudpit_switch:"0.000000001"},b=function(a){if(null===a||"object"!=typeof a)return a;var c=a.constructor();for(var d in a)a.hasOwnProperty(d)&&(c[d]=b(a[d]));return c},c=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c+"="+a[c]);return b.join("&")},d=function(a,b){b=b||",";for(var c=new RegExp("(\\"+b+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+b+"\\r\\n]*))","gi"),d=[[]],e=null;null!==(e=c.exec(a));){var f=e[1];f.length&&f!=b&&d.push([]);var g;g=e[2]?e[2].replace(new RegExp('""',"g"),'"'):e[3],d[d.length-1].push(g)}return d},e=function(a){var b=[],c=null,d={};return a.forEach(function(a){a[1]&&""!==a[1]&&(c=a[1]);var e=a[6]+a[7]+a[8];e&&!d[c+e]&&b.push([c,e]),d[c+e]=1}),b};MascotToJSON.prototype.convertReport=function(f,g){var h=this,i=new window.XMLHttpRequest,j=f.replace(/master_results(_2)?.pl.*/,"export_dat_2.pl"),k=(/file=([^&]*)/.exec(f)||[]).shift(),l=b(a);l.file=k,i.onreadystatechange=function(){if(4==i.readyState)if(200==i.status){var a=i.responseText;a=a.replace(/(.+\n)+\n.*\n/m,""),g&&g.call(h,e(d(a)))}else 0===i.status&&g&&g.call(h,[],new Error("Could not load page"))},i.open("GET",j+"?"+c(l),!0),i.send(null)}}(),"undefined"!=typeof module&&module.exports&&(module.exports.MascotToJSON=MascotToJSON),"undefined"!=typeof document&&"registerElement"in document&&!function(){var a=function(a,b){a.match(/^(https?:\/)?\//)&&MASCP.Service.request(a,b,!0)},b=function(b,c){sessionStorage.renderer_caches||(sessionStorage.renderer_caches=JSON.stringify({}));var d=JSON.parse(sessionStorage.renderer_caches);return d[b]?(console.log("Going to cache for renderer at "+b),void c.call(null,null,d[b])):void a(b,function(a,d){if(a)return void c.call(null,a);var e=JSON.parse(sessionStorage.renderer_caches);e[b]=d,sessionStorage.renderer_caches=JSON.stringify(e),c.call(null,null,d)})},c=function(a,b,c,d,e){c.preferences={getPreferences:function(a){a.call(c,null,b)}};var f=(b.render_options||{}).track?b.render_options.track:d;if(b&&b.icons||(b.render_options||{}).icons){var g=b.icons||(b.render_options||{}).icons;MASCP.Service.request(g.url,function(a,b){b&&e.importIcons(g.namespace,b.documentElement)},"xml")}"liveClass"!=b.type&&"reader"!=b.type||c.registerSequenceRenderer(e,b.render_options||{});var h=function(){if(this.result){e.trackOrder.indexOf(f)<0&&(MASCP.registerLayer(f,{fullname:f},[e]),e.trackOrder.push(f),e.showLayer(f)),MASCP.getLayer(f)&&!MASCP.getLayer(f).disabled||MASCP.registerLayer(f,{fullname:f},[e]);var a=this.result._raw_data.data;return b.render_options.renderer&&JSandbox?void function(g,h){if(g)return void window.notify.alert("Could not render "+b.title);var i=new JSandbox,j=e.sequence;!function(){var a={gotResult:function(){j=e.sequence},agi:d};e.trigger("readerRegistered",[a]),a.gotResult()}(),i.eval(h,function(){this.eval({data:"renderData(input.sequence,input.data,input.acc)",input:{sequence:j,data:a,acc:d},onerror:function(a){console.log(b.title),console.log("Errored out"),console.log(a)},callback:function(a){i.terminate();var g={gotResult:function(){a.forEach(function(a){var c=parseInt((b.render_options||{}).offset||0);if(a.options){if(a.options.offset)return void(a.options.offset+=c);a.options.offset=c}else a.options={offset:c}});var d=e.renderObjects(f,a);c.resetOnResult(e,d,f),e.trigger("resultsRendered",[c]),e.refresh()},agi:d};e.trigger("readerRegistered",[g]),g.gotResult()}})})}(null,b.render_options.renderer):void 0}};c.bind("resultReceived",h),c.retrieve(d)},d=null,e=function(){var a=Object.create(HTMLElement.prototype,{type:{get:function(){return this.readerType},set:function(a){this.readerType=a,this.setAttribute("type",a)}},track:{get:function(){return this.readerTrack},set:function(a){this.readerTrack=a,this.setAttribute("track",a)}},name:{get:function(){return this.readerTitle},set:function(a){this.readerTitle=a,this.setAttribute("name",a)}},rendererUrl:{set:function(a){this.rendererUrl=a},get:function(){return this.rendererUrl}},renderer:{set:function(a){this.renderFunc=a},get:function(){return this.renderFunc}}});a.createdCallback=function(){var a=this;this.renderFunc="",this.getAttribute("type")&&(this.type=this.getAttribute("type")),this.getAttribute("rendererurl")&&b(this.getAttribute("rendererurl"),function(b,c){b||(a.renderer=c)})},a.attributeChangedCallback=function(a,c,d){"name"==a&&this.name!==d&&(this.name=d),"type"==a&&this.type!==d&&(this.type=d),"track"==a&&this.track!=d&&(this.track=d),"rendererurl"==a&&b(d,function(a,b){a||(this.renderer=b)})},a._generateConfig=function(){var a={};return this.config_id?(a[this.config_id]={type:this.type,title:this.name,render_options:{track:this.track,renderer:this.renderFunc&&"function"==typeof this.renderFunc?"var renderData = "+this.renderFunc.toString():this.renderFunc,icons:{url:"/sugars.svg",namespace:"sugar"}},data:this.data},a):a},Object.defineProperty(a,"configuration",{get:function(){return this._generateConfig()}}),d=a;var c=document.registerElement("gator-reader",{prototype:a});return c}(),f=(function(){var a=Object.create(d,{href:{get:function(){return this.config_id},set:function(a){this.config_id=a}},type:{get:function(){return"gatorURL"}}});return a.createdCallback=function(){this.getAttribute("href")&&(this.href=this.getAttribute("href")),d.createdCallback.apply(this)},a.attributeChangedCallback=function(a,b,c){"href"==a&&c!==this.href&&(this.href=c),d.attributeChangedCallback.apply(this)},document.registerElement("gator-gatorurl",{prototype:a}),a}(),function(){var a=Object.create(d,{type:{get:function(){return"reader"}},config_id:{get:function(){return this._config_id}},data:{get:function(){return this._data},set:function(a){this._data=a,this.dataChanged()}}}),b=function(){var a=new MASCP.UserdataReader;return a.map=function(a){var b={};for(var c in a)"retrieved"!=c&&"title"!=c&&(a[c].data?b[c]=a:b[c]={data:a[c]},b[c].retrieved=a.retrieved,b[c].title=a.title);return b},a.datasetname=this.config_id,a.setData(this.config_id,this.data),a};return a.dataChanged=function(){this._reader&&(this._reader.bind("ready",function(){this.unbind("ready",arguments.callee),this.agi&&this.retrieve(this.agi)}),this._reader.setData(this._reader.datasetname,this.data))},a.createdCallback=function(){this._config_id="local-"+(new Date).getTime(),d.createdCallback.apply(this),this._reader=b.call(this)},a._generateConfig=function(){var a=d._generateConfig.call(this);return a[this._config_id].reader=this._reader,a},a.attributeChangedCallback=function(a,b,c){d.attributeChangedCallback.apply(this)},document.registerElement("gator-localdata",{prototype:a}),a}(),function(){var a=Object.create(d,{type:{get:function(){return"reader"}},config_id:{get:function(){return this._config_id}},data:{get:function(){return this._reader.data},set:function(a){this._reader.data=a}},boxTags:{get:function(){return this._reader.boxTags},set:function(a){this._reader.boxTags=a}},symbolTags:{get:function(){return this._reader.symbolTags},set:function(a){this._reader.symbolTags=a}}}),b=function(){var a=new MASCP.EditableReader;return a};return a.createdCallback=function(){this._config_id="editable-"+(new Date).getTime(),d.createdCallback.apply(this),this._reader=b.call(this)},a._generateConfig=function(){var a=d._generateConfig.call(this);return a[this._config_id].reader=this._reader,a},a.attributeChangedCallback=function(a,b,c){d.attributeChangedCallback.apply(this)},document.registerElement("gator-editabledata",{prototype:a}),a}(),function(){var a=Object.create(d,{type:{get:function(){return"liveClass"}},endpoint:{get:function(){return this._endpoint},set:function(a){this._endpoint=a}},config_id:{get:function(){return"DomainRetriever"}}});return a.createdCallback=function(){this.getAttribute("accepted")&&(this.accepted=this.getAttribute("accepted")),this.getAttribute("href")&&(this.endpoint=this.getAttribute("href")),d.createdCallback.apply(this)},a.attributeChangedCallback=function(a,b,c){d.attributeChangedCallback.apply(this)},a._generateConfig=function(){var a=d._generateConfig.call(this);return a.DomainRetriever.accepted_domains={type:"gatorURL",url:"http://glycodomain-data.glycocode.com/data/latest/spreadsheet:0Ai48KKDu9leCdHM5ZXRjdUdFWnQ4M2xYcjM3S0Izdmc"},this.endpoint&&(a.DomainRetriever.url=this.endpoint),a.DomainRetriever.render_options.renderer=null,a.DomainRetriever.render_options.offset=-4,a.DomainRetriever.render_options.height=8,a},document.registerElement("gator-domains",{prototype:a}),a}(),function(){var a=Object.create(HTMLElement.prototype,{});return a.attachedCallback=function(){},a.attributeChangedCallback=function(a,b,c){},a.go=function(){var a=this,b=this.readers.reduce(function(a,b){var c=b.configuration;for(var d in c)a[d]=c[d];return a},{});MASCP.IterateServicesFromConfig(b,function(b,d,e){c(b,d,e,a.parentNode.accession,a.parentNode.renderer)})},Object.defineProperty(a,"readers",{get:function(){for(var a=[],b=this.childNodes,c=0;c<b.length;c++)b[c]instanceof e&&a.push(b[c]);return a}}),document.registerElement("gator-reader-renderer",{prototype:a}),a}());(function(){var a=Object.create(f,{name:{get:function(){return this.trackName||this.parentNode.accession},set:function(a){this.trackName=a,this.setAttribute("name",a),b.apply(this)}},genomic:{get:function(){return this.trackGenomic},set:function(a){a?(this.trackGenomic=!0,this.setAttribute("genomic",!0)):(this.trackGenomic=!1,this.removeAttribute("genomic"))}}});a.createdCallback=function(){this.getAttribute("name")&&(this.name=this.getAttribute("name")),this.getAttribute("genomic")&&(this.genomic=this.getAttribute("genomic"))},a.attributeChangedCallback=function(a,b,c){"name"==a&&this.name!==c&&(this.name=c),"genomic"==a&&(c?this.genomic=!0:this.genomic=!1)};var b=function(){var a=this;this.readers.forEach(function(b){!b.track&&a.name&&(b.track=a.name)})};return a.go=function(){var a=this,c=MASCP.registerLayer(this.name,{fullname:this.name},[a.parentNode.renderer]);this.genomic?c.genomic=this.genomic:delete c.genomic,b.apply(this),f.go.apply(this)},document.registerElement("gator-track",{prototype:a}),a})()}(),function(a,b){"use strict";function c(){d.READY||(d.event.determineEventTypes(),d.utils.each(d.gestures,function(a){d.detection.register(a)}),d.event.onTouch(d.DOCUMENT,d.EVENT_MOVE,d.detection.detect),d.event.onTouch(d.DOCUMENT,d.EVENT_END,d.detection.detect),d.READY=!0)}var d=function(a,b){return new d.Instance(a,b||{})};d.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},d.HAS_POINTEREVENTS=a.navigator.pointerEnabled||a.navigator.msPointerEnabled,d.HAS_TOUCHEVENTS="ontouchstart"in a,d.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android|silk/i,d.NO_MOUSEEVENTS=d.HAS_TOUCHEVENTS&&a.navigator.userAgent.match(d.MOBILE_REGEX),d.EVENT_TYPES={},d.DIRECTION_DOWN="down",d.DIRECTION_LEFT="left",d.DIRECTION_UP="up",d.DIRECTION_RIGHT="right",d.POINTER_MOUSE="mouse",d.POINTER_TOUCH="touch",d.POINTER_PEN="pen",d.EVENT_START="start",d.EVENT_MOVE="move",d.EVENT_END="end",d.DOCUMENT=a.document,d.plugins=d.plugins||{},d.gestures=d.gestures||{},d.READY=!1,d.utils={extend:function(a,c,d){for(var e in c)a[e]!==b&&d||(a[e]=c[e]);return a},each:function(a,c,d){var e,f;if("forEach"in a)a.forEach(c,d);else if(a.length!==b){for(e=0,f=a.length;f>e;e++)if(c.call(d,a[e],e,a)===!1)return}else for(e in a)if(a.hasOwnProperty(e)&&c.call(d,a[e],e,a)===!1)return},hasParent:function(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1},getCenter:function(a){var b=[],c=[];return d.utils.each(a,function(a){b.push("undefined"!=typeof a.clientX?a.clientX:a.pageX),c.push("undefined"!=typeof a.clientY?a.clientY:a.pageY)}),{pageX:(Math.min.apply(Math,b)+Math.max.apply(Math,b))/2,pageY:(Math.min.apply(Math,c)+Math.max.apply(Math,c))/2}},getVelocity:function(a,b,c){return{x:Math.abs(b/a)||0,y:Math.abs(c/a)||0}},getAngle:function(a,b){var c=b.pageY-a.pageY,d=b.pageX-a.pageX;return 180*Math.atan2(c,d)/Math.PI},getDirection:function(a,b){var c=Math.abs(a.pageX-b.pageX),e=Math.abs(a.pageY-b.pageY);return c>=e?a.pageX-b.pageX>0?d.DIRECTION_LEFT:d.DIRECTION_RIGHT:a.pageY-b.pageY>0?d.DIRECTION_UP:d.DIRECTION_DOWN},getDistance:function(a,b){var c=b.pageX-a.pageX,d=b.pageY-a.pageY;return Math.sqrt(c*c+d*d)},getScale:function(a,b){return a.length>=2&&b.length>=2?this.getDistance(b[0],b[1])/this.getDistance(a[0],a[1]):1},getRotation:function(a,b){return a.length>=2&&b.length>=2?this.getAngle(b[1],b[0])-this.getAngle(a[1],a[0]):0},isVertical:function(a){return a==d.DIRECTION_UP||a==d.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(a,b){b&&a&&a.style&&(d.utils.each(["webkit","khtml","moz","Moz","ms","o",""],function(c){d.utils.each(b,function(b,d){c&&(d=c+d.substring(0,1).toUpperCase()+d.substring(1)),d in a.style&&(a.style[d]=b)})}),"none"==b.userSelect&&(a.onselectstart=function(){return!1}),"none"==b.userDrag&&(a.ondragstart=function(){return!1}))}},d.Instance=function(a,b){var e=this;return c(),this.element=a,this.enabled=!0,this.options=d.utils.extend(d.utils.extend({},d.defaults),b||{}),this.options.stop_browser_behavior&&d.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),d.event.onTouch(a,d.EVENT_START,function(a){e.enabled&&d.detection.startDetect(e,a)}),this},d.Instance.prototype={on:function(a,b){var c=a.split(" ");return d.utils.each(c,function(a){this.element.addEventListener(a,b,!1)},this),this},off:function(a,b){var c=a.split(" ");return d.utils.each(c,function(a){this.element.removeEventListener(a,b,!1)},this),this},trigger:function(a,b){b||(b={});var c=d.DOCUMENT.createEvent("Event");c.initEvent(a,!0,!0),c.gesture=b;var e=this.element;return d.utils.hasParent(b.target,e)&&(e=b.target),e.dispatchEvent(c),this},enable:function(a){return this.enabled=a,this}};var e=null,f=!1,g=!1;d.event={bindDom:function(a,b,c){var e=b.split(" ");d.utils.each(e,function(b){a.addEventListener(b,c,!1)})},onTouch:function(a,b,c){var h=this;this.bindDom(a,d.EVENT_TYPES[b],function(i){var j=i.type.toLowerCase();if(!j.match(/mouse/)||!g){j.match(/touch/)||j.match(/pointerdown/)||j.match(/mouse/)&&1===i.which?f=!0:j.match(/mouse/)&&!i.which&&(f=!1),j.match(/touch|pointer/)&&(g=!0);var k=0;f&&(d.HAS_POINTEREVENTS&&b!=d.EVENT_END?k=d.PointerEvent.updatePointer(b,i):j.match(/touch/)?k=i.touches.length:g||(k=j.match(/up/)?0:1),k>0&&b==d.EVENT_END?b=d.EVENT_MOVE:k||(b=d.EVENT_END),(k||null===e)&&(e=i),c.call(d.detection,h.collectEventData(a,b,h.getTouchList(e,b),i)),d.HAS_POINTEREVENTS&&b==d.EVENT_END&&(k=d.PointerEvent.updatePointer(b,i))),k||(e=null,f=!1,g=!1,d.PointerEvent.reset())}})},determineEventTypes:function(){var a;a=d.HAS_POINTEREVENTS?d.PointerEvent.getEvents():d.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],d.EVENT_TYPES[d.EVENT_START]=a[0],d.EVENT_TYPES[d.EVENT_MOVE]=a[1],d.EVENT_TYPES[d.EVENT_END]=a[2]},getTouchList:function(a){return d.HAS_POINTEREVENTS?d.PointerEvent.getTouchList():a.touches?a.touches:(a.identifier=1,[a])},collectEventData:function(a,b,c,e){var f=d.POINTER_TOUCH;return(e.type.match(/mouse/)||d.PointerEvent.matchType(d.POINTER_MOUSE,e))&&(f=d.POINTER_MOUSE),{center:d.utils.getCenter(c),timeStamp:(new Date).getTime(),target:e.target,touches:c,eventType:b,pointerType:f,srcEvent:e,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return d.detection.stopDetect()}}}},d.PointerEvent={pointers:{},getTouchList:function(){var a=this,b=[];return d.utils.each(a.pointers,function(a){b.push(a)}),b},updatePointer:function(a,b){return a==d.EVENT_END?this.pointers={}:(b.identifier=b.pointerId,this.pointers[b.pointerId]=b),Object.keys(this.pointers).length},matchType:function(a,b){if(!b.pointerType)return!1;var c=b.pointerType,e={};return e[d.POINTER_MOUSE]=c===b.MSPOINTER_TYPE_MOUSE||c===d.POINTER_MOUSE,e[d.POINTER_TOUCH]=c===b.MSPOINTER_TYPE_TOUCH||c===d.POINTER_TOUCH,e[d.POINTER_PEN]=c===b.MSPOINTER_TYPE_PEN||c===d.POINTER_PEN,e[a]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},d.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(a,b){this.current||(this.stopped=!1,this.current={inst:a,startEvent:d.utils.extend({},b),lastEvent:!1,name:""},this.detect(b))},detect:function(a){if(this.current&&!this.stopped){a=this.extendEventData(a);var b=this.current.inst.options;return d.utils.each(this.gestures,function(c){return this.stopped||b[c.name]===!1||c.handler.call(c,a,this.current.inst)!==!1?void 0:(this.stopDetect(),!1)},this),this.current&&(this.current.lastEvent=a),a.eventType==d.EVENT_END&&!a.touches.length-1&&this.stopDetect(),a}},stopDetect:function(){this.previous=d.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(a){var b=this.current.startEvent;!b||a.touches.length==b.touches.length&&a.touches!==b.touches||(b.touches=[],d.utils.each(a.touches,function(a){b.touches.push(d.utils.extend({},a))}));var c,e,f=a.timeStamp-b.timeStamp,g=a.center.pageX-b.center.pageX,h=a.center.pageY-b.center.pageY,i=d.utils.getVelocity(f,g,h);return"end"===a.eventType?(c=this.current.lastEvent&&this.current.lastEvent.interimAngle,e=this.current.lastEvent&&this.current.lastEvent.interimDirection):(c=this.current.lastEvent&&d.utils.getAngle(this.current.lastEvent.center,a.center),e=this.current.lastEvent&&d.utils.getDirection(this.current.lastEvent.center,a.center)),d.utils.extend(a,{deltaTime:f,deltaX:g,deltaY:h,velocityX:i.x,velocityY:i.y,distance:d.utils.getDistance(b.center,a.center),angle:d.utils.getAngle(b.center,a.center),interimAngle:c,direction:d.utils.getDirection(b.center,a.center),interimDirection:e,scale:d.utils.getScale(b.touches,a.touches),rotation:d.utils.getRotation(b.touches,a.touches),startEvent:b}),a},register:function(a){var c=a.defaults||{};return c[a.name]===b&&(c[a.name]=!0),d.utils.extend(d.defaults,c,!0),a.index=a.index||1e3,this.gestures.push(a),this.gestures.sort(function(a,b){return a.index<b.index?-1:a.index>b.index?1:0}),this.gestures}},d.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,correct_for_drag_min_distance:!0,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(a,b){if(d.detection.current.name!=this.name&&this.triggered)return b.trigger(this.name+"end",a),void(this.triggered=!1);if(!(b.options.drag_max_touches>0&&a.touches.length>b.options.drag_max_touches))switch(a.eventType){case d.EVENT_START:this.triggered=!1;break;case d.EVENT_MOVE:if(a.distance<b.options.drag_min_distance&&d.detection.current.name!=this.name)return;if(d.detection.current.name!=this.name&&(d.detection.current.name=this.name,b.options.correct_for_drag_min_distance&&a.distance>0)){var c=Math.abs(b.options.drag_min_distance/a.distance);d.detection.current.startEvent.center.pageX+=a.deltaX*c,d.detection.current.startEvent.center.pageY+=a.deltaY*c,a=d.detection.extendEventData(a)}(d.detection.current.lastEvent.drag_locked_to_axis||b.options.drag_lock_to_axis&&b.options.drag_lock_min_distance<=a.distance)&&(a.drag_locked_to_axis=!0);var e=d.detection.current.lastEvent.direction;a.drag_locked_to_axis&&e!==a.direction&&(d.utils.isVertical(e)?a.direction=a.deltaY<0?d.DIRECTION_UP:d.DIRECTION_DOWN:a.direction=a.deltaX<0?d.DIRECTION_LEFT:d.DIRECTION_RIGHT),this.triggered||(b.trigger(this.name+"start",a),this.triggered=!0),b.trigger(this.name,a),b.trigger(this.name+a.direction,a),(b.options.drag_block_vertical&&d.utils.isVertical(a.direction)||b.options.drag_block_horizontal&&!d.utils.isVertical(a.direction))&&a.preventDefault();break;case d.EVENT_END:this.triggered&&b.trigger(this.name+"end",a),this.triggered=!1}}},d.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(a,b){switch(a.eventType){case d.EVENT_START:clearTimeout(this.timer),d.detection.current.name=this.name,this.timer=setTimeout(function(){"hold"==d.detection.current.name&&b.trigger("hold",a)},b.options.hold_timeout);break;case d.EVENT_MOVE:a.distance>b.options.hold_threshold&&clearTimeout(this.timer);break;case d.EVENT_END:clearTimeout(this.timer)}}},d.gestures.Release={name:"release",index:1/0,handler:function(a,b){a.eventType==d.EVENT_END&&b.trigger(this.name,a)}},d.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_min_touches:1,swipe_max_touches:1,swipe_velocity:.7},handler:function(a,b){if(a.eventType==d.EVENT_END){if(b.options.swipe_max_touches>0&&a.touches.length<b.options.swipe_min_touches&&a.touches.length>b.options.swipe_max_touches)return;(a.velocityX>b.options.swipe_velocity||a.velocityY>b.options.swipe_velocity)&&(b.trigger(this.name,a),b.trigger(this.name+a.direction,a))}}},d.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(a,b){if(a.eventType==d.EVENT_END&&"touchcancel"!=a.srcEvent.type){var c=d.detection.previous,e=!1;if(a.deltaTime>b.options.tap_max_touchtime||a.distance>b.options.tap_max_distance)return;c&&"tap"==c.name&&a.timeStamp-c.lastEvent.timeStamp<b.options.doubletap_interval&&a.distance<b.options.doubletap_distance&&(b.trigger("doubletap",a),e=!0),e&&!b.options.tap_always||(d.detection.current.name="tap",b.trigger(d.detection.current.name,a))}}},d.gestures.Touch={name:"touch",index:-(1/0),defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(a,b){return b.options.prevent_mouseevents&&a.pointerType==d.POINTER_MOUSE?void a.stopDetect():(b.options.prevent_default&&a.preventDefault(),void(a.eventType==d.EVENT_START&&b.trigger(this.name,a)))}},d.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(a,b){if(d.detection.current.name!=this.name&&this.triggered)return b.trigger(this.name+"end",a),void(this.triggered=!1);if(!(a.touches.length<2))switch(b.options.transform_always_block&&a.preventDefault(),
a.eventType){case d.EVENT_START:this.triggered=!1;break;case d.EVENT_MOVE:var c=Math.abs(1-a.scale),e=Math.abs(a.rotation);if(c<b.options.transform_min_scale&&e<b.options.transform_min_rotation)return;d.detection.current.name=this.name,this.triggered||(b.trigger(this.name+"start",a),this.triggered=!0),b.trigger(this.name,a),e>b.options.transform_min_rotation&&b.trigger("rotate",a),c>b.options.transform_min_scale&&(b.trigger("pinch",a),b.trigger("pinch"+(a.scale<1?"in":"out"),a));break;case d.EVENT_END:this.triggered&&b.trigger(this.name+"end",a),this.triggered=!1}}},"function"==typeof define&&define.amd?define(function(){return d}):"object"==typeof module&&module.exports?module.exports=d:a.Hammer=d}(window);var JSandbox=function(a){var b="undefined",c=a.document,d=a.Worker;if(typeof d!==b){for(var e="eval",f="exec",g="load",h="requests",i="input",j="terminate",k="data",l="callback",m="onerror",n="worker",o="onresponse",p="prototype",q="call",r="string",s="function",t=function(){var a=this;if(!(a instanceof t))return new t;try{a[n]=new d(t.url)}catch(b){"SecurityError"===b.name&&(a[n]=new d(window.URL.createObjectURL(new Blob(["("+z.toString()+"(self,eval))"],{type:"text/javascript"}))))}a[h]={},a[n].onmessage=function(b){var c,d=b[k];if("object"==typeof d){if("log"==d.id)return void console.log(d.message);c=a[h][d.id],c&&(d.error?(typeof a[m]===s&&a[m](d,c),typeof c[m]===s&&c[m][q](a,d.error)):(typeof a[o]===s&&a[o](d,c),typeof c[l]===s&&c[l][q](a,d.results)),delete a[h][d.id])}}},u=t[p],v=function(a){u[a]=function(b,c,d,e){(typeof b===r||"[object Array]"===Object[p].toString[q](b)||arguments.length>1)&&(b={data:b,input:d,callback:c,onerror:e}),a===g&&typeof b[k]===r&&(b[k]=[b[k]]);var f=b[k],j=this.createRequestID();return d=b[i],delete b[k],delete b[i],this[h][j]=b,this[n].postMessage({id:j,method:a,data:f,input:d}),j},t[a]=function(){var b=new t;return b[o]=b[m]=function(){b[j](),b=null},t[p][a].apply(b,Array[p].slice[q](arguments)),t}},w=[e,g,f],x=3;x--;)v(w[x]);if(u[j]=function(){this[h]={},this[n].onmessage=null,this[n][j]()},u.abort=function(a){delete this[h][a]},u.createRequestID=function(){var a=Math.random().toString();return a in this[h]?this.createRequestID():a},typeof c!==b){var y=c.getElementsByTagName("link");for(x=y.length;x--;)if("jsandbox"===y[x].getAttribute("rel")){t.url=y[x].getAttribute("href");break}}var z=function(a,b){"use strict";var c=a.postMessage,d=a.importScripts,e="message",f=function(e){var f=e.data,g={};g.id=f.id;var h=f.data;a.input=f.input||{};try{switch(f.method){case"eval":g.results=b(h);break;case"exec":d("data:application/javascript,"+encodeURIComponent(h));break;case"load":d.apply(a,h)}}catch(i){g.code=i.message,g.error=i.stack,g.line=i.lineNumber,g.fileName=i.fileName}delete a.input;try{delete a.onmessage}catch(i){}c(g)};a.addEventListener?a.addEventListener(e,f,!1):a.attachEvent&&a.attachEvent("on"+e,f),a.window=a,a.console={log:function(a){c({id:"log",message:a})}},a.Worker=a.addEventListener=a.removeEventListener=a.importScripts=a.XMLHttpRequest=a.postMessage=a.attachEvent=a.detachEvent=a.ActiveXObject=void 0};return t.url||(t.url=window.URL.createObjectURL(new Blob(["("+z.toString()+"(self,eval))"],{type:"text/javascript"}))),t}}(self),Sandbox=JSandbox;if(function(a){var b=function(){};b.zoomIn=function(a,b,c,d){var e={TransformOriginX:b.RS*c+"px",TransformOriginY:b.RS*d+"px",Transform:"scale(0)",webkitTransition:"-webkit-transform 0.2s",mozTransition:"-moz-transform 0.2s;",transition:"transform 0.2s;"};for(var f in e)f.match(/^[a-z]/)&&(a.style[f]=e[f]),["webkit","moz","ms",null].forEach(function(b){a.style[b?b+f:f.charAt(0).toLowerCase()+f.slice(1)]=e[f]});setTimeout(function(){a.style.webkitTransform="",a.style.msTransform="",a.style.mozTransform="",a.style.transform=""},10)};var c=function(a){return-3>a?-1:a>3?1:a*(27+a*a)/(27+9*a*a)};b.create=function(a,d,e,f,g){"undefined"==typeof a.supports_use&&!function(){a.supports_use=!0}();var h=0,i={x:d,y:e};g||(g={});var j="ontouchstart"in window?3*(g.size||10)/a.zoom:2*(g.size||10)/a.zoom,k=(g.size||10)/a.zoom;"ontouchstart"in window&&(k*=1.4);var l=f?2*Math.PI/f.length:0,m=new b,n=[];if(m.container=a.group(),window.MutationObserver||window.webkitMutationObserver||window.MozMutationObserver){var o=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,p=new o(function(a){a.forEach(function(a){"childList"==a.type&&null!==m.container.nextSibling&&m.container.parentNode.appendChild(m.container)})});p.observe(a,{childList:!0}),m.observer=p}var q=null,r=function(b){b.preventDefault(),b.stopPropagation();var c=a.createSVGRect(),d=a.getBoundingClientRect();c.x=b.touches[0].clientX-d.left,c.y=b.touches[0].clientY-d.top,c.width=c.height=1;for(var e,f=a.getIntersectionList(c,null),g=0;!e&&g<f.length;g++)f[g].move_func&&(e=f[g]);e&&(null!==q&&e!==q&&q.moveout_func&&q.moveout_func(),e.move_func&&(e.move_func(b),q=e))};return a.addEventListener("touchmove",r,!0),a.addEventListener("touchend",function(b){q&&q.end_func&&(q.end_func(),b.stopPropagation()),a.removeEventListener("touchmove",r,!0),a.removeEventListener("touchend",arguments.callee)},!1),(f||[]).forEach(function(m){var o,p;if(o=i.x+j*Math.cos(h*l),p=i.y+1.3*j*Math.sin(h*l),g.ellipse){var q=f.length-5;0>q&&(q=0);var r=-1*(Math.PI/3+(7/18*Math.PI-Math.PI/3)*c(q*q/100)),s=1+q/6,t=1+q/15;o=i.x+j*t*Math.cos(h*l)*Math.cos(r)-j*s*Math.sin(h*l)*Math.sin(r),p=i.y+j*t*Math.cos(h*l)*Math.sin(r)+j*s*Math.sin(h*l)*Math.cos(r)}h++;var u=a.circle(o,p,k);u.setAttribute("fill","#eed"),u.setAttribute("stroke","#eee"),u.setAttribute("stroke-width",1.5*a.RS/a.zoom),b.zoomIn(u,a,d,e),n.push(u);var v=m.symbol;if("string"==typeof v)if(v.match(/^#[0123456789ABCDEF]{3,6}$/)||v.match(/^url/))u.setAttribute("fill",v);else if(v.match(/^(:?https?:)?\/?.*#/)){var w=a.group(),x=a.group();w.push(x);var y=a.use(v,0,0,100,100),z=.8;x.setAttribute("transform","translate("+(o-z*k)*a.RS+","+(p-z*k)*a.RS+") scale("+z*k+")"),x.push(y),w.setAttribute("pointer-events","none"),n.push(w)}else{v=a.text_circle(o,p,k,v);var w=a.group();w.push(v),n.push(w),w.setAttribute("pointer-events","none")}else if(v){var w=a.group(),x=a.group();x.setAttribute("transform","translate("+o*a.RS+","+p*a.RS+") scale("+.75*k+")"),x.push(v),w.push(x),n.push(w),w.setAttribute("pointer-events","none")}if(m.text){v=a.text_circle(o,p,.8*k,m.text,{stretch:o>i.x+k?"right":Math.abs(o-i.x)<k?!0:"left",weight:"normal",fill:"#000"});var w=a.group();w.push(v),n.push(w),w.setAttribute("pointer-events","none"),u.setAttribute("opacity","0.5")}u.move_func=function(a){this.setAttribute("stroke","#0f0"),m.hover_function&&m.hover_function(),a.stopPropagation()},u.end_func=function(a){m.select_function&&m.select_function()},u.moveout_func=function(a){this.setAttribute("stroke","#eee")},u.addEventListener("mouseover",u.move_func,!0),u.addEventListener("mouseup",u.end_func),u.addEventListener("mouseout",u.moveout_func)}),m.elements=n,m.elements.forEach(function(c){b.zoomIn(c,a,d,e),m.container.push(c)}),m},b.prototype.destroy=function(){var a=this;this.elements&&(this.observer&&this.observer.disconnect(),this.elements.forEach(function(a){if(a.setAttribute&&a.setAttribute("pointer-events","none"),a.style){var b="scale(0)";a.style.webkitTransform=b,a.style.msTransform=b,a.style.mozTransform=b,a.style.transform=b}setTimeout(function(){a&&a.parentNode&&a.parentNode.removeChild(a)},750)}),this.elements=[]),setTimeout(function(){a.container&&a.container.parentNode&&a.container.parentNode.removeChild(a.container)},1e3)},a.PieMenu=b}(window),"undefined"==typeof MASCP){MASCP={};var ie=function(){var a,b=3,c=document.createElement("div"),d=c.getElementsByTagName("i");do c.innerHTML="<!--[if gt IE "+ ++b+"]><i></i><![endif]-->";while(d[0]);return b>4?b:a}();ie&&(7===ie&&(MASCP.IE=!0,MASCP.IE7=!0),8===ie&&(MASCP.IE=!0,MASCP.IE8=!0))}MASCP.registerGroup=function(a,b){if(this.groups||(this.groups={}),!this.groups[a]){var c=new MASCP.Group;if(c.name=a,b=b||{},b.hide_member_controllers&&(c.hide_member_controllers=!0),b.hide_group_controller&&(c.hide_group_controller=!0),b.fullname&&(c.fullname=b.fullname),b.color&&(c.color=b.color),b.group){if(c.group=this.getGroup(b.group),!c.group)throw"Cannot register this layer with the given group - the group has not been registered yet";c.group._layers.push(c)}return c._layers=[],c.group_id=(new Date).getMilliseconds(),this.groups[a]=c,bean.fire(MASCP,"groupRegistered",[c]),c}},MASCP.registerLayer=function(a,b,c){this.layers||(this.layers={}),c||(c=[]);var d;if(this.layers[a]&&((this.layers[a].disabled||c.length>0)&&(this.layers[a].disabled=!1,bean.fire(MASCP,"layerRegistered",[this.layers[a]].concat(c))),d=this.layers[a]),d&&b.group&&(d.group!==this.getGroup(b.group)&&(d.group=this.getGroup(b.group),d.group._layers.push(d)),!d.group))throw"Cannot register this layer with the given group - the group has not been registered yet";if(d)return d;if(d=new MASCP.Layer,d.name=a,b=b||{},b.fullname&&(d.fullname=b.fullname),b.color&&(d.color=b.color),b.data&&(d.data=b.data),d&&b.group){if(d.group=this.getGroup(b.group),!d.group)throw"Cannot register this layer with the given group - the group has not been registered yet";d.group._layers.push(d)}return this.layers[a]=d,b.css&&console.log("options.css is deprecated"),d.layer_id=(new Date).getMilliseconds(),bean.fire(MASCP,"layerRegistered",[d].concat(c)),d},MASCP.Group=function(){},MASCP.Group.prototype.size=function(){for(var a=0,b=0;b<this._layers.length;b++)this._layers[b].disabled||(a+=1);return a},MASCP.Group.prototype.eachLayer=function(a){for(var b=0;b<this._layers.length;b++)this._layers[b].disabled||a.call(this._layers[b],this._layers[b])},MASCP.Layer=function(){},MASCP.SequenceRenderer=function(){var a=function(a){var b=[],c={getTrackOrder:function(){return b},setTrackOrder:function(c){var d=[],e=c;!e instanceof Array&&(e=[c]);for(var f=0;f<e.length;f++){var g=e[f];if(MASCP.getLayer(g)){for(;d.indexOf(g)>=0;)d.splice(d.indexOf(g),1);d.push(g)}else MASCP.getGroup(g)&&MASCP.getGroup(e[f]).eachLayer(function(a){for(;d.indexOf(a.name)>=0;)d.splice(d.indexOf(a.name),1);e.splice(f+1,0,a.name)})}for(f=(b||[]).length-1;f>=0;f--)d.indexOf(b[f])<0&&(this.hideLayer(b[f]),this.hideGroup(b[f]),MASCP.getLayer(b[f])&&bean.fire(MASCP.getLayer(b[f]),"removed",[a]),MASCP.getGroup(b[f])&&bean.fire(MASCP.getGroup(b[f]),"removed",[a]));b=d,this.refresh&&this.refresh(!0),bean.fire(a,"orderChanged",[d])}};MASCP.IE&&(a.setTrackOrder=c.setTrackOrder),"function"!=typeof Object.defineProperty||MASCP.IE8||Object.defineProperty(a,"trackOrder",{get:c.getTrackOrder,set:c.setTrackOrder})};return function(b){return b?("undefined"!=typeof b&&(this._container=b,this._container.style.position||(this._container.style.position="relative"),bean.add(this,"sequenceChange",function(a){for(;b.firstChild;)b.removeChild(b.firstChild);this._sequence_els.forEach(function(a){b.appendChild(a)});var c=document.createElement("div");c.setAttribute("style","clear: both; float: none; height: 0px; width: 100%;"),b.appendChild(c),b.style.width=this._sequence_els.length+"em"}),this.setSequence(b.textContent||"")),a(this),this):this}}(),MASCP.SequenceRenderer.prototype={sequence:null},MASCP.IE&&(MASCP.SequenceRenderer.prototype.prototype=document.createElement("div")),MASCP.SequenceRenderer.prototype.setSequence=function(a){this.sequence=this._cleanSequence(a);var b=[],c=this;if(this.sequence){for(var d=this.sequence.split(""),e=0;e<d.length;e++){var f=d[e];if(f.match(/[A-Za-z]/)){var g=document.createElement("span");g.textContent=f,b.push(g)}}b.forEach(function(a,b){a._index=b,a.style.display="block",a.style.cssFloat="left",a.style.styleFloat="left",a.style.height="1.1em",a.style.position="relative",a.addToLayer=MASCP.SequenceRenderer.addElementToLayer,a.addBoxOverlay=MASCP.SequenceRenderer.addBoxOverlayToElement,a.addToLayerWithLink=MASCP.SequenceRenderer.addElementToLayerWithLink,a._renderer=c}),this._sequence_els=b,bean.fire(this,"sequenceChange")}},MASCP.SequenceRenderer.prototype.colorResidues=function(a,b){var c=Math.floor(1e3*Math.random()).toString();MASCP.registerLayer(c,{color:b||"#ff0000"});for(var d=this.getAminoAcidsByPosition(a),e=0;e<d.length;e++)d[e].addToLayer(c);return MASCP.getLayer(c)},MASCP.SequenceRenderer.prototype._cleanSequence=function(a){if(!a)return a;var b=a;return b=b.replace(new RegExp(String.fromCharCode(160),"g"),""),b=b.replace(/[\n\t\s\d]+/gim,""),b=b.replace(/\(.*\)/g,"")},MASCP.SequenceRenderer.prototype.getAminoAcidsByPosition=function(a){var b=this._sequence_els;return a.map(function(a){return 0>a?null:b[a-1]})},MASCP.SequenceRenderer.prototype.getAA=function(a){return this.getAminoAcidsByPosition([a]).shift()},MASCP.SequenceRenderer.prototype.getAminoAcidsByPeptide=function(a){var b=this.sequence.indexOf(a),c=[];return 0>b?(c.addToLayer=function(){},c):(c=c.concat(this._sequence_els.slice(b,b+a.length)),c.length?c.addToLayer=function(a,b,d){return c[0].addBoxOverlay(a,c.length,b,d)}:c.addToLayer=function(){},c)},MASCP.SequenceRenderer.prototype.toggleLayer=function(a,b){var c=a;return"string"!=typeof a?c=a.name:a=MASCP.layers[a],this._container.classList.toggle(c+"_active"),this._container.classList.toggle(c+"_inactive"),b||bean.fire(a,"visibilityChange",[this,this.isLayerActive(a)]),this},MASCP.SequenceRenderer.prototype.showLayer=function(a,b){var c=MASCP.getLayer(a);if(c&&!c.disabled)return this._container.classList.add(c.name+"_active"),this._container.classList.add("active_layer"),this._container.classList.remove(c.name+"_inactive"),b||bean.fire(c,"visibilityChange",[this,!0]),this},MASCP.SequenceRenderer.prototype.hideLayer=function(a,b){var c=MASCP.getLayer(a);if(c&&!c.disabled)return this._container.classList.remove(c.name+"_active"),this._container.classList.remove("active_layer"),this._container.classList.add(c.name+"_inactive"),b||bean.fire(c,"visibilityChange",[this,!1]),this},MASCP.SequenceRenderer.prototype.registerLayer=function(a,b){return MASCP.registerLayer(a,b)},MASCP.SequenceRenderer.prototype.setGroupVisibility=function(a,b,c){var d=MASCP.getGroup(a);if(d){var e=(d.name,this);d.eachLayer(function(a){return MASCP.getGroup(a)!==a?this.disabled&&b?void e.hideLayer(a.name):void(b===!0?e.showLayer(a.name):b===!1?e.hideLayer(a.name):e.toggleLayer(a.name)):void 0}),null===b||c||bean.fire(d,"visibilityChange",[e,b])}},MASCP.SequenceRenderer.prototype.hideGroup=function(a,b){this.setGroupVisibility(a,!1,b)},MASCP.SequenceRenderer.prototype.showGroup=function(a,b){this.setGroupVisibility(a,!0,b)},MASCP.SequenceRenderer.prototype.toggleGroup=function(a,b){this.setGroupVisibility(a,b)},MASCP.SequenceRenderer.prototype.isLayerActive=function(a){var b=a;return"string"!=typeof a&&(b=a.name),!a.disabled&&this._container.classList.contains(b+"_active")},MASCP.SequenceRenderer.prototype._setHighlight=function(a,b){},MASCP.SequenceRenderer.prototype.createLayerController=function(){console.log("createLayerController is deprected")},MASCP.SequenceRenderer.prototype.createLayerCheckbox=function(a,b,c){console.log("createLayerCheckbox is deprecated")},MASCP.getLayer=function(a){return MASCP.layers?"string"==typeof a?MASCP.layers[a]:a:void 0},MASCP.getGroup=function(a){return"undefined"!=typeof a&&MASCP.groups?"string"==typeof a?MASCP.groups[a]:a==MASCP.groups[a.name]?a:null:void 0},MASCP.SequenceRenderer.prototype._removeOtherBindings=function(a,b){for(var c=this,d=0;d<b._current_bindings.length;d++)if(b._current_bindings[d].renderer==c){var e=b._current_bindings[d];e.layer&&e.layer!=a.name&&(bean.remove(MASCP.getLayer(e.layer),"visibilityChange",e.object_function),bean.remove(b,"change",e.input_function)),e.group&&e.group!=a.name&&(bean.remove(MASCP.getGroup(e.group),"visibilityChange",e.object_function),bean.remove(b,"change",e.input_function)),e.group=null,e.layer=null}},MASCP.SequenceRenderer.prototype.createGroupCheckbox=function(a,b,c){console.log("createGroupCheckbox is deprecated")},MASCP.SequenceRenderer.prototype.createGroupController=function(a,b){var c=MASCP.getLayer(a),d=MASCP.getGroup(b),e=this;bean.add(c,"visibilityChange",function(a,b){a==e&&(e.setGroupVisibility(d,b),e.refresh())})},MASCP.SequenceRenderer.addElementToLayer=function(a){return this.addBoxOverlay(a,1),this},MASCP.SequenceRenderer.addElementToLayerWithLink=function(a,b,c){this.classList.add(a);var d=document.createElement("a");for(d.setAttribute("href",b),d.classList.add(a+"_overlay"),d.setAttribute("style","display: box; left: 0px; top: 0px; width: 100%; position: absolute; height: 100%;"),d.textContent="&nbsp;",this.appendChild(d);c&&c>0;)this._renderer._sequence_els[this._index+c].addToLayerWithLink(a,b),c-=1;return this._z_indexes&&this._z_indexes[a]&&(d.style.zIndex=this._z_indexes[a]),this},MASCP.SequenceRenderer.addBoxOverlayToElement=function(a,b,c){"undefined"==typeof c&&(c=1),this.classList.add(a);var d=document.createElement("div");for(d.classList.add(a+"_overlay"),d.setAttribute("style","top: 0px; width: 100%; position: absolute; height: 100%; opacity:"+c+";"),this.appendChild(d);b&&b>1;)this._renderer._sequence_els[this._index+b-1].addBoxOverlay(a,0,c),b-=1;this._z_indexes&&this._z_indexes[a]&&(d.style.zIndex=this._z_indexes[a]);for(var e=["mouseover","mousedown","mousemove","mouseout","click","dblclick","mouseup","mouseenter","mouseleave"],f=0;f<e.length;f++)bean.add(d,e[f],function(){return function(b){bean.fire(MASCP.getLayer(a),b.type,[b,"SequenceRenderer"])}}(f));return this},MASCP.SequenceRenderer.prototype.reset=function(){for(;this._container.classList.length>0;)this._container.classList.remove(this._container.classList.item(0));for(var a in MASCP.groups)MASCP.groups.hasOwnProperty(a)&&this.hideGroup(a);for(var b in MASCP.layers)MASCP.layers.hasOwnProperty(b)&&(this.hideLayer(b,!0),MASCP.layers[b].disabled=!0);delete this._scalers,delete this.forceTrackAccs,this.resetAnnotations&&this.resetAnnotations()},MASCP.SequenceRenderer.prototype.withoutRefresh=function(a){var b=this.refresh;this.refresh=function(){},this.refresh.suspended=!0,a.apply(this),this.refresh=b},MASCP.SequenceRenderer.prototype.refresh=function(){var a=-2;this._z_indexes||(this._z_indexes={});for(var b=0;b<(this.trackOrder||[]).length;b++)this.isLayerActive(this.trackOrder[b])&&(Array.prototype.slice.call(document.querySelectorAll("."+this.trackOrder[b]+"_overlay")).forEach(function(b){b.style.zIndex=a}),this._z_indexes[this.trackOrder[b]]=a,a-=1)},MASCP.SequenceRenderer.prototype.bind=function(a,b){bean.add(this,a,b)},MASCP.SequenceRenderer.prototype.unbind=function(a,b){bean.remove(this,a,b)},MASCP.SequenceRenderer.prototype.trigger=function(a,b){bean.fire(this,a,b)};var SVGCanvas=SVGCanvas||function(){function b(a,b){var c,d,e,h,j;a.visibility=function(){for(var b="hidden",c=0;c<a.length;c++)if(!Array.isArray(a[c])&&(j=a[c].getAttribute("visibility"),j&&"hidden"!=j)){b=j;break}return b},a.currenty=function(){var b,c=a.filter(function(a){return!Array.isArray(a)});return c[0]&&c[0].getAttribute("transform")&&(b=/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/.exec(c[0].getAttribute("transform")),null!==b&&"undefined"!=typeof b&&(b=b[2])),a[0]?parseInt(b||a[0].getAttribute("y")||0,10):0},a.animate=function(c){if("undefined"==typeof c.y)return void l(c);if(0!==a.length){var d,e={};for(d in c)c.hasOwnProperty(d)&&(e[d]=c[d]);if(k(),a.animating)for(var g=0;g<(f||[]).length;g++)f[g].target_set==a&&(a.animating=!1,f.splice(g,1));var h=a.visibility(),j=e.visibility;if(h==j&&"hidden"==j)return void l(c);var m=a.currenty();if(isNaN(parseInt(m,10)))return void console.log("Have a NaN y value, skipping");var n=parseInt(e.y,10);delete e.y,h==j&&"visible"==j&&(delete e.visibility,j=null,l({visibility:"visible"})),"hidden"==e.visibility&&delete e.visibility,l(e);var o=0;if(n!=m){var p=1*(Math.abs(parseInt((n-m)/(50*b),10)/i)+1),q=(n-m)/p;e.y=m||0;arguments.callee;a.animating=!0,e.y=m+1*q,f.push(function(b){return 0>q&&e.y<n&&(e.y=n),q>0&&e.y>n&&(e.y=n),l(e),o+=b||1,e.y!=n?void(e.y=m+q*(o+1)):(a.animating=!1,j&&l({visibility:j}),void f.splice(f.indexOf(arguments.callee),1))}),f[f.length-1].target_set=a}}},a.attr=function(a){return g?this.animate(a):l(a)};var l=function(b){var f,g={};for(f in b)b.hasOwnProperty(f)&&(g[f]=b[f]);a.visibility(),parseInt(g.y,10);h=g.visibility;for(f in g)if(g.hasOwnProperty(f))for(var i=0;i<a.length;i++)if(a[i]&&!Array.isArray(a[i])&&"none"!=a[i].style.display){var j=g[f];if("style"==f&&a[i].hasAttribute("style")){var k=a[i].getAttribute("style");k+="; "+g[f],j=k}var l=a[i].hasAttribute("transform")&&a[i].getAttribute("transform").indexOf("translate")>=0;if("height"==f&&a[i].setHeight?a[i].setHeight(g[f]):(!l||"y"!=f&&"x"!=f)&&a[i].setAttribute(f,j),"y"==f&&a[i].hasAttribute("d")){var m=a[i].getAttribute("d"),n=/M\s*([\d\.]+) ([\d\.]+)/;if(m=m.replace(n,""),isNaN(parseInt(j,10)))throw"Error "+f+" is "+g[f];a[i].setAttribute("d","M0 "+parseInt(j,10)+" "+m)}if("y"==f&&a[i].hasAttribute("cy")&&a[i].setAttribute("cy",g[f]),"y"==f&&a[i].hasAttribute("transform")){if(e=a[i].getAttribute("transform"),c=/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)?\)/.exec(a[i].getAttribute("transform")),null===c)continue;c=c[1],e=e.replace(/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)?\)/,"translate("+c+","+j+")"),a[i].setAttribute("transform",e)}if("x"==f&&a[i].hasAttribute("transform")){if(e=a[i].getAttribute("transform"),d=/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/.exec(a[i].getAttribute("transform")),null===d)continue;d=d[2],e=e.replace(/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/,"translate("+j+","+d+")"),a[i].setAttribute("transform",e)}"text-anchor"==f&&a[i].hasAttribute("style")&&(a[i].style.textAnchor=g[f])}};return a.hide=function(){this.attr({visibility:"hidden"})},a.show=function(){this.attr({visibility:"visible"})},a.refresh_zoom=function(){for(var b=0;b<a.length;b++)Array.isArray(a[b])||(a[b].zoom_level&&"text"==a[b].zoom_level&&(a[b].ownerSVGElement&&a[b].ownerSVGElement.zoom>3.5?(a[b].setAttribute("display","inline"),a[b].setAttribute("opacity",1)):a[b].setAttribute("display","none")),a[b].zoom_level&&"summary"==a[b].zoom_level&&(a[b].ownerSVGElement&&a[b].ownerSVGElement.zoom<=3.5?(a[b].setAttribute("display","inline"),a[b].setAttribute("opacity",1)):a[b].setAttribute("display","none")))},a}var c=[],d=1,e="http://www.w3.org/2000/svg",f=null,g=!1,h=null,i=75,j=null,k=function(){null===f?f=[]:(f.forEach(function(a){a._last_step=null}),clearInterval(h)),g||(c.forEach(function(a){bean.fire(a,"_anim_begin")}),g=!0);var a=null;h=setInterval(function(){if(!f||0===f.length)return clearInterval(h),h=null,f=null,g=!1,void c.forEach(function(a){bean.fire(a,"_anim_end")});var b=[];c.forEach(function(a){b.push(a.suspendRedraw(5e3))});var d=(new Date).getTime();a||(a=(new Date).getTime());for(var e=0;e<(f||[]).length;e++){var l=(new Date).getTime(),m=parseInt((l-a)/i,10);null===j&&m-f[e]._last_step>2&&(j=Math.round(1.6*i)),f[e].apply(null,[m-(f[e]._last_step||m)]),f&&f[e]&&(f[e]._last_step=m)}var n=(new Date).getTime();c.forEach(function(a){a.unsuspendRedraw(b.shift())});var o=n-d;i>o&&null===j&&o>=1?(i=Math.round(1.5*(n-d)),k()):null!==j&&j!=i&&(i=j,k())},i)},l=/scale\((-?\d+\.?\d*)\)/,m=function(a){var b=this.getAttribute("transform").toString(),c=l.exec(b),d=parseFloat(this.getAttribute("height")||1),e=1;return null===c?(b+=" scale(1) ",c=1):c=parseFloat(c[1]),e=parseFloat(a)/d*c,b=b.replace(l,"scale("+e+")"),this.setAttribute("transform",b),this.setAttribute("height",a),e};return function(f){var g=f.RS||d;f.RS=g,f.font_order="Helvetica, Verdana, Arial, Sans-serif",c.push(f),f.makeEl=function(a,b){var c=f.ownerDocument.createElementNS(e,a);for(var d in b)b.hasOwnProperty(d)&&c.setAttribute(d,b[d]);return c},f.make_gradient=function(a,b,c,d,e){for(var f=this.makeEl("linearGradient",{id:a,x1:"0%",x2:b,y1:"0%",y2:c}),g=d.length;d.length>0;){var h=Math.round((g-d.length)/g*100),i=d.shift(),j=e.shift();f.appendChild(this.makeEl("stop",{offset:h+"%",style:"stop-color:"+i+";stop-opacity:"+j}))}return f},f.path=function(a){var b=document.createElementNS(e,"path");return b.setAttribute("d",a),b.setAttribute("stroke","#000000"),b.setAttribute("stroke-width","1"),this.appendChild(b),b},f.poly=function(a){var b=document.createElementNS(e,"polygon");return b.setAttribute("points",a),this.appendChild(b),b},f.circle=function(a,b,c){var d=document.createElementNS(e,"circle");return d.setAttribute("cx","string"==typeof a?a:a*g),d.setAttribute("cy","string"==typeof b?b:b*g),d.setAttribute("r","string"==typeof c?c:c*g),d.move=function(a){d.setAttribute("cx",a*g)},this.appendChild(d),d},f.group=function(){var a=document.createElementNS(e,"g");return this.appendChild(a),a.push=function(b){a.appendChild(b)},a},f.clipPath=function(){var a=document.createElementNS(e,"clipPath");return this.appendChild(a),a.push=function(b){a.appendChild(b)},a},f.line=function(a,b,c,d){var f=document.createElementNS(e,"line");return f.setAttribute("x1","string"==typeof a?a:a*g),f.setAttribute("y1","string"==typeof b?b:b*g),f.setAttribute("x2","string"==typeof c?c:c*g),f.setAttribute("y2","string"==typeof d?d:d*g),this.appendChild(f),f},f.rect=function(a,b,c,d,f){f||(f={});var h=document.createElementNS(e,"rect");return h.setAttribute("x","string"==typeof a?a:a*g),h.setAttribute("y","string"==typeof b?b:b*g),h.setAttribute("width","string"==typeof c?c:c*g),h.setAttribute("height","string"==typeof d?d:d*g),h.setAttribute("stroke","#000000"),this.appendChild(h),"undefined"!=typeof f.offset&&(h.offset=f.offset,h.setAttribute("transform","translate("+h.getAttribute("x")+","+h.getAttribute("y")+")"),h.setAttribute("x","0"),h.setAttribute("y",h.offset*g)),h.move=function(a,b){if("undefined"!=typeof this.offset&&this.getAttribute("transform")){var c=this.getAttribute("transform"),d=/translate\(.*[,\s](.*)\)/.exec(c);d[1]&&this.setAttribute("transform","translate("+a*g+","+d[1]+")"),this.setAttribute("width",b*g)}else this.setAttribute("x",a*g),this.setAttribute("width",b*g)},h},f.roundRect=function(a,b,c,d,e,f){var h=this.rect(a,b,c,d,f);return"object"==typeof e&&e.x||(e={x:e,y:e}),h.setAttribute("rx",e.x*g),h.setAttribute("ry",e.y*g),h},f.ellipticalRect=function(a,b,c,d){return this.roundRect(a,b,c,d,{x:.25*c,y:.5*d})},f.pentagon=function(a,b,c,d,e){return this.nagon(a,b,c,d,5,e)},f.hexagon=function(a,b,c,d,e){return this.nagon(a,b,c,d,6,e)};var h=function(a,b){this.constructor.prototype.setAttribute.call(this,a,b),"height"!=a&&"width"!=a&&"x"!=a&&"y"!=a||this.redraw(Math.floor(parseFloat(this.getAttribute("height"))))};f.nagon=function(b,c,d,e,f,i){var j=this.poly("");return j.setAttribute("x",b*g),j.setAttribute("y",c*g),j.setAttribute("width",d*g),j.redraw=function(a){a?this.last_height=a:a=this.last_height;for(var b=.5*Math.floor(parseFloat(j.getAttribute("width"))),c=.5*a,d=[],e=null,g=null,h=0;f>h;h++){var k=i/360*2*Math.PI+2/f*Math.PI*h,l=parseInt(b+b*Math.cos(k)),m=parseInt(c+c*Math.sin(k));d.push([l,m]),(null===e||e>l)&&(e=l),(null===g||l>g)&&(g=l)}var n=Math.floor(parseFloat(j.getAttribute("x"))),o=Math.floor(parseFloat(j.getAttribute("y")));d.map(function(d){return d[0]==e&&(d[0]=0),d[0]==g&&(d[0]=2*b),d[0]+=n,d[1]=o+.5*a*(d[1]/c),d.join(",")}),this.setAttribute("points",d.join(" "))},j.setHeight=j.redraw,j.move=function(b,c){var d=/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/.exec(this.getAttribute("transform"));if(null!==d){d=d[2];var e=this.getAttribute("transform").replace(/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/,"translate("+b*g+","+d+")");this.setAttribute("transform",e),a=.5*c*g}},j.setAttribute=h,j.redraw(e*g),j},f.use=function(a,b,c,d,f){var h=document.createElementNS(e,"use");return h.setAttribute("x","string"==typeof b?b:b*g),h.setAttribute("y","string"==typeof c?c:c*g),h.setAttribute("width","string"==typeof d?d:d*g),h.setAttribute("height","string"==typeof f?f:f*g),h.setAttributeNS("http://www.w3.org/1999/xlink","href",a),this.appendChild(h),h},f.a=function(a){var b=document.createElementNS(e,"a");return b.setAttribute("target","_new"),b.setAttributeNS("http://www.w3.org/1999/xlink","href",a),this.appendChild(b),b},f.button=function(a,b,c,d,f){var g=document.createElementNS(e,"foreignObject");g.setAttribute("x",a),g.setAttribute("y",b),g.setAttribute("width",a+c),g.setAttribute("height",b+d),g.style?g.style.position="absolute":g.setAttribute("style","position: absolute;"),this.appendChild(g);var h=document.createElement("button");return h.style.display="block",h.textContent=f,g.appendChild(h),h},f.svgbutton=function(a,b,c,d,e){var f=this.group(),g=this.rect(a,b,c,d);g.setAttribute("rx","10"),g.setAttribute("ry","10"),g.setAttribute("stroke","#ffffff"),g.setAttribute("stroke-width","2"),g.setAttribute("fill","url(#simple_gradient)"),a=g.x.baseVal.value,b=g.y.baseVal.value,c=g.width.baseVal.value,d=g.height.baseVal.value;var h=this.text(a+c/2,b+d/3,e);h.setAttribute("text-anchor","middle"),h.firstChild.setAttribute("dy","1.5ex"),h.setAttribute("font-size",.5*d),h.setAttribute("fill","#ffffff"),f.push(g),f.push(h),f.background_element=g,f.text_element=h,f.setAttribute("cursor","pointer");var i=function(){g.setAttribute("fill","#999999"),g.setAttribute("stroke","#000000")};f.addEventListener("mousedown",i,!1),f.addEventListener("touchstart",i,!1);var j=function(){g.setAttribute("stroke","#ffffff"),g.setAttribute("fill","url(#simple_gradient)")};return f.addEventListener("mouseup",j,!1),f.addEventListener("mouseout",j,!1),f.addEventListener("touchend",j,!1),f},f.callout=function(a,b,c,d){var f=this.group(),h=this.roundRect(-.5*(d.width+4),20,d.width+4,d.height+4,4);h.setAttribute("fill","#000000");var i=this.roundRect(-.5*(d.width+1),22,d.width+1,d.height,4);i.setAttribute("fill","#eeeeee"),f.push(h),f.push(i);var j=this.poly("0,500 500,1000 -500,1000");j.setAttribute("fill","#000000"),f.push(j);var k=document.createElementNS(e,"foreignObject");k.setAttribute("x",-.5*(d.width+1)*g),k.setAttribute("y",22*g),k.setAttribute("width",d.width*g),k.setAttribute("height",d.height*g),f.push(k);var l=document.createElementNS("http://www.w3.org/1999/xhtml","html");l.setAttribute("xmlns","http://www.w3.org/1999/xhtml");var n=document.createElementNS("http://www.w3.org/1999/xhtml","body");n.style.fontSize=(d["font-size"]||15)*g+"px",n.style.margin=5*g+"px",n.style.height=d.height*g*10+"px",l.appendChild(n),n.appendChild(c),k.appendChild(l);var o=d.height/15;if(f.setAttribute("transform","translate("+a*g+","+(b+20)*g+") scale("+o+")"),f.setHeight=m,!d.align){var p=parseFloat(this.getAttribute("viewBox").split(/\s+/)[2]);(a+10+.5*d.width)*g>p&&(d.align="right"),(a-.5*d.width)*g<0&&(d.align="left")}if(d.align){var q="right"==d.align?-.5:.5;h.setAttribute("transform","translate("+q*d.width*g+",0)"),i.setAttribute("transform","translate("+q*d.width*g+",0)"),j.setAttribute("transform","translate("+0*q*d.width*g+",0)"),j.setAttribute("points",q>0?"0,500 500,1000 0,1000":"0,500 0,1000 -500,1000"),k.setAttribute("transform","translate("+q*d.width*g+",0)")}return f.setAttribute("height",d.height*g),f},f.growingMarker=function(a,b,c,d){var f=document.createElementNS(e,"svg");d.stretch||Array.isArray&&Array.isArray(d.content)?f=this.group():(f.setAttribute("viewBox","-50 -100 200 250"),f.setAttribute("preserveAspectRatio","xMinYMin meet")),f.setAttribute("x",a),f.setAttribute("y",b);var h=this.marker(50/g,50/g,50/g,c,d);f.appendChild(h),f.contentElement=h.contentElement;var i=this.group(),j=this.group();return i.appendChild(j),j.appendChild(f),d.stretch||Array.isArray&&Array.isArray(d.content)||(f.setAttribute("width","200"),f.setAttribute("height","250")),d.angle&&(i.angle=d.angle),i.setAttribute("height","250"),i.setAttribute("transform","scale(1)"),i.setHeight=function(a){m.call(this,a);this.setAttribute("height",a);var b=this.offset||0;this.angle||(this.angle=0),this.firstChild.setAttribute("transform","translate(-100,"+b*g+") rotate("+this.angle+",100,0)")},i.container=f,i},f.marker=function(a,b,c,d,e){var h=0;if("string"==typeof a){var i=new RegExp(/(\d+)(.*)/g).exec(a);h=i[2],a=parseFloat(i[1]),i=new RegExp(/(\d+)(.*)/g).exec(b),
b=parseFloat(i[1]),i=new RegExp(/(\d+)(.*)/g).exec(c),c=parseFloat(i[1])}var j={CX:a+h,CY:b+h,R:c+h,MIN_X:a-c+h,MAX_X:a+c+h,MIN_Y:b-c+h,MAX_Y:b+c+h,MID_X1:a-c/2+h,MID_X2:a+c/2+h,MID_Y1:b-c/2+h,MID_Y2:b+c/2+h},k=this.group();e||(e={});var l=e&&e.border?e.border:"rgb(0,0,0)";if(!e.bare_element){k.push(this.circle(0,-.5*c,c)),k.lastChild.setAttribute("fill",l),k.lastChild.setAttribute("border","true"),k.push(this.circle(0,1.5*c,c)),k.lastChild.setAttribute("fill",l),k.lastChild.setAttribute("border","true");var n=this.poly(-.9*c*g+","+0*c*g+" 0,"+-2.5*c*g+" "+.9*c*g+","+0*c*g);n.setAttribute("fill",l),n.setAttribute("stroke-width","0"),k.push(n),k.lastChild.setAttribute("border","true")}if(k.setAttribute("transform","translate("+a*g+","+.5*b*g+") scale(1)"),k.setHeight=m,k.setAttribute("height",j.R*g),"string"==typeof d)d.match(/^(:?https?:)?\/?.*#/)?(k.contentElement=this.use(d,-c,0,c,c),k.contentElement.setAttribute("content","true")):(k.contentElement=this.text_circle(0,0,2*c,d,e),k.contentElement.firstChild.setAttribute("content","true")),k.push(k.contentElement);else if(Array.isArray&&Array.isArray(d)){k.contentElement=this.group();var o=Math.PI/d.length,p=e.stretch;d.forEach(function(a,b){var h,i=1.2*c+c*d.length*Math.cos(b*o-0*Math.PI/2),j=c+c*(4*c/d.length)*d.length*Math.sin(b*o-0*Math.PI/2),l=180*b/d.length;if(l-=0,p&&(l>=-90&&90>=l?e.stretch="right":e.stretch="left",l%90==0&&90!=l&&-90!=l&&(0==l&&(e.stretch="right"),1==d.length&&(e.stretch=!0))),l>90&&270>l&&(l=180+l),a.match(/^(:?https?:)?\/?.*#/))h=f.use(a,(i-.5)*c,(j-.5)*c,c,c),h.setAttribute("pointer-events","none"),h.setAttribute("content","true");else{var m=JSON.parse(JSON.stringify(e));m.no_tracer=!0,delete m.offset,delete m.height,h=f.text_circle(i*c,j*c,1.75*c,a,m),h.firstChild.setAttribute("content","true")}var n=h.getAttribute("transform");n=n+" rotate("+l+","+0*c*g+","+j*c*g+")",h.setAttribute("transform",n),k.contentElement.push(h)}),k.push(k.contentElement)}else k.contentElement=this.group(),e.bare_element||(k.contentElement.push(this.text_circle(0,.5*c,1.75*c,"",e)),k.contentElement.lastChild.firstChild.setAttribute("content","true")),d&&(e.bare_element||d.setAttribute("transform","translate(0,"+.5*c*g+")"),d.setAttribute("content","true"),k.contentElement.push(d)),k.push(k.contentElement);return k.setAttribute("marker","true"),k},f.text_circle=function(a,b,c,d,e){e||(e={});var f=0;if("string"==typeof a){var h=new RegExp(/(\d+)(.*)/g).exec(a);f=h[2],a=parseFloat(h[1]),h=new RegExp(/(\d+)(.*)/g).exec(b),b=parseFloat(h[1]),h=new RegExp(/(\d+)(.*)/g).exec(c),c=parseFloat(h[1])}var i={CX:a+f,CY:b+f,R:c+f,MIN_X:a-c+f,MAX_X:a+c+f,MIN_Y:b-c+f,MAX_Y:b+c+f,MID_X1:a-c/2+f,MID_X2:a+c/2+f,MID_Y1:b-c/2+f,MID_Y2:b+c/2+f},j=this.group(),k=this.text(0,i.CY,d);k.setAttribute("font-size",10*g),k.setAttribute("font-weight",e.weight||"bolder"),k.setAttribute("fill",e.text_fill||"#ffffff"),k.setAttribute("style","font-family: sans-serif; text-anchor: middle;"),k.firstChild.setAttribute("dy","0.35em"),k.setAttribute("text-anchor","middle");var l;if(e.stretch){var n=1.2*(e.font_size||c)*k.getBBox().width/(10*g),o=1.5*i.R,p=-.5*n;n>3*i.R?(p=-.5*n,"right"==e.stretch&&(p=-.1*n),"left"==e.stretch&&(p=-.9*n)):(n=3*i.R,p=-.5*n),k.setAttribute("x",(.5*n+p)*g),l=this.roundRect(p,i.CY-.5*o,n,o,{x:.5*i.R,y:.5*o},{})}else l=this.circle(0,i.CY,.9*i.R);return k.setAttribute("font-size",(e.font_size||c)*g),l.setAttribute("fill",e.fill||"url(#simple_gradient)"),window.matchMedia("print").addListener(function(a){l.setAttribute("fill",a.matches?"#aaaaaa":e.fill||"url(#simple_gradient)")}),l.setAttribute("stroke",e.border||"#000000"),l.setAttribute("stroke-width",c/10*g),j.push(l),j.push(k),j.setAttribute("transform","translate("+i.CX*g+", 1) scale(1)"),j.setAttribute("height",i.R/2*g),j.setHeight=m,j},f.crossed_circle=function(a,b,c){var d=0;if("string"==typeof a){var e=new RegExp(/(\d+)(.*)/g).exec(a);d=e[2],a=parseFloat(e[1]),e=new RegExp(/(\d+)(.*)/g).exec(b),b=parseFloat(e[1]),e=new RegExp(/(\d+)(.*)/g).exec(c),c=parseFloat(e[1])}var f={CX:a+d,CY:b+d,R:c+d,MIN_X:a-c+d,MAX_X:a+c+d,MIN_Y:b-c+d,MAX_Y:b+c+d,MID_X1:a-c/2+d,MID_X2:a+c/2+d,MID_Y1:b-c/2+d,MID_Y2:b+c/2+d},g=this.group(),h=this.circle(f.CX,f.CY,f.R);h.setAttribute("fill","#000000"),h.setAttribute("stroke","#ffffff"),h.setAttribute("stroke-width","2"),g._button=h,g.push(h);var i=this.line(f.MID_X1,f.MID_Y1,f.MID_X2,f.MID_Y2);i.setAttribute("stroke","#ffffff"),i.setAttribute("stroke-width","2"),g.push(i);var j=i,i=this.line(f.MID_X1,f.MID_Y2,f.MID_X2,f.MID_Y1);return i.setAttribute("stroke","#ffffff"),i.setAttribute("stroke-width","2"),g.push(i),g.move=function(a,b){h.setAttribute("cx",a),f.MID_X1=a-c/2,f.MID_X2=a+c/2,f.MID_Y1=b-c/2,f.MID_Y2=b+c/2,j.setAttribute("x1",f.MID_X1),j.setAttribute("y1",f.MID_Y1),j.setAttribute("x2",f.MID_X2),j.setAttribute("y2",f.MID_Y2),i.setAttribute("x1",f.MID_X1),i.setAttribute("y1",f.MID_Y2),i.setAttribute("x2",f.MID_X2),i.setAttribute("y2",f.MID_Y1)},g},f.text=function(a,b,c){var d=document.createElementNS(e,"text"),f=document.createElementNS(e,"tspan");return"string"!=typeof c?d.appendChild(c):(d.appendChild(f),f.textContent=c,f.setAttribute("dy","0")),d.style.fontFamily=this.font_order||"Helvetica, Verdana, Arial, Sans-serif",d.setAttribute("x","string"==typeof a?a:a*g),d.setAttribute("y","string"==typeof b?b:b*g),d.move=function(a,b){if("undefined"!=typeof this.offset&&this.getAttribute("transform")){var c=this.getAttribute("transform"),d=/translate\(.*[,\s](.*)\)/.exec(c);d[1]&&this.setAttribute("transform","translate("+a*g+","+d[1]+")")}else this.setAttribute("x",a*g)},this.appendChild(d),d},f.plus=function(a,b,c){var d=this.group();return d.appendChild(this.makeEl("rect",{x:Math.round(.4*c*g).toString(),y:Math.round(.1*c*g).toString(),"stroke-width":"1",width:Math.round(.2*c*g).toString(),height:Math.round(.8*c*g).toString(),stroke:"#ffffff",fill:"#ffffff"})),d.appendChild(this.makeEl("rect",{x:Math.round(.1*c*g).toString(),y:Math.round(.4*c*g).toString(),"stroke-width":"1",width:Math.round(.8*c*g).toString(),height:Math.round(.2*c*g).toString(),stroke:"#ffffff",fill:"#ffffff"})),d.setAttribute("transform","translate("+a*g+","+b*g+")"),d},f.minus=function(a,b,c){var d=this.group();return d.appendChild(this.makeEl("rect",{x:Math.round(.1*c*g).toString(),y:Math.round(.4*c*g).toString(),"stroke-width":"1",width:Math.round(.8*c*g).toString(),height:Math.round(.2*c*g).toString(),stroke:"#ffffff",fill:"#ffffff"})),d.setAttribute("transform","translate("+a*g+","+b*g+")"),d},f.transformedBoundingBox=function(a){var b=a.getBBox(),c=a.ownerSVGElement,d=a.parentNode.getScreenCTM().inverse().multiply(a.getScreenCTM()).inverse(),e=[c.createSVGPoint(),c.createSVGPoint(),c.createSVGPoint(),c.createSVGPoint()];e[0].x=b.x,e[0].y=b.y,e[1].x=b.x+b.width,e[1].y=b.y,e[2].x=b.x+b.width,e[2].y=b.y+b.height,e[3].x=b.x,e[3].y=b.y+b.height;var f=1/0,g=-(1/0),h=1/0,i=-(1/0);e.forEach(function(a){a=a.matrixTransform(d),f=Math.min(f,a.x),g=Math.max(g,a.x),h=Math.min(h,a.y),i=Math.max(i,a.y)});try{b.x=f,b.width=g-f,b.y=h,b.height=i-h}catch(j){b={x:f,y:h,width:g-f,height:i-h}}return b},f.set=function(){var a=[];return b(a,g),a},f.hide=function(){this.setAttribute("display","none")},f.show=function(){this.setAttribute("display","inline")}}}();if(MASCP.svgns="http://www.w3.org/2000/svg",MASCP.CondensedSequenceRenderer=function(a){this._RS=50,MASCP.SequenceRenderer.apply(this,arguments);var b=this;MASCP.CondensedSequenceRenderer.Zoom(b);var c,d=function(){a.cached_width=a.getBoundingClientRect().width};return window.addEventListener("resize",function(){clearTimeout(c),window.requestAnimationFrame?window.requestAnimationFrame(d):c=setTimeout(d,100)},!0),a.cached_width=a.getBoundingClientRect().width,bean.remove(this,"sequenceChange"),bean.add(this,"sequenceChange",function(){for(var a in MASCP.layers)MASCP.layers.hasOwnProperty(a)&&(MASCP.layers[a].disabled=!0);b.zoom=b.zoom}),this},MASCP.CondensedSequenceRenderer.prototype=new MASCP.SequenceRenderer,function(){var a=document.getElementsByTagName("script"),b=a[a.length-1].src;b=b.replace(/[^\/]+$/,""),MASCP.CondensedSequenceRenderer._BASE_PATH=b}(),function(a){var b=function(){var a=this;this._object&&("undefined"!=typeof svgweb?svgweb.removeChild(this._object,this._object.parentNode):this._object.parentNode.removeChild(this._object),this._canvas=null,this._object=null);var b;if(document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")){var c=this.win().document.createElementNS(MASCP.svgns,"svg");c.setAttribute("width","100%"),c.setAttribute("height","100%"),this._container.appendChild(c),this._canvas=c,b={addEventListener:function(a,b){c.contentDocument={rootElement:c},b.call(c)}}}return b.addEventListener("load",function(){var b=this;SVGCanvas(b),a.font_order&&(b.font_order=a.font_order);var c=b.makeEl("g"),e=b.makeEl("svg");e.RS=a._RS,SVGCanvas(e),a.font_order&&(e.font_order=a.font_order),c.appendChild(e),b.appendChild(c);var f=!0;try{e.addEventListener}catch(g){f=!1}var h=(e.makeEl("rect",{x:"-10%",y:"-10%",width:"120%",height:"120%",style:"fill: #ffffff;"}),b.makeEl("rect",{x:"0",y:"0",width:"50",height:"100%",style:"fill: url(#left_fade);"})),i=b.makeEl("rect",{x:"100%",y:"0",width:"25",height:"100%",transform:"translate(-15,0)",style:"fill: url(#right_fade);"});b.appendChild(h),b.appendChild(i),bean.add(e,"pan",function(){e.currentTranslate.x>=0?h.setAttribute("visibility","hidden"):h.setAttribute("visibility","visible"),a.rightVisibleResidue()<a.sequence.length?i.setAttribute("visibility","visible"):i.setAttribute("visibility","hidden")}),bean.add(e,"_anim_begin",function(){h.setAttribute("visibility","hidden"),i.setAttribute("visibility","hidden")}),bean.add(e,"_anim_end",function(){bean.fire(e,"pan")}),e.currentTranslate.x>=0&&h.setAttribute("visibility","hidden"),i.setAttribute("visibility","hidden");var j=b.makeEl("g");b.appendChild(j);var k=b.makeEl("svg");j.appendChild(k),e.setCurrentTranslateXY=function(a,b){var d=(c.getAttribute("transform")||"").replace(/translate\([^\)]+\)/,"");d=d+" translate("+a+", "+b+") ",c.setAttribute("transform",d),this.currentTranslate.x=a,this.currentTranslate.y=b},e.setCurrentTranslateXY(0,0),k.setCurrentTranslateXY=function(a,b){var c=(j.getAttribute("transform")||"").replace(/translate\([^\)]+\)/,"");c=c+" translate("+a+", "+b+") ",j.setAttribute("transform",c),this.currentTranslate.x=a,this.currentTranslate.y=b},k.setCurrentTranslateXY(0,0),d.call(a,k);var l=a.navigation,m=l.show,n=l.hide;l.show=function(){m.apply(l,arguments),e.style.GomapScrollLeftMargin=100*a._RS/a.zoom},l.hide=function(){n.apply(l,arguments),e.style.GomapScrollLeftMargin=1e3},a._container_canvas=b,b.setAttribute("preserveAspectRatio","xMinYMin meet"),b.setAttribute("width","100%"),b.setAttribute("height","100%"),e.appendChild(e.makeEl("rect",{x:0,y:0,opacity:0,width:"100%",height:"100%","stroke-width":"0",fill:"#ffffff"})),a._object=this,a._canvas=e,a._canvas._canvas_height=0,bean.fire(a,"svgready")},!1),b},c=function(a){return a.stopPropagation(),!0},d=function(a){this.navigation=new MASCP.CondensedSequenceRenderer.Navigation(a,this);var b=this.navigation,d=function(){b.demote()},e=function(){b.promote()};MASCP.IE||(bean.add(this._canvas,"panstart",d),bean.add(this._canvas,"panend",e),bean.add(this._canvas,"_anim_begin",d),bean.add(this._canvas,"_anim_end",e),a.addEventListener("DOMMouseScroll",c,!1),a.addEventListener("wheel",c,!1),a.onmousewheel=c)},e=function(){var a=this,b=a.addTextTrack(this.sequence,this._canvas.set());b.attr({y:.5*a._axis_height*a._RS}),a.select=function(){var a=Array.prototype.slice.call(arguments);a[0],a[1];this.moveHighlight.apply(this,a)};var c=function(){b.attr({y:.5*a._axis_height*a._RS})},d=a._canvas;return bean.add(d,"zoomChange",c),bean.add(b,"removed",function(){bean.remove(d,"zoomChange",c)}),b},f=mainDrawAxis=function(a,b){var c=this._RS,d=this,e=0,f=0,g=a.set(),h=a.rect(0,0,b,1.5);h.setAttribute("fill","url('#"+d.axis_pattern_id+"')"),h.removeAttribute("stroke"),h.removeAttribute("stroke-width"),h.setAttribute("id","axis_back");var i=30,j=a.set(),k=a.set(),l=a.set(),m=a.set(),n=10,o=20;for(this.sequence.length>5e3&&(n=100,o=200),this.sequence.length>1e3&&(n=20,o=40),f=0;b/5>f;f++){var p=a.text(e,0,""+e);j.push(p),e%o===0&&0!==e?k.push(p):e%n===0&&0!==e&&l.push(p),e%(250*parseInt(this.sequence.length/500))===0&&0!==e&&m.push(p),e+=5}for(f=0;f<j.length;f++)j[f].style.textAnchor="middle",j[f].firstChild.setAttribute("dy","1.5ex");j.attr({"pointer-events":"none","text-anchor":"middle","font-size":7*c+"pt"}),j.hide(),d._axis_height=parseInt(i/d.zoom);var q=function(){var a=d;a._axis_height=parseInt(i/a.zoom);var b=a._canvas.ownerSVGElement.getElementById(a.axis_pattern_id);if(m.forEach(function(a){a.setAttribute("visibility","hidden")}),this.zoom>3.6){h.setAttribute("transform","translate(-5,"+.3*a._axis_height*c+")"),h.setAttribute("height",.25*a._axis_height*c),b.setAttribute("width",10*c),b.firstChild.setAttribute("width",c/a.zoom),l.show(),k.show();var e=.15*d._axis_height;1>e&&(e=1),l.attr({"font-size":e*c+"pt","text-anchor":"end"}),k.attr({"font-size":e*c+"pt","text-anchor":"end"}),this._visibleTracers&&this._visibleTracers()&&this._visibleTracers().show()}else if(this.zoom>1.8)l.hide(),k.show(),k.attr({"font-size":.5*c*d._axis_height+"pt","text-anchor":"middle"}),h.setAttribute("transform","translate(-25,"+.5*a._axis_height*c+")"),h.setAttribute("height",.3*a._axis_height*c),b.setAttribute("width",20*c),b.firstChild.setAttribute("width",c/a.zoom),this.tracers&&this.tracers.hide();else if(this.zoom>.2){this.tracers&&this.tracers.hide(),l.hide(),k.show(),k.attr({"font-size":.5*c*d._axis_height+"pt","text-anchor":"middle"}),h.setAttribute("transform","translate(-25,"+.5*a._axis_height*c+")"),h.setAttribute("height",.3*a._axis_height*c),b.setAttribute("width",50*c),b.firstChild.setAttribute("width",c/a.zoom);var f=-1e4,g=!1;k.forEach(function(a){a.cached_bbox||(a.cached_bbox=a.getBBox()),a.cached_bbox.x<=f+10*c||parseInt(a.textContent)%50!=0?(a.setAttribute("visibility","hidden"),g=!0):(a.setAttribute("visibility","visible"),f=a.cached_bbox.x+a.cached_bbox.width)}),g&&k[0].setAttribute("visibility","hidden")}else{this.tracers&&this.tracers.hide(),l.hide(),k.hide(),m.show(),m.attr({"font-size":.5*c*d._axis_height+"pt","text-anchor":"middle"}),h.setAttribute("transform","translate(-50,"+.85*a._axis_height*c+")"),h.setAttribute("height",.1*a._axis_height*c),b.setAttribute("width",250*c),b.firstChild.setAttribute("width",c/a.zoom);var f=-1e4,g=!1;m.forEach(function(a){a.cached_bbox||(a.cached_bbox=a.getBBox()),a.cached_bbox.x<=f+10*c||parseInt(a.textContent)%250!=0?a.setAttribute("visibility","hidden"):(a.setAttribute("visibility","visible"),f=a.cached_bbox.x+a.cached_bbox.width)}),g&&m[0].setAttribute("visibility","hidden")}};return bean.add(a,"zoomChange",q),bean.add(g,"removed",function(){bean.remove(a,"zoomChange",q);var b=function(a){a.parentNode&&a.parentNode.removeChild(a)};h.parentNode.removeChild(h),j.forEach(b)}),g};a.prototype.panTo=function(a,b){var c=this,d=c.leftVisibleResidue(),e=1;return d==a?void(b&&b.call(null)):(d>a&&(e=-1),void requestAnimationFrame(function(){c.setLeftVisibleResidue(d),d+=e,bean.fire(c._canvas,"panend"),d!==a?requestAnimationFrame(arguments.callee):b&&b.call(null)}))},a.prototype.zoomTo=function(a,b,c){var d=this,e=d.zoom,f=(a-e)/50;return bean.add(d,"zoomChange",function(){bean.remove(d,"zoomChange",arguments.callee),delete d.zoomCenter,c&&c.call(null)}),b?(d.zoomCenter="center"==b?b:{x:d._RS*b},void requestAnimationFrame(function(){d.zoom=e,e+=f,Math.abs(e-a)>.01&&requestAnimationFrame(arguments.callee)})):void(d.zoom=a)},a.prototype.setLeftVisibleResidue=function(a){var b=this;b._canvas.setCurrentTranslateXY(b._canvas.width.baseVal.value*(1-a/(b.sequence.length+b.padding+2))-b._canvas.width.baseVal.value,0)},a.prototype.leftVisibleResidue=function(){var a=this,b=Math.floor((a.sequence.length+a.padding+2)*(1-(a._canvas.width.baseVal.value+a._canvas.currentTranslate.x)/a._canvas.width.baseVal.value))-1;return 0>b&&(b=0),b},a.prototype.rightVisibleResidue=function(){var a=this,b=a._container_canvas.parentNode.cached_width;b||(b=a._container_canvas.parentNode.getBoundingClientRect().width);var c=Math.floor(a.leftVisibleResidue()+(a.sequence.length+a.padding+2)*(b/a._canvas.width.baseVal.value));return c>a.sequence.length&&(c=a.sequence.length),c},a.prototype.addAxisScale=function(a,b){return this._scalers||(this._scalers=[]),this._scalers.push(b),b.identifier=a,b},a.prototype.refreshScale=function(){var a=this,b=Object.keys(this._layer_containers);b.forEach(function(b){a._layer_containers[b].forEach(function(c){if(c.move&&c.aa){var d=a.scalePosition(c.aa,b?b:c.acc),e=a.scalePosition(c.aa+c.aa_width,b?b:c.acc);0>d&&(d*=-1),0>e&&(e*=-1),c.move(d-1,e-d)}})})},a.prototype.scalePosition=function(a,b,c){var d=MASCP.getLayer(b),e=(c?(this._scalers||[]).concat([]).reverse():this._scalers||[]).reduce(function(a,e){return e(a,d||{name:b},c)},a);return e},a.prototype.getAA=function(a,b,c){return this.getAminoAcidsByPosition([a],b,c).shift()},a.prototype.getAminoAcidsByPosition=function(a,b,c){for(var d=this,e=a.map(function(a){return Math.abs(d.scalePosition(a,b?b:c))}),f=MASCP.SequenceRenderer.prototype.getAminoAcidsByPosition.call(this,e),g=0;g<e.length;g++)f[g]&&(f[g].original_index=a[g],f[g].accession=b?b:c);return f},a.prototype.getAminoAcidsByPeptide=function(a,b,c){var d,e=this,f=[],g=c?c:b;d=e.sequences?e.sequences[e.sequences.map(function(a){return(a.agi||a.acc||"").toLowerCase()}).indexOf(g.toLowerCase())].toString():e.sequence;for(var h=d.indexOf(a),i=0;i<a.length;i++)f.push(h+i);var j=e.getAminoAcidsByPosition(f,b,c);return j.length?j.addToLayer=function(a,b,c){return j[0].addBoxOverlay(a,j.length,b,c)}:j.addToLayer=function(){},j},a.prototype.win=function(){if(this._container&&this._container.ownerDocument&&this._container.ownerDocument.defaultView){var a=this._container.ownerDocument.defaultView;return"object"==typeof a&&a.constructor!==Window&&(a=a[Object.keys(a)[0]]),a}return null},a.prototype.setSequence=function(a){var c=this._cleanSequence(a);if(c==this.sequence&&null!==c)return void bean.fire(this,"sequenceChange");if(c){this.sequence=c,delete this.sequences;var d=this.sequence.split(""),g=d.length;if(0!==g){var h=this,i=function(){var a=[];h.sequence.split("").forEach(function(b,c){var d={};d._index=c,d._renderer=h,h._extendElement(d),d.amino_acid=b,a.push(d)}),h._sequence_els=a};i();var j=this._RS;bean.remove(this,"svgready"),bean.add(this,"svgready",function(a){var b=h._canvas;b.RS=j,b.setAttribute("background","#000000"),b.setAttribute("preserveAspectRatio","xMinYMin meet");var c=b.makeEl("defs");h._container_canvas.appendChild(c),c.appendChild(b.make_gradient("track_shine","0%","100%",["#111111","#aaaaaa","#111111"],[.5,.5,.5])),c.appendChild(b.make_gradient("simple_gradient","0%","100%",["#aaaaaa","#888888"],[1,1])),c.appendChild(b.make_gradient("left_fade","100%","0%",["#ffffff","#ffffff"],[1,0])),c.appendChild(b.make_gradient("right_fade","100%","0%",["#ffffff","#ffffff"],[0,1])),c.appendChild(b.make_gradient("red_3d","0%","100%",["#CF0000","#540000"],[1,1])),h.gradients=[],h.add3dGradient=function(a){c.appendChild(b.make_gradient("grad_"+a,"0%","100%",[a,"#ffffff",a],[1,1,1])),h.gradients.push(a)};var d=b.makeEl("filter",{id:"drop_shadow",filterUnits:"objectBoundingBox",x:"-50%",y:"-50%",width:"200%",height:"200%"});d.appendChild(b.makeEl("feGaussianBlur",{"in":"SourceGraphic",stdDeviation:"4",result:"blur_out"})),d.appendChild(b.makeEl("feOffset",{"in":"blur_out",result:"the_shadow",dx:"3",dy:"1"})),d.appendChild(b.makeEl("feBlend",{"in":"SourceGraphic",in2:"the_shadow",mode:"normal"})),c.appendChild(d);var k=b.makeEl("svg",{width:"100%",height:"100%",id:"new_link_icon",viewBox:"0 0 100 100",preserveAspectRatio:"xMinYMin meet"});c.appendChild(k),k.appendChild(b.makeEl("rect",{x:"12.5",y:"37.5","stroke-width":"3",width:"50",height:"50",stroke:"#ffffff",fill:"none"})),k.appendChild(b.makeEl("path",{d:"M 50.0,16.7 L 83.3,16.7 L 83.3,50.0 L 79.2,56.2 L 68.8,39.6 L 43.8,66.7 L 33.3,56.2 L 60.4,31.2 L 43.8,20.8 L 50.0,16.7 z","stroke-width":"3",stroke:"#999999",fill:"#ffffff"}));var l=b.makeEl("svg",{width:"100%",height:"100%",id:"plus_icon",viewBox:"0 0 100 100",preserveAspectRatio:"xMinYMin meet"});l.appendChild(b.plus(0,0,100/b.RS)),c.appendChild(l);var m=b.makeEl("svg",{width:"100%",height:"100%",id:"minus_icon",viewBox:"0 0 100 100",preserveAspectRatio:"xMinYMin meet"});m.appendChild(b.minus(0,0,100/b.RS)),c.appendChild(m);var n="axis_pattern_"+(new Date).getTime(),o=b.makeEl("pattern",{patternUnits:"userSpaceOnUse",x:"0",y:"0",width:10*b.RS,height:2*b.RS,id:n});h.axis_pattern_id=n;var p=b.makeEl("rect",{x:"0",y:"0",width:"10%",height:"1000%",fill:"#000",stroke:"0"});o.appendChild(p),c.appendChild(o);var q=this;h._axis_height=10;var r=e.call(q,b);h.hideAxis=function(){f=function(a){return bean.add(a,"zoomChange",function(){q._axis_height=10/q.zoom}),{}},q._axis_height=10/q.zoom,this.redrawAxis()},h.showAxis=function(){f=mainDrawAxis,this.redrawAxis()};var s=f.call(q,b,g);h.redrawAxis=function(){bean.fire(s,"removed"),r.forEach(function(a){a.parentNode&&a.parentNode.removeChild(a)}),bean.fire(r,"removed"),s=f.call(q,b,h.sequence.length),r=e.call(q,b),i(),h.refresh()},h.hide_axis?this.hideAxis():this.showAxis(),h._layer_containers={},h.enablePrintResizing(),h.enableScaling(),h.enableSelection(),bean.add(MASCP,"layerRegistered",function(a,b){b&&b!==h||h.addTrack(a)}),bean.fire(h,"sequenceChange")});var k=b.call(this);this._canvas||("undefined"!=typeof svgweb?svgweb.appendChild(k,this._container):this._container.appendChild(k));var l=this;this.EnableHighlights();var m=function(a){l._canvas?a.apply():bean.add(l,"sequenceChange",function(){bean.remove(l,"sequenceChange",arguments.callee),a.apply()})};return m.ready=function(a){this.call(this,a)},m}}}}(MASCP.CondensedSequenceRenderer),function(){var a="http://www.w3.org/2000/svg",b=function(b){b.ELEMENT_NODE||(b.ELEMENT_NODE=1,b.ATTRIBUTE_NODE=2,b.TEXT_NODE=3,b.CDATA_SECTION_NODE=4,b.ENTITY_REFERENCE_NODE=5,b.ENTITY_NODE=6,b.PROCESSING_INSTRUCTION_NODE=7,b.COMMENT_NODE=8,b.DOCUMENT_NODE=9,b.DOCUMENT_TYPE_NODE=10,b.DOCUMENT_FRAGMENT_NODE=11,b.NOTATION_NODE=12),b._importNode=function(c,d){switch(c.nodeType){case b.ELEMENT_NODE:var e=b.createElementNS(a,c.nodeName);if(c.attributes&&c.attributes.length>0)for(var f=0,g=c.attributes.length;g>f;)/^on/.test(c.attributes[f].nodeName)||e.setAttribute(c.attributes[f].nodeName,c.getAttribute(c.attributes[f++].nodeName));if(d&&c.childNodes&&c.childNodes.length>0)for(var f=0,g=c.childNodes.length;g>f;)"USE"!==c.childNodes[f].nodeName&&"SCRIPT"!==c.childNodes[f].nodeName&&e.appendChild(b._importNode(c.childNodes[f++],d));return e;case b.TEXT_NODE:case b.CDATA_SECTION_NODE:case b.COMMENT_NODE:return b.createTextNode(c.nodeValue)}}};MASCP.CondensedSequenceRenderer.prototype.importIcons=function(a,c){var d=this._container_canvas.ownerDocument;if(!this._container_canvas.getElementById("defs_"+a)){this._container_canvas.appendChild(d.createElement("defs")),this._container_canvas.lastChild.setAttribute("id","defs_"+a);var e=this._container_canvas.lastChild;d._importNode||b(d);var f=d._importNode(c,!0);if("undefined"!=typeof XPathResult){for(var g=d.evaluate("//svg:defs/*",f,function(a){return MASCP.svgns},XPathResult.ANY_TYPE,null),h=g.iterateNext(),i=[];h;)i.push(h),h=g.iterateNext();i.forEach(function(b){b.setAttribute("id",a+"_"+b.getAttribute("id")),e.appendChild(b)})}else for(var j=f.querySelectorAll("defs > *"),k=0;k<j.length;k++)j[k].setAttribute("id",a+"_"+j[k].getAttribute("id")),e.appendChild(j[k])}}}(),MASCP.CondensedSequenceRenderer.prototype.addValuesToLayer=function(a,b,c){var d=this._RS,e=this._canvas;if(!e){var f=arguments.callee,g=this;return bean.add(this._renderer,"sequencechange",function(){bean.remove(this._renderer,"sequencechange",arguments.callee),f.call(g,a,b)}),void log("Delaying rendering, waiting for sequence change")}var h,i,j=1;c=c||{},c.height&&(j=c.height/this._layer_containers[a].track_height);var k=0;c.offset&&(k=c.offset/this._layer_containers[a].track_height);var l=function(a){var c=" m"+-.5*d+" 0",e=null;return b.forEach(function(b){"undefined"==typeof e||(c+=" l"+d+" "+-1*d*a*j*(b-e)),e=b,(isNaN(h)||b>h)&&(h=b),(isNaN(i)||i>b)&&(i=b)}),c},m=this._canvas.path("M0 0 M0 0 m0 "+(h||0)*d+" "+l(1)),n=i,o=h;if(m.setAttribute("stroke",c.color||"#ff0000"),m.setAttribute("stroke-width",(c.thickness||.35)*d),m.setAttribute("fill","none"),m.setAttribute("visibility","hidden"),m.setAttribute("pointer-events","none"),this._layer_containers[a].push(m),m.setAttribute("transform","translate(1,10) scale(1,1)"),!c.hide_axis){var p=this._canvas.path("M0 0 m0 "+d*((h||0)-(i||0))+" l"+this._sequence_els.length*d+" 0");p.setAttribute("stroke-width",.2*d),p.setAttribute("visibility","hidden"),p.setAttribute("transform","translate(1,0)"),p.setAttribute("pointer-events","none"),p.setHeight=function(a){0>n&&o>0?p.setAttribute("d","M0 0 M0 0 m0 "+a*k+" m0 "+.5*a*j+" l"+q._sequence_els.length*d+" 0"):p.setAttribute("d","M0 0 M0 0 m0 "+a*k+" m0 "+.5*(1-n)*a*j+" l"+q._sequence_els.length*d+" 0"),p.setAttribute("stroke-width",.2*d/q.zoom)},this._layer_containers[a].push(p)}var q=this;if(c.label){var r=this._canvas.text(0,0,c.label.max||c.label.min);r.setAttribute("transform","translate(0,0)"),r.setAttribute("font-size",4*d+"pt"),r.setHeight=function(a){r.setAttribute("y",a*k),r.setAttribute("font-size",4*d/q.zoom+"pt")},this._layer_containers[a].push(r)}return m.setHeight=function(a){var b=l(.5*a/d);m.setAttribute("d","M0 0 M0 0 m0 "+a*k+" m0 "+.5*a*j+" "+b),m.setAttribute("stroke-width",(c.thickness||.35)*d/q.zoom)},m},function(){var a=function(a,b){var c=this._renderer._canvas;if(!c){var d=arguments.callee,e=this;return bean.add(this._renderer,"sequencechange",function(){bean.remove(this._renderer,"sequencechange",arguments.callee),d.call(e,a)}),void log("Delaying rendering, waiting for sequence change")}var f=null,g=null,h=this._renderer;b||(b={});var i=1;b.height&&(b.height=parseFloat(b.height),"undefined"!=typeof b.height&&b.bare_element&&(b.height*=2),i=b.height/this._renderer._layer_containers[a].track_height,"undefined"!=typeof b.offset&&(b.offset=-2.5+b.offset/b.height*5));var g=c.growingMarker(0,0,b.content||a.charAt(0).toUpperCase(),b);if(g.setAttribute("transform","translate("+(this._index+.5)*this._renderer._RS+",0.01) scale("+i+")"),g.setAttribute("height","250"),g.firstChild.setAttribute("transform","translate(-100,0) rotate(0,100,0.001)"),b.break_viewbox&&(g.container.removeAttribute("viewBox"),g.container.setAttribute("width","100%"),g.container.setAttribute("height","100%")),!b.no_tracer){var j=c.circle(this._index+.5,10,.25);j.setAttribute("visibility","hidden"),j.style.opacity="0.4",f=c.rect(this._index+.5,10,.05,0),f._index=this._index,f.style.strokeWidth="0",f.style.fill=MASCP.layers[a].color,f.setAttribute("visibility","hidden"),c.insertBefore(f,c.firstChild.nextSibling);var h=this._renderer;this._renderer._layer_containers[a].tracers||(this._renderer._layer_containers[a].tracers=c.set()),c.tracers||(c.tracers=c.set(),c._visibleTracers=function(){return h._visibleTracers()}),f.setHeight=function(a){if("hidden"!=f.getAttribute("visibility")){var b=g.getAttribute("transform"),c=/translate\(.*[,\s](.*)\) scale\((.*)\)/.exec(b);if(c[1]&&c[2]){var d=parseFloat(c[2]),e=parseFloat(c[1]),h=e+d*(50*(g.offset||0)+125)-parseInt(this.getAttribute("y"));this.setAttribute("height",0>h?0:h)}else this.setAttribute("height",a)}},this._renderer._layer_containers[a].tracers.push(f),this._renderer._layer_containers[a].tracers.push(j),f.setAttribute("pointer-events","none"),j.setAttribute("pointer-events","none"),c.tracers.push(f)}"undefined"==typeof b.offset||null===b.offset||(g.offset=b.offset),g.setAttribute("visibility","hidden"),this._renderer._layer_containers[a].push(g);var k=[f,g,j];return g.setAttribute("class",a),k.move=function(a,b){var c=g.getAttribute("transform"),d=/translate\(.*[,\s](.*)\) scale\((.*)\)/.exec(c);d[1]&&d[2]&&g.setAttribute("transform","translate("+(a+.5)*h._RS+","+d[1]+") scale("+d[2]+")"),f&&(f.move(a+.5,.05),j.move(a+.5))},f&&(g.tracer=f,g.bobble=j),this._renderer._layer_containers[a].push(k),k},b=function(a,b,c,d){var e=this._renderer._canvas,f=this._renderer;if(d||(d={}),!e){var g=arguments.callee,h=this;return bean.add(this._renderer,"sequencechange",function(){bean.remove(this._renderer,"sequencechange",arguments.callee),g.call(h,a,b,d)}),void log("Delaying rendering, waiting for sequence change")}var i=e.rect(-.25+this._index,60,b||1,d.height||4,d),j=parseFloat(i.getAttribute("x")),k=j+parseFloat(i.getAttribute("width")),l=this._renderer._layer_containers[a];if("undefined"!=typeof d.merge&&d.merge)for(var m=0;m<l.length;m++)if(l[m].value==c){var n=parseFloat(l[m].getAttribute("x")),o=n+parseFloat(l[m].getAttribute("width"));if(j>=n&&o>=j||n>=j&&k>=n)return l[m].setAttribute("x",""+Math.min(n,j)),l[m].setAttribute("width",""+(Math.max(o,k)-Math.min(n,j))),i.parentNode.removeChild(i),l[m]}if(this._renderer._layer_containers[a].push(i),i.setAttribute("class",a),i.setAttribute("visibility","hidden"),i.setAttribute("stroke-width","0px"),"undefined"!=typeof c&&(i.setAttribute("opacity",c),i.value=c),i.setAttribute("fill",d.fill||MASCP.layers[a].color),i.position_start=this._index,i.position_end=this._index+b,"undefined"!=typeof d.offset||d.height_scale){var p=d.offset;i.setHeight=function(a){var b=d.height?d.height*f._RS/f.zoom:a*(d.height_scale||1);"bottom"==d.align?(this.setAttribute("y",p*f._RS/f.zoom-a*(d.height_scale||1)),this.setAttribute("height",b)):(this.setAttribute("y",p*f._RS/f.zoom),this.setAttribute("height",b))}}return i},c=function(a,b,c){var d=this._renderer._canvas,e=this._renderer;if(!d){var f=arguments.callee,g=this;return bean.add(this._renderer,"sequencechange",function(){bean.remove(this._renderer,"sequencechange",arguments.callee),f.call(g,a,b,c)}),void log("Delaying rendering, waiting for sequence change")}c||(c={}),c.height&&(c.height=c.height*this._renderer._RS);var h=c.height||this._renderer._layer_containers[a].trackHeight||4,i=this._index;b>1&&(i+=Math.floor(.5*b));var j=4/3,k=d.text(i,0,c.txt||"Text");if(k.setAttribute("font-size",j*h),k.setAttribute("font-weight","bolder"),k.setAttribute("fill",c.fill||"#ffffff"),k.setAttribute("stroke","#000000"),"stroke_width"in c||(c.stroke_width=5),k.setAttribute("stroke-width",c.stroke_width+""),k.setAttribute("style","font-family: "+d.font_order),k.firstChild.setAttribute("dy","1.3ex"),k.setAttribute("text-anchor","middle"),c.align&&("left"==c.align&&k.setAttribute("text-anchor","start"),"right"==c.align&&k.setAttribute("text-anchor","end")),b>1){var l=d.clipPath(),m=d.rect(-.5*b,c.offset||0,b,h);l.push(m),m.removeAttribute("y");var n="id"+(new Date).getTime()+"_"+l.parentNode.childNodes.length;l.setAttribute("id",n),k.setAttribute("clip-path","url(#"+n+")")}return"undefined"!=typeof c.offset?(k.setAttribute("transform","translate("+k.getAttribute("x")+","+k.getAttribute("y")+")"),k.offset=c.offset,k.setHeight=function(a){var b=this.offset;this.setAttribute("x",0),this.setAttribute("y",b*e._RS/e.zoom),m&&m.setAttribute("y",this.getAttribute("y")),this.setAttribute("stroke-width",5/e.zoom),c.height?(this.setAttribute("font-size",j*c.height/e.zoom),m&&m.setAttribute("height",c.height/e.zoom)):(this.setAttribute("font-size",j*a),m&&m.setAttribute("height",a))}):k.setHeight=function(a){k.setAttribute("stroke-width",5/e.zoom),c.height?(k.setAttribute("font-size",j*c.height/e.zoom),m&&m.setAttribute("height",c.height/e.zoom)):(k.setAttribute("font-size",j*a),m&&m.setAttribute("height",a))},b>1&&(k.move=function(a,b){m&&m.setAttribute("x",-1*b*e._RS*.5),m&&m.setAttribute("width",b*e._RS),k.setAttribute("x",(a+parseInt(.5*b))*e._RS)}),this._renderer._layer_containers[a].push(k),k},d=function(a,b,c){var d=this._renderer._canvas,e=this._renderer;
if(!d){var f=arguments.callee,g=this;return bean.add(this._renderer,"sequencechange",function(){bean.remove(this._renderer,"sequencechange",arguments.callee),f.call(g,a,b,c)}),void log("Delaying rendering, waiting for sequence change")}var h={pentagon:d.pentagon,hexagon:d.hexagon,rectangle:d.rect,ellipse:d.ellipticalRect,roundrect:function(a,b,c,e){return d.roundRect(a,b,c,e,.25*e)}};c.rotate||(c.rotate=0);var i=null;if(c.shape in h){if(i=h[c.shape].call(d,this._index,60,b||1,c.height||4,c.rotate),"undefined"!=typeof c.offset){var j=i.getAttribute("x"),k=i.getAttribute("y");i.setAttribute("transform","translate("+j+","+k+")"),i.setAttribute("x","0");var l=c.offset||0,m=c.height||4;i.setAttribute("y",l*this._renderer._RS),i.setHeight=function(a){this._orig_stroke_width||(this._orig_stroke_width=parseInt(this.getAttribute("stroke-width"))),i.setAttribute("y",l*e._RS/e.zoom),i.setAttribute("height",m*e._RS/e.zoom),i.setAttribute("stroke-width",this._orig_stroke_width/e.zoom),"ellipse"==c.shape&&i.setAttribute("ry",.5*(m*e._RS)/e.zoom),"roundrect"==c.shape&&(i.setAttribute("rx",.25*(m*e._RS)/e.zoom),i.setAttribute("ry",.25*(m*e._RS)/e.zoom))},i.move=function(a,b){var c=this.getAttribute("transform"),d=/translate\(.*[,\s](.*)\)/.exec(c);d[1]&&this.setAttribute("transform","translate("+a*e._RS+","+d[1]+")"),this.setAttribute("width",b*e._RS)}}if("undefined"==typeof c.offset||"hexagon"!=c.shape&&"pentagon"!=c.shape)this._renderer._layer_containers[a].push(i),i.setAttribute("visibility","hidden"),i.setAttribute("class",a),i.position_start=this._index,i.position_end=this._index+b;else{var l=c.offset||0,m=c.height||4,n=d.group();n.setAttribute("transform",i.getAttribute("transform")),n.push(i),i.setAttribute("transform","translate(0,"+l*this._renderer._RS+")"),n.setHeight=function(a){i._orig_stroke_width||(i._orig_stroke_width=parseInt(i.getAttribute("stroke-width"))||0),i.setHeight(m*e._RS/e.zoom),i.setAttribute("stroke-width",this._orig_stroke_width/e.zoom),i.setAttribute("transform","translate(0,"+l*e._RS/e.zoom+")")},this._renderer._layer_containers[a].push(n),n.setAttribute("visibility","hidden"),n.setAttribute("class",a),n.position_start=this._index,n.position_end=this._index+b}return i.setAttribute("fill",c.fill||MASCP.layers[a].color),c.stroke&&i.setAttribute("stroke",c.stroke),c.stroke_width?i.setAttribute("stroke-width",e._RS*c.stroke_width):i.style.strokeWidth="0",i}},e=function(a,b,c){var d=this._renderer._canvas;if(!d){var e=arguments.callee,f=this;return bean.add(this._renderer,"sequencechange",function(){bean.remove(this._renderer,"sequencechange",arguments.callee),e.call(f,a,b,c)}),void log("Delaying rendering, waiting for sequence change")}var g=d.rect(-.25+this._index,60,c||1,4);return this._renderer._layer_containers[a].push(g),g.style.strokeWidth="0px",g.setAttribute("fill",MASCP.layers[a].color),g.setAttribute("visibility","hidden"),g.setAttribute("class",a),g},f=function(a,b,c){var d=this._renderer._canvas,e=this._renderer;if("string"==typeof b){var f=document.createElement("div");e.fillTemplate(b,c,function(a,b){f.innerHTML=b}),b=f}if(!d){var g=arguments.callee,h=this;return bean.add(this._renderer,"sequencechange",function(){bean.remove(this._renderer,"sequencechange",arguments.callee),g.call(h,a,width,c)}),void log("Delaying rendering, waiting for sequence change")}var i=d.callout(this._index+.5,.01,b,{width:10*c.width||100,height:10*c.height||100,align:c.align,"font-size":c["font-size"]});return i.setHeight(c.height*this._renderer._RS),this._renderer._canvas_callout_padding=Math.max(10*c.height||100,this._renderer._canvas_callout_padding||0),this._renderer._layer_containers[a].push(i),i.clear=function(){var b=e._layer_containers[a];b.indexOf(i)>0&&b.splice(b.indexOf(i),1),i.parentNode.removeChild(i)},i},g={},h=function(a,b,c){var d=this._renderer._canvas,e=this._renderer;if(!d){var f=arguments.callee,h=this;return bean.add(this._renderer,"sequencechange",function(){bean.remove(this._renderer,"sequencechange",arguments.callee),f.call(h,a,b,c)}),void log("Delaying rendering, waiting for sequence change")}"undefined"==typeof c?c={angle:0,border:"rgb(255,0,0)",content:"A"}:"undefined"==typeof c.angle&&(c.angle=0),g[a]||(g[a]={});var i=this._index+"_"+c.angle;"auto"==c.angle&&(g[a][i]||(g[a][i]={}));var j="undefined"!=typeof g[a][i],k=c.height||this._renderer._layer_containers[a].track_height,l=k/2,m=g[a][i]?g[a][i]:d.growingMarker(0,0,c.content,c);if("auto"==c.angle&&(m.contents?m.contents.indexOf(c.content)<0&&m.contents.push(c.content):m.contents=[c.content],c.angle=1==m.contents.length?0:-45+90*(m.contents.indexOf(c.content)/(m.contents.length-1)),i=this._index+"_"+c.content,j="undefined"!=typeof g[a][i],m=g[a][i]?g[a][i]:d.growingMarker(0,l,c.content,c)),m.setAttribute("transform","translate("+(this._index+.5)*this._renderer._RS+",0.01) scale(1)"),m.setAttribute("height","250"),m.firstChild.setAttribute("transform","translate(-100,0) rotate("+c.angle+",100,0.001)"),m.angle=c.angle,g[a][i]=m,!j)if(m._value=0,this._renderer._layer_containers[a].push(m),"undefined"==typeof c.offset||null===c.offset?m.offset=0*k:(m.offset=c.offset,c.height&&(m.offset=c.offset/c.height)),m.height=k,c.height){var n=m.setHeight;m.setHeight=function(a){return arguments.callee.caller==e.redrawAnnotations?n.call(this,a):void 0}}else this._renderer._layer_containers[a].fixed_track_height=k;if(m._value+=b,!j){var o=d.circle(this._index+.5,10+k,.25);o.setAttribute("visibility","hidden"),o.style.opacity="0.4";var p=d.rect(this._index+.5,10+k,.05,0);p._index=this._index,p.style.strokeWidth="0px",p.style.fill="#777777",p.setAttribute("visibility","hidden");this._renderer._layer_containers[a].track_height;p.setHeight=function(a){if("hidden"!=this.getAttribute("visibility")){var b=m.getAttribute("transform"),c=/translate\(.*[,\s](.*)\) scale\((.*)\)/.exec(b);if(c[1]&&c[2]){var d=parseFloat(c[2]),e=parseFloat(c[1]),f=e+d*(50*(m.offset||0))-parseInt(this.getAttribute("y"));this.setAttribute("height",f)}else this.setAttribute("height",k)}},d.insertBefore(p,d.firstChild.nextSibling),this._renderer._layer_containers[a].tracers||(this._renderer._layer_containers[a].tracers=d.set()),d.tracers||(d.tracers=d.set(),d._visibleTracers=function(){return e._visibleTracers()}),this._renderer._layer_containers[a].tracers.push(p),this._renderer._layer_containers[a].tracers.push(o),d.tracers.push(p)}return this._renderer.redrawAnnotations(a,k),m},j=function(a,b,c){var e=this._index,f=Math.abs(this._renderer.scalePosition(this.original_index+b,this.accession?this.accession:a))-1,g=d.call(f>e?this:this._renderer._sequence_els[f],a,Math.abs(f-e),c);return g.aa=this.original_index,g.aa_width=b,g.acc=this.acc,g},k=function(a,c,d,e){var f=this._index,g=Math.abs(this._renderer.scalePosition(this.original_index+c,this.accession?this.accession:a))-1,h=b.call(g>f?this:this._renderer._sequence_els[g],a,Math.abs(g-f),d,e);return(e||{}).merge?(h.aa_width=parseInt(h.getAttribute("width"))/this._renderer._RS,h.aa_width==c&&(h.aa=this.original_index)):(h.aa_width=c,h.aa=this.original_index),h.acc=this.accession,h},l=function(a,b,d){var e=this._index,f=Math.abs(this._renderer.scalePosition(this.original_index+b,this.accession?this.accession:a))-1,g=c.call(f>e?this:this._renderer._sequence_els[f],a,Math.abs(f-e),d);return g.aa=this.original_index,g.aa_width=b,g.acc=this.accession,g},m=function(a,b,c){var d=this._index,f=Math.abs(this._renderer.scalePosition(this.original_index+c,this.accession?this.accession:a))-1,g=e.call(f>d?this:this._renderer._sequence_els[f],a,b,Math.abs(f-d));return g.aa=this.original_index,g.acc=this.accession,g},n=function(b,c){var d=a.call(this,b,c);return d.aa=this.original_index,d.acc=this.accession,d.aa_width=1,d};MASCP.CondensedSequenceRenderer.prototype.enableScaling=function(){bean.add(this,"readerRegistered",function(a){var b=a.gotResult,c=this;a.gotResult=function(){var d=a.acc||a.agi||"",e=c.getAminoAcidsByPosition,f=c.getAminoAcidsByPeptide,g=c.sequence;c.sequences?c.sequence=(c.sequences[c.sequences.map(function(a){return(a.agi||a.acc||"").toLowerCase()}).indexOf(d.toLowerCase())]||"").toString():g=null,c.getAminoAcidsByPosition=function(a,b,f){return c.forceTrackAccs?e.call(this,a,d,d):e.call(this,a,b||d,f||d)},c.getAminoAcidsByPeptide=function(a,b,e){return c.forceTrackAccs?f.call(this,a,d,d):f.call(this,a,b||d,e||d)},b.call(a),g&&(c.sequence=g),c.getAminoAcidsByPosition=e,c.getAminoAcidsByPeptide=f}})},MASCP.CondensedSequenceRenderer.prototype._extendElement=function(a){a.addToLayer=n,a.addBoxOverlay=k,a.addShapeOverlay=j,a.addTextOverlay=l,a.addToLayerWithLink=m,a.addAnnotation=h,a.callout=f,a._renderer=this},MASCP.CondensedSequenceRenderer.prototype.remove=function(a,b){return b&&this._layer_containers[a]&&this._layer_containers[a].indexOf(b)>=0?(this._layer_containers[a].splice(this._layer_containers[a].indexOf(b),1),bean.fire(b,"removed"),b.parentNode&&b.parentNode.removeChild(b),b.tracer&&b.tracer.parentNode&&b.tracer.parentNode.removeChild(b.tracer),b.bobble&&b.bobble.parentNode&&b.bobble.parentNode.removeChild(b.bobble),!0):!1};var o=[];MASCP.CondensedSequenceRenderer.prototype.addUnderlayRenderer=function(a){0==o.length&&bean.add(this,"zoomChange",function(){for(var a=o.length-1;a>=0;a--)o[a].call(this,this.zoom,this._canvas)}),o.push(a)};var p=function(a,b){var c=[],d=[];for(i=0;i<b.length;i++){var e=b[i],f=null;e&&(b[i+1]&&(f=b[i+1]),!f||parseInt(f.aa)-parseInt(e.aa)>10||a.sequence.substring(e,f-1).match(/[ST]/)?(c.length<3?(c.push(e),c.forEach(function(a){})):(c.push(e),c.forEach(function(a){a.options.zoom_level="text"}),d.push({aa:c[0].aa,type:"shape",width:parseInt(e.aa)-parseInt(c[0].aa)+1,options:{zoom_level:"summary",shape:"roundrect",fill:c[0].coalesce.fill,stroke:c[0].coalesce.stroke,stroke_width:c[0].coalesce.stroke_width,height:c[0].options.height,offset:c[0].options.offset}})),c=[]):c.push(e))}d.forEach(function(a){b.push(a)})};MASCP.CondensedSequenceRenderer.prototype.renderObjects=function(a,b){var c=this;b.length>0&&b[0].coalesce&&p(c,b);var d=[];return b.forEach(function(b){var e=b.options?(b.options.height||c._layer_containers[a].track_height)+(b.options.offset+b.options.height||0):0;b.options&&e>c._layer_containers[a].track_height&&(c._layer_containers[a].fixed_track_height=c._layer_containers[a].track_height+b.options.offset+(b.options.height||c._layer_containers[a].track_height));var f,g;if((!b.aa||c.getAA(parseInt(b.aa),a))&&("undefined"==typeof b.aa||!isNaN(b.aa))){if("text"==b.type&&(b.aa?g=b.width?c.getAA(parseInt(b.aa),a).addTextOverlay(a,b.width,b.options):c.getAA(parseInt(b.aa),a).addTextOverlay(a,1,b.options):b.peptide&&(g=c.getAminoAcidsByPeptide(b.peptide,a).addTtextOverlay(a,1,b.options))),"box"===b.type&&(b.aa?g=c.getAA(parseInt(b.aa),a).addBoxOverlay(a,parseInt(b.width),1,b.options):b.peptide&&(g=c.getAminoAcidsByPeptide(b.peptide,a).addToLayer(a,1,b.options))),"shape"==b.type&&(b.aa?g=c.getAA(parseInt(b.aa),a).addShapeOverlay(a,parseInt(b.width),b.options):b.peptide&&(g=c.getAminoAcidsByPeptide(b.peptide,a)[0].addShapeOverlay(a,b.peptide.length,b.options))),"line"==b.type&&(g=c.addValuesToLayer(a,b.values,b.options)),"marker"==b.type){var h=(b.options||{}).content;b.options.height;if(Array.isArray&&Array.isArray(h)){var i={};for(var j in b.options)b.options.hasOwnProperty(j)&&(i[j]=b.options[j]);f=c.getAA(parseInt(b.aa),a).addToLayer(a,i),f=f[1],f.style.display="none",b.options.content=b.options.alt_content,h=b.options.content}if("object"==typeof h){var k;"circle"==h.type&&(k=c._canvas.circle(-.5,-.5,1,1)),"text_circle"==h.type&&(k=c._canvas.text_circle(.5,.5,1,h.text,h.options||{}),b.options.break_viewbox=!0),"left_triangle"==h.type&&(k=c._canvas.poly("-100,0 0,-100 0,100")),"right_triangle"==h.type&&(k=c._canvas.poly("0,100 100,0 0,-100")),["fill","stroke","stroke-width","fill-opacity","stroke-opacity","opacity"].forEach(function(a){h[a]&&k.setAttribute(a,h[a])}),b.options.content=k}var l={};for(var j in b.options)b.options.hasOwnProperty(j)&&(l[j]=b.options[j]);var m=c.getAA(parseInt(b.aa),a).addToLayer(a,l);f&&m[1].addEventListener("click",function(){"none"===f.style.display?(f.parentNode.appendChild(f),f.style.display="block"):f.style.display="none",c.refresh()},!1),g=m[1]}(b.options||{}).zoom_level&&(g.zoom_level=b.options.zoom_level),b.identifier&&g.setAttribute("identifier",b.identifier),(b.options||{}).events&&g&&b.options.events.forEach(function(c){(c.type||"").split(",").forEach(function(d){"click"==d&&g.style&&(g.style.cursor="pointer"),g.addEventListener(d,function(d){d.event_data=c.data,d.layer=a,d.aa=b.aa})})}),d.push(g)}}),d},MASCP.CondensedSequenceRenderer.prototype.addTextTrack=function(a,b){var c=this._RS,d=MASCP.svgns,e=this,f=300,g=e._canvas,h=a.split(""),i=g.set(),j=!1,k=0,l=!0,m=function(){};try{var n=document.createElementNS(d,"text");n.setAttribute("textLength",10),m(n.textLength)}catch(o){l=!1}var p=!1;"undefined"!=typeof MASCP.supports_dx?p=MASCP.supports_dx:!function(a){if(!a)return void(p=!1);var b=document.createElementNS(d,"text");if(b.setAttribute("textLength",30),b.getExtentOfChar){b.setAttribute("x","0"),b.setAttribute("y","0"),b.textContent="ABC",g.appendChild(b);var c=b.getExtentOfChar(2).x;b.setAttribute("dx","10"),p=!(Math.abs(b.getExtentOfChar(2).x-c)<9.5),MASCP.supports_dx=p,b.parentNode.removeChild(b)}}(l);var q;if(l&&"lengthAdjust"in document.createElementNS(d,"text")&&"textLength"in document.createElementNS(d,"text"))a.length<=f?(q=g.text(0,12,document.createTextNode(a)),q.setAttribute("textLength",c*a.length)):(q=g.text(0,12,document.createTextNode(a.substr(0,f))),q.setAttribute("textLength",c*f)),g.insertBefore(q,g.firstChild.nextSibling),q.style.fontFamily="'Lucida Console', 'Courier New', Monaco, monospace",q.setAttribute("lengthAdjust","spacing"),q.setAttribute("text-anchor","start"),q.setAttribute("dx",5),q.setAttribute("dy","1.5ex"),q.setAttribute("font-size",c),q.setAttribute("fill","#000000"),i.push(q),b.push(q);else{for(var r=0;r<h.length;r++)q=g.text(k,12,h[r]),q.firstChild.setAttribute("dy","1.5ex"),i.push(q),b.push(q),q.style.fontFamily="'Lucida Console', Monaco, monospace",k+=1;i.attr({width:c,"text-anchor":"start",height:c,"font-size":c,fill:"#000000"})}var s=function(){if(!(a.length<=f)){var b=e._container_canvas.parentNode.cached_width;if(!b){b=e._container_canvas.parentNode.getBoundingClientRect().width;var d=document.documentElement.clientWidth;d>b&&(b=d)}max_size=Math.ceil(10*b*e.zoom/c),max_size>a.length&&(max_size=a.length),q.setAttribute("textLength",c*max_size);var g=parseInt(e.leftVisibleResidue());g-=50,0>g&&(g=0),g+max_size>=a.length&&(g=a.length-max_size,0>g&&(g=0)),q.replaceChild(document.createTextNode(a.substr(g,max_size)),q.firstChild),q.setAttribute(p?"dx":"x",5+g*c)}},t=function(){j&&i.attr({display:"none"})},u=function(){j&&(i.attr({display:"block"}),s())},v=function(){g.zoom>3.6?(i.attr({display:"block"}),j=!0,s()):g.zoom>.2?(i.attr({display:"none"}),j=!1):(i.attr({display:"none"}),j=!1)};return b.panevents||(g.addEventListener("panstart",t,!1),bean.add(g,"panend",u),b.panevents=!0),bean.add(g,"zoomChange",v,!1),bean.add(i[0],"removed",function(){g.removeEventListener("panstart",t),bean.remove(g,"panend",u),bean.remove(g,"zoomChange",v),delete b.panevents}),i},MASCP.CondensedSequenceRenderer.prototype.renderTextTrack=function(a,b){var c=a;"string"!=typeof c&&(c=a.name);var d=this._canvas;if(d&&"undefined"!=typeof c){var e=this._layer_containers[c],f=this.addTextTrack(b,e);return f}},MASCP.CondensedSequenceRenderer.prototype.resetAnnotations=function(){g={}},MASCP.CondensedSequenceRenderer.prototype.removeAnnotations=function(a){var b=a;"string"!=typeof b&&(b=a.name);var c=this._canvas;if(c&&"undefined"!=typeof b){for(var d in g[b])if(g[b].hasOwnProperty(d)){var e=g[b][d],f=this._layer_containers[b];if(f.indexOf(e)>=0&&f.splice(f.indexOf(e),1),c.tracers&&f.tracers){for(var h=0;h<f.tracers.length;h++){var i=f.tracers[h];i.parentNode.removeChild(i),c.tracers.indexOf(i)>=0&&c.tracers.splice(c.tracers.indexOf(i),1)}f.tracers=c.set()}e.parentNode&&e.parentNode.removeChild(e),g[b][d]=null}g[b]=null,delete g[b],delete this._layer_containers[b].fixed_track_height}},MASCP.CondensedSequenceRenderer.prototype.redrawAnnotations=function(a){var b=this._canvas,c=null,d=0,e=b.suspendRedraw(1e4),f=0;for(d in g[a])if(g[a].hasOwnProperty(d)){if(g[a][d]._value>f&&(f=g[a][d]._value),c=g[a][d].parentNode,!c)continue;c.removeChild(g[a][d]),g[a][d]._parent=c}for(d in g[a])if(g[a].hasOwnProperty(d)){var h=g[a][d],i=h.height;this._layer_containers[a].fixed_track_height||this._layer_containers[a].track_height;if(!h.setHeight)continue;var j=(.4+.6*h._value/f)*(this._RS*i*1);h.setHeight(j)}for(d in g[a])if(g[a].hasOwnProperty(d)){if(c=g[a][d]._parent,!c)continue;c.appendChild(g[a][d])}b.unsuspendRedraw(e)},function(a){var b={},c=!1,d=function f(a,c){var d=/\W/.test(a)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").split(/\x3c\%/g).join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):b[a]=b[a]||f(document.getElementById(a).innerHTML);return c?d(c):d};try{new Function("return;")}catch(e){c=!0}return c?void(a.fillTemplate=function(a,b,c){MASCP.SANDBOX.contentWindow.postMessage({template:document.getElementById(a).innerHTML,data:b},"*");var d=function(a){bean.remove(window,"message",d),a.data.html&&c.call(null,null,a.data.html)};bean.add(window,"message",d)}):void(a.fillTemplate=function(a,b,c){c.call(null,null,d(a,b))})}(MASCP.CondensedSequenceRenderer.prototype)}(),MASCP.CondensedSequenceRenderer.prototype.EnableHighlights=function(){var a=this,b=[],c=function(){var c=a._canvas.rect(0,0,0,"100%");c.setAttribute("fill","#ffdddd"),c.removeAttribute("stroke");var d=c.parentNode;d.insertBefore(c,d.firstChild.nextSibling),b.push(c)};c(),a.moveHighlight=function(){var a=Array.prototype.slice.call(arguments),d=this._RS,e=0,f=0;for(e=0;e<a.length;e+=2){var g=a[e],h=a[e+1],i=b[f];i||(c(),i=b[f]),i.previousSibling.previousSibling&&b.indexOf(i.previousSibling.previousSibling)<0&&i.parentNode.insertBefore(i,i.parentNode.firstChild.nextSibling),i.setAttribute("x",(g-1)*d),i.setAttribute("width",(h-(g-1))*d),i.setAttribute("visibility","visible"),f+=1}for(e=f;e<b.length;e++)b[e].setAttribute("visibility","hidden")}},function(){var a=function(a,b){"ontouchstart"in window?a.addEventListener("touchstart",function(c){var d=c.touches[0].clientX,e=c.touches[0].clientY,f=function(){document.body.removeEventListener("touchmove",h),a.removeEventListener("touchend",g)},g=function(a){f(),a.stopPropagation(),a.preventDefault(),b&&b.call(null,a)},h=function(a){(Math.abs(a.touches[0].clientX-d)>10||Math.abs(a.touches[0].clientY-e)>10)&&f()};document.body.addEventListener("touchmove",h,!1),a.addEventListener("touchend",g,!1)},!1):a.addEventListener("click",b,!1)},b=function(a){var b=0,c=0;return a||(a=window.event),a.pageX||a.pageY?(b=a.pageX-(document.body.scrollLeft+document.documentElement.scrollLeft),c=a.pageY-(document.body.scrollTop+document.documentElement.scrollTop)):(a.clientX||a.clientY)&&(b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c=a.clientY+document.body.scrollTop+document.documentElement.scrollTop),self.targetElement&&(b=a.screenX,c=a.screenY),[b,c]},c=function(a,c){var d=b(a.changedTouches?a.changedTouches[0]:a),e={};if("svg"==c.nodeName){e=c.createSVGPoint();var f=c.getScreenCTM();e.x=d[0],e.y=d[1],self.matrix=f.inverse(),e=e.matrixTransform(self.matrix)}else e.x=d[0],e.y=d[1];return e},d=function(a,b,c){for(var d in MASCP.layers){var e=MASCP.getLayer(d);a&&b?bean.fire(e,"selection",[c.scalePosition(a,d,!0),c.scalePosition(b,d,!0)]):bean.fire(e,"selection",[null,null])}};MASCP.CondensedSequenceRenderer.prototype.enableSelection=function(e){var f=this;if(!f._canvas)return void bean.add(f,"sequenceChange",function(){f.enableSelection()});var g,h,i,j,k=f._canvas,l=function(a){a.preventDefault();var b=c(a,k);h=b.x,g>h?(j=parseInt(g/50),i=parseInt(h/50)):(j=parseInt(h/50),i=parseInt(g/50)),f.select(i+1,j)};a(k,function(a){f.selecting||(f.select(),d(null,null,f),i=null,j=null)}),k.addEventListener("mousedown",function(a){if(f.selecting){var c=b(a),d={};if("svg"==k.nodeName){d=k.createSVGPoint();var e=this.getScreenCTM();d.x=c[0],d.y=c[1],f.matrix=e.inverse(),d=d.matrixTransform(f.matrix)}else d.x=c[0],d.y=c[1];g=d.x,h=d.x,k.addEventListener("mousemove",l,!1),a.preventDefault()}},!1),k.addEventListener("mouseup",function(a){f.selecting&&(d(i+1,j,f),i=null,j=null),k.removeEventListener("mousemove",l),a.preventDefault()}),k.addEventListener("touchend",function(){f.selecting&&setTimeout(function(){d(i+1,j,f),i=null,j=null},500),k.removeEventListener("touchmove",l)}),k.addEventListener("touchstart",function(a){if(f.selecting&&1==a.changedTouches.length){a.preventDefault();var c=b(a.changedTouches[0]),d={};if("svg"==k.nodeName){d=k.createSVGPoint();var e=this.getScreenCTM();d.x=c[0],d.y=c[1],f.matrix=e.inverse(),d=d.matrixTransform(f.matrix)}else d.x=c[0],d.y=c[1];g=d.x,h=d.x,k.addEventListener("touchmove",l,!1)}},!1)}}(),MASCP.CondensedSequenceRenderer.prototype._visibleTracers=function(){var a=null;for(var b in MASCP.layers)this.isLayerActive(b)&&this._layer_containers[b]&&this._layer_containers[b].tracers&&(a?a.concat(this._layer_containers[b].tracers):a=this._layer_containers[b].tracers);return a},MASCP.CondensedSequenceRenderer.prototype._resizeContainer=function(){this._RS;if(this._container&&this._canvas){var a=2*(this.zoom||1)*this.sequence.length,b=2*(this.zoom||1)*(this._canvas._canvas_height/this._RS);this._canvas_callout_padding&&(b+=this._canvas_callout_padding),this._canvas.setAttribute("width",a),this._canvas.setAttribute("height",b),this.navigation.setDimensions(a,b),this.grow_container?this._container_canvas.setAttribute("height",b):(this._container_canvas.setAttribute("height","100%"),this._container_canvas.setAttribute("width","100%"),this.navigation.setZoom(this.zoom))}},function(a){var b=MASCP.svgns,c=function(a,b){var c=this;!a._layer_containers[c.name]||a._layer_containers[c.name].length<=0||b||a._layer_containers[c.name].tracers&&a._layer_containers[c.name].tracers.hide()};a.prototype.addTrack=function(a){var b=(this._RS,this);if(!this._canvas)return bean.add(this,"sequencechange",function(){this.addTrack(a),bean.remove(this,"sequencechange",arguments.callee)}),void console.log("No canvas, cannot add track, waiting for sequencechange event");var d=this._layer_containers||[];if(!d[a.name]||null===d[a.name]){d[a.name]=this._canvas.set(),d[a.name].track_height||(d[a.name].track_height=b.trackHeight||4),bean.remove(a,"visibilityChange",c),bean.add(a,"visibilityChange",c);bean.remove(a,"removed"),bean.add(a,"removed",function(a){a?a.removeTrack(this):b.removeTrack(this)})}this._layer_containers=d},a.prototype.removeTrack=function(a){if(this._layer_containers){var b=this._layer_containers||[];b[a.name]&&(this.removeAnnotations(a),this._layer_containers[a.name]=null,a.disabled=!0)}};a.prototype.disablePrintResizing=function(){delete this._media_func},a.prototype.enablePrintResizing=function(){if((this.win()||window).matchMedia){if(this._media_func)return this._media_func;this._media_func=function(a){var b=this;if(b._canvas)if(b.grow_container)if(a.matches){var c=10*parseInt(b.leftVisibleResidue()/10)+10;b._canvas.ownerSVGElement.getElementById(b.axis_pattern_id).setAttribute("x",c*b._RS),delete b._container_canvas.parentNode.cached_width,bean.fire(b._canvas,"panend")}else b._canvas.ownerSVGElement.getElementById(b.axis_pattern_id).setAttribute("x","0");else{var d=a;if(d.matches)try{var e=b._container;b.old_translate=b._canvas.currentTranslate.x,b._canvas.setCurrentTranslateXY(0,0);var f=.95*e.clientWidth/b.sequence.length;b.old_zoom||(b.old_zoom=b.zoom,b.old_viewbox=b._container_canvas.getAttribute("viewBox")),b.zoomCenter=null,b._container_canvas.removeAttribute("viewBox"),b.withoutRefresh(function(){b.zoom=f}),b.refresh()}catch(g){console.log(g),console.log(g.stack)}else if(b.old_zoom){var h=b.old_zoom;b.old_zoom=null,b.zoomCenter=null,b.withoutRefresh(function(){b.zoom=h}),b._canvas.setCurrentTranslateXY(b.old_translate,0),b._container_canvas.setAttribute("viewBox",b.old_viewbox),b.old_zoom=null,b.old_translate=null,b.refresh(),bean.fire(b._canvas,"zoomChange")}}};var a=this;a._bound_media||(this.win()||window).matchMedia("print").addListener(function(b){a._media_func&&a._media_func(b)}),a._bound_media=!0}},a.prototype.wireframe=function(){var a=this.trackOrder||[],b=0,c=0;if(this.wireframes){for(;this.wireframes.length>0;)this._canvas.removeChild(this.wireframes.shift());for(var d=0;d<a.length;d++){var e=a[d],f=this._layer_containers[e];if(this.isLayerActive(e))if(f.fixed_track_height){var g=f.fixed_track_height;b=this._axis_height+(c-.3*g)/this.zoom;var h=this._canvas.rect(0,b,1e4,.5*g);h.setAttribute("stroke","#ff0000"),h.setAttribute("fill","none"),this.wireframes.push(h);var h=this._canvas.rect(0,b,1e4,g);h.setAttribute("stroke","#ff0000"),h.setAttribute("fill","none"),this.wireframes.push(h),c+=this.zoom*g+this.trackGap}else{b=this._axis_height+c/this.zoom;var h=this._canvas.rect(0,b,1e4,.5*f.track_height/this.zoom);h.setAttribute("stroke","#ff0000"),h.setAttribute("fill","none"),this.wireframes.push(h),h=this._canvas.rect(0,b,1e4,f.track_height/this.zoom),h.setAttribute("stroke","#ff0000"),h.setAttribute("fill","none"),this.wireframes.push(h),this.navigation&&(c+=f.track_height),c+=f.track_height+this.trackGap}}}},a.prototype.refresh=function(a){if(this._canvas){var b=this._layer_containers||[],c=this._RS,d=0,e=this.trackOrder||[],f=this.fixedFontScale;this.navigation&&this.navigation.reset();for(var g=0;g<e.length;g++){var h=e[g],i=b[h];if(i){var j;if(this.isLayerActive(h)){var k=d;if(i.fixed_track_height){i.fixed_track_height;j=this._axis_height+d/this.zoom,a?i.animate({visibility:"visible",y:j*c,height:c*i.track_height/this.zoom}):i.attr({visibility:"visible",y:j*c,height:c*i.track_height/this.zoom}),this.navigation&&(j-=1*i.track_height/this.zoom,this.navigation.renderTrack(MASCP.getLayer(h),j*c,c*i.fixed_track_height/this.zoom,{"font-scale":3*(f||1)*i.track_height/i.fixed_track_height})),d+=i.fixed_track_height+this.trackGap-i.track_height}else j=this._axis_height+d/this.zoom,a?i.animate({visibility:"visible",y:j*c,height:c*i.track_height/this.zoom}):i.attr({visibility:"visible",y:j*c,height:c*i.track_height/this.zoom}),this.navigation&&(j-=1*i.track_height/this.zoom,this.navigation.renderTrack(MASCP.getLayer(h),j*c,3*c*i.track_height/this.zoom,f?{"font-scale":f}:null),d+=i.track_height),d+=i.track_height+this.trackGap;if(i.refresh_zoom(),i.tracers){var l=this.isLayerActive(h)&&this.zoom>3.6?"visible":"hidden",m=(1.5+k/this.zoom)*c;a?i.tracers.animate({visibility:l,y:.65*this._axis_height*c,height:m}):i.tracers.attr({visibility:l,y:.65*this._axis_height*c,height:m})}}else{var n={y:-1*this._axis_height*c,height:c*i.track_height/this.zoom,visibility:"hidden"};if(MASCP.getLayer(h).group){var o=this.navigation.getController(MASCP.getLayer(h).group);o&&this.isLayerActive(o)&&(n.y=b[o.name].currenty())}i.fixed_track_height&&delete n.height,a?i.animate(n):i.attr(n),i.tracers}}}this.wireframe();var p=[-1,0,0,0];p[0]=-2*c,p[2]=(this.sequence.split("").length+this.padding+2)*c,p[3]=(this._axis_height+d/this.zoom+this.padding/this.zoom)*c,this._canvas.setAttribute("viewBox",p.join(" ")),this._canvas._canvas_height=p[3];var q=[].concat(p);q[0]=0,q[2]=this.zoom*(2*this.sequence.length)+this.padding,q[3]=2*this.zoom*(this._axis_height+d/this.zoom+this.padding/this.zoom),this.grow_container?this._container_canvas.removeAttribute("viewBox"):this._container_canvas.setAttribute("viewBox",q.join(" ")),this._resizeContainer(),p[0]=0,this.navigation&&(this.navigation.nav_width_base=q[3]<200?q[3]:200,this.navigation.visible()?this._canvas.style.GomapScrollLeftMargin=100*c/this.zoom:this._canvas.style.GomapScrollLeftMargin=1e3,this.navigation.setViewBox(p.join(" "))),this.navigation&&this.navigation.refresh()}};var d=function(a){a.setAttribute("xmlns","http://www.w3.org/2000/svg"),a.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");var b=(new XMLSerializer).serializeToString(a);return"data:image/svg+xml,"+encodeURIComponent(b)};a.prototype.pngURL=function(a,c){for(var e=this._canvas.cloneNode(!0),f=e.querySelectorAll("text[data-spaces]"),g=0;g<f.length;g++)f[g].parentNode.removeChild(f[g]);var h=document.createElementNS(b,"svg");h.setAttribute("width",this._container_canvas.getBoundingClientRect().width),h.setAttribute("height",this._container_canvas.getBoundingClientRect().height),h.setAttribute("preserveAspectRatio","xMinYMin meet");var i=document.createElementNS(b,"g");i.setAttribute("transform",this._canvas.parentNode.getAttribute("transform")),h.appendChild(i),i.appendChild(e);for(var j=this._container_canvas.querySelectorAll("defs"),g=0;g<j.length;g++)h.appendChild(j[g].cloneNode(!0));var k=document.createElement("canvas"),l=2*parseInt(h.getAttribute("width")),m=2*parseInt(h.getAttribute("height"));if(c&&l>c){var n=l/c;l=c,m=parseInt(m/n)}k.width=l,k.height=m;var o=new Image;o.width=1,o.height=1;var p=k.getContext("2d");o.onload=function(){p.drawImage(o,0,0,k.width,k.height),a(k.toDataURL())},o.onerror=function(){console.log("Got an error")};var q=d(h);o.src=q}}(MASCP.CondensedSequenceRenderer),MASCP.CondensedSequenceRenderer.Zoom=function(a){var b,c,d=null,e=null,f=null,g=null,h=null,i={setZoom:function(i){var j=a._container.cached_width;if(j||(j=a._container.clientWidth),!a.sequence)return void(f=i);var k=j/(2*a.sequence.length);a.grow_container||(k=.15*k),k>i&&(i=k),i>10&&(i=10);var l=this;if(i!=f){if(!l._canvas)return void(f=i);var m=!1;if("center"==l.zoomCenter&&(m=!0,l.zoomCenter={x:.5*l._RS*(l.leftVisibleResidue()+l.rightVisibleResidue())}),l.zoomCenter&&!g)h=l._canvas.currentTranslate.x||0,g=l.zoomCenter?l.zoomCenter.x:0;else if(g&&!l.zoomCenter)return;d?clearTimeout(d):e=parseFloat(f||1),f=parseFloat(i);var n=Math.abs(parseFloat(i)/e);if(window.cancelAnimationFrame(b),b=window.requestAnimationFrame(function(){console.log("Setting transform");var a=l._canvas.parentNode.getAttribute("transform")||"";a=a.replace(/scale\([^\)]+\)/,""),a="scale("+n+") "+(a||""),l._canvas.parentNode.setAttribute("transform",a)}),bean.fire(l._canvas,"_anim_begin"),document.createEvent){var o=document.createEvent("Events");o.initEvent("panstart",!1,!0),l._canvas.dispatchEvent(o)}l._canvas.currentTranslate.x;if(g){var p=(e-f)/(25*n)*g;p+=h/n,cancelAnimationFrame(c),c=window.requestAnimationFrame(function(){l._canvas.setCurrentTranslateXY(p,(e-f)/n*l._axis_height*2)})}var q=function(){d=null;var a=(Math.abs(parseFloat(f)/e),l._canvas.parentNode.getAttribute("transform")||"");a=a.replace(/scale\([^\)]+\)/,""),l._canvas.parentNode.setAttribute("transform",a),bean.fire(l._canvas,"panend"),bean.fire(l._canvas,"_anim_end"),bean.add(l._canvas,"zoomChange",function(){if(bean.remove(l._canvas,"zoomChange",arguments.callee),l.refresh(),"undefined"!=typeof g){var a=(e-f)/25*g;a+=h,l._resizeContainer(),l._canvas.shiftPosition?l._canvas.shiftPosition(a,0):l._canvas.setCurrentTranslateXY(a,0)}g=null,h=null}),l._canvas&&(l._canvas.zoom=parseFloat(f),bean.fire(l._canvas,"zoomChange")),bean.fire(l,"zoomChange")};"ontouchend"in document&&l.zoomCenter&&!m?(bean.remove(l,"gestureend"),bean.add(l,"gestureend",function(){bean.remove(l,"gestureend",arguments.callee),q()}),d=1):this.refresh.suspended?q():d=setTimeout(q,100)}else if(this.refresh.suspended&&l._canvas&&l._canvas.zoom!==parseFloat(f)){l._canvas.zoom=parseFloat(f);var r=l._canvas.parentNode.getAttribute("transform")||"";r=r.replace(/scale\([^\)]+\)/,"");var n=1;r="scale("+n+") "+(r||""),l._canvas.parentNode.setAttribute("transform",r),bean.fire(l._canvas,"zoomChange")}},fitZoom:function(){var b=a._container.cached_width;b||(b=a._container.clientWidth);var c=.5;
a.sequence&&(c=b/(2*a.sequence.length)),a.zoom=c},getZoom:function(){return f||1}};Object.defineProperty&&!MASCP.IE8&&Object.defineProperty(a,"zoom",{get:i.getZoom,set:i.setZoom}),a.fitZoom=i.fitZoom},function(a){var b={getPadding:function(){return this._padding||10},setPadding:function(a){this._padding=a,this.refresh()},getTrackGap:function(){if(!this._track_gap){var a="ontouchend"in document?20:10;this._track_gap=this._track_gap||a}return this._track_gap},setTrackGap:function(a){this._track_gap=a,this.refresh()}};Object.defineProperty&&!MASCP.IE8&&(Object.defineProperty(a.prototype,"padding",{get:b.getPadding,set:b.setPadding}),Object.defineProperty(a.prototype,"trackGap",{get:b.getTrackGap,set:b.setTrackGap}))}(MASCP.CondensedSequenceRenderer),MASCP.CondensedSequenceRenderer.Navigation=function(){var a=MASCP.svgns,b=1,c=!1;"ontouchend"in document&&(b=window.devicePixelRatio,c=!0);var d=function(b,c){SVGCanvas(b),this.win=function(){return c.win()},g.call(this,b);var d=b.group();b.insertBefore(d,b.lastChild);var f=document.createElementNS(a,"svg");h.call(this,f,e.call(this,c)),d.appendChild(f),d.setAttribute("clip-path","url(#"+this.clipping_id+")"),this.disable=function(){b.style.display="none",f.style.display="none"},this.enable=function(){b.style.display="block",f.style.display="block"},this.demote=function(){f.hide()},this.promote=function(){this.visible()?f.show():f.hide()},this.setDimensions=function(a,c){b.setAttribute("width",a),b.setAttribute("height",c)}},e=function(a){var b={},c={},d=a.removeTrack;return a.removeTrack=function(a){d.call(this,a),delete b[a.name],delete c[a.name]},this.isController=function(a){return!!b[a.name]},this.getController=function(a){for(var c in b)if(b.hasOwnProperty(c)&&b[c]==a)return MASCP.getLayer(c);return null},this.isControllerExpanded=function(a){return c[a.name]},a.createGroupController=function(d,e){var f=MASCP.getLayer(d),g=MASCP.getGroup(e);if(f&&g&&!b[f.name]){b[f.name]=g,c[f.name]=!1;var h=this;bean.add(f,"removed",function(a,b){h.setGroupVisibility(g)}),bean.add(f,"visibilityChange",function(b,d){g.size()>0&&(c.hasOwnProperty(f.name)||(c[f.name]=!1),h.setGroupVisibility(g,c[f.name]&&d,!0),a.refresh())}),bean.add(g,"visibilityChange",function(a,b){b&&(h.showLayer(f,!0),c[f.name]=!0)}),bean.remove(f,"_expandevent"),bean.add(f,"_expandevent",function(a){c[f.name]=!c[f.name],h.withoutRefresh(function(){h.setGroupVisibility(g,c[f.name])}),h.refresh(!0)})}},f(function(c,d,e){var f=a.trackOrder;f.trackIndex=function(a){return a?this.indexOf(a.name):this.length},e&&!d&&(d=MASCP.getLayer(f[f.trackIndex(e)+1])),f.splice(f.trackIndex(c),1);var g=[];if(b[c.name]&&MASCP.getGroup(b[c.name]).eachLayer(function(a){MASCP.getGroup(a)===a&&MASCP.getGroup(a).eachLayer(arguments.callee),f.trackIndex(a)>=0&&(g=[f.splice(f.trackIndex(a),1)[0]].concat(g))}),d){f.splice(f.trackIndex(d),1,c.name,d?d.name:void 0);for(var h=0;h<g.length;h++)g[h]&&f.splice(f.trackIndex(d),0,g[h])}else a.hideLayer(c),MASCP.getLayer(c).disabled=!0,g.forEach(function(b){a.hideLayer(b),MASCP.getLayer(b).disabled=!0}),f.push(c.name),f=f.concat(g);a.trackOrder=f})},f=function(a){var b,d,e,f=[],g=!1,h={},i=null,j=function(j,l,m,n){var o=this,p=o.reset;null===i&&(o.reset=function(){f=[],p.call(this)},i=!0);var q=function(){window.clearTimeout(h.anim),window.clearTimeout(h.hover);for(var a=0;a<f.length;a++)f[a]!=b&&(f[a].removeAttribute("dragging"),f[a].removeAttribute("transform"),f[a].setAttribute("pointer-events","all"))};f.push(l),l.track=m;var r=function(a){return function(b){b.touches&&1==b.touches.length&&a.call(this,b)}},s=function(h,i,j){if(!k()){var l=n.nearestViewportElement;if(!g){j.setAttribute("dragging","true"),spliceBefore=null,spliceAfter=null;var o=j.nearestViewportElement.createSVGPoint();o.x=h.clientX||window.pageXOffset+h.touches[0].clientX,o.y=h.clientY||window.pageYOffset+h.touches[0].clientY;var p=j.nearestViewportElement.getScreenCTM(),s=p.inverse();o=o.matrixTransform(s);var t=o.x,v=o.y,w=function(a){var b=j.nearestViewportElement.createSVGPoint();b.x=a.clientX||window.pageXOffset+a.touches[0].clientX,b.y=a.clientY||window.pageYOffset+a.touches[0].clientY,b=b.matrixTransform(s);var c=b.x-t,d=b.y-v,e=j.getAttribute("transform")||"";return e=e.replace(/\s?translate\([^\)]+\)/,""),e+=" translate("+c+","+d+") ",e=e.replace(/\s*$/,""),j.setAttribute("transform",e),f.forEach(function(c){var d=c.getBBox();d.y<b.y&&d.y>b.y-d.height&&d.x<b.x&&d.x>b.x-d.width&&u.call(c,a,c.track)}),a.stopPropagation(),a.preventDefault(),!1};c&&(w=r(w));var x=function(b){return!b.relatedTarget||b.relatedTarget!=j&&b.relatedTarget.nearestViewportElement!=j.nearestViewportElement&&b.relatedTarget.nearestViewportElement!=l?(!g||"mouseup"!=b.type&&"touchend"!=b.type||(spliceBefore||spliceAfter)&&a(d,spliceBefore,spliceAfter),l.removeEventListener("touchmove",w,!1),l.removeEventListener("mousemove",w,!1),l.removeEventListener("touchend",arguments.callee,!1),l.removeEventListener("mouseup",arguments.callee,!1),l.removeEventListener("mouseout",arguments.callee,!1),void(g&&(j.setAttributeNS(null,"pointer-events","all"),j.removeAttribute("transform"),q(),g=!1,e=null))):void(g&&f.indexOf(b.relatedTarget)>=0&&q())};j.setAttributeNS(null,"pointer-events","none"),j.addEventListener("touchmove",w,!1),j.addEventListener("touchend",x,!1),l.addEventListener("mousemove",w,!1),l.addEventListener("mouseup",x,!1),l.addEventListener("mouseout",x,!1),g=m,b=j}}},t=function(a){s(a,m,l)},u=function(a,c){var i=c?c:m,j=this?this:l;g&&g!=i&&i!=e&&(e=i,h.hover&&window.clearTimeout(h.hover),h.hover=window.setTimeout(function(){if((g.group||i.group)&&(g.group?i.group:!i.group)){if(g.group.name!=i.group.name)return}else if(g.group||i.group)return;h.anim&&(window.clearInterval(h.anim),h.anim=null),q();for(var a=j,c=[];null!==a&&(a!=b&&f.indexOf(a)>=0&&c.push(a),a=a.nextSibling,a!=b););a=j.previousSibling;for(var e=[];null!==a&&(a!=b&&f.indexOf(a)>=0&&e.push(a),a=a.previousSibling,a!=b););var k=1,l=b.getBBox().height/4;h.anim=window.setInterval(function(){var a,b=0;if(5>k){for(b=0;b<c.length;b++)a=c[b].getAttribute("transform")||"",a=a.replace(/\s?translate\([^\)]+\)/,""),a+=" translate(0,"+k*l+")",c[b].setAttribute("transform",a);for(b=0;c.length>0&&b<e.length;b++)a=e[b].getAttribute("transform")||"",a=a.replace(/\s?translate\([^\)]+\)/,""),a+=" translate(0,"+-1*k*l+")",e[b].setAttribute("transform",a);k+=1}else spliceBefore=i,d=g,window.clearInterval(h.anim),h.anim=null},30)},300))};j.addEventListener("mousedown",t,!1),j.addEventListener("touchstart",r(t),!1)},k=function(){return j.disabled};return j.spliceFunction=a,j},g=function(d){var e=this;e.zoom=1,e.nav_width_base=200+100*(b-1);var f=e.nav_width_base;e.nav_width=e.nav_width_base;var g=d.group(),h=d.group(),i=d.rect(-10,0,f.toString(),"100%"),j=[12*b,10*b];i.setAttribute("rx",j[0].toString()),i.setAttribute("ry",j[1].toString()),c||i.setAttribute("opacity","0.8"),i.style.stroke="#000000",i.style.strokeWidth="2px",i.style.fill="#000000",i.id="nav_back",g.push(i),e.clipping_id="nav_clipping"+(new Date).getTime();var k=document.createElementNS(a,"clipPath");k.id=e.clipping_id;var l=i.cloneNode();l.removeAttribute("id"),l.removeAttribute("opacity"),l.setAttribute("x","0"),l.setAttribute("width",""+(parseInt(l.getAttribute("width"))-10)),l.removeAttribute("style"),l.setAttribute("height","10000"),d.insertBefore(k,d.firstChild),k.appendChild(l);var m=d.crossed_circle(f-(10+11*b),12*b,10*b);m.style.cursor="pointer","undefined"!=typeof matchMedia&&(this.win()||window).matchMedia("print").addListener(function(a){a.matches?(m.setAttribute("display","none"),n.setAttribute("display","none")):(m.setAttribute("display","block"),n.setAttribute("display","none"))}),h.push(m);var n=MASCP.IE?d.svgbutton(10,5,65,25,"Edit"):d.button(10,5,65,25,"Edit");n.id="controls",n.parentNode.setAttribute("clip-path","url(#"+e.clipping_id+")"),g.push(MASCP.IE?n:n.parentNode),n.addEventListener("click",function(){bean.fire(e,"toggleEdit"),bean.fire(e,"click")},!1),g.setAttribute("style","transition: all 0.25s;");var o=n.getAttribute("style"),p=""+(f-(10+11*b))+"px "+12*b+"px;",q=" -webkit-transform-origin: "+p+" -ms-transform-origin: "+p+" -moz-transform-origin: "+p+" transform-origin: "+p,r=function(a,b){var c=" translate3d("+a+"px,0px,0px)";return b&&(c=c+" rotate("+b+")"),"-webkit-transform:"+c+"; -moz-transform:"+c+"; -ms-transform:"+c.replace("3d","").replace(",0px)",")")+"; transform: "+c+";"};n.setAttribute("style",o+" transition: all 0.25s;"),m.setAttribute("style","transition: all 0.25s; "+q);var s=!0,t=function(a,c){s=a===!1||a===!0?a:!s;var d,f=c?"transition: all ease-in-out 0.4s;":"";return s?(e.promote(),g.setAttribute("visibility","visible"),g.setAttribute("style",f+r(0)),n.setAttribute("style",o+" "+f),m._button.removeAttribute("filter"),("ontouchend"in window||window.getComputedStyle(m).getPropertyValue("-ms-transform"))&&(d=m.getAttribute("transform")||" ",d=d.replace(/translate\(.*\)/,""),d=d.replace(/rotate\(.*\)/,""),m.setAttribute("transform",d)),m.setAttribute("style",f+r(0)+q),e.refresh()):(e.demote(),m.setAttribute("style",f+q+r(-.75*e.nav_width_base,"405deg")),"ontouchend"in window||window.getComputedStyle(m).getPropertyValue("-ms-transform")?(d=m.getAttribute("transform")||" ",d=d+" translate("+-.75*e.nav_width_base+",0) rotate(45,"+(e.nav_width_base-(10+11*b))+","+12*b+") ",m.setAttribute("transform",d),g.setAttribute("visibility","hidden")):(g.setAttribute("style",f+r(-1*e.nav_width*e.zoom)),n.setAttribute("style",o+" "+f+r(-1*e.nav_width*e.zoom)))),!0};e.hide=function(a){t.call(this,!1,a)},e.show=function(a){t.call(this,!0,a)},e.visible=function(){return s},e.setZoom=function(a){e.nav_width=e.nav_width_base/a,m.setAttribute("transform","scale("+a+","+a+") ");var c=""+(e.nav_width_base-(10+11*b))+"px "+12*b+"px;";q=" -webkit-transform-origin: "+c+" -ms-transform-origin: "+c+" -moz-transform-origin: "+c+" transform-origin: "+c,m.move(e.nav_width_base-(10+11*b),12*b),i.setAttribute("transform","scale("+a+",1) "),i.setAttribute("ry",j[1].toString()),i.setAttribute("rx",(j[0]/a).toString()),i.setAttribute("x",parseInt(-10/a).toString()),i.setAttribute("width",e.nav_width.toString()),e.zoom=a,t.call(this,s),e.refresh()},m.addEventListener("click",function(){s?e.hide(!0):e.show(!0)},!1)},h=function(a,d){var e,f,g,h=this,i=0;SVGCanvas(a),a.setAttribute("preserveAspectRatio","xMinYMin meet");var j=[];h.reset=function(){for(;a.firstChild;)a.removeChild(a.firstChild);j=[],k=[]};var k=[];h.isEditing=function(){return g},h.refresh=function(){if((e||[]).forEach(function(a){a.setAttribute("visibility",g?"visible":"hidden")}),(f||[]).forEach(function(a){a.setAttribute("visibility",g?"hidden":"visible")}),g?l.call(this,!0):l.call(this,!1),"none"!=a.getAttribute("display")&&"none"!=a.style.display&&!(k.length<1)){var b=a.ownerSVGElement.getElementById("nav_back"),c=b.getScreenCTM().inverse().multiply(a.getScreenCTM()).inverse(),d=b.getBBox().width+b.getBBox().x,h=a.createSVGPoint();h.x=d,h.y=0,i=h.matrixTransform(c).x,k.forEach(function(a){var b=0;try{b=a.getBBox().width}catch(c){}if(b>0){var d=/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/.exec(a.getAttribute("transform")||"");if("undefined"==typeof d)return;d=d[2];var e=i-1.5*parseInt(a.getAttribute("width"),10);a.setAttribute("transform","translate("+e+","+d+")")}})}};var l=function(a){j&&(j||[]).forEach(function(b){b.setAttribute("opacity",a?"1":c?"0.5":"0.1"),b.setAttribute("pointer-events",a?"all":"none"),a?b.parentNode.setAttribute("dragenabled","true"):b.parentNode.removeAttribute("dragenabled")})};bean.add(h,"toggleEdit",function(){g="undefined"==typeof g?!0:!g,d.disabled=!g,l.call(h,g),h.hide(),h.show(),(e||[]).forEach(function(a){a.setAttribute("visibility",g?"visible":"hidden")}),(f||[]).forEach(function(a){a.setAttribute("visibility",g?"hidden":"visible")})}),this.setViewBox=function(b){a.setAttribute("viewBox",b)},a.style.height="100%",a.style.width="100%",a.setAttribute("height","100%"),a.setAttribute("width","100%"),this.renderTrack=function(g,l,m,n){var o=a.group(),p=a.rect(0,l,"100%",m);p.setAttribute("stroke","#000000"),p.setAttribute("stroke-width","2"),p.setAttribute("fill","url(#simple_gradient)"),p.setAttribute("opacity",c?"0.5":"0.1"),p.setAttribute("pointer-events","none"),j=j||[],j.push(p),o.push(p);var q=n&&n["font-scale"]?n["font-scale"]:1,r=4/3*b*m*q,s=a.text(r,l+.5*m,g.fullname||g.name);s.setAttribute("height",m),s.setAttribute("width",m),s.setAttribute("font-size",.6*m*q),s.setAttribute("fill","#ffffff"),s.setAttribute("stroke","#ffffff"),s.setAttribute("stroke-width","0"),s.firstChild.setAttribute("dy","0.5ex"),o.push(s),s.setAttribute("pointer-events","none");var t;if(g.href){a_anchor=a.a(g.href);var u=null,v=[.5*m*q,0,m*q*b];v[1]=-.5*(v[2]-m),t=a.circle(v[0]+.5*v[2],.5*m,.5*v[2]),t.setAttribute("fill","#ffffff"),t.setAttribute("opacity","0.1"),a_anchor.appendChild(t);var w=g.href;"string"==typeof w&&w.match(/^javascript\:/)?u="#plus_icon":"function"==typeof w?(u="#plus_icon",a_anchor.setAttribute("href","#"),a_anchor.removeAttribute("target"),a_anchor.addEventListener("click",function(a){return w.call(),a.preventDefault?a.preventDefault():a.returnResult=!1,a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,!1},!1)):u="#new_link_icon",g.icon&&(u=g.icon);var x=a.use(u,v[0],v[1],v[2],v[2]);x.style.cursor="pointer",a_anchor.appendChild(x),a_anchor.setAttribute("transform","translate("+(i-1.5*v[2])+","+l+")"),a_anchor.setAttribute("width",v[2].toString()),k.push(a_anchor)}if(o.addEventListener("touchstart",function(){o.onmouseover=void 0,o.onmouseout=void 0},!1),o.addEventListener("touchend",function(){o.onmouseover=void 0,o.onmouseout=void 0},!1),d.call(this,p,o,g,a),function(){if(!g.group){var c=.5*m*b;e||(e=[]);var f=a.crossed_circle(1.5*c,0,c);f.setAttribute("transform","translate(0,"+(l+.5*m)+") scale("+q+")"),f.firstChild.setAttribute("fill","url(#red_3d)");for(var h=f.childNodes,i=0,j=h.length;j>i;i++)h[i].setAttribute("stroke-width",(c/4).toString());f.addEventListener("click",function(){d.spliceFunction(g)},!1),o.push(f),e.push(f),f.setAttribute("visibility","hidden")}}(),this.isController(g)){f||(f=[]);var y=.5*m*b,z=a.group();t=a.circle(1.5*y,0,y),t.setAttribute("fill","#ffffff"),t.setAttribute("opacity","0.1"),z.push(t);var A=[1.1*y,-1.25*y,2.25*y,-.5*y,1.1*y,.25*y];A[1]+=.5*(y-0*m),A[3]+=.5*(y-0*m),A[5]+=.5*(y-0*m);var B=a.poly(""+A[0]+","+A[1]+" "+A[2]+","+A[3]+" "+A[4]+","+A[5]);this.isControllerExpanded(g)?z.setAttribute("transform","translate(0,"+(l+.5*m)+") scale("+q+") rotate(90,"+1.5*y+","+A[3]+")"):z.setAttribute("transform","translate(0,"+(l+.5*m)+") scale("+q+")"),B.setAttribute("height",1.75*y),B.setAttribute("font-size",1.5*y),B.setAttribute("fill","#ffffff"),B.setAttribute("pointer-events","none"),z.push(B),z.style.cursor="pointer",z.addEventListener("click",function(a){a.stopPropagation(),bean.fire(g,"_expandevent"),h.isControllerExpanded(g)?z.setAttribute("transform","translate(0,"+(l+.5*m)+") scale("+q+") rotate(90,"+1.5*y+","+A[3]+")"):z.setAttribute("transform","translate(0,"+(l+.5*m)+") scale("+q+")")},!1),o.push(z),f.push(z),z.setAttribute("visibility","hidden")}}};return d}(),"undefined"==typeof MASCP&&(MASCP={}),"undefined"==typeof MASCP.TagVisualisation&&(MASCP.TagVisualisation={}),MASCP.TagVisualisation=function(a,b){this.datasetName=a,this._buildRichTableView(b)},MASCP.TagVisualisation.prototype={__class__:MASCP.TagVisualisation,visualisations:null,datasetName:"",tagColumn:""},MASCP.TagVisualisation.prototype._buildRichTableView=function(a){var b=this.datasetName,c=document.getElementById(b);if(c.getAttributeNS){var d=parseInt(c.getAttributeNS("MASCP.TagVisualisation","tagcolumn"),10);this.tagColumn=d?d:this._getTagColumn()}else this.tagColumn=this._getTagColumn();var e=c.parentNode,f=null;if("BODY"==e.nodeName){f=e;var g=document.createElement("div");c.parentNode.replaceChild(g,c),g.appendChild(c),e=c.parentNode}else f=e.parentNode;this._dataTableContainer=e;var h=this._buildRichTagInfoContainer(e);f.insertBefore(h,e),this._displayElement=h;for(var i=0;i<a.length;i++)this.addVisualisation(new a[i](this));c.old_style=c.style.display,c.style.display="none"},MASCP.TagVisualisation.prototype._getDisplayWidth=function(a){var b;return void 0!==window.getComputedStyle?b=getComputedStyle(a,""):void 0!==document.defaultView.getComputedStyle&&(b=document.defaultView.getComputedStyle(a,"")),void 0!==b?parseInt(b.getPropertyValue("width").replace(/px/,""),10):void 0},MASCP.TagVisualisation.prototype._buildRichTagInfoContainer=function(a){var b=document.createElement("div");return b.setAttribute("id","rich_"+this.datasetName),b.setAttribute("class","rich_as_data "+a.className),b.style.width=a.style.width,b.style.height=a.style.height,b.style.display=a.style.display,b.style.position=a.style.position,b},MASCP.TagVisualisation.prototype.toggleTagView=function(){var a=document.getElementById(this.datasetName);"none"==a.style.display?(a.style.display=a.old_style,this.getDisplayElement().style.display="none"):(a.style.display="none",this.getDisplayElement().style.display="block")},MASCP.TagVisualisation.prototype.getDisplayElement=function(){return this._displayElement},MASCP.TagVisualisation.prototype.addVisualisation=function(a){this.visualisations||(this.visualisations=[]),this.getDisplayElement().appendChild(a.getDisplayElement()),this.visualisations.push(a)},MASCP.TagVisualisation.prototype.getAllTags=function(){for(var a=document.getElementById(this.datasetName),b=a.getElementsByTagName("tbody")[0].getElementsByTagName("tr"),c={},d=0;d<b.length;d++)tagname=b[d].getElementsByTagName("td")[this.tagColumn].childNodes[0].data,c[b[d].id]=tagname;return c},MASCP.TagVisualisation.prototype._getTagColumn=function(){for(var a=document.getElementById(this.datasetName),b=a.getElementsByTagName("thead")[0].getElementsByTagName("tr")[0].getElementsByTagName("th"),c=0;c<b.length;c++)if("tag"==b[c].childNodes[0].data.toLowerCase())return c;return 1},MASCP.TagVisualisation.prototype._getColumnCount=function(){var a=document.getElementById(this.datasetName),b=a.getElementsByTagName("thead")[0].getElementsByTagName("tr")[0].getElementsByTagName("th");return b.length-this._getTagColumn()-1},void 0===typeof MASCP.TagVisualisation.TagCloud&&(MASCP.TagVisualisation.TagCloud={}),MASCP.TagVisualisation.TagCloud=function(a){this._tagVisualiser=a,this._initElements()},MASCP.TagVisualisation.TagCloud.prototype={__class__:MASCP.TagVisualisation.TagCloud},MASCP.TagVisualisation.TagCloud.ELEMENT_CSS_CLASS="rich_tagcloud",MASCP.TagVisualisation.TagCloud.ELEMENT_ID_PREFIX="rich_tagcloud_",MASCP.TagVisualisation.TagCloud.TAG_ELEMENT_CSS_CLASS="rich_tagcloud_tag",MASCP.TagVisualisation.TagCloud.TAG_ELEMENT_ID_PREFIX="rich_tagcloud_tag_",MASCP.TagVisualisation.TagCloud.prototype._initElements=function(){return this._displayElement=document.createElement("div"),this._displayElement.setAttribute("id",MASCP.TagVisualisation.TagCloud.ELEMENT_ID_PREFIX+this._tagVisualiser.datasetName),this._displayElement.setAttribute("class",MASCP.TagVisualisation.TagCloud.ELEMENT_CSS_CLASS),this._displayElement},MASCP.TagVisualisation.TagCloud.prototype.getDisplayElement=function(){return this._displayElement},MASCP.TagVisualisation.TagCloud.prototype.update=function(a){var b,c=this.getDisplayElement(),d=document.getElementById(this._tagVisualiser.datasetName),e={},f={},g=d.getElementsByTagName("tbody")[0].getElementsByTagName("tr"),h=0,i=[];for(b=0;b<g.length;b++){var j=g[b].getElementsByTagName("td"),k=parseFloat(j[this._tagVisualiser.tagColumn+a].childNodes[0].data);if(0!==j[this._tagVisualiser.tagColumn].childNodes.length){var l=j[this._tagVisualiser.tagColumn].childNodes[0].data;e[l]=k,f[l]=j,h=Math.max(h,k),i[b]=l}}for(i.sort(),b=0;b<i.length;b++){var m=i[b];if(m){var n,o=m.replace(/\s+/,"_");null!==document.getElementById(MASCP.TagVisualisation.TagCloud.TAG_ELEMENT_ID_PREFIX+o)&&(n=document.getElementById(MASCP.TagVisualisation.TagCloud.TAG_ELEMENT_ID_PREFIX+o),n.parentNode.removeChild(n)),n=this.tagFactory(o,m,f[m]),c.appendChild(n);var p=Math.floor(30*Math.log(1.5+e[m]/h));n.style.fontSize=p+"px",n.setAttribute("class",MASCP.TagVisualisation.TagCloud.TAG_ELEMENT_CSS_CLASS)}}if(!c.hasSpacer){var q=document.createElement("div");q.setAttribute("class","spacer"),q.setAttribute("style","width: 100%; height: 0px; clear: both;"),c.appendChild(q),c.hasSpacer=!0}},MASCP.TagVisualisation.TagCloud.prototype.tagFactory=function(a,b,c){var d=document.createElement("span");return d.setAttribute("id",MASCP.TagVisualisation.TagCloud.TAG_ELEMENT_ID_PREFIX+a),d.textContent=b,d},"undefined"!=typeof document&&"registerElement"in document&&!function(){var a=function(){var a=Object.create(HTMLElement.prototype,{sequence:{set:function(a){this.renderer.setSequence(a)},get:function(){return this.renderer.sequence}},trackmargin:{set:function(a){this.renderer.trackGap=a+4},get:function(a){return this.renderer.trackGap-4}},zoom:{set:function(a){this.zoomval=a,"auto"===a?(this.renderer.enablePrintResizing(),this.renderer.fitZoom()):null!==a&&"null"!==a&&(this.renderer.disablePrintResizing(),this.renderer.zoom=parseFloat(a),this.zoomval=parseFloat(a))},get:function(a){return this.renderer.zoom}}});return a.createdCallback=function(){var a=this,b=this.createShadowRoot();b.appendChild(b.ownerDocument.createElement("div")),this.style.display="block",b.firstChild.style.overflow="hidden",a.renderer=new MASCP.CondensedSequenceRenderer(b.firstChild);var c=new GOMap.Diagram.Dragger;b.appendChild(b.ownerDocument.createElement("style")),b.lastChild.textContent="[dragenabled] { cursor: move; cursor: -webkit-grab; cursor: -moz-grab; cursor: grab; }\n[dragging] { cursor: move; cursor: -webkit-grabbing; cursor: -moz-grabbing; cursor: grabbing; }",Object.defineProperty(c,"enabled",{get:function(){return this._enabled},set:function(b){a.renderer._canvas&&(b?a.renderer._canvas.setAttribute("dragenabled","true"):a.renderer._canvas.removeAttribute("dragenabled")),this._enabled=b}}),c.enabled=!0;var d=b.ownerDocument.createElement("div");d.style.height="24px",b.appendChild(d),a.renderer.getVisibleLength=function(){return this.rightVisibleResidue()-this.leftVisibleResidue()},a.renderer.getTotalLength=function(){return this.sequence.length},a.renderer.getLeftPosition=function(){return this.leftVisibleResidue()},a.renderer.setLeftPosition=function(a){return this.setLeftVisibleResidue(a)},Object.defineProperty(this.renderer,"grow_container",{get:function(){return"auto"==a.style.overflow},set:function(){}}),Object.defineProperty(a,"interactive",{get:function(){return!!a.getAttribute("interactive")},set:function(a){e.enabled=a}}),Object.defineProperty(this.renderer,"selecting",{get:function(){return!c.enabled},set:function(a){return c.enabled=!a,a}});var e={enabled:a.interactive},f=new MutationObserver(function(){a.renderer.grow_container?c.enabled=!0:(c.enabled=!1,a.renderer.setLeftVisibleResidue(0)),a.renderer.refresh()});f.observe(a,{attributes:!0,attributeFilter:["style"]}),this.getAttribute("zoom")?this.zoom=this.getAttribute("zoom"):this.setAttribute("zoom","auto"),this.getAttribute("trackmargin")&&(this.trackmargin=parseInt(this.getAttribute("trackmargin"))),this.renderer.bind("sequenceChange",function(){c.applyToElement(a.renderer._canvas),c.enabled=a.renderer.grow_container,GOMap.Diagram.addScrollBar(a.renderer,a.renderer._canvas,d),c.addTouchZoomControls(a.renderer,a.renderer._canvas,e),GOMap.Diagram.addScrollZoomControls.call(e,a.renderer,a.renderer._canvas,.001),a.setAttribute("sequence",a.renderer.sequence),"auto"==a.zoomval&&a.renderer.fitZoom()}),this.renderer.bind("zoomChange",function(){"auto"!==a.zoomval&&a.setAttribute("zoom",a.renderer.zoom)}),a.getAttribute("sequence")&&(a.sequence=a.getAttribute("sequence"))},a.attributeChangedCallback=function(a,b,c){"sequence"==a&&this.sequence!==c&&(this.sequence=c),"zoom"==a&&this.zoomval!==c&&(this.zoom=c),"trackmargin"==a&&this.trackmargin!==c&&(this.trackmargin=parseInt(c)),"interactive"==a&&(this.interactive=!!c)},document.registerElement("gator-viewer",{prototype:a}),a}(),b=function(a,b){var c=new a;return b&&MASCP.Service.BeginCaching(c),c},c=function(a,b){var c=document.createEvent("Events");c.initEvent(b,!1,!0),a.dispatchEvent(c)},d=function(){var d=document.registerElement("gator-uniprot",{prototype:Object.create(a,{createdCallback:{value:function(){a.createdCallback.apply(this),this.getAttribute("caching")&&(this.caching=this.getAttribute("caching")),this.getAttribute("auto")&&(this.auto=this.getAttribute("auto")),this.getAttribute("accession")&&(this.accession=this.getAttribute("accession"))}},attributeChangedCallback:{value:function(b,c,d){a.attributeChangedCallback.call(this,b,c,d),"accession"==b&&this.accession!==d&&(this.accession=d),"auto"==b&&(d&&!this.auto?this.auto=!0:!d&&this.auto&&(this.auto=!1)),"caching"==b&&(d&&!this.caching?this.caching=d:!d&&this.caching&&(this.caching=!1))}},auto:{get:function(){return this.autoRun},set:function(a){this.autoRun=a}},accession:{set:function(a){var b=this;b.acc=a,b.setAttribute("accession",a),b.auto&&b.go()},get:function(){return this.acc}},go:{value:function(){var a=this;MASCP.ready=function(){b(MASCP.UniprotReader,a.caching).retrieve(a.accession,function(b){b||(a.renderer.bind("sequenceChange",function(){a.renderer.unbind("sequenceChange",arguments.callee),c(a,"ready")}),a.renderer.setSequence(this.result.getSequence()))})}}},caching:{set:function(a){a?(this.cachingval=!0,this.setAttribute("caching",!0)):this.removeAttribute("caching")},get:function(){return this.cachingval}}})});return d.prototype}();(function(){var a=document.registerElement("gator-gene",{prototype:Object.create(d,{createdCallback:{value:function(){d.createdCallback.apply(this),this.renderer.hide_axis=!0,this.getAttribute("exonmargin")&&(this.exonmargin=parseInt(this.getAttribute("exonmargin")))}},attributeChangedCallback:{value:function(a,b,c){d.attributeChangedCallback.call(this,a,b,c),"geneid"==a&&this.geneid!==c&&(this.geneid=c),"exonmargin"==a&&this.exonmargin!=c&&(this.exonmargin=parseInt(c),this._genomereader&&(this._genomereader.exon_margin=this.exonmargin,this.renderer.refreshScale(),"auto"==this.getAttribute("zoom")&&this.renderer.fitZoom()))}},accession:{set:function(a){this.acc=a,a?this.setAttribute("accession",a):this.removeAttribute("accession")},get:function(){return this.acc}},go:{value:function(){var a=this;a.renderer.trackOrder=[],a.renderer.reset();var d=a.getAttribute("zoom")||"auto";a.removeAttribute("zoom"),a.renderer.bind("sequenceChange",function(){a.renderer.unbind("sequenceChange",arguments.callee);var e=b(MASCP.GenomeReader,a.caching);e.geneid=a.geneid,e.exon_margin=a.exonmargin,a.nt_mapping&&(e.nt_mapping=a.nt_mapping),a._genomereader=e,e.registerSequenceRenderer(a.renderer),e.bind("requestComplete",function(){a.renderer.hideAxis(),a.setAttribute("zoom",d),c(a,"ready")}),e.retrieve(a.accession||""+a.geneid)}),MASCP.ready=function(){a.renderer.setSequence("M")}}},geneid:{set:function(a){var b=this;b.ncbigene=a,b.setAttribute("geneid",a),b.auto&&b.go()},get:function(){return this.ncbigene}}})});return a.prototype})()}(),"undefined"==typeof GOMap&&(GOMap={}),function(){var a=function(){var a,b=3,c=document.createElement("div"),d=c.getElementsByTagName("i");do c.innerHTML="<!--[if gt IE "+ ++b+"]><i></i><![endif]-->";while(d[0]);return b>4?b:a}();a&&(7===a&&(GOMap.IE=!0,GOMap.IE7=!0),8===a&&(GOMap.IE=!0,GOMap.IE8=!0))}(),GOMap.IE&&"undefined"==typeof svgweb&&"undefined"==typeof SVGWEB_LOADING&&!window.svgns){var svg_path="svgweb/";"undefined"!=typeof SVGWEB_PATH&&(svg_path=SVGWEB_PATH);var scriptTag=document.createElement("script");scriptTag.src=svg_path+"svg.js",scriptTag.type="text/javascript",scriptTag.setAttribute("data-path",svg_path),document.getElementsByTagName("head")[0].insertBefore(scriptTag,document.getElementsByTagName("head")[0].firstChild),SVGWEB_LOADING=!0}log="undefined"==typeof log?"undefined"==typeof console?function(){}:function(a){return"String"==typeof a&&1==arguments.length?console.log("%s",a):console.log("%o: %o",a,this),this}:log,window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1e3/60)}}(),window.attachEvent?window.onload=function(){GOMap.LOADED=!0}:GOMap.LOADED=!0,GOMap.Diagram=function(a,b){if(null!==a){this._highlighted={},this._styles_cache={},this.enabled=!0;var c=this,d=null;if("string"==typeof a)d=a,a=null;else if(a.nodeName&&"object"==a.nodeName.toLowerCase())d=a.getAttribute("src")||a.getAttribute("data");else if(a.nodeName&&"svg"==a.nodeName.toLowerCase())return void function(){return GOMap.LOADED?(c._container=a.parentNode,c.element=a,c._svgLoaded(),c.loaded=!0,b.load&&b.load.apply(c),void(c.onload&&c.onload.apply(c))):void window.attachEvent("onload",arguments.callee)}();this.element=document.createElement("object",!0),this.element.setAttribute("data",d),this.element.setAttribute("type","image/svg+xml"),this.element.setAttribute("width","100%"),this.element.setAttribute("height","100%"),this.element.setAttribute("style","background: transparent;"),this.element.addEventListener||(this.element.addEventListener=function(a,b){this.attachEvent(a,b)});var e="undefined"!=typeof svgweb;this.element.addEventListener(e?"SVGLoad":"load",function(){var a=this;if(!this.nodeName)return void console.log("The SVG hasn't been loaded properly");null!==a.contentDocument?c.element=a.contentDocument.rootElement:c.element=a.getAttribute("contentDocument").rootElement;var d=a;c.destroy=function(){d&&d.parentNode&&("undefined"!=typeof svgweb?svgweb.removeChild(d,d.parentNode):d.parentNode.removeChild(d))},c._svgLoaded(),c.loaded=!0,b.load&&b.load.apply(c),c.onload&&c.onload.apply(c)},!1),a&&(this.appendTo(a.parentNode),a.parentNode.removeChild(a))}},GOMap.Diagram.prototype.appendTo=function(a){return this._container=a,"undefined"!=typeof svgweb?svgweb.appendChild(this.element,a):a.appendChild(this.element),this},GOMap.Diagram.prototype.showKeyword=function(a,b){var c=this._elementsForKeyword(a);if(0===c.length)return!1;if(this._highlighted[a]&&!b)return!0;b=b||"#ff0000",this._highlighted[a]=!0;for(var d=0;d<c.length;d++)c[d]._highlighted=c[d]._highlighted||{},c[d]._highlighted[b]=!0,"path"!=c[d].nodeName&&"circle"!=c[d].nodeName&&"ellipse"!=c[d].nodeName||this._outlineElement(c[d]);var e=this;return this._recurse(c,function(a){return e._highlightElement(a),!0}),!0},GOMap.Diagram.prototype.zoomToKeyword=function(a){for(var b=this.element,c=this._elementsForKeyword(a),d=null,e=0;e<c.length;e++)if("g"==c[e].nodeName){d=c[e];break}if(!d)return void(b._baseViewBox&&b.setAttribute("viewBox",b._baseViewBox));if(d.getBBox){var f=d.getBBox();b.getBBox();b._baseViewBox||(b._baseViewBox=b.getAttribute("viewBox"));var g=[f.x-10,f.y-10,f.width+20,f.height+20];b.setAttribute("viewBox",g.join(" "))}},GOMap.Diagram.prototype.hideAllKeywords=function(){for(var a in this._highlighted)this._highlighted.hasOwnProperty(a)&&this.hideKeyword(a)},GOMap.Diagram.prototype.hideKeyword=function(a,b){var c=this._elementsForKeyword(a),d=this;this._highlighted[a]=!1,this._recurse(c,function(a){null!==b&&a._highlighted?a._highlighted[b]=!1:a._highlighted={};for(var c in a._highlighted)if(a._highlighted[c]===!0)return"path"!=a.nodeName&&"circle"!=a.nodeName&&"ellipse"!=a.nodeName||d._outlineElement(a),!1;return d._restoreStyle(a),!0})},GOMap.Diagram.prototype.toggleKeyword=function(a,b){return this._highlighted[a]?(this.hideKeyword(a),!1):this.showKeyword(a,b)},GOMap.Diagram.prototype.clearMarkers=function(a){if(this.markers){if(a)return void this._clearMarkers(this.markers[a]);for(var b in this.markers)this.markers.hasOwnProperty(b)&&this._clearMarkers(this.markers[b]);this.markers={}}},GOMap.Diagram.prototype._clearMarkers=function(a){if(a)for(var b=0;b<a.length;b++)a[b].parentNode.removeChild(a[b]);
},GOMap.Diagram.prototype.addMarker=function(a,b){this.markers||(this.markers={}),b||(b=1);var c,d=this.element;if(this.markers[a])for(this.markers[a].current_radius+=b,c=0;c<this.markers[a].length;c++)this.markers[a][c].setAttribute("r",this.markers[a].current_radius);else{var e=this._elementsForKeyword(a);for(this.markers[a]=[],this.markers[a].current_radius=b,c=0;c<e.length;c++){var f=e[c];if("g"==f.nodeName){var g=f.getBBox(),h=g.x+g.width/2,i=g.y+g.height/2;circle=document.createElementNS(svgns,"circle"),circle.setAttribute("cx",h),circle.setAttribute("cy",i),circle.setAttribute("r",this.markers[a].current_radius),circle.setAttribute("fill","#ff0000"),this.markers[a].push(circle),d.appendChild(circle)}}}},GOMap.Diagram.prototype.addEventListener=function(a,b){this._events||(this._events={}),this._events[a]||(this._events[a]=[]),this._events[a].push(b)},function(){var a=function(){if(this._events&&this._events.zoomChange)for(var a=0;a<this._events.zoomChange.length;a++)this._events.zoomChange[a].apply(this,[{type:"zoomChange"}])},b={setZoom:function(b){0>b&&(b=0),this.element&&(this.element.currentScale=b),a.apply(this)},getZoom:function(){return this.element.currentScale}};Object.defineProperty&&!MASCP.IE8&&Object.defineProperty(GOMap.Diagram.prototype,"zoom",{get:b.getZoom,set:b.setZoom})}(),GOMap.Diagram.prototype.makeInteractive=function(){var a=this.element,b=this._container;try{a.addEventListener}catch(c){return void console.log("Browser does not support addEventListener")}(new GOMap.Diagram.Dragger).applyToElement(a);var d=GOMap.Diagram.addZoomControls(this,.1,2,.1,1);b.appendChild(d),d.style.position="absolute",d.style.top="0px",d.style.left="0px",d.style.height="30%"},GOMap.Diagram.prototype._svgLoaded=function(){this._forceOpacity()},GOMap.Diagram.prototype._elementsForKeyword=function(a){var b=this.element,c=[];if(GOMap.IE)for(var d=b.ownerDocument.getElementsByTagNameNS(svgns,"*"),e=0;e<d.length;e++){var f=d[e].getAttribute("keyword");f==a&&c.push(d[e])}else c=this._execute_xpath(b,"//*[@keyword = '"+a+"']",b.ownerDocument);return c},GOMap.Diagram.prototype._execute_xpath=function(a,b,c){var d=[],e=0;if(c.evaluate)for(xpath_result=c.evaluate(b,a,null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null);null!==(a_result=xpath_result.snapshotItem(e));)d.push(a_result),e++;else for(xpath_result=a.selectNodes(b),e=0;e<xpath_result.length;e++)d[e]=xpath_result.item(e);return d},GOMap.Diagram.prototype._recurse=function(a,b){for(var c=0;c<a.length;c++){var d=b.call(this,a[c]);d&&a[c].childNodes.length>0&&this._recurse(a[c].childNodes,b)}},GOMap.Diagram.prototype._cacheStyle=function(a){if(!a.id){var b="svg"+(new Date).getTime().toString()+Math.floor(1e3*Math.random());a.setAttribute("id",b)}null===this._styles_cache[a.id]&&a.style&&a.id&&(!a.style.stroke||a.style.strokeWidth||a.style.getPropertyValue("stroke-width")||(a.style.strokeWidth="1"),this._styles_cache[a.id]={stroke:a.style.stroke||a.style.getPropertyValue("stroke"),"stroke-width":a.style.strokeWidth||a.style.getPropertyValue("stroke-width")||"0px",opacity:a.style.getPropertyValue("opacity"),"fill-opacity":a.style.fillOpacity||a.style.getPropertyValue("fill-opacity"),"stroke-opacity":a.style.strokeOpacity||a.style.getPropertyValue("stroke-opacity")})},GOMap.Diagram.prototype._restoreStyle=function(a){if(a.style&&this._styles_cache[a.id]){var b=this._styles_cache[a.id];for(var c in{"stroke-width":null,opacity:null,stroke:null,"fill-opacity":null,"stroke-opacity":null})GOMap.IE&&!b[c]||a.style.setProperty(c,b[c],null)}},GOMap.Diagram.prototype._outlineElement=function(a){if(a.style){this._cacheStyle(a);var b=this._calculateColorForElement(a);a.style.setProperty("stroke",b,null),a.style.setProperty("stroke-width",1,null),a.style.setProperty("stroke-opacity",1,null)}},GOMap.Diagram.prototype._calculateColorForElement=function(a){var b,c="pat",d=0;if(a._animates){for(b=0;b<a._animates.length;b++)a.removeChild(a._animates[b]);a._animates=null}for(var e in a._highlighted)a._highlighted&&a._highlighted[e]===!0&&(c+="_"+e,d++);var f=document.createElementNS(svgns,"animate").beginElement;if(1==d)return c.split(/_/)[1];if(f){var g=this._buildAnimatedColor(c,a.id);for(b=0;b<g.length;b++)a.appendChild(g[b]);return g[0].beginElement(),a._animates=g,c.split(/_/)[1]}return this._buildPattern(c)},GOMap.Diagram.prototype._buildPattern=function(a){var b=a.split("_");b.shift(),this._cached_patterns=this._cached_patterns||{};var c=a.replace(/#/g,"");if(this._cached_patterns[c])return"url(#"+c+")";var d=this.element,e=d.ownerDocument.getElementsByTagNameNS(svgns,"defs")[0];e||(e=document.createElementNS(svgns,"defs"),d.appendChild(e));var f=document.createElementNS(svgns,"pattern");f.setAttribute("x","0"),f.setAttribute("y","0"),f.setAttribute("width","30"),f.setAttribute("height","30"),f.setAttribute("viewBox","0 0 100 100"),f.setAttribute("patternUnits","userSpaceOnUse"),f.setAttribute("patternTransform","rotate(45)"),f.setAttribute("id",c);for(var g=100/b.length,h=0,i=0;i<b.length;i++){var j=document.createElementNS(svgns,"rect");j.setAttribute("x",h),h+=g,j.setAttribute("y",0),j.setAttribute("width",g),j.setAttribute("height",100),j.setAttribute("fill",b[i]),f.appendChild(j)}return e.appendChild(f),this._cached_patterns[c]=!0,"url(#"+c+")"},GOMap.Diagram.prototype._buildAnimatedColor=function(a,b){var c=a.split("_");c.shift(),this._cached_patterns=this._cached_patterns||{};var d=a.replace(/#/g,"");if(this._cached_patterns[d])return"url(#"+d+")";d=b+d;var e=this.element,f=e.ownerDocument.getElementsByTagNameNS(svgns,"defs")[0];f||(f=document.createElementNS(svgns,"defs"),e.appendChild(f));for(var g=[],h=0;h<c.length;h++){var i=document.createElementNS(svgns,"animate");i.setAttribute("id",d+h),i.setAttribute("from",c[h]);var j="";j=c.length<=h+1?c[0]:c[h+1],i.setAttribute("to",j);var k="";k=0===h?"SVGLoad;indefinite;"+(d+(c.length-1))+".end":d+(h-1)+".end",i.setAttribute("attributeType","CSS"),i.setAttribute("attributeName","stroke"),i.setAttribute("begin",k),i.setAttribute("dur","1s"),g.push(i)}return g},GOMap.Diagram.prototype._highlightElement=function(a){!a.style||"g"!=a.nodeName&&null===a.id||(this._cacheStyle(a),"path"!=a.nodeName&&"circle"!=a.nodeName&&"ellipse"!=a.nodeName||(a.setAttribute("opacity","1"),a.style.setProperty("opacity",1,null)),a.setAttribute("fill-opacity","1"),a.setAttribute("stroke-opacity","1"),a.style.setProperty&&(a.style.setProperty("fill-opacity",1,null),a.style.setProperty("stroke-opacity",1,null)))},GOMap.Diagram.prototype._forceOpacity=function(){for(var a=this.element,b=a.suspendRedraw(5e3),c=a.ownerDocument.getElementsByTagNameNS(svgns,"*"),d=0;d<c.length;d++)"svg"!=c[d].nodeName&&(c[d].parentNode&&c[d].parentNode.parentNode&&"defs"==c[d].parentNode.parentNode.nodeName||"defs"==c[d].nodeName||c[d].parentNode&&"defs"==c[d].parentNode.nodeName||("path"==c[d].nodeName?(c[d].setAttribute("opacity","0.4"),c[d].style.opacity=.4):(c[d].setAttribute("fill-opacity","0.3"),c[d].setAttribute("stroke-opacity","0.2"),c[d].style&&(c[d].style.fillOpacity=.3,c[d].style.strokeOpacity=.2))));a.unsuspendRedraw(b)},GOMap.Diagram.Dragger=function(){this.oX=0,this.oY=0,this.dX=0,this.dY=0,this.dragging=!1,this.targetElement=null},GOMap.Diagram.Dragger.prototype.applyToElement=function(a){var b=this;b.enabled=!0;var c=[];"svg"==a.nodeName?(a.getPosition=function(){var b=a.currentTranslate.x,c=a.currentTranslate.y;return[b,c]},a.shiftPosition=function(c,d){var e,f,g,h,i={x:c,y:d},j=1,k=this.getAttribute("viewBox");if(k){var l=this.getAttribute("viewBox").split(" ");j=parseFloat(this.width.baseVal.value)/parseFloat(l[2]),e=0,f=parseInt(l[1],10),g=parseInt(l[2],10),h=parseInt(l[3],10)}else e=0,f=0,g=a.width,h=a.height;a.style.GomapScrollLeftMargin&&(e+=a.style.GomapScrollLeftMargin),b.dragging&&(i.x=j*(i.x-b.oX),i.y=j*(i.y-b.oY),i.x+=b.dX,i.y+=b.dY,i.y=0),a._snapback&&(clearTimeout(a._snapback),a._snapback=null),i.x>j*e&&(a._snapback=setTimeout(function(){var c;if(Math.abs(a.currentTranslate.x-j*e)>35){var d=.95*(a.currentTranslate.x-j*e);if(j*e>d&&(d=j*e),a.setCurrentTranslateXY(d,0),window.requestAnimFrame(arguments.callee,a),document.createEvent){var c=document.createEvent("Events");c.initEvent("panstart",!1,!0),a.dispatchEvent(c)}}else{if(a.setCurrentTranslateXY(j*e,0),document.createEvent){var c=document.createEvent("Events");c.initEvent("pan",!1,!0),a.dispatchEvent(c)}b.dragging||bean.fire(a,"panend"),a._snapback=null}},300));var m=j*(g-2*e);if(0===e&&(m*=.9),i.x<0&&Math.abs(i.x)>m&&(a._snapback=setTimeout(function(){var c;if(Math.abs(a.currentTranslate.x- -1*m)>35){var d=.95*a.currentTranslate.x;d>-1*m&&(d=-1*m),a.setCurrentTranslateXY(d,0),window.requestAnimFrame(arguments.callee,a),document.createEvent&&(c=document.createEvent("Events"),c.initEvent("panstart",!1,!0),a.dispatchEvent(c))}else a.setCurrentTranslateXY(-1*m,0),document.createEvent&&(c=document.createEvent("Events"),c.initEvent("pan",!1,!0),a.dispatchEvent(c)),b.dragging||bean.fire(a,"panend"),a._snapback=null},300)),i.y>j*f&&(i.y=j*f),Math.abs(i.y)>.5*j*h&&(i.y=-.5*j*h),this.setCurrentTranslateXY?this.setCurrentTranslateXY(i.x,i.y):this.currentTranslate.setXY?this.currentTranslate.setXY(i.x,i.y):(this.currentTranslate.x=i.x,this.currentTranslate.y=i.y),document.createEvent){var n=document.createEvent("Events");n.initEvent("pan",!1,!0),this.dispatchEvent(n)}}):(a.getPosition=function(){return[this.scrollLeft,this.scrollTop]},a.shiftPosition=function(a,c){if(this.scrollLeft=b.dX+(b.oX-a),this.scrollTop=b.dY+(b.oY-c),document.createEvent){var d=document.createEvent("Events");d.initEvent("pan",!1,!0),this.dispatchEvent(d)}});var d=function(c){if(!b.enabled)return!0;var d=b.targetElement?b.targetElement:a,f=e(c);if(b.dragging=!0,d.setAttribute("dragging","true"),b.targetElement)return b.oX=f[0],b.oY=f[1],b.dX=b.targetElement.scrollLeft,b.dY=b.targetElement.scrollTop,void c.preventDefault(!0);var g=a.createSVGPoint();f=e(c),g.x=f[0],g.y=f[1];var h=this.firstElementChild.getScreenCTM();b.matrix=h.inverse(),g=g.matrixTransform(b.matrix),b.dX=a.getPosition()[0],b.dY=a.getPosition()[1],b.oX=g.x,b.oY=g.y,c.preventDefault(!0),document.createEvent&&(b.clicktimeout=setTimeout(function(){var a=document.createEvent("Events");b.clicktimeout=null,a.initEvent("panstart",!1,!0),d.dispatchEvent(a)},200))},e=function(a){var c=0,d=0;return a||(a=window.event),a.pageX||a.pageY?(c=a.pageX,d=a.pageY):(a.clientX||a.clientY)&&(c=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,d=a.clientY+document.body.scrollTop+document.documentElement.scrollTop),b.targetElement&&(c=a.screenX,d=a.screenY),[c,d]},f=function(c){var d=e(c);b.clicktimeout&&Math.abs(d[0]-b.oX)<10&&j(),b.dragging&&(a.shiftPosition(d[0],d[1]),c.preventDefault(!0))},g=function(c){b.dragging=!0;var d=e(c);b.oX=d[0],b.oY=d[1],b.dX=a.getPosition()[0],b.dY=a.getPosition()[1],c.preventDefault(!0);var f=b.targetElement?b.targetElement:a;if(f.setAttribute("dragging","true"),document.createEvent){var g=document.createEvent("Events");g.initEvent("panstart",!1,!0),f.dispatchEvent(g)}},h=function(a){return b.enabled?void(b.dragging&&i.call(this,a)):!0},i=function(c){var d=e(c);if(b.targetElement)return void b.targetElement.shiftPosition(d[0],d[1]);var f=a._cachedpoint||a.createSVGPoint();a._cachedpoint=f,d=e(c),f.x=d[0],f.y=d[1];var g=a._cachedrctm||a.firstElementChild.getScreenCTM();a._cachedrctm=g,f=f.matrixTransform(b.matrix),a.shiftPosition(f.x,f.y)},j=function(c){if(b.clicktimeout&&(clearTimeout(b.clicktimeout),b.clicktimeout=null),!b.enabled)return!0;b.oX=0,b.oY=0,b.dX=null,b.dY=null,b.dragging=!1,c.preventDefault(!0);var d=b.targetElement?b.targetElement:a;d.removeAttribute("dragging"),d._snapback||bean.fire(d,"panend",!0)},k=function(a){if(!b.dragging||!b.enabled)return!0;if(this==b.targetElement&&j(a),a.target==this||a.currentTarget){for(var c=a.relatedTarget?a.relatedTarget:a.toElement;null!==c;){if(c==this)return;c=c.parentNode}j(a)}};a.addEventListener||(a.addEventListener=function(a,b,c){this.attachEvent(a,b)}),a.addEventListener("touchstart",function(d){if(b.enabled){var f=b.targetElement?b.targetElement:a;if(b.momentum&&(window.clearTimeout(b.momentum),b.momentum=null),1==d.touches.length){var g,h=e(d.touches[0]);if("svg"==f.nodeName){g=f.createSVGPoint(),g.x=h[0],g.y=h[1];var i=this.getScreenCTM();b.matrix=i.inverse(),g=g.matrixTransform(b.matrix)}else g.x=h[0],g.y=h[1];if(b.oX=g.x,b.oY=g.y,b.dragging=!0,b.dX=f.getPosition()[0],b.dY=f.getPosition()[1],b._momentum_shrinker=setInterval(function(){c.shift()},20),document.createEvent){var j=document.createEvent("Events");j.initEvent("panstart",!1,!0),f.dispatchEvent(j)}d.preventDefault()}}},!1),a.addEventListener("touchmove",function(d){b.momentum&&(window.clearTimeout(b.momentum),b.momentum=null),1!=d.touches.length&&(b.dragging=!1);var f=b.targetElement?b.targetElement:a,g=e(d.touches[0]);if(g&&b.matrix){var h;if("svg"==f.nodeName?(h=f.createSVGPoint(),h.x=g[0],h.y=g[1],h=h.matrixTransform(b.matrix)):(h.x=g[0],h.y=g[1]),b.dragging&&6*Math.abs(b.oX-h.x)>Math.abs(b.oY-h.y)&&d.preventDefault(),!b.dragging)return b.oX=0,b.oY=0,b.dX=null,void(b.dY=null);c.length>3&&c.splice(2),f.shiftPosition(h.x,h.y),c.push(f.getPosition()[0]-b.dX)}},!1);var l=function(d){if(!b.enabled)return!0;if(!b.dragging)return clearInterval(b._momentum_shrinker),void j(d);var e=b.targetElement?b.targetElement:a,f=0;if(c.length>0){var g=c[0];c.forEach(function(a){"undefined"!=typeof g&&(f+=a-g),g=a}),f/=c.length}var h=e.getPosition()[0],i=f;b.dragging=!1,b.momentum&&window.clearTimeout(b.momentum),b.momentum=1,function(){h=e.getPosition()[0],b.dragging?h+=b.oX-b.dX:(b.oX=0,b.dX=0),e.shiftPosition(h+f,0),h+=f,f=.5*f,f>0&&Math.abs(i/f)<10?window.requestAnimFrame(arguments.callee,e):(b.momentum=null,clearInterval(b._momentum_shrinker),j(d))}()};a.addEventListener("touchend",l,!1),"svg"==a.nodeName?(a.addEventListener("mousedown",d,!1),a.addEventListener("mousemove",h,!1),a.addEventListener("mouseup",j,!1),a.addEventListener("mouseout",k,!1),b.targetElement&&b.targetElement.addEventListener("mouseout",k,!1)):(a.addEventListener("mousedown",g,!1),a.addEventListener("mousemove",f,!1),a.addEventListener("mouseup",j,!1),a.addEventListener("mouseout",k,!1))},GOMap.Diagram.addTouchZoomControls=function(a,b,c){return c||(c={enabled:!0}),GOMap.Diagram.Dragger.prototype.addTouchZoomControls.call(c,a,b),c},GOMap.Diagram.Dragger.prototype.addTouchZoomControls=function(a,b){var c=this,d=function(a){var b=0,d=0;return a||(a=window.event),a.pageX||a.pageY?(b=a.pageX,d=a.pageY):(a.clientX||a.clientY)&&(b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,d=a.clientY+document.body.scrollTop+document.documentElement.scrollTop),c.targetElement&&(b=a.screenX,d=a.screenY),[b,d]};b.addEventListener("touchstart",function(e){if(c.enabled&&2==e.touches.length){var f,g=d(e.touches[0]),h=d(e.touches[1]);if("svg"==b.nodeName){f=b.createSVGPoint(),f.x=.5*(g[0]+h[0]),f.y=.5*(g[1]+h[1]);var i=this.getScreenCTM();c.matrix=i.inverse(),f=f.matrixTransform(c.matrix)}else f.x=.5*(g[0]+h[0]),f.y=.5*(g[1]+h[1]);a.zoomCenter=f,e.preventDefault()}},!1),Hammer(b).on("touch",function(d){if(c.enabled){var e=a.zoom,f=function(b){a.zoomCenter&&(a.zoom=e*b.gesture.scale),b.preventDefault()};Hammer(b).on("pinch",f,!1),Hammer(b).on("release",function(c){Hammer(b).off("pinch",f),Hammer(b).off("release",arguments.callee),a.zoomCenter=null,a.zoomLeft=null,bean.fire(a,"gestureend")},!1),d.preventDefault()}},!1)},GOMap.Diagram.addZoomControls=function(a,b,c,d,e){b=b||0,c=c||10,d=d||.5,e=e||a.zoom||b;var f=document.createElement("div"),g=document.createElement("input");g.setAttribute("type","button"),g.setAttribute("value","+");var h=document.createElement("input");h.setAttribute("type","button"),h.setAttribute("value","-");var i=document.createElement("input");i.setAttribute("type","button"),i.setAttribute("value","Reset"),f.appendChild(i),i.addEventListener("click",function(){a.zoom=a.defaultZoom||e},!1);var j=document.createElement("input");if(j.setAttribute("min",b),j.setAttribute("max",c),j.setAttribute("step",d),j.setAttribute("value",e),j.setAttribute("type","range"),j.setAttribute("style","-webkit-appearance: slider-horizontal; width: 100%; position: absolute; top: 0px; bottom: 0px; margin-top: 0.5em; left: 100%; margin-left: -0.5em;"),"range"==j.type){j.addEventListener("change",function(){a.zoom=this.value},!1);var k=null;a.addEventListener?k=a.addEventListener:a.bind&&(k=a.bind),k.apply(a,["zoomChange",function(){j.value=a.zoom},!1]),i.style.margin="0px",i.style.display="block",i.style.position="absolute",i.style.top="0px",f.appendChild(j),f.style.height="100%"}else{if(!g.addEventListener){var l=function(a,b){this.attachEvent(a,b)};g.addEventListener=l,i.addEventListener=l,h.addEventListener=l}g.addEventListener("click",function(){a.zoom+=d},!1),h.addEventListener("click",function(){a.zoom-=d},!1),g.style.margin="0px",g.style.display="block",g.style.position="absolute",g.style.top="0px",g.style.left="29px",h.style.margin="0px",h.style.display="block",h.style.position="absolute",h.style.top="0px",i.style.margin="0px",i.style.display="block",i.style.position="absolute",i.style.top="23px",i.style.left="3px",f.appendChild(h),f.appendChild(g),f.appendChild(i)}return this.addScrollZoomControls(a,f,d),f},GOMap.Diagram.addScrollBar=function(a,b,c){for(var d=document.createElement("div");c.childNodes.length>0;)c.removeChild(c.firstChild);c.appendChild(d),c.style.position||(c.style.position="relative"),c.style.overflowX="scroll",c.style.overflowY="hidden",d.style.position="absolute",d.style.left="0px",d.style.width="100%",d.style.height="100%",bean.remove(c,"scroll"),bean.remove(c,"mouseenter"),bean.add(c,"mouseenter",function(){var b=100*a.getTotalLength()/a.getVisibleLength();d.cached_width=d.clientWidth/b,e=!0,c.scrollLeft+=1,c.scrollLeft-=1,setTimeout(function(){e=!1},0),bean.remove(c,"scroll",f),bean.add(c,"scroll",f)});var e=!1;window.matchMedia&&window.matchMedia("print").addListener(function(a){e=!0,setTimeout(function(){e=!1},0)});var f=function(){if(!e&&console){if(document.createEvent){var f=document.createEvent("Events");f.initEvent("panstart",!1,!0),b.dispatchEvent(f)}var g=100*a.getTotalLength()/a.getVisibleLength(),h=d.cached_width?parseInt(d.cached_width*g):d.clientWidth;a.setLeftPosition(parseInt(c.scrollLeft*a.getTotalLength()/h)),bean.fire(b,"panend")}};bean.add(c,"scroll",f);var g;bean.add(b,"pan",function(){cancelAnimationFrame(g);var b=100*a.getTotalLength()/a.getVisibleLength();d.style.width=parseInt(b)+"%";var e=d.cached_width?parseInt(d.cached_width*b):d.clientWidth;d.cached_width=e/b;var h=parseInt(e*(a.getLeftPosition()/a.getTotalLength()));bean.remove(c,"scroll",f),g=requestAnimationFrame(function(){c.scrollLeft=h})})},GOMap.Diagram.addScrollZoomControls=function(a,b,c){c=c||.5;var d;d=null===this.enabled?{enabled:!0}:this;var e=function(a,b,c){"string"==typeof a&&(a=document.getElementById(a)),null!==a&&(a.addEventListener?("mousewheel"==b&&(a.addEventListener("DOMMouseScroll",c,!1),a.addEventListener("wheel",c,!1)),a.addEventListener(b,c,!1)):a.attachEvent&&a.attachEvent("on"+b,c))},f=function(a){if(d.enabled){var c=0,e=0;a||(a=window.event),a.pageX||a.pageY?(c=a.pageX,e=a.pageY):(a.clientX||a.clientY)&&(c=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,e=a.clientY+document.body.scrollTop+document.documentElement.scrollTop);var f={};if("svg"==b.nodeName){f=b.createSVGPoint(),f.x=c,f.y=e;var g=b.firstElementChild.getScreenCTM();d.matrix=g.inverse(),f=f.matrixTransform(d.matrix)}else f.x=c,f.y=e;return f}},g=function(b){if(d.enabled){b=b?b:window.event;var e=b.detail?-1*b.detail:b.wheelDelta;return e||(e=b.deltaY),a.zoomCenter=f(b),e>0?a.zoom=a.zoom+=c:a.zoom=a.zoom-=c,b.preventDefault&&b.preventDefault(),b.returnValue=!1,b.stopPropagation(),!1}},h=!1;return navigator.userAgent.indexOf("Gecko")>=0&&(h=parseFloat(navigator.userAgent.split("Firefox/")[1])||void 0),h&&"undefined"!=typeof svgweb&&"native"==svgweb.getHandlerType()?e(b,"mousewheel",g):e(b,"mousewheel",g),e(b,"mousemove",function(b){d.enabled&&a.zoomCenter&&Math.abs(a.zoomCenter.x-f(b).x)>100&&(a.zoomCenter=null,a.zoomLeft=null)}),d};