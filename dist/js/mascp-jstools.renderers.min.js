!function(a,b){"use strict";function c(){d.READY||(d.event.determineEventTypes(),d.utils.each(d.gestures,function(a){d.detection.register(a)}),d.event.onTouch(d.DOCUMENT,d.EVENT_MOVE,d.detection.detect),d.event.onTouch(d.DOCUMENT,d.EVENT_END,d.detection.detect),d.READY=!0)}var d=function(a,b){return new d.Instance(a,b||{})};d.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},d.HAS_POINTEREVENTS=a.navigator.pointerEnabled||a.navigator.msPointerEnabled,d.HAS_TOUCHEVENTS="ontouchstart"in a,d.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android|silk/i,d.NO_MOUSEEVENTS=d.HAS_TOUCHEVENTS&&a.navigator.userAgent.match(d.MOBILE_REGEX),d.EVENT_TYPES={},d.DIRECTION_DOWN="down",d.DIRECTION_LEFT="left",d.DIRECTION_UP="up",d.DIRECTION_RIGHT="right",d.POINTER_MOUSE="mouse",d.POINTER_TOUCH="touch",d.POINTER_PEN="pen",d.EVENT_START="start",d.EVENT_MOVE="move",d.EVENT_END="end",d.DOCUMENT=a.document,d.plugins=d.plugins||{},d.gestures=d.gestures||{},d.READY=!1,d.utils={extend:function(a,c,d){for(var e in c)a[e]!==b&&d||(a[e]=c[e]);return a},each:function(a,c,d){var e,f;if("forEach"in a)a.forEach(c,d);else if(a.length!==b){for(e=0,f=a.length;f>e;e++)if(c.call(d,a[e],e,a)===!1)return}else for(e in a)if(a.hasOwnProperty(e)&&c.call(d,a[e],e,a)===!1)return},hasParent:function(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1},getCenter:function(a){var b=[],c=[];return d.utils.each(a,function(a){b.push("undefined"!=typeof a.clientX?a.clientX:a.pageX),c.push("undefined"!=typeof a.clientY?a.clientY:a.pageY)}),{pageX:(Math.min.apply(Math,b)+Math.max.apply(Math,b))/2,pageY:(Math.min.apply(Math,c)+Math.max.apply(Math,c))/2}},getVelocity:function(a,b,c){return{x:Math.abs(b/a)||0,y:Math.abs(c/a)||0}},getAngle:function(a,b){var c=b.pageY-a.pageY,d=b.pageX-a.pageX;return 180*Math.atan2(c,d)/Math.PI},getDirection:function(a,b){var c=Math.abs(a.pageX-b.pageX),e=Math.abs(a.pageY-b.pageY);return c>=e?a.pageX-b.pageX>0?d.DIRECTION_LEFT:d.DIRECTION_RIGHT:a.pageY-b.pageY>0?d.DIRECTION_UP:d.DIRECTION_DOWN},getDistance:function(a,b){var c=b.pageX-a.pageX,d=b.pageY-a.pageY;return Math.sqrt(c*c+d*d)},getScale:function(a,b){return a.length>=2&&b.length>=2?this.getDistance(b[0],b[1])/this.getDistance(a[0],a[1]):1},getRotation:function(a,b){return a.length>=2&&b.length>=2?this.getAngle(b[1],b[0])-this.getAngle(a[1],a[0]):0},isVertical:function(a){return a==d.DIRECTION_UP||a==d.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(a,b){b&&a&&a.style&&(d.utils.each(["webkit","khtml","moz","Moz","ms","o",""],function(c){d.utils.each(b,function(b,d){c&&(d=c+d.substring(0,1).toUpperCase()+d.substring(1)),d in a.style&&(a.style[d]=b)})}),"none"==b.userSelect&&(a.onselectstart=function(){return!1}),"none"==b.userDrag&&(a.ondragstart=function(){return!1}))}},d.Instance=function(a,b){var e=this;return c(),this.element=a,this.enabled=!0,this.options=d.utils.extend(d.utils.extend({},d.defaults),b||{}),this.options.stop_browser_behavior&&d.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),d.event.onTouch(a,d.EVENT_START,function(a){e.enabled&&d.detection.startDetect(e,a)}),this},d.Instance.prototype={on:function(a,b){var c=a.split(" ");return d.utils.each(c,function(a){this.element.addEventListener(a,b,!1)},this),this},off:function(a,b){var c=a.split(" ");return d.utils.each(c,function(a){this.element.removeEventListener(a,b,!1)},this),this},trigger:function(a,b){b||(b={});var c=d.DOCUMENT.createEvent("Event");c.initEvent(a,!0,!0),c.gesture=b;var e=this.element;return d.utils.hasParent(b.target,e)&&(e=b.target),e.dispatchEvent(c),this},enable:function(a){return this.enabled=a,this}};var e=null,f=!1,g=!1;d.event={bindDom:function(a,b,c){var e=b.split(" ");d.utils.each(e,function(b){a.addEventListener(b,c,!1)})},onTouch:function(a,b,c){var h=this;this.bindDom(a,d.EVENT_TYPES[b],function(i){var j=i.type.toLowerCase();if(!j.match(/mouse/)||!g){j.match(/touch/)||j.match(/pointerdown/)||j.match(/mouse/)&&1===i.which?f=!0:j.match(/mouse/)&&!i.which&&(f=!1),j.match(/touch|pointer/)&&(g=!0);var k=0;f&&(d.HAS_POINTEREVENTS&&b!=d.EVENT_END?k=d.PointerEvent.updatePointer(b,i):j.match(/touch/)?k=i.touches.length:g||(k=j.match(/up/)?0:1),k>0&&b==d.EVENT_END?b=d.EVENT_MOVE:k||(b=d.EVENT_END),(k||null===e)&&(e=i),c.call(d.detection,h.collectEventData(a,b,h.getTouchList(e,b),i)),d.HAS_POINTEREVENTS&&b==d.EVENT_END&&(k=d.PointerEvent.updatePointer(b,i))),k||(e=null,f=!1,g=!1,d.PointerEvent.reset())}},{passive:!0})},determineEventTypes:function(){var a;a=d.HAS_POINTEREVENTS?d.PointerEvent.getEvents():d.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],d.EVENT_TYPES[d.EVENT_START]=a[0],d.EVENT_TYPES[d.EVENT_MOVE]=a[1],d.EVENT_TYPES[d.EVENT_END]=a[2]},getTouchList:function(a){return d.HAS_POINTEREVENTS?d.PointerEvent.getTouchList():a.touches?a.touches:(a.identifier=1,[a])},collectEventData:function(a,b,c,e){var f=d.POINTER_TOUCH;return(e.type.match(/mouse/)||d.PointerEvent.matchType(d.POINTER_MOUSE,e))&&(f=d.POINTER_MOUSE),{center:d.utils.getCenter(c),timeStamp:(new Date).getTime(),target:e.target,touches:c,eventType:b,pointerType:f,srcEvent:e,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return d.detection.stopDetect()}}}},d.PointerEvent={pointers:{},getTouchList:function(){var a=this,b=[];return d.utils.each(a.pointers,function(a){b.push(a)}),b},updatePointer:function(a,b){return a==d.EVENT_END?this.pointers={}:(b.identifier=b.pointerId,this.pointers[b.pointerId]=b),Object.keys(this.pointers).length},matchType:function(a,b){if(!b.pointerType)return!1;var c=b.pointerType,e={};return e[d.POINTER_MOUSE]=c===b.MSPOINTER_TYPE_MOUSE||c===d.POINTER_MOUSE,e[d.POINTER_TOUCH]=c===b.MSPOINTER_TYPE_TOUCH||c===d.POINTER_TOUCH,e[d.POINTER_PEN]=c===b.MSPOINTER_TYPE_PEN||c===d.POINTER_PEN,e[a]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},d.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(a,b){this.current||(this.stopped=!1,this.current={inst:a,startEvent:d.utils.extend({},b),lastEvent:!1,name:""},this.detect(b))},detect:function(a){if(this.current&&!this.stopped){a=this.extendEventData(a);var b=this.current.inst.options;return d.utils.each(this.gestures,function(c){return this.stopped||b[c.name]===!1||c.handler.call(c,a,this.current.inst)!==!1?void 0:(this.stopDetect(),!1)},this),this.current&&(this.current.lastEvent=a),a.eventType==d.EVENT_END&&!a.touches.length-1&&this.stopDetect(),a}},stopDetect:function(){this.previous=d.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(a){var b=this.current.startEvent;!b||a.touches.length==b.touches.length&&a.touches!==b.touches||(b.touches=[],d.utils.each(a.touches,function(a){b.touches.push(d.utils.extend({},a))}));var c,e,f=a.timeStamp-b.timeStamp,g=a.center.pageX-b.center.pageX,h=a.center.pageY-b.center.pageY,i=d.utils.getVelocity(f,g,h);return"end"===a.eventType?(c=this.current.lastEvent&&this.current.lastEvent.interimAngle,e=this.current.lastEvent&&this.current.lastEvent.interimDirection):(c=this.current.lastEvent&&d.utils.getAngle(this.current.lastEvent.center,a.center),e=this.current.lastEvent&&d.utils.getDirection(this.current.lastEvent.center,a.center)),d.utils.extend(a,{deltaTime:f,deltaX:g,deltaY:h,velocityX:i.x,velocityY:i.y,distance:d.utils.getDistance(b.center,a.center),angle:d.utils.getAngle(b.center,a.center),interimAngle:c,direction:d.utils.getDirection(b.center,a.center),interimDirection:e,scale:d.utils.getScale(b.touches,a.touches),rotation:d.utils.getRotation(b.touches,a.touches),startEvent:b}),a},register:function(a){var c=a.defaults||{};return c[a.name]===b&&(c[a.name]=!0),d.utils.extend(d.defaults,c,!0),a.index=a.index||1e3,this.gestures.push(a),this.gestures.sort(function(a,b){return a.index<b.index?-1:a.index>b.index?1:0}),this.gestures}},d.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,correct_for_drag_min_distance:!0,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(a,b){if(d.detection.current.name!=this.name&&this.triggered)return b.trigger(this.name+"end",a),void(this.triggered=!1);if(!(b.options.drag_max_touches>0&&a.touches.length>b.options.drag_max_touches))switch(a.eventType){case d.EVENT_START:this.triggered=!1;break;case d.EVENT_MOVE:if(a.distance<b.options.drag_min_distance&&d.detection.current.name!=this.name)return;if(d.detection.current.name!=this.name&&(d.detection.current.name=this.name,b.options.correct_for_drag_min_distance&&a.distance>0)){var c=Math.abs(b.options.drag_min_distance/a.distance);d.detection.current.startEvent.center.pageX+=a.deltaX*c,d.detection.current.startEvent.center.pageY+=a.deltaY*c,a=d.detection.extendEventData(a)}(d.detection.current.lastEvent.drag_locked_to_axis||b.options.drag_lock_to_axis&&b.options.drag_lock_min_distance<=a.distance)&&(a.drag_locked_to_axis=!0);var e=d.detection.current.lastEvent.direction;a.drag_locked_to_axis&&e!==a.direction&&(d.utils.isVertical(e)?a.direction=a.deltaY<0?d.DIRECTION_UP:d.DIRECTION_DOWN:a.direction=a.deltaX<0?d.DIRECTION_LEFT:d.DIRECTION_RIGHT),this.triggered||(b.trigger(this.name+"start",a),this.triggered=!0),b.trigger(this.name,a),b.trigger(this.name+a.direction,a),(b.options.drag_block_vertical&&d.utils.isVertical(a.direction)||b.options.drag_block_horizontal&&!d.utils.isVertical(a.direction))&&a.preventDefault();break;case d.EVENT_END:this.triggered&&b.trigger(this.name+"end",a),this.triggered=!1}}},d.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(a,b){switch(a.eventType){case d.EVENT_START:clearTimeout(this.timer),d.detection.current.name=this.name,this.timer=setTimeout(function(){"hold"==d.detection.current.name&&b.trigger("hold",a)},b.options.hold_timeout);break;case d.EVENT_MOVE:a.distance>b.options.hold_threshold&&clearTimeout(this.timer);break;case d.EVENT_END:clearTimeout(this.timer)}}},d.gestures.Release={name:"release",index:1/0,handler:function(a,b){a.eventType==d.EVENT_END&&b.trigger(this.name,a)}},d.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_min_touches:1,swipe_max_touches:1,swipe_velocity:.7},handler:function(a,b){if(a.eventType==d.EVENT_END){if(b.options.swipe_max_touches>0&&a.touches.length<b.options.swipe_min_touches&&a.touches.length>b.options.swipe_max_touches)return;(a.velocityX>b.options.swipe_velocity||a.velocityY>b.options.swipe_velocity)&&(b.trigger(this.name,a),b.trigger(this.name+a.direction,a))}}},d.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(a,b){if(a.eventType==d.EVENT_END&&"touchcancel"!=a.srcEvent.type){var c=d.detection.previous,e=!1;if(a.deltaTime>b.options.tap_max_touchtime||a.distance>b.options.tap_max_distance)return;c&&"tap"==c.name&&a.timeStamp-c.lastEvent.timeStamp<b.options.doubletap_interval&&a.distance<b.options.doubletap_distance&&(b.trigger("doubletap",a),e=!0),e&&!b.options.tap_always||(d.detection.current.name="tap",b.trigger(d.detection.current.name,a))}}},d.gestures.Touch={name:"touch",index:-(1/0),defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(a,b){return b.options.prevent_mouseevents&&a.pointerType==d.POINTER_MOUSE?void a.stopDetect():(b.options.prevent_default&&a.preventDefault(),void(a.eventType==d.EVENT_START&&b.trigger(this.name,a)))}},d.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(a,b){if(d.detection.current.name!=this.name&&this.triggered)return b.trigger(this.name+"end",a),void(this.triggered=!1);if(!(a.touches.length<2))switch(b.options.transform_always_block&&a.preventDefault(),a.eventType){case d.EVENT_START:this.triggered=!1;break;case d.EVENT_MOVE:var c=Math.abs(1-a.scale),e=Math.abs(a.rotation);if(c<b.options.transform_min_scale&&e<b.options.transform_min_rotation)return;d.detection.current.name=this.name,this.triggered||(b.trigger(this.name+"start",a),this.triggered=!0),b.trigger(this.name,a),e>b.options.transform_min_rotation&&b.trigger("rotate",a),c>b.options.transform_min_scale&&(b.trigger("pinch",a),b.trigger("pinch"+(a.scale<1?"in":"out"),a));break;case d.EVENT_END:this.triggered&&b.trigger(this.name+"end",a),this.triggered=!1}}},"function"==typeof define&&define.amd?define(function(){return d}):"object"==typeof module&&module.exports?module.exports=d:a.Hammer=d}(window);var JSandbox=function(a){var b="undefined",c=a.document,d=a.Worker;if(typeof d!==b){for(var e="eval",f="exec",g="load",h="requests",i="input",j="terminate",k="data",l="callback",m="onerror",n="worker",o="onresponse",p="prototype",q="call",r="string",s="function",t=function(){var a=this;if(!(a instanceof t))return new t;try{a[n]=new d(t.url)}catch(b){"SecurityError"===b.name&&(a[n]=new d(window.URL.createObjectURL(new Blob(["("+z.toString()+"(self,eval))"],{type:"text/javascript"}))))}a[h]={},a[n].onmessage=function(b){var c,d=b[k];if("object"==typeof d){if("log"==d.id)return void console.log(d.message);c=a[h][d.id],c&&(d.error?(typeof a[m]===s&&a[m](d,c),typeof c[m]===s&&c[m][q](a,d.error)):(typeof a[o]===s&&a[o](d,c),typeof c[l]===s&&c[l][q](a,d.results)),delete a[h][d.id])}}},u=t[p],v=function(a){u[a]=function(b,c,d,e){(typeof b===r||"[object Array]"===Object[p].toString[q](b)||arguments.length>1)&&(b={data:b,input:d,callback:c,onerror:e}),a===g&&typeof b[k]===r&&(b[k]=[b[k]]);var f=b[k],j=this.createRequestID();return d=b[i],delete b[k],delete b[i],this[h][j]=b,this[n].postMessage({id:j,method:a,data:f,input:d}),j},t[a]=function(){var b=new t;return b[o]=b[m]=function(){b[j](),b=null},t[p][a].apply(b,Array[p].slice[q](arguments)),t}},w=[e,g,f],x=3;x--;)v(w[x]);if(u[j]=function(){this[h]={},this[n].onmessage=null,this[n][j]()},u.abort=function(a){delete this[h][a]},u.createRequestID=function(){var a=Math.random().toString();return a in this[h]?this.createRequestID():a},typeof c!==b){var y=c.getElementsByTagName("link");for(x=y.length;x--;)if("jsandbox"===y[x].getAttribute("rel")){t.url=y[x].getAttribute("href");break}}var z=function(a,b){"use strict";var c=a.postMessage,d=a.importScripts,e="message",f=function(e){var f=e.data,g={};g.id=f.id;var h=f.data;a.input=f.input||{};try{switch(f.method){case"eval":g.results=b(h);break;case"exec":d("data:application/javascript,"+encodeURIComponent(h));break;case"load":d.apply(a,h)}}catch(i){g.code=i.message,g.error=i.stack,g.line=i.lineNumber,g.fileName=i.fileName}delete a.input;try{delete a.onmessage}catch(i){}c(g)};a.addEventListener?a.addEventListener(e,f,!1):a.attachEvent&&a.attachEvent("on"+e,f),a.window=a,a.console={log:function(a){c({id:"log",message:a})}},a.Worker=a.addEventListener=a.removeEventListener=a.importScripts=a.XMLHttpRequest=a.postMessage=a.attachEvent=a.detachEvent=a.ActiveXObject=void 0};return t.url||(t.url=window.URL.createObjectURL(new Blob(["("+z.toString()+"(self,eval))"],{type:"text/javascript"}))),t}}(self),Sandbox=JSandbox;if(function(a){var b=function(){};b.zoomIn=function(a,b,c,d){var e={TransformOriginX:b.RS*c+"px",TransformOriginY:b.RS*d+"px",Transform:"scale(0)",webkitTransition:"-webkit-transform 0.2s",mozTransition:"-moz-transform 0.2s;",transition:"transform 0.2s;"};for(var f in e)f.match(/^[a-z]/)&&(a.style[f]=e[f]),["webkit","moz","ms",null].forEach(function(b){a.style[b?b+f:f.charAt(0).toLowerCase()+f.slice(1)]=e[f]});setTimeout(function(){a.style.webkitTransform="",a.style.msTransform="",a.style.mozTransform="",a.style.transform=""},10)};var c=function(a){return-3>a?-1:a>3?1:a*(27+a*a)/(27+9*a*a)};b.create=function(a,d,e,f,g){"undefined"==typeof a.supports_use&&!function(){a.supports_use=!0}();var h=0,i={x:d,y:e};g||(g={});var j="ontouchstart"in window?3*(g.size||10)/a.zoom:2*(g.size||10)/a.zoom,k=(g.size||10)/a.zoom;"ontouchstart"in window&&(k*=1.4);var l=f?2*Math.PI/f.length:0,m=new b,n=[];if(m.container=a.group(),window.MutationObserver||window.webkitMutationObserver||window.MozMutationObserver){var o=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,p=new o(function(a){a.forEach(function(a){"childList"==a.type&&null!==m.container.nextSibling&&m.container.parentNode.appendChild(m.container)})});p.observe(a,{childList:!0}),m.observer=p}var q=null,r=function(b){b.preventDefault(),b.stopPropagation();var c=a.createSVGRect(),d=a.getBoundingClientRect();c.x=b.touches[0].clientX-d.left,c.y=b.touches[0].clientY-d.top,c.width=c.height=1;for(var e,f=a.getIntersectionList(c,null),g=0;!e&&g<f.length;g++)f[g].move_func&&(e=f[g]);e&&(null!==q&&e!==q&&q.moveout_func&&q.moveout_func(),e.move_func&&(e.move_func(b),q=e))};return a.addEventListener("touchmove",r,!0),a.addEventListener("touchend",function(b){q&&q.end_func&&(q.end_func(),b.stopPropagation()),a.removeEventListener("touchmove",r,!0),a.removeEventListener("touchend",arguments.callee)},!1),(f||[]).forEach(function(m){var o,p;if(o=i.x+j*Math.cos(h*l),p=i.y+1.3*j*Math.sin(h*l),g.ellipse){var q=f.length-5;0>q&&(q=0);var r=-1*(Math.PI/3+(7/18*Math.PI-Math.PI/3)*c(q*q/100)),s=1+q/6,t=1+q/15;o=i.x+j*t*Math.cos(h*l)*Math.cos(r)-j*s*Math.sin(h*l)*Math.sin(r),p=i.y+j*t*Math.cos(h*l)*Math.sin(r)+j*s*Math.sin(h*l)*Math.cos(r)}h++;var u=a.circle(o,p,k);u.setAttribute("fill","#eed"),u.setAttribute("stroke","#eee"),u.setAttribute("stroke-width",1.5*a.RS/a.zoom),b.zoomIn(u,a,d,e),n.push(u);var v=m.symbol;if("string"==typeof v)if(v.match(/^#[0123456789ABCDEF]{3,6}$/)||v.match(/^url/))u.setAttribute("fill",v);else if(v.match(/^(:?https?:)?\/?.*#/)){var w=a.group(),x=a.group();w.push(x);var y=a.use(v,0,0,100,100),z=.8;x.setAttribute("transform","translate("+(o-z*k)*a.RS+","+(p-z*k)*a.RS+") scale("+z*k+")"),x.push(y),w.setAttribute("pointer-events","none"),n.push(w)}else{v=a.text_circle(o,p,k,v);var w=a.group();w.push(v),n.push(w),w.setAttribute("pointer-events","none")}else if(v){var w=a.group(),x=a.group();x.setAttribute("transform","translate("+o*a.RS+","+p*a.RS+") scale("+.75*k+")"),x.push(v),w.push(x),n.push(w),w.setAttribute("pointer-events","none")}if(m.text){v=a.text_circle(o,p,.8*k,m.text,{stretch:o>i.x+k?"right":Math.abs(o-i.x)<k?!0:"left",weight:"normal",fill:"#000"});var w=a.group();w.push(v),n.push(w),w.setAttribute("pointer-events","none"),u.setAttribute("opacity","0.5")}u.move_func=function(a){this.setAttribute("stroke","#0f0"),m.hover_function&&m.hover_function(),a.stopPropagation()},u.end_func=function(a){m.select_function&&m.select_function()},u.moveout_func=function(a){this.setAttribute("stroke","#eee")},u.addEventListener("mouseover",u.move_func,!0),u.addEventListener("mouseup",u.end_func),u.addEventListener("mouseout",u.moveout_func)}),m.elements=n,m.elements.forEach(function(c){b.zoomIn(c,a,d,e),m.container.push(c)}),m},b.prototype.destroy=function(){var a=this;this.elements&&(this.observer&&this.observer.disconnect(),this.elements.forEach(function(a){if(a.setAttribute&&a.setAttribute("pointer-events","none"),a.style){var b="scale(0)";a.style.webkitTransform=b,a.style.msTransform=b,a.style.mozTransform=b,a.style.transform=b}setTimeout(function(){a&&a.parentNode&&a.parentNode.removeChild(a)},750)}),this.elements=[]),setTimeout(function(){a.container&&a.container.parentNode&&a.container.parentNode.removeChild(a.container)},1e3)},a.PieMenu=b}(window),"undefined"==typeof MASCP){MASCP={};var ie=function(){var a,b=3,c=document.createElement("div"),d=c.getElementsByTagName("i");do c.innerHTML="<!--[if gt IE "+ ++b+"]><i></i><![endif]-->";while(d[0]);return b>4?b:a}();ie&&(7===ie&&(MASCP.IE=!0,MASCP.IE7=!0),8===ie&&(MASCP.IE=!0,MASCP.IE8=!0))}MASCP.registerGroup=function(a,b){if(this.groups||(this.groups={}),!this.groups[a]){var c=new MASCP.Group;if(c.name=a,b=b||{},b.hide_member_controllers&&(c.hide_member_controllers=!0),b.hide_group_controller&&(c.hide_group_controller=!0),b.fullname&&(c.fullname=b.fullname),b.color&&(c.color=b.color),b.group){if(c.group=this.getGroup(b.group),!c.group)throw"Cannot register this layer with the given group - the group has not been registered yet";c.group._layers.push(c)}return c._layers=[],c.group_id=(new Date).getMilliseconds(),this.groups[a]=c,bean.fire(MASCP,"groupRegistered",[c]),c}},MASCP.registerLayer=function(a,b,c){this.layers||(this.layers={}),c||(c=[]);var d;if(this.layers[a]&&((this.layers[a].disabled||c.length>0)&&(this.layers[a].disabled=!1,bean.fire(MASCP,"layerRegistered",[this.layers[a]].concat(c))),d=this.layers[a]),d&&b.group&&(d.group!==this.getGroup(b.group)&&(d.group=this.getGroup(b.group),d.group._layers.push(d)),!d.group))throw"Cannot register this layer with the given group - the group has not been registered yet";if(d)return d;if(d=new MASCP.Layer,d.name=a,b=b||{},b.fullname&&(d.fullname=b.fullname),b.color&&(d.color=b.color),b.data&&(d.data=b.data),d&&b.group){if(d.group=this.getGroup(b.group),!d.group)throw"Cannot register this layer with the given group - the group has not been registered yet";d.group._layers.push(d)}return this.layers[a]=d,b.css&&console.log("options.css is deprecated"),d.layer_id=(new Date).getMilliseconds(),bean.fire(MASCP,"layerRegistered",[d].concat(c)),d},MASCP.Group=function(){},MASCP.Group.prototype.size=function(){for(var a=0,b=0;b<this._layers.length;b++)this._layers[b].disabled||(a+=1);return a},MASCP.Group.prototype.eachLayer=function(a){for(var b=0;b<this._layers.length;b++)this._layers[b].disabled||a.call(this._layers[b],this._layers[b])},MASCP.Layer=function(){},MASCP.SequenceRenderer=function(){var a=function(a){var b=[],c={getTrackOrder:function(){return b},setTrackOrder:function(c){var d=[],e=c;!e instanceof Array&&(e=[c]);for(var f=0;f<e.length;f++){var g=e[f];if(MASCP.getLayer(g)){for(;d.indexOf(g)>=0;)d.splice(d.indexOf(g),1);d.push(g)}MASCP.getGroup(g)&&MASCP.getGroup(e[f]).eachLayer(function(a){for(;d.indexOf(a.name)>=0;)d.splice(d.indexOf(a.name),1);e.splice(f+1,0,a.name)})}for(f=(b||[]).length-1;f>=0;f--)d.indexOf(b[f])<0&&(this.hideLayer(b[f]),this.hideGroup(b[f]),MASCP.getLayer(b[f])&&bean.fire(MASCP.getLayer(b[f]),"removed",[a]),MASCP.getGroup(b[f])&&bean.fire(MASCP.getGroup(b[f]),"removed",[a]));b=d,this.refresh&&this.refresh(!0),bean.fire(a,"orderChanged",[d])}};MASCP.IE&&(a.setTrackOrder=c.setTrackOrder),"function"!=typeof Object.defineProperty||MASCP.IE8||Object.defineProperty(a,"trackOrder",{get:c.getTrackOrder,set:c.setTrackOrder})};return function(b){return b?("undefined"!=typeof b&&(this._container=b,this._container.style.position||(this._container.style.position="relative"),bean.add(this,"sequenceChange",function(a){for(;b.firstChild;)b.removeChild(b.firstChild);this._sequence_els.forEach(function(a){b.appendChild(a)});var c=document.createElement("div");c.setAttribute("style","clear: both; float: none; height: 0px; width: 100%;"),b.appendChild(c),b.style.width=this._sequence_els.length+"em"}),this.setSequence(b.textContent||"")),a(this),this):this}}(),MASCP.SequenceRenderer.prototype={sequence:null},MASCP.IE&&(MASCP.SequenceRenderer.prototype.prototype=document.createElement("div")),MASCP.SequenceRenderer.prototype.setSequence=function(a){this.sequence=this._cleanSequence(a);var b=[],c=this;if(this.sequence){for(var d=this.sequence.split(""),e=0;e<d.length;e++){var f=d[e];if(f.match(/[A-Za-z]/)){var g=document.createElement("span");g.textContent=f,b.push(g)}}b.forEach(function(a,b){a._index=b,a.style.display="block",a.style.cssFloat="left",a.style.styleFloat="left",a.style.height="1.1em",a.style.position="relative",a.addToLayer=MASCP.SequenceRenderer.addElementToLayer,a.addBoxOverlay=MASCP.SequenceRenderer.addBoxOverlayToElement,a.addToLayerWithLink=MASCP.SequenceRenderer.addElementToLayerWithLink,a._renderer=c}),this._sequence_els=b,bean.fire(this,"sequenceChange")}},MASCP.SequenceRenderer.prototype.colorResidues=function(a,b){var c=Math.floor(1e3*Math.random()).toString();MASCP.registerLayer(c,{color:b||"#ff0000"});for(var d=this.getAminoAcidsByPosition(a),e=0;e<d.length;e++)d[e].addToLayer(c);return MASCP.getLayer(c)},MASCP.SequenceRenderer.prototype._cleanSequence=function(a){if(!a)return a;var b=a;return b=b.replace(new RegExp(String.fromCharCode(160),"g"),""),b=b.replace(/[\n\t\s\d]+/gim,""),b=b.replace(/\(.*\)/g,"")},MASCP.SequenceRenderer.prototype.getAminoAcidsByPosition=function(a){var b=this._sequence_els;return a.map(function(a){return 0>a?null:b[a-1]})},MASCP.SequenceRenderer.prototype.getAA=function(a){return this.getAminoAcidsByPosition([a]).shift()},MASCP.SequenceRenderer.prototype.getAminoAcidsByPeptide=function(a){var b=this.sequence.indexOf(a),c=[];return 0>b?(c.addToLayer=function(){},c):(c=c.concat(this._sequence_els.slice(b,b+a.length)),c.length?c.addToLayer=function(a,b,d){return c[0].addBoxOverlay(a,c.length,b,d)}:c.addToLayer=function(){},c)},MASCP.SequenceRenderer.prototype.toggleLayer=function(a,b){var c=a;return"string"!=typeof a?c=a.name:a=MASCP.layers[a],this._container.classList.toggle(c+"_active"),this._container.classList.toggle(c+"_inactive"),b||bean.fire(a,"visibilityChange",[this,this.isLayerActive(a)]),this},MASCP.SequenceRenderer.prototype.showLayer=function(a,b){var c=MASCP.getLayer(a);if(c&&!c.disabled)return this._container.classList.add(c.name+"_active"),this._container.classList.add("active_layer"),this._container.classList.remove(c.name+"_inactive"),b||bean.fire(c,"visibilityChange",[this,!0]),this},MASCP.SequenceRenderer.prototype.hideLayer=function(a,b){var c=MASCP.getLayer(a);if(c&&!c.disabled)return this._container.classList.remove(c.name+"_active"),this._container.classList.remove("active_layer"),this._container.classList.add(c.name+"_inactive"),b||bean.fire(c,"visibilityChange",[this,!1]),this},MASCP.SequenceRenderer.prototype.registerLayer=function(a,b){return MASCP.registerLayer(a,b)},MASCP.SequenceRenderer.prototype.setGroupVisibility=function(a,b,c){var d=MASCP.getGroup(a);if(d){var e=(d.name,this);d.eachLayer(function(a){return MASCP.getGroup(a)!==a?this.disabled&&b?void e.hideLayer(a.name):void(b===!0?e.showLayer(a.name):b===!1?e.hideLayer(a.name):e.toggleLayer(a.name)):void 0}),null===b||c||bean.fire(d,"visibilityChange",[e,b])}},MASCP.SequenceRenderer.prototype.hideGroup=function(a,b){this.setGroupVisibility(a,!1,b)},MASCP.SequenceRenderer.prototype.showGroup=function(a,b){this.setGroupVisibility(a,!0,b)},MASCP.SequenceRenderer.prototype.toggleGroup=function(a,b){this.setGroupVisibility(a,b)},MASCP.SequenceRenderer.prototype.isLayerActive=function(a){var b=a;return"string"!=typeof a&&(b=a.name),!a.disabled&&this._container.classList.contains(b+"_active")},MASCP.SequenceRenderer.prototype._setHighlight=function(a,b){},MASCP.SequenceRenderer.prototype.createLayerController=function(){console.log("createLayerController is deprected")},MASCP.SequenceRenderer.prototype.createLayerCheckbox=function(a,b,c){console.log("createLayerCheckbox is deprecated")},MASCP.getLayer=function(a){return MASCP.layers?"string"==typeof a?MASCP.layers[a]:a:void 0},MASCP.getGroup=function(a){return"undefined"!=typeof a&&MASCP.groups?"string"==typeof a?MASCP.groups[a]:a==MASCP.groups[a.name]?a:null:void 0},MASCP.SequenceRenderer.prototype._removeOtherBindings=function(a,b){for(var c=this,d=0;d<b._current_bindings.length;d++)if(b._current_bindings[d].renderer==c){var e=b._current_bindings[d];e.layer&&e.layer!=a.name&&(bean.remove(MASCP.getLayer(e.layer),"visibilityChange",e.object_function),bean.remove(b,"change",e.input_function)),e.group&&e.group!=a.name&&(bean.remove(MASCP.getGroup(e.group),"visibilityChange",e.object_function),bean.remove(b,"change",e.input_function)),e.group=null,e.layer=null}},MASCP.SequenceRenderer.prototype.createGroupCheckbox=function(a,b,c){console.log("createGroupCheckbox is deprecated")},MASCP.SequenceRenderer.prototype.createGroupController=function(a,b){var c=MASCP.getLayer(a),d=MASCP.getGroup(b),e=this;bean.add(c,"visibilityChange",function(a,b){a==e&&(e.setGroupVisibility(d,b),e.refresh())})},MASCP.SequenceRenderer.addElementToLayer=function(a){return this.addBoxOverlay(a,1),this},MASCP.SequenceRenderer.addElementToLayerWithLink=function(a,b,c){this.classList.add(a);var d=document.createElement("a");for(d.setAttribute("href",b),d.classList.add(a+"_overlay"),d.setAttribute("style","display: box; left: 0px; top: 0px; width: 100%; position: absolute; height: 100%;"),d.textContent="&nbsp;",this.appendChild(d);c&&c>0;)this._renderer._sequence_els[this._index+c].addToLayerWithLink(a,b),c-=1;return this._z_indexes&&this._z_indexes[a]&&(d.style.zIndex=this._z_indexes[a]),this},MASCP.SequenceRenderer.addBoxOverlayToElement=function(a,b,c){"undefined"==typeof c&&(c=1),this.classList.add(a);var d=document.createElement("div");for(d.classList.add(a+"_overlay"),d.setAttribute("style","top: 0px; width: 100%; position: absolute; height: 100%; opacity:"+c+";"),this.appendChild(d);b&&b>1;)this._renderer._sequence_els[this._index+b-1].addBoxOverlay(a,0,c),b-=1;this._z_indexes&&this._z_indexes[a]&&(d.style.zIndex=this._z_indexes[a]);for(var e=["mouseover","mousedown","mousemove","mouseout","click","dblclick","mouseup","mouseenter","mouseleave"],f=0;f<e.length;f++)bean.add(d,e[f],function(){return function(b){bean.fire(MASCP.getLayer(a),b.type,[b,"SequenceRenderer"])}}(f));return this},MASCP.SequenceRenderer.prototype.reset=function(){for(;this._container.classList.length>0;)this._container.classList.remove(this._container.classList.item(0));for(var a in MASCP.groups)MASCP.groups.hasOwnProperty(a)&&this.hideGroup(a);for(var b in MASCP.layers)MASCP.layers.hasOwnProperty(b)&&(this.hideLayer(b,!0),MASCP.layers[b].disabled=!0);delete this._scalers,delete this.forceTrackAccs,this.resetAnnotations&&this.resetAnnotations()},MASCP.SequenceRenderer.prototype.withoutRefresh=function(a){var b=this.refresh;this.refresh=function(){},this.refresh.suspended=!0,a.apply(this),this.refresh=b},MASCP.SequenceRenderer.prototype.refresh=function(){var a=-2;this._z_indexes||(this._z_indexes={});for(var b=0;b<(this.trackOrder||[]).length;b++)this.isLayerActive(this.trackOrder[b])&&(Array.prototype.slice.call(document.querySelectorAll("."+this.trackOrder[b]+"_overlay")).forEach(function(b){b.style.zIndex=a}),this._z_indexes[this.trackOrder[b]]=a,a-=1)},MASCP.SequenceRenderer.prototype.bind=function(a,b){bean.add(this,a,b)},MASCP.SequenceRenderer.prototype.unbind=function(a,b){bean.remove(this,a,b)},MASCP.SequenceRenderer.prototype.trigger=function(a,b){bean.fire(this,a,b)};var SVGCanvas=SVGCanvas||function(){function b(a,b){var c,d,e,h,j;a.visibility=function(){for(var b="hidden",c=0;c<a.length;c++)if(!Array.isArray(a[c])&&(j=a[c].getAttribute("visibility"),j&&"hidden"!=j)){b=j;break}return b},a.currenty=function(){var b,c=a.filter(function(a){return!Array.isArray(a)});return c[0]&&c[0].getAttribute("transform")&&(b=/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/.exec(c[0].getAttribute("transform")),null!==b&&"undefined"!=typeof b&&(b=b[2])),a[0]?parseInt(b||a[0].getAttribute("y")||0,10):0},a.animate=function(c){if("undefined"==typeof c.y)return void l(c);if(0!==a.length){var d,e={};for(d in c)c.hasOwnProperty(d)&&(e[d]=c[d]);if(k(),a.animating)for(var g=0;g<(f||[]).length;g++)f[g].target_set==a&&(a.animating=!1,f.splice(g,1));var h=a.visibility(),j=e.visibility;if(h==j&&"hidden"==j)return void l(c);var m=a.currenty();if(isNaN(parseInt(m,10)))return void console.log("Have a NaN y value, skipping");var n=parseInt(e.y,10);delete e.y,h==j&&"visible"==j&&(delete e.visibility,j=null,l({visibility:"visible"})),"hidden"==e.visibility&&delete e.visibility,
l(e);var o=0;if(n!=m){var p=1*(Math.abs(parseInt((n-m)/(50*b),10)/i)+1),q=(n-m)/p;e.y=m||0;arguments.callee;a.animating=!0,e.y=m+1*q,f.push(function(b){return 0>q&&e.y<n&&(e.y=n),q>0&&e.y>n&&(e.y=n),l(e),o+=b||1,e.y!=n?void(e.y=m+q*(o+1)):(a.animating=!1,j&&l({visibility:j}),void f.splice(f.indexOf(arguments.callee),1))}),f[f.length-1].target_set=a}}},a.attr=function(a){return g?this.animate(a):l(a)};var l=function(b){var f,g={};for(f in b)b.hasOwnProperty(f)&&(g[f]=b[f]);a.visibility(),parseInt(g.y,10);h=g.visibility;for(f in g)if(g.hasOwnProperty(f))for(var i=0;i<a.length;i++)if(a[i]&&!Array.isArray(a[i])&&"none"!=a[i].style.display){var j=g[f];if("style"==f&&a[i].hasAttribute("style")){var k=a[i].getAttribute("style");k+="; "+g[f],j=k}var l=a[i].hasAttribute("transform")&&a[i].getAttribute("transform").indexOf("translate")>=0;if("height"==f&&a[i].setHeight?a[i].setHeight(g[f]):(!l||"y"!=f&&"x"!=f)&&a[i].setAttribute(f,j),"y"==f&&a[i].hasAttribute("d")){var m=a[i].getAttribute("d"),n=/M\s*([\d\.]+) ([\d\.]+)/;if(m=m.replace(n,""),isNaN(parseInt(j,10)))throw"Error "+f+" is "+g[f];a[i].setAttribute("d","M0 "+parseInt(j,10)+" "+m)}if("y"==f&&a[i].hasAttribute("cy")&&a[i].setAttribute("cy",g[f]),"y"==f&&a[i].hasAttribute("transform")){if(e=a[i].getAttribute("transform"),c=/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)?\)/.exec(a[i].getAttribute("transform")),null===c)continue;c=c[1],e=e.replace(/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)?\)/,"translate("+c+","+j+")"),a[i].setAttribute("transform",e)}if("x"==f&&a[i].hasAttribute("transform")){if(e=a[i].getAttribute("transform"),d=/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/.exec(a[i].getAttribute("transform")),null===d)continue;d=d[2],e=e.replace(/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/,"translate("+j+","+d+")"),a[i].setAttribute("transform",e)}"text-anchor"==f&&a[i].hasAttribute("style")&&(a[i].style.textAnchor=g[f])}};return a.hide=function(){this.attr({visibility:"hidden"})},a.show=function(){this.attr({visibility:"visible"})},a.refresh_zoom=function(){for(var b=0;b<a.length;b++)Array.isArray(a[b])||(a[b].zoom_level&&"text"==a[b].zoom_level&&(a[b].ownerSVGElement&&a[b].ownerSVGElement.zoom>3.5?(a[b].setAttribute("display","inline"),a[b].setAttribute("opacity",1)):a[b].setAttribute("display","none")),a[b].zoom_level&&"summary"==a[b].zoom_level&&(a[b].ownerSVGElement&&a[b].ownerSVGElement.zoom<=3.5?(a[b].setAttribute("display","inline"),a[b].setAttribute("opacity",1)):a[b].setAttribute("display","none")))},a}var c=[],d=1,e="http://www.w3.org/2000/svg",f=null,g=!1,h=null,i=75,j=null,k=function(){null===f?f=[]:(f.forEach(function(a){a._last_step=null}),clearInterval(h)),g||(c.forEach(function(a){bean.fire(a,"_anim_begin")}),g=!0);var a=null;h=setInterval(function(){if(!f||0===f.length)return clearInterval(h),h=null,f=null,g=!1,void c.forEach(function(a){bean.fire(a,"_anim_end")});var b=[];c.forEach(function(a){b.push(a.suspendRedraw(5e3))});var d=(new Date).getTime();a||(a=(new Date).getTime());for(var e=0;e<(f||[]).length;e++){var l=(new Date).getTime(),m=parseInt((l-a)/i,10);null===j&&m-f[e]._last_step>2&&(j=Math.round(1.6*i)),f[e].apply(null,[m-(f[e]._last_step||m)]),f&&f[e]&&(f[e]._last_step=m)}var n=(new Date).getTime();c.forEach(function(a){a.unsuspendRedraw(b.shift())});var o=n-d;i>o&&null===j&&o>=1?(i=Math.round(1.5*(n-d)),k()):null!==j&&j!=i&&(i=j,k())},i)},l=/scale\((-?\d+\.?\d*)\)/,m=function(a){var b=this.getAttribute("transform").toString(),c=l.exec(b),d=parseFloat(this.getAttribute("height")||1),e=1;return null===c?(b+=" scale(1) ",c=1):c=parseFloat(c[1]),e=parseFloat(a)/d*c,b=b.replace(l,"scale("+e+")"),this.setAttribute("transform",b),this.setAttribute("height",a),e};return function(f){var g=f.RS||d;f.RS=g,f.font_order="Helvetica, Verdana, Arial, Sans-serif",c.push(f),f.makeEl=function(a,b){var c=f.ownerDocument.createElementNS(e,a);for(var d in b)b.hasOwnProperty(d)&&c.setAttribute(d,b[d]);return c},f.make_gradient=function(a,b,c,d,e){for(var f=this.makeEl("linearGradient",{id:a,x1:"0%",x2:b,y1:"0%",y2:c}),g=d.length;d.length>0;){var h=Math.round((g-d.length)/g*100),i=d.shift(),j=e.shift();f.appendChild(this.makeEl("stop",{offset:h+"%",style:"stop-color:"+i+";stop-opacity:"+j}))}return f},f.path=function(a){var b=document.createElementNS(e,"path");return b.setAttribute("d",a),b.setAttribute("stroke","#000000"),b.setAttribute("stroke-width","1"),this.appendChild(b),b},f.poly=function(a){var b=document.createElementNS(e,"polygon");return b.setAttribute("points",a),this.appendChild(b),b},f.circle=function(a,b,c){var d=document.createElementNS(e,"circle");return d.setAttribute("cx","string"==typeof a?a:a*g),d.setAttribute("cy","string"==typeof b?b:b*g),d.setAttribute("r","string"==typeof c?c:c*g),d.move=function(a){d.setAttribute("cx",a*g)},this.appendChild(d),d},f.group=function(){var a=document.createElementNS(e,"g");return this.appendChild(a),a.push=function(b){a.appendChild(b)},a},f.clipPath=function(){var a=document.createElementNS(e,"clipPath");return this.appendChild(a),a.push=function(b){a.appendChild(b)},a},f.line=function(a,b,c,d){var f=document.createElementNS(e,"line");return f.setAttribute("x1","string"==typeof a?a:a*g),f.setAttribute("y1","string"==typeof b?b:b*g),f.setAttribute("x2","string"==typeof c?c:c*g),f.setAttribute("y2","string"==typeof d?d:d*g),this.appendChild(f),f},f.rect=function(a,b,c,d,f){f||(f={});var h=document.createElementNS(e,"rect");return h.setAttribute("x","string"==typeof a?a:a*g),h.setAttribute("y","string"==typeof b?b:b*g),h.setAttribute("width","string"==typeof c?c:c*g),h.setAttribute("height","string"==typeof d?d:d*g),h.setAttribute("stroke","#000000"),this.appendChild(h),"undefined"!=typeof f.offset&&(h.offset=f.offset,h.setAttribute("transform","translate("+h.getAttribute("x")+","+h.getAttribute("y")+")"),h.setAttribute("x","0"),h.setAttribute("y",h.offset*g)),h.move=function(a,b){if("undefined"!=typeof this.offset&&this.getAttribute("transform")){var c=this.getAttribute("transform"),d=/translate\(.*[,\s](.*)\)/.exec(c);d[1]&&this.setAttribute("transform","translate("+a*g+","+d[1]+")"),this.setAttribute("width",b*g)}else this.setAttribute("x",a*g),this.setAttribute("width",b*g)},h},f.roundRect=function(a,b,c,d,e,f){var h=this.rect(a,b,c,d,f);return"object"==typeof e&&e.x||(e={x:e,y:e}),h.setAttribute("rx",e.x*g),h.setAttribute("ry",e.y*g),h},f.ellipticalRect=function(a,b,c,d){return this.roundRect(a,b,c,d,{x:.25*c,y:.5*d})},f.pentagon=function(a,b,c,d,e){return this.nagon(a,b,c,d,5,e)},f.hexagon=function(a,b,c,d,e){return this.nagon(a,b,c,d,6,e)};var h=function(a,b){this.constructor.prototype.setAttribute.call(this,a,b),"height"!=a&&"width"!=a&&"x"!=a&&"y"!=a||this.redraw(Math.floor(parseFloat(this.getAttribute("height"))))};f.nagon=function(b,c,d,e,f,i){var j=this.poly("");return j.setAttribute("x",b*g),j.setAttribute("y",c*g),j.setAttribute("width",d*g),j.redraw=function(a){a?this.last_height=a:a=this.last_height;for(var b=.5*Math.floor(parseFloat(j.getAttribute("width"))),c=.5*a,d=[],e=null,g=null,h=0;f>h;h++){var k=i/360*2*Math.PI+2/f*Math.PI*h,l=parseInt(b+b*Math.cos(k)),m=parseInt(c+c*Math.sin(k));d.push([l,m]),(null===e||e>l)&&(e=l),(null===g||l>g)&&(g=l)}var n=Math.floor(parseFloat(j.getAttribute("x"))),o=Math.floor(parseFloat(j.getAttribute("y")));d.map(function(d){return d[0]==e&&(d[0]=0),d[0]==g&&(d[0]=2*b),d[0]+=n,d[1]=o+.5*a*(d[1]/c),d.join(",")}),this.setAttribute("points",d.join(" "))},j.setHeight=j.redraw,j.move=function(b,c){var d=/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/.exec(this.getAttribute("transform"));if(null!==d){d=d[2];var e=this.getAttribute("transform").replace(/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/,"translate("+b*g+","+d+")");this.setAttribute("transform",e),a=.5*c*g}},j.setAttribute=h,j.redraw(e*g),j},f.use=function(a,b,c,d,f){var h=document.createElementNS(e,"use");return h.setAttribute("x","string"==typeof b?b:b*g),h.setAttribute("y","string"==typeof c?c:c*g),h.setAttribute("width","string"==typeof d?d:d*g),h.setAttribute("height","string"==typeof f?f:f*g),h.setAttributeNS("http://www.w3.org/1999/xlink","href",a),this.appendChild(h),h},f.a=function(a){var b=document.createElementNS(e,"a");return b.setAttribute("target","_new"),b.setAttributeNS("http://www.w3.org/1999/xlink","href",a),this.appendChild(b),b},f.button=function(a,b,c,d,f){var g=document.createElementNS(e,"foreignObject");g.setAttribute("x",a),g.setAttribute("y",b),g.setAttribute("width",a+c),g.setAttribute("height",b+d),g.style?g.style.position="absolute":g.setAttribute("style","position: absolute;"),this.appendChild(g);var h=document.createElement("button");return h.style.display="block",h.textContent=f,g.appendChild(h),h},f.svgbutton=function(a,b,c,d,e){var f=this.group(),g=this.rect(a,b,c,d);g.setAttribute("rx","10"),g.setAttribute("ry","10"),g.setAttribute("stroke","#ffffff"),g.setAttribute("stroke-width","2"),g.setAttribute("fill","url(#simple_gradient)"),a=g.x.baseVal.value,b=g.y.baseVal.value,c=g.width.baseVal.value,d=g.height.baseVal.value;var h=this.text(a+c/2,b+d/3,e);h.setAttribute("text-anchor","middle"),h.firstChild.setAttribute("dy","1.5ex"),h.setAttribute("font-size",.5*d),h.setAttribute("fill","#ffffff"),f.push(g),f.push(h),f.background_element=g,f.text_element=h,f.setAttribute("cursor","pointer");var i=function(){g.setAttribute("fill","#999999"),g.setAttribute("stroke","#000000")};f.addEventListener("mousedown",i,!1),f.addEventListener("touchstart",i,!1);var j=function(){g.setAttribute("stroke","#ffffff"),g.setAttribute("fill","url(#simple_gradient)")};return f.addEventListener("mouseup",j,!1),f.addEventListener("mouseout",j,!1),f.addEventListener("touchend",j,!1),f},f.callout=function(a,b,c,d){var f=this.group(),h=this.roundRect(-.5*(d.width+4),20,d.width+4,d.height+4,4);h.setAttribute("fill","#000000");var i=this.roundRect(-.5*(d.width+1),22,d.width+1,d.height,4);i.setAttribute("fill","#eeeeee"),f.push(h),f.push(i);var j=this.poly("0,500 500,1000 -500,1000");j.setAttribute("fill","#000000"),f.push(j);var k=document.createElementNS(e,"foreignObject");k.setAttribute("x",-.5*(d.width+1)*g),k.setAttribute("y",22*g),k.setAttribute("width",d.width*g),k.setAttribute("height",d.height*g),f.push(k);var l=document.createElementNS("http://www.w3.org/1999/xhtml","html");l.setAttribute("xmlns","http://www.w3.org/1999/xhtml");var n=document.createElementNS("http://www.w3.org/1999/xhtml","body");n.style.fontSize=(d["font-size"]||15)*g+"px",n.style.margin=5*g+"px",n.style.height=d.height*g*10+"px",l.appendChild(n),n.appendChild(c),k.appendChild(l);var o=d.height/15;if(f.setAttribute("transform","translate("+a*g+","+(b+20)*g+") scale("+o+")"),f.setHeight=m,!d.align){var p=parseFloat(this.getAttribute("viewBox").split(/\s+/)[2]);(a+10+.5*d.width)*g>p&&(d.align="right"),(a-.5*d.width)*g<0&&(d.align="left")}if(d.align){var q="right"==d.align?-.5:.5;h.setAttribute("transform","translate("+q*d.width*g+",0)"),i.setAttribute("transform","translate("+q*d.width*g+",0)"),j.setAttribute("transform","translate("+0*q*d.width*g+",0)"),j.setAttribute("points",q>0?"0,500 500,1000 0,1000":"0,500 0,1000 -500,1000"),k.setAttribute("transform","translate("+q*d.width*g+",0)")}return f.setAttribute("height",d.height*g),f},f.growingMarker=function(a,b,c,d){var f=document.createElementNS(e,"svg");d.stretch||Array.isArray&&Array.isArray(d.content)?f=this.group():(f.setAttribute("viewBox","-50 -100 200 250"),f.setAttribute("preserveAspectRatio","xMinYMin meet")),f.setAttribute("x",a),f.setAttribute("y",b);var h=this.marker(50/g,50/g,50/g,c,d);f.appendChild(h),f.contentElement=h.contentElement;var i=this.group(),j=this.group();return i.appendChild(j),j.appendChild(f),d.stretch||Array.isArray&&Array.isArray(d.content)||(f.setAttribute("width","200"),f.setAttribute("height","250")),d.angle&&(i.angle=d.angle),i.setAttribute("height","250"),i.setAttribute("transform","scale(1)"),i.setHeight=function(a){m.call(this,a);this.setAttribute("height",a);var b=this.offset||0;this.angle||(this.angle=0),this.firstChild.setAttribute("transform","translate(-100,"+b*g+") rotate("+this.angle+",100,0)")},i.container=f,i},f.marker=function(a,b,c,d,e){var h=0;if("string"==typeof a){var i=new RegExp(/(\d+)(.*)/g).exec(a);h=i[2],a=parseFloat(i[1]),i=new RegExp(/(\d+)(.*)/g).exec(b),b=parseFloat(i[1]),i=new RegExp(/(\d+)(.*)/g).exec(c),c=parseFloat(i[1])}var j={CX:a+h,CY:b+h,R:c+h,MIN_X:a-c+h,MAX_X:a+c+h,MIN_Y:b-c+h,MAX_Y:b+c+h,MID_X1:a-c/2+h,MID_X2:a+c/2+h,MID_Y1:b-c/2+h,MID_Y2:b+c/2+h},k=this.group();e||(e={});var l=e&&e.border?e.border:"rgb(0,0,0)";if(!e.bare_element){k.push(this.circle(0,-.5*c,c)),k.lastChild.setAttribute("fill",l),k.lastChild.setAttribute("border","true"),k.push(this.circle(0,1.5*c,c)),k.lastChild.setAttribute("fill",l),k.lastChild.setAttribute("border","true");var n=this.poly(-.9*c*g+","+0*c*g+" 0,"+-2.5*c*g+" "+.9*c*g+","+0*c*g);n.setAttribute("fill",l),n.setAttribute("stroke-width","0"),k.push(n),k.lastChild.setAttribute("border","true")}if(k.setAttribute("transform","translate("+a*g+","+.5*b*g+") scale(1)"),k.setHeight=m,k.setAttribute("height",j.R*g),"string"==typeof d)d.match(/^(:?https?:)?\/?.*#/)?(k.contentElement=this.use(d,-c,0,c,c),k.contentElement.setAttribute("content","true")):(k.contentElement=this.text_circle(0,0,2*c,d,e),k.contentElement.firstChild.setAttribute("content","true")),k.push(k.contentElement);else if(Array.isArray&&Array.isArray(d)){k.contentElement=this.group();var o=Math.PI/d.length,p=e.stretch;d.forEach(function(a,b){var h,i=1.2*c+c*d.length*Math.cos(b*o-0*Math.PI/2),j=c+c*(4*c/d.length)*d.length*Math.sin(b*o-0*Math.PI/2),l=180*b/d.length;if(l-=0,p&&(l>=-90&&90>=l?e.stretch="right":e.stretch="left",l%90==0&&90!=l&&-90!=l&&(0==l&&(e.stretch="right"),1==d.length&&(e.stretch=!0))),l>90&&270>l&&(l=180+l),a.match(/^(:?https?:)?\/?.*#/))h=f.use(a,(i-.5)*c,(j-.5)*c,c,c),h.setAttribute("pointer-events","none"),h.setAttribute("content","true");else{var m=JSON.parse(JSON.stringify(e));m.no_tracer=!0,delete m.offset,delete m.height,h=f.text_circle(i*c,j*c,1.75*c,a,m),h.firstChild.setAttribute("content","true")}var n=h.getAttribute("transform");n=n+" rotate("+l+","+0*c*g+","+j*c*g+")",h.setAttribute("transform",n),k.contentElement.push(h)}),k.push(k.contentElement)}else k.contentElement=this.group(),e.bare_element||(k.contentElement.push(this.text_circle(0,.5*c,1.75*c,"",e)),k.contentElement.lastChild.firstChild.setAttribute("content","true")),d&&(e.bare_element||d.setAttribute("transform","translate(0,"+.5*c*g+")"),d.setAttribute("content","true"),k.contentElement.push(d)),k.push(k.contentElement);return k.setAttribute("marker","true"),k},f.text_circle=function(a,b,c,d,e){e||(e={});var f=0;if("string"==typeof a){var h=new RegExp(/(\d+)(.*)/g).exec(a);f=h[2],a=parseFloat(h[1]),h=new RegExp(/(\d+)(.*)/g).exec(b),b=parseFloat(h[1]),h=new RegExp(/(\d+)(.*)/g).exec(c),c=parseFloat(h[1])}var i={CX:a+f,CY:b+f,R:c+f,MIN_X:a-c+f,MAX_X:a+c+f,MIN_Y:b-c+f,MAX_Y:b+c+f,MID_X1:a-c/2+f,MID_X2:a+c/2+f,MID_Y1:b-c/2+f,MID_Y2:b+c/2+f},j=this.group(),k=this.text(0,i.CY,d);k.setAttribute("font-size",10*g),k.setAttribute("font-weight",e.weight||"bolder"),k.setAttribute("fill",e.text_fill||"#ffffff"),k.setAttribute("style","font-family: sans-serif; text-anchor: middle;"),k.firstChild.setAttribute("dy","0.35em"),k.setAttribute("text-anchor","middle");var l;if(e.stretch){var n=1.2*(e.font_size||c)*k.getBBox().width/(10*g),o=1.5*i.R,p=-.5*n;n>3*i.R?(p=-.5*n,"right"==e.stretch&&(p=-.1*n),"left"==e.stretch&&(p=-.9*n)):(n=3*i.R,p=-.5*n),k.setAttribute("x",(.5*n+p)*g),l=this.roundRect(p,i.CY-.5*o,n,o,{x:.5*i.R,y:.5*o},{})}else l=this.circle(0,i.CY,.9*i.R);return k.setAttribute("font-size",(e.font_size||c)*g),l.setAttribute("fill",e.fill||"url(#simple_gradient)"),window.matchMedia("print").addListener(function(a){l.setAttribute("fill",a.matches?"#aaaaaa":e.fill||"url(#simple_gradient)")}),l.setAttribute("stroke",e.border||"#000000"),l.setAttribute("stroke-width",c/10*g),j.push(l),j.push(k),j.setAttribute("transform","translate("+i.CX*g+", 1) scale(1)"),j.setAttribute("height",i.R/2*g),j.setHeight=m,j},f.crossed_circle=function(a,b,c){var d=0;if("string"==typeof a){var e=new RegExp(/(\d+)(.*)/g).exec(a);d=e[2],a=parseFloat(e[1]),e=new RegExp(/(\d+)(.*)/g).exec(b),b=parseFloat(e[1]),e=new RegExp(/(\d+)(.*)/g).exec(c),c=parseFloat(e[1])}var f={CX:a+d,CY:b+d,R:c+d,MIN_X:a-c+d,MAX_X:a+c+d,MIN_Y:b-c+d,MAX_Y:b+c+d,MID_X1:a-c/2+d,MID_X2:a+c/2+d,MID_Y1:b-c/2+d,MID_Y2:b+c/2+d},g=this.group(),h=this.circle(f.CX,f.CY,f.R);h.setAttribute("fill","#000000"),h.setAttribute("stroke","#ffffff"),h.setAttribute("stroke-width","2"),g._button=h,g.push(h);var i=this.line(f.MID_X1,f.MID_Y1,f.MID_X2,f.MID_Y2);i.setAttribute("stroke","#ffffff"),i.setAttribute("stroke-width","2"),g.push(i);var j=i,i=this.line(f.MID_X1,f.MID_Y2,f.MID_X2,f.MID_Y1);return i.setAttribute("stroke","#ffffff"),i.setAttribute("stroke-width","2"),g.push(i),g.move=function(a,b){h.setAttribute("cx",a),f.MID_X1=a-c/2,f.MID_X2=a+c/2,f.MID_Y1=b-c/2,f.MID_Y2=b+c/2,j.setAttribute("x1",f.MID_X1),j.setAttribute("y1",f.MID_Y1),j.setAttribute("x2",f.MID_X2),j.setAttribute("y2",f.MID_Y2),i.setAttribute("x1",f.MID_X1),i.setAttribute("y1",f.MID_Y2),i.setAttribute("x2",f.MID_X2),i.setAttribute("y2",f.MID_Y1)},g},f.text=function(a,b,c){var d=document.createElementNS(e,"text"),f=document.createElementNS(e,"tspan");return"string"!=typeof c?d.appendChild(c):(d.appendChild(f),f.textContent=c,f.setAttribute("dy","0")),d.style.fontFamily=this.font_order||"Helvetica, Verdana, Arial, Sans-serif",d.setAttribute("x","string"==typeof a?a:a*g),d.setAttribute("y","string"==typeof b?b:b*g),d.move=function(a,b){if("undefined"!=typeof this.offset&&this.getAttribute("transform")){var c=this.getAttribute("transform"),d=/translate\(.*[,\s](.*)\)/.exec(c);d[1]&&this.setAttribute("transform","translate("+a*g+","+d[1]+")")}else this.setAttribute("x",a*g)},this.appendChild(d),d},f.plus=function(a,b,c){var d=this.group();return d.appendChild(this.makeEl("rect",{x:Math.round(.4*c*g).toString(),y:Math.round(.1*c*g).toString(),"stroke-width":"1",width:Math.round(.2*c*g).toString(),height:Math.round(.8*c*g).toString(),stroke:"#ffffff",fill:"#ffffff"})),d.appendChild(this.makeEl("rect",{x:Math.round(.1*c*g).toString(),y:Math.round(.4*c*g).toString(),"stroke-width":"1",width:Math.round(.8*c*g).toString(),height:Math.round(.2*c*g).toString(),stroke:"#ffffff",fill:"#ffffff"})),d.setAttribute("transform","translate("+a*g+","+b*g+")"),d},f.minus=function(a,b,c){var d=this.group();return d.appendChild(this.makeEl("rect",{x:Math.round(.1*c*g).toString(),y:Math.round(.4*c*g).toString(),"stroke-width":"1",width:Math.round(.8*c*g).toString(),height:Math.round(.2*c*g).toString(),stroke:"#ffffff",fill:"#ffffff"})),d.setAttribute("transform","translate("+a*g+","+b*g+")"),d},f.transformedBoundingBox=function(a){var b=a.getBBox(),c=a.ownerSVGElement,d=a.parentNode.getScreenCTM().inverse().multiply(a.getScreenCTM()).inverse(),e=[c.createSVGPoint(),c.createSVGPoint(),c.createSVGPoint(),c.createSVGPoint()];e[0].x=b.x,e[0].y=b.y,e[1].x=b.x+b.width,e[1].y=b.y,e[2].x=b.x+b.width,e[2].y=b.y+b.height,e[3].x=b.x,e[3].y=b.y+b.height;var f=1/0,g=-(1/0),h=1/0,i=-(1/0);e.forEach(function(a){a=a.matrixTransform(d),f=Math.min(f,a.x),g=Math.max(g,a.x),h=Math.min(h,a.y),i=Math.max(i,a.y)});try{b.x=f,b.width=g-f,b.y=h,b.height=i-h}catch(j){b={x:f,y:h,width:g-f,height:i-h}}return b},f.set=function(){var a=[];return b(a,g),a},f.hide=function(){this.setAttribute("display","none")},f.show=function(){this.setAttribute("display","inline")}}}();MASCP.svgns="http://www.w3.org/2000/svg",MASCP.CondensedSequenceRenderer=function(a){this._RS=50,MASCP.SequenceRenderer.apply(this,arguments);var b=this;MASCP.CondensedSequenceRenderer.Zoom(b);var c,d=function(){a.cached_width=a.getBoundingClientRect().width};return window.addEventListener("resize",function(){clearTimeout(c),window.requestAnimationFrame?window.requestAnimationFrame(d):c=setTimeout(d,100)},!0),a.cached_width=a.getBoundingClientRect().width,bean.remove(this,"sequenceChange"),bean.add(this,"sequenceChange",function(){for(var a in MASCP.layers)MASCP.layers.hasOwnProperty(a)&&(MASCP.layers[a].disabled=!0);b.zoom=b.zoom}),this},MASCP.CondensedSequenceRenderer.prototype=new MASCP.SequenceRenderer,function(){var a=document.getElementsByTagName("script"),b=a[a.length-1].src;b=b.replace(/[^\/]+$/,""),MASCP.CondensedSequenceRenderer._BASE_PATH=b}(),function(a){var b=function(){var a=this;this._object&&("undefined"!=typeof svgweb?svgweb.removeChild(this._object,this._object.parentNode):this._object.parentNode.removeChild(this._object),this._canvas=null,this._object=null);var b;if(document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")){var c=this.win().document.createElementNS(MASCP.svgns,"svg");c.setAttribute("width","100%"),c.setAttribute("height","100%"),this._container.appendChild(c),this._canvas=c,b={addEventListener:function(a,b){c.contentDocument={rootElement:c},b.call(c)}}}return b.addEventListener("load",function(){var b=this;SVGCanvas(b),a.font_order&&(b.font_order=a.font_order);var c=b.makeEl("g"),e=b.makeEl("svg");e.RS=a._RS,SVGCanvas(e),a.font_order&&(e.font_order=a.font_order),c.appendChild(e),b.appendChild(c);var f=!0;try{e.addEventListener}catch(g){f=!1}var h=(e.makeEl("rect",{x:"-10%",y:"-10%",width:"120%",height:"120%",style:"fill: #ffffff;"}),b.makeEl("rect",{x:"0",y:"0",width:"50",height:"100%",style:"fill: url(#left_fade);"})),i=b.makeEl("rect",{x:"100%",y:"0",width:"25",height:"100%",transform:"translate(-15,0)",style:"fill: url(#right_fade);"});b.appendChild(h),b.appendChild(i),bean.add(e,"pan",function(){e.currentTranslate.x>=0?h.setAttribute("visibility","hidden"):h.setAttribute("visibility","visible"),a.rightVisibleResidue()<a.sequence.length?i.setAttribute("visibility","visible"):i.setAttribute("visibility","hidden")}),bean.add(e,"_anim_begin",function(){h.setAttribute("visibility","hidden"),i.setAttribute("visibility","hidden")}),bean.add(e,"_anim_end",function(){bean.fire(e,"pan")}),e.currentTranslate.x>=0&&h.setAttribute("visibility","hidden"),i.setAttribute("visibility","hidden");var j=b.makeEl("g");b.appendChild(j);var k=b.makeEl("svg");j.appendChild(k),e.setCurrentTranslateXY=function(a,b){var d=(c.getAttribute("transform")||"").replace(/translate\([^\)]+\)/,"");d=d+" translate("+a+", "+b+") ",c.setAttribute("transform",d),this.currentTranslate.x=a,this.currentTranslate.y=b},e.setCurrentTranslateXY(0,0),k.setCurrentTranslateXY=function(a,b){var c=(j.getAttribute("transform")||"").replace(/translate\([^\)]+\)/,"");c=c+" translate("+a+", "+b+") ",j.setAttribute("transform",c),this.currentTranslate.x=a,this.currentTranslate.y=b},k.setCurrentTranslateXY(0,0),d.call(a,k);var l=a.navigation,m=l.show,n=l.hide;l.show=function(){m.apply(l,arguments),e.style.GomapScrollLeftMargin=100*a._RS/a.zoom},l.hide=function(){n.apply(l,arguments),e.style.GomapScrollLeftMargin=1e3},a._container_canvas=b,b.setAttribute("preserveAspectRatio","xMinYMin meet"),b.setAttribute("width","100%"),b.setAttribute("height","100%"),e.appendChild(e.makeEl("rect",{x:0,y:0,opacity:0,width:"100%",height:"100%","stroke-width":"0",fill:"#ffffff"})),a._object=this,a._canvas=e,a._canvas._canvas_height=0,bean.fire(a,"svgready")},!1),b},c=function(a){return a.stopPropagation(),!0},d=function(a){this.navigation=new MASCP.CondensedSequenceRenderer.Navigation(a,this);var b=this.navigation,d=function(){b.demote()},e=function(){b.promote(),b.refresh()};MASCP.IE||(bean.add(this._canvas,"panstart",d),bean.add(this._canvas,"panend",e),bean.add(this._canvas,"_anim_begin",d),bean.add(this._canvas,"_anim_end",e),a.addEventListener("DOMMouseScroll",c,!1),a.addEventListener("wheel",c,!1),a.onmousewheel=c)},e=function(){var a=this,b=a.addTextTrack(this.sequence,this._canvas.set());b.attr({y:.5*a._axis_height*a._RS}),a.select=function(){var a=Array.prototype.slice.call(arguments);a[0],a[1];this.moveHighlight.apply(this,a)};var c=function(){b.attr({y:.5*a._axis_height*a._RS})},d=a._canvas;return bean.add(d,"zoomChange",c),bean.add(b,"removed",function(){bean.remove(d,"zoomChange",c)}),b},f=mainDrawAxis=function(a,b){var c=this._RS,d=this,e=0,f=0,g=a.set(),h=a.rect(0,0,b,1.5);h.setAttribute("fill","url('#"+d.axis_pattern_id+"')"),h.removeAttribute("stroke"),h.removeAttribute("stroke-width"),h.setAttribute("id","axis_back");var i=30,j=a.set(),k=a.set(),l=a.set(),m=a.set(),n=10,o=20;for(this.sequence.length>5e3&&(n=100,o=200),this.sequence.length>1e3&&(n=20,o=40),f=0;b/5>f;f++){var p=a.text(e,0,""+e);j.push(p),e%o===0&&0!==e?k.push(p):e%n===0&&0!==e&&l.push(p),e%(250*parseInt(this.sequence.length/500))===0&&0!==e&&m.push(p),e+=5}for(f=0;f<j.length;f++)j[f].style.textAnchor="middle",j[f].firstChild.setAttribute("dy","1.5ex");j.attr({"pointer-events":"none","text-anchor":"middle","font-size":7*c+"pt"}),j.hide(),d._axis_height=parseInt(i/d.zoom);var q=function(){var a=d;a._axis_height=parseInt(i/a.zoom);var b=a._canvas.ownerSVGElement.getElementById(a.axis_pattern_id);if(m.forEach(function(a){a.setAttribute("visibility","hidden")}),this.zoom>3.6){h.setAttribute("transform","translate(-5,"+.3*a._axis_height*c+")"),h.setAttribute("height",.25*a._axis_height*c),b.setAttribute("width",10*c),b.firstChild.setAttribute("width",c/a.zoom),l.show(),k.show();var e=.15*d._axis_height;1>e&&(e=1),l.attr({"font-size":e*c+"pt","text-anchor":"end"}),k.attr({"font-size":e*c+"pt","text-anchor":"end"}),this._visibleTracers&&this._visibleTracers()&&this._visibleTracers().show()}else if(this.zoom>1.8)l.hide(),k.show(),k.attr({"font-size":.5*c*d._axis_height+"pt","text-anchor":"middle"}),h.setAttribute("transform","translate(-25,"+.5*a._axis_height*c+")"),h.setAttribute("height",.3*a._axis_height*c),b.setAttribute("width",20*c),b.firstChild.setAttribute("width",c/a.zoom),this.tracers&&this.tracers.hide();else if(this.zoom>.2){this.tracers&&this.tracers.hide(),l.hide(),k.show(),k.attr({"font-size":.5*c*d._axis_height+"pt","text-anchor":"middle"}),h.setAttribute("transform","translate(-25,"+.5*a._axis_height*c+")"),h.setAttribute("height",.3*a._axis_height*c),b.setAttribute("width",50*c),b.firstChild.setAttribute("width",c/a.zoom);var f=-1e4,g=!1;k.forEach(function(a){a.cached_bbox||(a.cached_bbox=a.getBBox()),a.cached_bbox.x<=f+10*c||parseInt(a.textContent)%50!=0?(a.setAttribute("visibility","hidden"),g=!0):(a.setAttribute("visibility","visible"),f=a.cached_bbox.x+a.cached_bbox.width)}),g&&k[0].setAttribute("visibility","hidden")}else{this.tracers&&this.tracers.hide(),l.hide(),k.hide(),m.show(),m.attr({"font-size":.5*c*d._axis_height+"pt","text-anchor":"middle"}),h.setAttribute("transform","translate(-50,"+.85*a._axis_height*c+")"),h.setAttribute("height",.1*a._axis_height*c),b.setAttribute("width",250*c),b.firstChild.setAttribute("width",c/a.zoom);var f=-1e4,g=!1;m.forEach(function(a){a.cached_bbox||(a.cached_bbox=a.getBBox()),a.cached_bbox.x<=f+10*c||parseInt(a.textContent)%250!=0?a.setAttribute("visibility","hidden"):(a.setAttribute("visibility","visible"),f=a.cached_bbox.x+a.cached_bbox.width)}),g&&m[0].setAttribute("visibility","hidden")}};return bean.add(a,"zoomChange",q),bean.add(g,"removed",function(){bean.remove(a,"zoomChange",q);var b=function(a){a.parentNode&&a.parentNode.removeChild(a)};h.parentNode.removeChild(h),j.forEach(b)}),g};a.prototype.panTo=function(a,b){var c=this,d=c.leftVisibleResidue(),e=1;return d==a?void(b&&b.call(null)):(d>a&&(e=-1),void requestAnimationFrame(function(){c.setLeftVisibleResidue(d),d+=e,bean.fire(c._canvas,"panend"),d!==a?requestAnimationFrame(arguments.callee):b&&b.call(null)}))},a.prototype.zoomTo=function(a,b,c){var d=this,e=d.zoom,f=(a-e)/50;return bean.add(d,"zoomChange",function(){bean.remove(d,"zoomChange",arguments.callee),delete d.zoomCenter,c&&c.call(null)}),b?(d.zoomCenter="center"==b?b:{x:d._RS*b},void requestAnimationFrame(function(){d.zoom=e,e+=f,Math.abs(e-a)>.01&&requestAnimationFrame(arguments.callee)})):void(d.zoom=a)},a.prototype.setLeftVisibleResidue=function(a){var b=this;b._canvas.setCurrentTranslateXY(b._canvas.width.baseVal.value*(1-a/(b.sequence.length+b.padding+2))-b._canvas.width.baseVal.value,0)},a.prototype.leftVisibleResidue=function(){var a=this,b=Math.floor((a.sequence.length+a.padding+2)*(1-(a._canvas.width.baseVal.value+a._canvas.currentTranslate.x)/a._canvas.width.baseVal.value))-1;return 0>b&&(b=0),b},a.prototype.rightVisibleResidue=function(){var a=this,b=a._container_canvas.parentNode.cached_width;b||(b=a._container_canvas.parentNode.getBoundingClientRect().width);var c=Math.floor(a.leftVisibleResidue()+(a.sequence.length+a.padding+2)*(b/a._canvas.width.baseVal.value));return c>a.sequence.length&&(c=a.sequence.length),c},a.prototype.addAxisScale=function(a,b){return this._scalers||(this._scalers=[]),this._scalers.push(b),b.identifier=a,b},a.prototype.refreshScale=function(){var a=this,b=Object.keys(this._layer_containers);b.forEach(function(b){a._layer_containers[b].forEach(function(c){if(c.move&&c.aa){var d=a.scalePosition(c.aa,b?b:c.acc),e=a.scalePosition(c.aa+c.aa_width,b?b:c.acc);0>d&&(d*=-1),0>e&&(e*=-1),c.move(d-1,e-d)}})})},a.prototype.scalePosition=function(a,b,c){var d=MASCP.getLayer(b),e=(c?(this._scalers||[]).concat([]).reverse():this._scalers||[]).reduce(function(a,e){return e(a,d||{name:b},c)},a);return e},a.prototype.getAA=function(a,b,c){return this.getAminoAcidsByPosition([a],b,c).shift()},a.prototype.getAminoAcidsByPosition=function(a,b,c){for(var d=this,e=a.map(function(a){return Math.abs(d.scalePosition(a,b?b:c))}),f=MASCP.SequenceRenderer.prototype.getAminoAcidsByPosition.call(this,e),g=0;g<e.length;g++)f[g]&&(f[g].original_index=a[g],f[g].accession=b?b:c);return f},a.prototype.getAminoAcidsByPeptide=function(a,b,c){var d,e=this,f=[],g=c?c:b;d=e.sequences?e.sequences[e.sequences.map(function(a){return(a.agi||a.acc||"").toLowerCase()}).indexOf(g.toLowerCase())].toString():e.sequence;for(var h=d.indexOf(a),i=0;i<a.length;i++)f.push(h+i);var j=e.getAminoAcidsByPosition(f,b,c);return j.length?j.addToLayer=function(a,b,c){return j[0].addBoxOverlay(a,j.length,b,c)}:j.addToLayer=function(){},j},a.prototype.win=function(){if(this._container&&this._container.ownerDocument&&this._container.ownerDocument.defaultView){var a=this._container.ownerDocument.defaultView;return"object"==typeof a&&a.constructor!==Window&&(a=a[Object.keys(a)[0]]),a}return null},a.prototype.setSequence=function(a){var c=this._cleanSequence(a);if(c==this.sequence&&null!==c)return void bean.fire(this,"sequenceChange");if(c){this.sequence=c,delete this.sequences;var d=this.sequence.split(""),g=d.length;if(0!==g){var h=this,i=function(){var a=[];h.sequence.split("").forEach(function(b,c){var d={};d._index=c,d._renderer=h,h._extendElement(d),d.amino_acid=b,a.push(d)}),h._sequence_els=a};i();var j=this._RS;bean.remove(this,"svgready"),bean.add(this,"svgready",function(a){var b=h._canvas;b.RS=j,b.setAttribute("background","#000000"),b.setAttribute("preserveAspectRatio","xMinYMin meet");var c=b.makeEl("defs");h._container_canvas.appendChild(c),c.appendChild(b.make_gradient("track_shine","0%","100%",["#111111","#aaaaaa","#111111"],[.5,.5,.5])),c.appendChild(b.make_gradient("simple_gradient","0%","100%",["#aaaaaa","#888888"],[1,1])),c.appendChild(b.make_gradient("left_fade","100%","0%",["#ffffff","#ffffff"],[1,0])),c.appendChild(b.make_gradient("right_fade","100%","0%",["#ffffff","#ffffff"],[0,1])),c.appendChild(b.make_gradient("red_3d","0%","100%",["#CF0000","#540000"],[1,1])),h.gradients=[],h.add3dGradient=function(a){c.appendChild(b.make_gradient("grad_"+a,"0%","100%",[a,"#ffffff",a],[1,1,1])),h.gradients.push(a)};var d=b.makeEl("filter",{id:"drop_shadow",filterUnits:"objectBoundingBox",x:"-50%",y:"-50%",width:"200%",height:"200%"});d.appendChild(b.makeEl("feGaussianBlur",{"in":"SourceGraphic",stdDeviation:"4",result:"blur_out"})),d.appendChild(b.makeEl("feOffset",{"in":"blur_out",result:"the_shadow",dx:"3",dy:"1"})),d.appendChild(b.makeEl("feBlend",{
"in":"SourceGraphic",in2:"the_shadow",mode:"normal"})),c.appendChild(d);var k=b.makeEl("svg",{width:"100%",height:"100%",id:"new_link_icon",viewBox:"0 0 100 100",preserveAspectRatio:"xMinYMin meet"});c.appendChild(k),k.appendChild(b.makeEl("rect",{x:"12.5",y:"37.5","stroke-width":"3",width:"50",height:"50",stroke:"#ffffff",fill:"none"})),k.appendChild(b.makeEl("path",{d:"M 50.0,16.7 L 83.3,16.7 L 83.3,50.0 L 79.2,56.2 L 68.8,39.6 L 43.8,66.7 L 33.3,56.2 L 60.4,31.2 L 43.8,20.8 L 50.0,16.7 z","stroke-width":"3",stroke:"#999999",fill:"#ffffff"}));var l=b.makeEl("svg",{width:"100%",height:"100%",id:"plus_icon",viewBox:"0 0 100 100",preserveAspectRatio:"xMinYMin meet"});l.appendChild(b.plus(0,0,100/b.RS)),c.appendChild(l);var m=b.makeEl("svg",{width:"100%",height:"100%",id:"minus_icon",viewBox:"0 0 100 100",preserveAspectRatio:"xMinYMin meet"});m.appendChild(b.minus(0,0,100/b.RS)),c.appendChild(m);var n="axis_pattern_"+(new Date).getTime(),o=b.makeEl("pattern",{patternUnits:"userSpaceOnUse",x:"0",y:"0",width:10*b.RS,height:2*b.RS,id:n});h.axis_pattern_id=n;var p=b.makeEl("rect",{x:"0",y:"0",width:"10%",height:"1000%",fill:"#000",stroke:"0"});o.appendChild(p),c.appendChild(o);var q=this;h._axis_height=10;var r=e.call(q,b);h.hideAxis=function(){f=function(a){return bean.add(a,"zoomChange",function(){q._axis_height=10/q.zoom}),{}},q._axis_height=10/q.zoom,this.redrawAxis()},h.showAxis=function(){f=mainDrawAxis,this.redrawAxis()};var s=f.call(q,b,g);h.redrawAxis=function(){bean.fire(s,"removed"),r.forEach(function(a){a.parentNode&&a.parentNode.removeChild(a)}),bean.fire(r,"removed"),s=f.call(q,b,h.sequence.length),r=e.call(q,b),i(),h.refresh()},h.hide_axis?this.hideAxis():this.showAxis(),h._layer_containers={},h.enablePrintResizing(),h.enableScaling(),h.enableSelection(),bean.add(MASCP,"layerRegistered",function(a,b){b&&b!==h||h.addTrack(a)}),bean.fire(h,"sequenceChange")});var k=b.call(this);this._canvas||("undefined"!=typeof svgweb?svgweb.appendChild(k,this._container):this._container.appendChild(k));var l=this;this.EnableHighlights();var m=function(a){l._canvas?a.apply():bean.add(l,"sequenceChange",function(){bean.remove(l,"sequenceChange",arguments.callee),a.apply()})};return m.ready=function(a){this.call(this,a)},m}}}}(MASCP.CondensedSequenceRenderer),function(){var a="http://www.w3.org/2000/svg",b=function(b){b.ELEMENT_NODE||(b.ELEMENT_NODE=1,b.ATTRIBUTE_NODE=2,b.TEXT_NODE=3,b.CDATA_SECTION_NODE=4,b.ENTITY_REFERENCE_NODE=5,b.ENTITY_NODE=6,b.PROCESSING_INSTRUCTION_NODE=7,b.COMMENT_NODE=8,b.DOCUMENT_NODE=9,b.DOCUMENT_TYPE_NODE=10,b.DOCUMENT_FRAGMENT_NODE=11,b.NOTATION_NODE=12),b._importNode=function(c,d){switch(c.nodeType){case b.ELEMENT_NODE:var e=b.createElementNS(a,c.nodeName);if(c.attributes&&c.attributes.length>0)for(var f=0,g=c.attributes.length;g>f;)/^on/.test(c.attributes[f].nodeName)||e.setAttribute(c.attributes[f].nodeName,c.getAttribute(c.attributes[f++].nodeName));if(d&&c.childNodes&&c.childNodes.length>0)for(var f=0,g=c.childNodes.length;g>f;)"USE"!==c.childNodes[f].nodeName&&"SCRIPT"!==c.childNodes[f].nodeName&&e.appendChild(b._importNode(c.childNodes[f++],d));return e;case b.TEXT_NODE:case b.CDATA_SECTION_NODE:case b.COMMENT_NODE:return b.createTextNode(c.nodeValue)}}};MASCP.CondensedSequenceRenderer.prototype.importIcons=function(a,c){var d=this._container_canvas.ownerDocument;if(!this._container_canvas.getElementById("defs_"+a)){this._container_canvas.appendChild(d.createElement("defs")),this._container_canvas.lastChild.setAttribute("id","defs_"+a);var e=this._container_canvas.lastChild;d._importNode||b(d);var f=d._importNode(c,!0);if("undefined"!=typeof XPathResult){for(var g=d.evaluate("//svg:defs/*",f,function(a){return MASCP.svgns},XPathResult.ANY_TYPE,null),h=g.iterateNext(),i=[];h;)i.push(h),h=g.iterateNext();i.forEach(function(b){b.setAttribute("id",a+"_"+b.getAttribute("id")),e.appendChild(b)})}else for(var j=f.querySelectorAll("defs > *"),k=0;k<j.length;k++)j[k].setAttribute("id",a+"_"+j[k].getAttribute("id")),e.appendChild(j[k])}}}(),MASCP.CondensedSequenceRenderer.prototype.addValuesToLayer=function(a,b,c){var d=this._RS,e=this._canvas;if(!e){var f=arguments.callee,g=this;return bean.add(this._renderer,"sequencechange",function(){bean.remove(this._renderer,"sequencechange",arguments.callee),f.call(g,a,b)}),void log("Delaying rendering, waiting for sequence change")}var h,i,j=1;c=c||{},c.height&&(j=c.height/this._layer_containers[a].track_height);var k=0;c.offset&&(k=c.offset/this._layer_containers[a].track_height);var l=function(a){var c=" m"+-.5*d+" 0",e=null;return b.forEach(function(b){"undefined"==typeof e||(c+=" l"+d+" "+-1*d*a*j*(b-e)),e=b,(isNaN(h)||b>h)&&(h=b),(isNaN(i)||i>b)&&(i=b)}),c},m=this._canvas.path("M0 0 M0 0 m0 "+(h||0)*d+" "+l(1)),n=i,o=h;if(m.setAttribute("stroke",c.color||"#ff0000"),m.setAttribute("stroke-width",(c.thickness||.35)*d),m.setAttribute("fill","none"),m.setAttribute("visibility","hidden"),m.setAttribute("pointer-events","none"),this._layer_containers[a].push(m),m.setAttribute("transform","translate(1,10) scale(1,1)"),!c.hide_axis){var p=this._canvas.path("M0 0 m0 "+d*((h||0)-(i||0))+" l"+this._sequence_els.length*d+" 0");p.setAttribute("stroke-width",.2*d),p.setAttribute("visibility","hidden"),p.setAttribute("transform","translate(1,0)"),p.setAttribute("pointer-events","none"),p.setHeight=function(a){0>n&&o>0?p.setAttribute("d","M0 0 M0 0 m0 "+a*k+" m0 "+.5*a*j+" l"+q._sequence_els.length*d+" 0"):p.setAttribute("d","M0 0 M0 0 m0 "+a*k+" m0 "+.5*(1-n)*a*j+" l"+q._sequence_els.length*d+" 0"),p.setAttribute("stroke-width",.2*d/q.zoom)},this._layer_containers[a].push(p)}var q=this;if(c.label){var r=this._canvas.text(0,0,c.label.max||c.label.min);r.setAttribute("transform","translate(0,0)"),r.setAttribute("font-size",4*d+"pt"),r.setHeight=function(a){r.setAttribute("y",a*k),r.setAttribute("font-size",4*d/q.zoom+"pt")},this._layer_containers[a].push(r)}return m.setHeight=function(a){var b=l(.5*a/d);m.setAttribute("d","M0 0 M0 0 m0 "+a*k+" m0 "+.5*a*j+" "+b),m.setAttribute("stroke-width",(c.thickness||.35)*d/q.zoom)},m},function(){var a=function(a,b){var c=this._renderer._canvas;if(!c){var d=arguments.callee,e=this;return bean.add(this._renderer,"sequencechange",function(){bean.remove(this._renderer,"sequencechange",arguments.callee),d.call(e,a)}),void log("Delaying rendering, waiting for sequence change")}var f=null,g=null,h=this._renderer;b||(b={});var i=1;b.height&&(b.height=parseFloat(b.height),"undefined"!=typeof b.height&&b.bare_element&&(b.height*=2),i=b.height/this._renderer._layer_containers[a].track_height,"undefined"!=typeof b.offset&&(b.offset=-2.5+b.offset/b.height*5));var g=c.growingMarker(0,0,b.content||a.charAt(0).toUpperCase(),b);if(g.setAttribute("transform","translate("+(this._index+.5)*this._renderer._RS+",0.01) scale("+i+")"),g.setAttribute("height","250"),g.firstChild.setAttribute("transform","translate(-100,0) rotate(0,100,0.001)"),b.break_viewbox&&(g.container.removeAttribute("viewBox"),g.container.setAttribute("width","100%"),g.container.setAttribute("height","100%")),!b.no_tracer){var j=c.circle(this._index+.5,10,.25);j.setAttribute("visibility","hidden"),j.style.opacity="0.4",f=c.rect(this._index+.5,10,.05,0),f._index=this._index,f.style.strokeWidth="0",f.style.fill=MASCP.layers[a].color,f.setAttribute("visibility","hidden"),c.insertBefore(f,c.firstChild.nextSibling);var h=this._renderer;this._renderer._layer_containers[a].tracers||(this._renderer._layer_containers[a].tracers=c.set()),c.tracers||(c.tracers=c.set(),c._visibleTracers=function(){return h._visibleTracers()}),f.setHeight=function(a){if("hidden"!=f.getAttribute("visibility")){var b=g.getAttribute("transform"),c=/translate\(.*[,\s](.*)\) scale\((.*)\)/.exec(b);if(c[1]&&c[2]){var d=parseFloat(c[2]),e=parseFloat(c[1]),h=e+d*(50*(g.offset||0)+125)-parseInt(this.getAttribute("y"));this.setAttribute("height",0>h?0:h)}else this.setAttribute("height",a)}},this._renderer._layer_containers[a].tracers.push(f),this._renderer._layer_containers[a].tracers.push(j),f.setAttribute("pointer-events","none"),j.setAttribute("pointer-events","none"),c.tracers.push(f)}"undefined"==typeof b.offset||null===b.offset||(g.offset=b.offset),g.setAttribute("visibility","hidden"),this._renderer._layer_containers[a].push(g);var k=[f,g,j];return g.setAttribute("class",a),k.move=function(a,b){var c=g.getAttribute("transform"),d=/translate\(.*[,\s](.*)\) scale\((.*)\)/.exec(c);d[1]&&d[2]&&g.setAttribute("transform","translate("+(a+.5)*h._RS+","+d[1]+") scale("+d[2]+")"),f&&(f.move(a+.5,.05),j.move(a+.5))},f&&(g.tracer=f,g.bobble=j),this._renderer._layer_containers[a].push(k),k},b=function(a,b,c,d){var e=this._renderer._canvas,f=this._renderer;if(d||(d={}),!e){var g=arguments.callee,h=this;return bean.add(this._renderer,"sequencechange",function(){bean.remove(this._renderer,"sequencechange",arguments.callee),g.call(h,a,b,d)}),void log("Delaying rendering, waiting for sequence change")}var i=e.rect(-.25+this._index,60,b||1,d.height||4,d),j=parseFloat(i.getAttribute("x")),k=j+parseFloat(i.getAttribute("width")),l=this._renderer._layer_containers[a];if("undefined"!=typeof d.merge&&d.merge)for(var m=0;m<l.length;m++)if(l[m].value==c){var n=parseFloat(l[m].getAttribute("x")),o=n+parseFloat(l[m].getAttribute("width"));if(j>=n&&o>=j||n>=j&&k>=n)return l[m].setAttribute("x",""+Math.min(n,j)),l[m].setAttribute("width",""+(Math.max(o,k)-Math.min(n,j))),i.parentNode.removeChild(i),l[m]}if(this._renderer._layer_containers[a].push(i),i.setAttribute("class",a),i.setAttribute("visibility","hidden"),i.setAttribute("stroke-width","0px"),"undefined"!=typeof c&&(i.setAttribute("opacity",c),i.value=c),i.setAttribute("fill",d.fill||MASCP.layers[a].color),i.position_start=this._index,i.position_end=this._index+b,"undefined"!=typeof d.offset||d.height_scale){var p=d.offset;i.setHeight=function(a){var b=d.height?d.height*f._RS/f.zoom:a*(d.height_scale||1);"bottom"==d.align?(this.setAttribute("y",p*f._RS/f.zoom-a*(d.height_scale||1)),this.setAttribute("height",b)):(this.setAttribute("y",p*f._RS/f.zoom),this.setAttribute("height",b))}}return i},c=function(a,b,c){var d=this._renderer._canvas,e=this._renderer;if(!d){var f=arguments.callee,g=this;return bean.add(this._renderer,"sequencechange",function(){bean.remove(this._renderer,"sequencechange",arguments.callee),f.call(g,a,b,c)}),void log("Delaying rendering, waiting for sequence change")}c||(c={}),c.height&&(c.height=c.height*this._renderer._RS);var h=c.height||this._renderer._layer_containers[a].trackHeight||4,i=this._index;b>1&&(i+=Math.floor(.5*b));var j=4/3,k=d.text(i,0,c.txt||"Text");if(k.setAttribute("font-size",j*h),k.setAttribute("font-weight","bolder"),k.setAttribute("fill",c.fill||"#ffffff"),k.setAttribute("stroke","#000000"),"stroke_width"in c||(c.stroke_width=5),k.setAttribute("stroke-width",c.stroke_width+""),k.setAttribute("style","font-family: "+d.font_order),k.firstChild.setAttribute("dy","1.3ex"),k.setAttribute("text-anchor","middle"),c.align&&("left"==c.align&&k.setAttribute("text-anchor","start"),"right"==c.align&&k.setAttribute("text-anchor","end")),b>1){var l=d.clipPath(),m=d.rect(-.5*b,c.offset||0,b,h);l.push(m),m.removeAttribute("y");var n="id"+(new Date).getTime()+"_"+l.parentNode.childNodes.length;l.setAttribute("id",n),k.setAttribute("clip-path","url(#"+n+")")}return"undefined"!=typeof c.offset?(k.setAttribute("transform","translate("+k.getAttribute("x")+","+k.getAttribute("y")+")"),k.offset=c.offset,k.setHeight=function(a){var b=this.offset;this.setAttribute("x",0),this.setAttribute("y",b*e._RS/e.zoom),m&&m.setAttribute("y",this.getAttribute("y")),this.setAttribute("stroke-width",5/e.zoom),c.height?(this.setAttribute("font-size",j*c.height/e.zoom),m&&m.setAttribute("height",c.height/e.zoom)):(this.setAttribute("font-size",j*a),m&&m.setAttribute("height",a))}):k.setHeight=function(a){k.setAttribute("stroke-width",5/e.zoom),c.height?(k.setAttribute("font-size",j*c.height/e.zoom),m&&m.setAttribute("height",c.height/e.zoom)):(k.setAttribute("font-size",j*a),m&&m.setAttribute("height",a))},b>1&&(k.move=function(a,b){m&&m.setAttribute("x",-1*b*e._RS*.5),m&&m.setAttribute("width",b*e._RS),k.setAttribute("x",(a+parseInt(.5*b))*e._RS)}),this._renderer._layer_containers[a].push(k),k},d=function(a,b,c){var d=this._renderer._canvas,e=this._renderer;if(!d){var f=arguments.callee,g=this;return bean.add(this._renderer,"sequencechange",function(){bean.remove(this._renderer,"sequencechange",arguments.callee),f.call(g,a,b,c)}),void log("Delaying rendering, waiting for sequence change")}var h={pentagon:d.pentagon,hexagon:d.hexagon,rectangle:d.rect,ellipse:d.ellipticalRect,roundrect:function(a,b,c,e){return d.roundRect(a,b,c,e,.25*e)}};c.rotate||(c.rotate=0);var i=null,j=(c.shape.split("-")||"")[0];if(j in h){var k=c.shape.split("-")[1];if("left"!=k||c.rotate||(c.rotate=90),"right"!=k||c.rotate||(c.rotate=270),"flip"!=k||c.rotate||(c.rotate=180),i=h[j].call(d,this._index,60,b||1,c.height||4,c.rotate),"undefined"!=typeof c.offset){var l=i.getAttribute("x"),m=i.getAttribute("y");i.setAttribute("transform","translate("+l+","+m+")"),i.setAttribute("x","0");var n=c.offset||0,o=c.height||4;i.setAttribute("y",n*this._renderer._RS),i.setHeight=function(a){this._orig_stroke_width||(this._orig_stroke_width=parseInt(this.getAttribute("stroke-width"))),i.setAttribute("y",n*e._RS/e.zoom),i.setAttribute("height",o*e._RS/e.zoom),i.setAttribute("stroke-width",this._orig_stroke_width/e.zoom),"ellipse"==c.shape&&i.setAttribute("ry",.5*(o*e._RS)/e.zoom),"roundrect"==c.shape&&(i.setAttribute("rx",.25*(o*e._RS)/e.zoom),i.setAttribute("ry",.25*(o*e._RS)/e.zoom))},i.move=function(a,b){var c=this.getAttribute("transform"),d=/translate\(.*[,\s](.*)\)/.exec(c);d[1]&&this.setAttribute("transform","translate("+a*e._RS+","+d[1]+")"),this.setAttribute("width",b*e._RS)}}if("undefined"==typeof c.offset||"hexagon"!=c.shape&&"pentagon"!=c.shape)this._renderer._layer_containers[a].push(i),i.setAttribute("visibility","hidden"),i.setAttribute("class",a),i.position_start=this._index,i.position_end=this._index+b;else{var n=c.offset||0,o=c.height||4,p=d.group();p.setAttribute("transform",i.getAttribute("transform")),p.push(i),i.setAttribute("transform","translate(0,0)"),p.setHeight=function(a){i._orig_stroke_width||(i._orig_stroke_width=parseInt(i.getAttribute("stroke-width"))||0),i.setHeight(o*e._RS/e.zoom),i.setAttribute("stroke-width",this._orig_stroke_width/e.zoom),i.setAttribute("transform","translate(0,0)")},this._renderer._layer_containers[a].push(p),p.setAttribute("visibility","hidden"),p.setAttribute("class",a),p.position_start=this._index,p.position_end=this._index+b}return i.setAttribute("fill",c.fill||MASCP.layers[a].color),c.stroke&&i.setAttribute("stroke",c.stroke),c.stroke_width?i.setAttribute("stroke-width",e._RS*c.stroke_width):i.style.strokeWidth="0",i}},e=function(a,b,c){var d=this._renderer._canvas;if(!d){var e=arguments.callee,f=this;return bean.add(this._renderer,"sequencechange",function(){bean.remove(this._renderer,"sequencechange",arguments.callee),e.call(f,a,b,c)}),void log("Delaying rendering, waiting for sequence change")}var g=d.rect(-.25+this._index,60,c||1,4);return this._renderer._layer_containers[a].push(g),g.style.strokeWidth="0px",g.setAttribute("fill",MASCP.layers[a].color),g.setAttribute("visibility","hidden"),g.setAttribute("class",a),g},f=function(a,b,c){var d=this._renderer._canvas,e=this._renderer;if("string"==typeof b){var f=document.createElement("div");e.fillTemplate(b,c,function(a,b){f.innerHTML=b}),b=f}if(!d){var g=arguments.callee,h=this;return bean.add(this._renderer,"sequencechange",function(){bean.remove(this._renderer,"sequencechange",arguments.callee),g.call(h,a,width,c)}),void log("Delaying rendering, waiting for sequence change")}var i=d.callout(this._index+.5,.01,b,{width:10*c.width||100,height:10*c.height||100,align:c.align,"font-size":c["font-size"]});return i.setHeight(c.height*this._renderer._RS),this._renderer._canvas_callout_padding=Math.max(10*c.height||100,this._renderer._canvas_callout_padding||0),this._renderer._layer_containers[a].push(i),i.clear=function(){var b=e._layer_containers[a];b.indexOf(i)>0&&b.splice(b.indexOf(i),1),i.parentNode.removeChild(i)},i},g={},h=function(a,b,c){var d=this._renderer._canvas,e=this._renderer;if(!d){var f=arguments.callee,h=this;return bean.add(this._renderer,"sequencechange",function(){bean.remove(this._renderer,"sequencechange",arguments.callee),f.call(h,a,b,c)}),void log("Delaying rendering, waiting for sequence change")}"undefined"==typeof c?c={angle:0,border:"rgb(255,0,0)",content:"A"}:"undefined"==typeof c.angle&&(c.angle=0),g[a]||(g[a]={});var i=this._index+"_"+c.angle;"auto"==c.angle&&(g[a][i]||(g[a][i]={}));var j="undefined"!=typeof g[a][i],k=c.height||this._renderer._layer_containers[a].track_height,l=k/2,m=g[a][i]?g[a][i]:d.growingMarker(0,0,c.content,c);if("auto"==c.angle&&(m.contents?m.contents.indexOf(c.content)<0&&m.contents.push(c.content):m.contents=[c.content],c.angle=1==m.contents.length?0:-45+90*(m.contents.indexOf(c.content)/(m.contents.length-1)),i=this._index+"_"+c.content,j="undefined"!=typeof g[a][i],m=g[a][i]?g[a][i]:d.growingMarker(0,l,c.content,c)),m.setAttribute("transform","translate("+(this._index+.5)*this._renderer._RS+",0.01) scale(1)"),m.setAttribute("height","250"),m.firstChild.setAttribute("transform","translate(-100,0) rotate("+c.angle+",100,0.001)"),m.angle=c.angle,g[a][i]=m,!j)if(m._value=0,this._renderer._layer_containers[a].push(m),"undefined"==typeof c.offset||null===c.offset?m.offset=0*k:(m.offset=c.offset,c.height&&(m.offset=c.offset/c.height)),m.height=k,c.height){var n=m.setHeight;m.setHeight=function(a){return arguments.callee.caller==e.redrawAnnotations?n.call(this,a):void 0}}else this._renderer._layer_containers[a].fixed_track_height=k;if(m._value+=b,!j){var o=d.circle(this._index+.5,10+k,.25);o.setAttribute("visibility","hidden"),o.style.opacity="0.4";var p=d.rect(this._index+.5,10+k,.05,0);p._index=this._index,p.style.strokeWidth="0px",p.style.fill="#777777",p.setAttribute("visibility","hidden");this._renderer._layer_containers[a].track_height;p.setHeight=function(a){if("hidden"!=this.getAttribute("visibility")){var b=m.getAttribute("transform"),c=/translate\(.*[,\s](.*)\) scale\((.*)\)/.exec(b);if(c[1]&&c[2]){var d=parseFloat(c[2]),e=parseFloat(c[1]),f=e+d*(50*(m.offset||0))-parseInt(this.getAttribute("y"));this.setAttribute("height",f)}else this.setAttribute("height",k)}},d.insertBefore(p,d.firstChild.nextSibling),this._renderer._layer_containers[a].tracers||(this._renderer._layer_containers[a].tracers=d.set()),d.tracers||(d.tracers=d.set(),d._visibleTracers=function(){return e._visibleTracers()}),this._renderer._layer_containers[a].tracers.push(p),this._renderer._layer_containers[a].tracers.push(o),d.tracers.push(p)}return this._renderer.redrawAnnotations(a,k),m},j=function(a,b,c){var e=this._index,f=Math.abs(this._renderer.scalePosition(this.original_index+b,this.accession?this.accession:a))-1,g=d.call(f>e?this:this._renderer._sequence_els[f],a,Math.abs(f-e),c);return g.aa=this.original_index,g.aa_width=b,g.acc=this.acc,g},k=function(a,c,d,e){var f=this._index,g=Math.abs(this._renderer.scalePosition(this.original_index+c,this.accession?this.accession:a))-1,h=b.call(g>f?this:this._renderer._sequence_els[g],a,Math.abs(g-f),d,e);return(e||{}).merge?(h.aa_width=parseInt(h.getAttribute("width"))/this._renderer._RS,h.aa_width==c&&(h.aa=this.original_index)):(h.aa_width=c,h.aa=this.original_index),h.acc=this.accession,h},l=function(a,b,d){var e=this._index,f=Math.abs(this._renderer.scalePosition(this.original_index+b,this.accession?this.accession:a))-1,g=c.call(f>e?this:this._renderer._sequence_els[f],a,Math.abs(f-e),d);return g.aa=this.original_index,g.aa_width=b,g.acc=this.accession,g},m=function(a,b,c){var d=this._index,f=Math.abs(this._renderer.scalePosition(this.original_index+c,this.accession?this.accession:a))-1,g=e.call(f>d?this:this._renderer._sequence_els[f],a,b,Math.abs(f-d));return g.aa=this.original_index,g.acc=this.accession,g},n=function(b,c){var d=a.call(this,b,c);return d.aa=this.original_index,d.acc=this.accession,d.aa_width=1,d};MASCP.CondensedSequenceRenderer.prototype.enableScaling=function(){bean.add(this,"readerRegistered",function(a){var b=a.gotResult,c=this;a.gotResult=function(){var d=a.acc||a.agi||"",e=MASCP.CondensedSequenceRenderer.prototype.getAminoAcidsByPosition,f=MASCP.CondensedSequenceRenderer.prototype.getAminoAcidsByPeptide,g=c.sequence;c.sequences?c.sequence=(c.sequences[c.sequences.map(function(a){return(a.agi||a.acc||"").toLowerCase()}).indexOf(d.toLowerCase())]||"").toString():g=null,c.getAminoAcidsByPosition=function(a,b,f){return c.forceTrackAccs?e.call(this,a,d,d):e.call(this,a,b||d,f||d)},c.getAminoAcidsByPeptide=function(a,b,e){return c.forceTrackAccs?f.call(this,a,d,d):f.call(this,a,b||d,e||d)},b.call(a),g&&(c.sequence=g),c.getAminoAcidsByPosition=e,c.getAminoAcidsByPeptide=f}})},MASCP.CondensedSequenceRenderer.prototype._extendElement=function(a){a.addToLayer=n,a.addBoxOverlay=k,a.addShapeOverlay=j,a.addTextOverlay=l,a.addToLayerWithLink=m,a.addAnnotation=h,a.callout=f,a._renderer=this},MASCP.CondensedSequenceRenderer.prototype.remove=function(a,b){return b&&this._layer_containers[a]&&this._layer_containers[a].indexOf(b)>=0?(this._layer_containers[a].splice(this._layer_containers[a].indexOf(b),1),bean.fire(b,"removed"),b.parentNode&&b.parentNode.removeChild(b),b.tracer&&b.tracer.parentNode&&b.tracer.parentNode.removeChild(b.tracer),b.bobble&&b.bobble.parentNode&&b.bobble.parentNode.removeChild(b.bobble),!0):!1};var o=[];MASCP.CondensedSequenceRenderer.prototype.addUnderlayRenderer=function(a){0==o.length&&bean.add(this,"zoomChange",function(){for(var a=o.length-1;a>=0;a--)o[a].call(this,this.zoom,this._canvas)}),o.push(a)};var p=function(a,b){var c=[],d=[];for(i=0;i<b.length;i++){var e=b[i],f=null;e&&(b[i+1]&&(f=b[i+1]),!f||parseInt(f.aa)-parseInt(e.aa)>10||a.sequence.substring(e,f-1).match(/[ST]/)?(c.length<3?(c.push(e),c.forEach(function(a){})):(c.push(e),c.forEach(function(a){a.options.zoom_level="text"}),d.push({aa:c[0].aa,type:"shape",width:parseInt(e.aa)-parseInt(c[0].aa)+1,options:{zoom_level:"summary",shape:"roundrect",fill:c[0].coalesce.fill,stroke:c[0].coalesce.stroke,stroke_width:c[0].coalesce.stroke_width,height:c[0].options.height,offset:c[0].options.offset}})),c=[]):c.push(e))}d.forEach(function(a){b.push(a)})};MASCP.CondensedSequenceRenderer.prototype.renderObjects=function(a,b){var c=this;b.length>0&&b[0].coalesce&&p(c,b);var d=[];return b.forEach(function(b){var e=b.options?(b.options.height||c._layer_containers[a].track_height)+(b.options.offset+b.options.height||0):0;b.options&&e>c._layer_containers[a].track_height&&(c._layer_containers[a].fixed_track_height=c._layer_containers[a].track_height+b.options.offset+(b.options.height||c._layer_containers[a].track_height));var f,g;if((!b.aa||c.getAA(parseInt(b.aa),a))&&("undefined"==typeof b.aa||!isNaN(b.aa))){if("text"==b.type&&(b.aa?g=b.width?c.getAA(parseInt(b.aa),a).addTextOverlay(a,b.width,b.options):c.getAA(parseInt(b.aa),a).addTextOverlay(a,1,b.options):b.peptide&&(g=c.getAminoAcidsByPeptide(b.peptide,a).addTtextOverlay(a,1,b.options))),"box"===b.type&&(b.aa?g=c.getAA(parseInt(b.aa),a).addBoxOverlay(a,parseInt(b.width),1,b.options):b.peptide&&(g=c.getAminoAcidsByPeptide(b.peptide,a).addToLayer(a,1,b.options))),"shape"==b.type&&(b.aa?g=c.getAA(parseInt(b.aa),a).addShapeOverlay(a,parseInt(b.width),b.options):b.peptide&&(g=c.getAminoAcidsByPeptide(b.peptide,a)[0].addShapeOverlay(a,b.peptide.length,b.options))),"line"==b.type&&(g=c.addValuesToLayer(a,b.values,b.options)),"marker"==b.type){var h=(b.options||{}).content;b.options.height;if(Array.isArray&&Array.isArray(h)){var i={};for(var j in b.options)b.options.hasOwnProperty(j)&&(i[j]=b.options[j]);f=c.getAA(parseInt(b.aa),a).addToLayer(a,i),f=f[1],f.style.display="none",b.options.content=b.options.alt_content,h=b.options.content}if("object"==typeof h){var k;"circle"==h.type&&(k=c._canvas.circle(-.5,-.5,1,1)),"text_circle"==h.type&&(k=c._canvas.text_circle(.5,.5,1,h.text,h.options||{}),b.options.break_viewbox=!0),"left_triangle"==h.type&&(k=c._canvas.poly("-100,0 0,-100 0,100")),"right_triangle"==h.type&&(k=c._canvas.poly("0,100 100,0 0,-100")),["fill","stroke","stroke-width","fill-opacity","stroke-opacity","opacity"].forEach(function(a){h[a]&&k.setAttribute(a,h[a])}),b.options.content=k}var l={};for(var j in b.options)b.options.hasOwnProperty(j)&&(l[j]=b.options[j]);var m=c.getAA(parseInt(b.aa),a).addToLayer(a,l);f&&m[1].addEventListener("click",function(){"none"===f.style.display?(f.parentNode.appendChild(f),f.style.display="block"):f.style.display="none",c.refresh()},!1),g=m[1]}(b.options||{}).zoom_level&&(g.zoom_level=b.options.zoom_level),b.identifier&&g.setAttribute("identifier",b.identifier),(b.options||{}).events&&g&&b.options.events.forEach(function(c){(c.type||"").split(",").forEach(function(d){"click"==d&&g.style&&(g.style.cursor="pointer"),g.addEventListener(d,function(d){d.event_data=c.data,d.layer=a,d.aa=b.aa})})}),d.push(g)}}),d},MASCP.CondensedSequenceRenderer.prototype.addTextTrack=function(a,b){var c=this._RS,d=MASCP.svgns,e=this,f=300,g=e._canvas,h=a.split(""),i=g.set(),j=!1,k=0,l=!0,m=function(){};try{var n=document.createElementNS(d,"text");n.setAttribute("textLength",10),m(n.textLength)}catch(o){l=!1}var p=!1;"undefined"!=typeof MASCP.supports_dx?p=MASCP.supports_dx:!function(a){if(!a)return void(p=!1);var b=document.createElementNS(d,"text");if(b.setAttribute("textLength",30),b.getExtentOfChar){b.setAttribute("x","0"),b.setAttribute("y","0"),b.textContent="ABC",g.appendChild(b);var c=b.getExtentOfChar(2).x;b.setAttribute("dx","10"),p=!(Math.abs(b.getExtentOfChar(2).x-c)<9.5),MASCP.supports_dx=p,b.parentNode.removeChild(b)}}(l);var q;if(l&&"lengthAdjust"in document.createElementNS(d,"text")&&"textLength"in document.createElementNS(d,"text"))a.length<=f?(q=g.text(0,12,document.createTextNode(a)),q.setAttribute("textLength",c*a.length)):(q=g.text(0,12,document.createTextNode(a.substr(0,f))),q.setAttribute("textLength",c*f)),g.insertBefore(q,g.firstChild.nextSibling),q.style.fontFamily="'Lucida Console', 'Courier New', Monaco, monospace",q.setAttribute("lengthAdjust","spacing"),q.setAttribute("text-anchor","start"),q.setAttribute("dx",5),q.setAttribute("dy","1.5ex"),q.setAttribute("font-size",c),q.setAttribute("fill","#000000"),i.push(q),b.push(q);else{for(var r=0;r<h.length;r++)q=g.text(k,12,h[r]),q.firstChild.setAttribute("dy","1.5ex"),i.push(q),b.push(q),q.style.fontFamily="'Lucida Console', Monaco, monospace",k+=1;i.attr({width:c,"text-anchor":"start",height:c,"font-size":c,fill:"#000000"})}var s=function(){if(!(a.length<=f)){var b=e._container_canvas.parentNode.cached_width;if(!b){b=e._container_canvas.parentNode.getBoundingClientRect().width;var d=document.documentElement.clientWidth;d>b&&(b=d)}max_size=Math.ceil(10*b*e.zoom/c),max_size>a.length&&(max_size=a.length),q.setAttribute("textLength",c*max_size);var g=parseInt(e.leftVisibleResidue());g-=50,0>g&&(g=0),g+max_size>=a.length&&(g=a.length-max_size,0>g&&(g=0)),q.replaceChild(document.createTextNode(a.substr(g,max_size)),q.firstChild),q.setAttribute(p?"dx":"x",5+g*c)}},t=function(){j&&i.attr({display:"none"})},u=function(){j&&(i.attr({display:"block"}),s())},v=function(){g.zoom>3.6?(i.attr({display:"block"}),j=!0,s()):g.zoom>.2?(i.attr({display:"none"}),j=!1):(i.attr({display:"none"}),j=!1)};return b.panevents||(g.addEventListener("panstart",t,!1),bean.add(g,"panend",u),b.panevents=!0),bean.add(g,"zoomChange",v,!1),bean.add(i[0],"removed",function(){g.removeEventListener("panstart",t),bean.remove(g,"panend",u),bean.remove(g,"zoomChange",v),delete b.panevents}),i},MASCP.CondensedSequenceRenderer.prototype.renderTextTrack=function(a,b){var c=a;"string"!=typeof c&&(c=a.name);var d=this._canvas;if(d&&"undefined"!=typeof c){var e=this._layer_containers[c],f=this.addTextTrack(b,e);return f}},MASCP.CondensedSequenceRenderer.prototype.resetAnnotations=function(){g={}},MASCP.CondensedSequenceRenderer.prototype.removeAnnotations=function(a){var b=a;"string"!=typeof b&&(b=a.name);var c=this._canvas;if(c&&"undefined"!=typeof b){for(var d in g[b])if(g[b].hasOwnProperty(d)){var e=g[b][d],f=this._layer_containers[b];if(f.indexOf(e)>=0&&f.splice(f.indexOf(e),1),c.tracers&&f.tracers){for(var h=0;h<f.tracers.length;h++){var i=f.tracers[h];i.parentNode.removeChild(i),c.tracers.indexOf(i)>=0&&c.tracers.splice(c.tracers.indexOf(i),1)}f.tracers=c.set()}e.parentNode&&e.parentNode.removeChild(e),g[b][d]=null}g[b]=null,delete g[b],delete this._layer_containers[b].fixed_track_height}},MASCP.CondensedSequenceRenderer.prototype.redrawAnnotations=function(a){var b=this._canvas,c=null,d=0,e=b.suspendRedraw(1e4),f=0;for(d in g[a])if(g[a].hasOwnProperty(d)){if(g[a][d]._value>f&&(f=g[a][d]._value),c=g[a][d].parentNode,!c)continue;c.removeChild(g[a][d]),g[a][d]._parent=c}for(d in g[a])if(g[a].hasOwnProperty(d)){var h=g[a][d],i=h.height;this._layer_containers[a].fixed_track_height||this._layer_containers[a].track_height;if(!h.setHeight)continue;var j=(.4+.6*h._value/f)*(this._RS*i*1);h.setHeight(j)}for(d in g[a])if(g[a].hasOwnProperty(d)){if(c=g[a][d]._parent,!c)continue;c.appendChild(g[a][d])}b.unsuspendRedraw(e)},function(a){var b={},c=!1,d=function f(a,c){var d=/\W/.test(a)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").split(/\x3c\%/g).join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):b[a]=b[a]||f(document.getElementById(a).innerHTML);return c?d(c):d};try{new Function("return;")}catch(e){c=!0}return c?void(a.fillTemplate=function(a,b,c){MASCP.SANDBOX.contentWindow.postMessage({template:document.getElementById(a).innerHTML,data:b},"*");var d=function(a){bean.remove(window,"message",d),a.data.html&&c.call(null,null,a.data.html)};bean.add(window,"message",d)}):void(a.fillTemplate=function(a,b,c){c.call(null,null,d(a,b))})}(MASCP.CondensedSequenceRenderer.prototype)}(),MASCP.CondensedSequenceRenderer.prototype.EnableHighlights=function(){var a=this,b=[],c=function(){var c=a._canvas.rect(0,0,0,"100%");c.setAttribute("fill","#ffdddd"),c.removeAttribute("stroke");var d=c.parentNode;d.insertBefore(c,d.firstChild.nextSibling),b.push(c)};c(),a.moveHighlight=function(){var a=Array.prototype.slice.call(arguments),d=this._RS,e=0,f=0;for(e=0;e<a.length;e+=2){var g=a[e],h=a[e+1],i=b[f];i||(c(),i=b[f]),i.previousSibling.previousSibling&&b.indexOf(i.previousSibling.previousSibling)<0&&i.parentNode.insertBefore(i,i.parentNode.firstChild.nextSibling),i.setAttribute("x",(g-1)*d),i.setAttribute("width",(h-(g-1))*d),i.setAttribute("visibility","visible"),f+=1}for(e=f;e<b.length;e++)b[e].setAttribute("visibility","hidden")}},function(){var a=function(a,b){"ontouchstart"in window?a.addEventListener("touchstart",function(c){var d=c.touches[0].clientX,e=c.touches[0].clientY,f=function(){document.body.removeEventListener("touchmove",h),a.removeEventListener("touchend",g)},g=function(a){f(),a.stopPropagation(),a.preventDefault(),b&&b.call(null,a)},h=function(a){(Math.abs(a.touches[0].clientX-d)>10||Math.abs(a.touches[0].clientY-e)>10)&&f()};document.body.addEventListener("touchmove",h,{passive:!0}),a.addEventListener("touchend",g,!1)},{passive:!0}):a.addEventListener("click",b,!1)},b=function(a){var b=0,c=0;return a||(a=window.event),a.pageX||a.pageY?(b=a.pageX-(document.body.scrollLeft+document.documentElement.scrollLeft),c=a.pageY-(document.body.scrollTop+document.documentElement.scrollTop)):(a.clientX||a.clientY)&&(b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c=a.clientY+document.body.scrollTop+document.documentElement.scrollTop),self.targetElement&&(b=a.screenX,c=a.screenY),[b,c]},c=function(a,c){var d=b(a.changedTouches?a.changedTouches[0]:a),e={};
if("svg"==c.nodeName){e=c.createSVGPoint();var f=c.getScreenCTM();e.x=d[0],e.y=d[1],self.matrix=f.inverse(),e=e.matrixTransform(self.matrix)}else e.x=d[0],e.y=d[1];return e},d=function(a,b,c){for(var d in MASCP.layers){var e=MASCP.getLayer(d);a&&b?bean.fire(e,"selection",[c.scalePosition(a,d,!0),c.scalePosition(b,d,!0)]):bean.fire(e,"selection",[null,null])}};MASCP.CondensedSequenceRenderer.prototype.enableSelection=function(e){var f=this;if(!f._canvas)return void bean.add(f,"sequenceChange",function(){f.enableSelection()});var g,h,i,j,k=f._canvas,l=function(a){a.preventDefault();var b=c(a,k);h=b.x,g>h?(j=parseInt(g/50),i=parseInt(h/50)):(j=parseInt(h/50),i=parseInt(g/50)),f.select(i+1,j)};a(k,function(a){f.selecting||(f.select(),d(null,null,f),i=null,j=null)}),k.addEventListener("mousedown",function(a){if(f.selecting){var c=b(a),d={};if("svg"==k.nodeName){d=k.createSVGPoint();var e=this.getScreenCTM();d.x=c[0],d.y=c[1],f.matrix=e.inverse(),d=d.matrixTransform(f.matrix)}else d.x=c[0],d.y=c[1];g=d.x,h=d.x,k.addEventListener("mousemove",l,!1),a.preventDefault()}},!1),k.addEventListener("mouseup",function(a){f.selecting&&(d(i+1,j,f),i=null,j=null),k.removeEventListener("mousemove",l),a.preventDefault()}),k.addEventListener("touchend",function(){f.selecting&&setTimeout(function(){d(i+1,j,f),i=null,j=null},500),k.removeEventListener("touchmove",l)}),k.addEventListener("touchstart",function(a){if(f.selecting&&1==a.changedTouches.length){a.preventDefault();var c=b(a.changedTouches[0]),d={};if("svg"==k.nodeName){d=k.createSVGPoint();var e=this.getScreenCTM();d.x=c[0],d.y=c[1],f.matrix=e.inverse(),d=d.matrixTransform(f.matrix)}else d.x=c[0],d.y=c[1];g=d.x,h=d.x,k.addEventListener("touchmove",l,!1)}},{passive:!0})}}(),MASCP.CondensedSequenceRenderer.prototype._visibleTracers=function(){var a=null;for(var b in MASCP.layers)this.isLayerActive(b)&&this._layer_containers[b]&&this._layer_containers[b].tracers&&(a?a.concat(this._layer_containers[b].tracers):a=this._layer_containers[b].tracers);return a},MASCP.CondensedSequenceRenderer.prototype._resizeContainer=function(){this._RS;if(this._container&&this._canvas){var a=2*(this.zoom||1)*this.sequence.length,b=2*(this.zoom||1)*(this._canvas._canvas_height/this._RS);this._canvas_callout_padding&&(b+=this._canvas_callout_padding),this._canvas.setAttribute("width",a),this._canvas.setAttribute("height",b),this.navigation.setDimensions(a,b),this.grow_container?this._container_canvas.setAttribute("height",b):(this._container_canvas.setAttribute("height","100%"),this._container_canvas.setAttribute("width","100%"),this.navigation.setZoom(this.zoom))}},function(a){var b=MASCP.svgns,c=function(a,b){var c=this;!a._layer_containers[c.name]||a._layer_containers[c.name].length<=0||b||a._layer_containers[c.name].tracers&&a._layer_containers[c.name].tracers.hide()};a.prototype.addTrack=function(a){var b=(this._RS,this);if(!this._canvas)return bean.add(this,"sequencechange",function(){this.addTrack(a),bean.remove(this,"sequencechange",arguments.callee)}),void console.log("No canvas, cannot add track, waiting for sequencechange event");var d=this._layer_containers||[];if(!d[a.name]||null===d[a.name]){d[a.name]=this._canvas.set(),d[a.name].track_height||(d[a.name].track_height=b.trackHeight||4),bean.remove(a,"visibilityChange",c),bean.add(a,"visibilityChange",c);bean.remove(a,"removed"),bean.add(a,"removed",function(a){a?a.removeTrack(this):b.removeTrack(this)})}this._layer_containers=d},a.prototype.removeTrack=function(a){if(this._layer_containers){var b=this._layer_containers||[];b[a.name]&&(this.removeAnnotations(a),this._layer_containers[a.name]=null,a.disabled=!0)}};a.prototype.disablePrintResizing=function(){delete this._media_func},a.prototype.enablePrintResizing=function(){if((this.win()||window).matchMedia){if(this._media_func)return this._media_func;this._media_func=function(a){var b=this;if(b._canvas)if(b.grow_container)if(a.matches){var c=10*parseInt(b.leftVisibleResidue()/10)+10;b._canvas.ownerSVGElement.getElementById(b.axis_pattern_id).setAttribute("x",c*b._RS),delete b._container_canvas.parentNode.cached_width,bean.fire(b._canvas,"panend")}else b._canvas.ownerSVGElement.getElementById(b.axis_pattern_id).setAttribute("x","0");else{var d=a;if(d.matches)try{var e=b._container;b.old_translate=b._canvas.currentTranslate.x,b._canvas.setCurrentTranslateXY(0,0);var f=.95*e.clientWidth/b.sequence.length;b.old_zoom||(b.old_zoom=b.zoom,b.old_viewbox=b._container_canvas.getAttribute("viewBox")),b.zoomCenter=null,b._container_canvas.removeAttribute("viewBox"),b.withoutRefresh(function(){b.zoom=f}),b.refresh()}catch(g){console.log(g),console.log(g.stack)}else if(b.old_zoom){var h=b.old_zoom;b.old_zoom=null,b.zoomCenter=null,b.withoutRefresh(function(){b.zoom=h}),b._canvas.setCurrentTranslateXY(b.old_translate,0),b._container_canvas.setAttribute("viewBox",b.old_viewbox),b.old_zoom=null,b.old_translate=null,b.refresh(),bean.fire(b._canvas,"zoomChange")}}};var a=this;a._bound_media||(this.win()||window).matchMedia("print").addListener(function(b){a._media_func&&a._media_func(b)}),a._bound_media=!0}},a.prototype.wireframe=function(){var a=this.trackOrder||[],b=0,c=0;if(this.wireframes){for(;this.wireframes.length>0;)this._canvas.removeChild(this.wireframes.shift());for(var d=0;d<a.length;d++){var e=a[d],f=this._layer_containers[e];if(this.isLayerActive(e))if(f.fixed_track_height){var g=f.fixed_track_height;b=this._axis_height+(c-.3*g)/this.zoom;var h=this._canvas.rect(0,b,1e4,.5*g);h.setAttribute("stroke","#ff0000"),h.setAttribute("fill","none"),this.wireframes.push(h);var h=this._canvas.rect(0,b,1e4,g);h.setAttribute("stroke","#ff0000"),h.setAttribute("fill","none"),this.wireframes.push(h),c+=this.zoom*g+this.trackGap}else{b=this._axis_height+c/this.zoom;var h=this._canvas.rect(0,b,1e4,.5*f.track_height/this.zoom);h.setAttribute("stroke","#ff0000"),h.setAttribute("fill","none"),this.wireframes.push(h),h=this._canvas.rect(0,b,1e4,f.track_height/this.zoom),h.setAttribute("stroke","#ff0000"),h.setAttribute("fill","none"),this.wireframes.push(h),this.navigation&&(c+=f.track_height),c+=f.track_height+this.trackGap}}}},a.prototype.refresh=function(a){if(this._canvas){var b=this._layer_containers||[],c=this._RS,d=0,e=this.trackOrder||[],f=this.fixedFontScale;this.navigation&&this.navigation.reset();for(var g=0;g<e.length;g++){var h=e[g],i=b[h];if(i){var j;if(this.isLayerActive(h)){var k=d;if(i.fixed_track_height){i.fixed_track_height;j=this._axis_height+d/this.zoom,a?i.animate({visibility:"visible",y:j*c,height:c*i.track_height/this.zoom}):i.attr({visibility:"visible",y:j*c,height:c*i.track_height/this.zoom}),this.navigation&&(j-=1*i.track_height/this.zoom,this.navigation.renderTrack(MASCP.getLayer(h),j*c,c*i.fixed_track_height/this.zoom,{"font-scale":3*(f||1)*i.track_height/i.fixed_track_height})),d+=i.fixed_track_height+this.trackGap-i.track_height}else j=this._axis_height+d/this.zoom,a?i.animate({visibility:"visible",y:j*c,height:c*i.track_height/this.zoom}):i.attr({visibility:"visible",y:j*c,height:c*i.track_height/this.zoom}),this.navigation&&(j-=1*i.track_height/this.zoom,this.navigation.renderTrack(MASCP.getLayer(h),j*c,3*c*i.track_height/this.zoom,f?{"font-scale":f}:null),d+=i.track_height),d+=i.track_height+this.trackGap;if(i.refresh_zoom(),i.tracers){var l=this.isLayerActive(h)&&this.zoom>3.6?"visible":"hidden",m=(1.5+k/this.zoom)*c;a?i.tracers.animate({visibility:l,y:.65*this._axis_height*c,height:m}):i.tracers.attr({visibility:l,y:.65*this._axis_height*c,height:m})}}else{var n={y:-1*this._axis_height*c,height:c*i.track_height/this.zoom,visibility:"hidden"};if(MASCP.getLayer(h).group){var o=this.navigation.getController(MASCP.getLayer(h).group);o&&this.isLayerActive(o)&&(n.y=b[o.name].currenty())}i.fixed_track_height&&delete n.height,a?i.animate(n):i.attr(n),i.tracers}}}this.wireframe();var p=[-1,0,0,0];p[0]=-2*c,p[2]=(this.sequence.split("").length+this.padding+2)*c,p[3]=(this._axis_height+d/this.zoom+this.padding/this.zoom)*c,this._canvas.setAttribute("viewBox",p.join(" ")),this._canvas._canvas_height=p[3];var q=[].concat(p);q[0]=0,q[2]=this.zoom*(2*this.sequence.length)+this.padding,q[3]=2*this.zoom*(this._axis_height+d/this.zoom+this.padding/this.zoom),this.grow_container?this._container_canvas.removeAttribute("viewBox"):this._container_canvas.setAttribute("viewBox",q.join(" ")),this._resizeContainer(),p[0]=0,this.navigation&&(this.navigation.nav_width_base=q[3]<200?q[3]:200,this.navigation.visible()?this._canvas.style.GomapScrollLeftMargin=100*c/this.zoom:this._canvas.style.GomapScrollLeftMargin=1e3,this.navigation.setViewBox(p.join(" "))),this.navigation&&this.navigation.refresh()}};var d=function(a){a.setAttribute("xmlns","http://www.w3.org/2000/svg"),a.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");var b=(new XMLSerializer).serializeToString(a);return"data:image/svg+xml,"+encodeURIComponent(b)};a.prototype.pngURL=function(a,c){for(var e=this._canvas.cloneNode(!0),f=e.querySelectorAll("text[data-spaces]"),g=0;g<f.length;g++)f[g].parentNode.removeChild(f[g]);var h=document.createElementNS(b,"svg");h.setAttribute("width",this._container_canvas.getBoundingClientRect().width),h.setAttribute("height",this._container_canvas.getBoundingClientRect().height),h.setAttribute("preserveAspectRatio","xMinYMin meet");var i=document.createElementNS(b,"g");i.setAttribute("transform",this._canvas.parentNode.getAttribute("transform")),h.appendChild(i),i.appendChild(e);for(var j=this._container_canvas.querySelectorAll("defs"),g=0;g<j.length;g++)h.appendChild(j[g].cloneNode(!0));var k=document.createElement("canvas"),l=2*parseInt(h.getAttribute("width")),m=2*parseInt(h.getAttribute("height"));if(c&&l>c){var n=l/c;l=c,m=parseInt(m/n)}k.width=l,k.height=m;var o=new Image;o.width=1,o.height=1;var p=k.getContext("2d");o.onload=function(){p.drawImage(o,0,0,k.width,k.height),a(k.toDataURL())},o.onerror=function(){console.log("Got an error")};var q=d(h);o.src=q}}(MASCP.CondensedSequenceRenderer),MASCP.CondensedSequenceRenderer.Zoom=function(a){var b,c,d=null,e=null,f=null,g=null,h=null,i={setZoom:function(i){var j=a._container.cached_width;if(j||(j=a._container.clientWidth),!a.sequence)return void(f=i);var k=j/(2*a.sequence.length);a.grow_container||(k=.15*k),k>i&&(i=k),i>10&&(i=10);var l=this;if(i!=f){if(!l._canvas)return void(f=i);var m=!1;if("center"==l.zoomCenter&&(m=!0,l.zoomCenter={x:.5*l._RS*(l.leftVisibleResidue()+l.rightVisibleResidue())}),l.zoomCenter&&!g)h=l._canvas.currentTranslate.x||0,g=l.zoomCenter?l.zoomCenter.x:0;else if(g&&!l.zoomCenter)return;d?clearTimeout(d):e=parseFloat(f||1),f=parseFloat(i);var n=Math.abs(parseFloat(i)/e);if(window.cancelAnimationFrame(b),b=window.requestAnimationFrame(function(){console.log("Setting transform");var a=l._canvas.parentNode.getAttribute("transform")||"";a=a.replace(/scale\([^\)]+\)/,""),a="scale("+n+") "+(a||""),l._canvas.parentNode.setAttribute("transform",a)}),bean.fire(l._canvas,"_anim_begin"),document.createEvent){var o=document.createEvent("Events");o.initEvent("panstart",!1,!0),l._canvas.dispatchEvent(o)}l._canvas.currentTranslate.x;if(g){var p=(e-f)/(25*n)*g;p+=h/n,cancelAnimationFrame(c),c=window.requestAnimationFrame(function(){l._canvas.setCurrentTranslateXY(p,(e-f)/n*l._axis_height*2)})}var q=function(){d=null;var a=(Math.abs(parseFloat(f)/e),l._canvas.parentNode.getAttribute("transform")||"");a=a.replace(/scale\([^\)]+\)/,""),l._canvas.parentNode.setAttribute("transform",a),bean.fire(l._canvas,"panend"),bean.fire(l._canvas,"_anim_end"),bean.add(l._canvas,"zoomChange",function(){if(bean.remove(l._canvas,"zoomChange",arguments.callee),l.refresh(),"undefined"!=typeof g){var a=(e-f)/25*g;a+=h,l._resizeContainer(),l._canvas.shiftPosition?l._canvas.shiftPosition(a,0):l._canvas.setCurrentTranslateXY(a,0)}g=null,h=null}),l._canvas&&(l._canvas.zoom=parseFloat(f),bean.fire(l._canvas,"zoomChange")),bean.fire(l,"zoomChange")};"ontouchend"in document&&l.zoomCenter&&!m?(bean.remove(l,"gestureend"),bean.add(l,"gestureend",function(){bean.remove(l,"gestureend",arguments.callee),q()}),d=1):this.refresh.suspended?q():d=setTimeout(q,100)}else if(this.refresh.suspended&&l._canvas&&l._canvas.zoom!==parseFloat(f)){l._canvas.zoom=parseFloat(f);var r=l._canvas.parentNode.getAttribute("transform")||"";r=r.replace(/scale\([^\)]+\)/,"");var n=1;r="scale("+n+") "+(r||""),l._canvas.parentNode.setAttribute("transform",r),bean.fire(l._canvas,"zoomChange")}},fitZoom:function(){var b=a._container.cached_width;b||(b=a._container.clientWidth);var c=.5;a.sequence&&(c=b/(2*a.sequence.length)),a.zoom=c},getZoom:function(){return f||1}};Object.defineProperty&&!MASCP.IE8&&Object.defineProperty(a,"zoom",{get:i.getZoom,set:i.setZoom}),a.fitZoom=i.fitZoom},function(a){var b={getPadding:function(){return this._padding||10},setPadding:function(a){this._padding=a,this.refresh()},getTrackGap:function(){if(!this._track_gap){var a="ontouchend"in document?20:10;this._track_gap=this._track_gap||a}return this._track_gap},setTrackGap:function(a){this._track_gap=a,this.refresh()}};Object.defineProperty&&!MASCP.IE8&&(Object.defineProperty(a.prototype,"padding",{get:b.getPadding,set:b.setPadding}),Object.defineProperty(a.prototype,"trackGap",{get:b.getTrackGap,set:b.setTrackGap}))}(MASCP.CondensedSequenceRenderer),MASCP.CondensedSequenceRenderer.Navigation=function(){var a=MASCP.svgns,b=1,c=!1;"ontouchend"in document&&(b=window.devicePixelRatio,c=!0);var d=function(b,c){SVGCanvas(b),this.win=function(){return c.win()},g.call(this,b);var d=b.group();b.insertBefore(d,b.lastChild);var f=document.createElementNS(a,"svg");h.call(this,f,e.call(this,c)),d.appendChild(f),d.setAttribute("clip-path","url(#"+this.clipping_id+")"),this.disable=function(){b.style.display="none",f.style.display="none"},this.enable=function(){b.style.display="block",f.style.display="block"},this.demote=function(){f.hide()},this.promote=function(){this.visible()?f.show():f.hide()},this.setDimensions=function(a,c){b.setAttribute("width",a),b.setAttribute("height",c)}},e=function(a){var b={},c={},d=a.removeTrack;return a.removeTrack=function(a){d.call(this,a),delete b[a.name],delete c[a.name]},this.isController=function(a){return!!b[a.name]},this.getController=function(a){for(var c in b)if(b.hasOwnProperty(c)&&b[c]==a)return MASCP.getLayer(c);return null},this.isControllerExpanded=function(a){return c[a.name]},a.createGroupController=function(d,e){var f=MASCP.getLayer(d),g=MASCP.getGroup(e);if(f&&g&&!b[f.name]){b[f.name]=g,c[f.name]=!1;var h=this;bean.add(f,"removed",function(a,b){h.setGroupVisibility(g)}),bean.add(f,"visibilityChange",function(b,d){g.size()>0&&(c.hasOwnProperty(f.name)||(c[f.name]=!1),h.setGroupVisibility(g,c[f.name]&&d,!0),a.refresh())}),bean.add(g,"visibilityChange",function(a,b){b&&(h.showLayer(f,!0),c[f.name]=!0)}),bean.remove(f,"_expandevent"),bean.add(f,"_expandevent",function(a){c[f.name]=!c[f.name],h.withoutRefresh(function(){h.setGroupVisibility(g,c[f.name])}),h.refresh(!0)})}},f(function(c,d,e){var f=a.trackOrder;f.trackIndex=function(a){return a?this.indexOf(a.name):this.length},e&&!d&&(d=MASCP.getLayer(f[f.trackIndex(e)+1])),f.splice(f.trackIndex(c),1);var g=[];if(b[c.name]&&MASCP.getGroup(b[c.name]).eachLayer(function(a){MASCP.getGroup(a)===a&&MASCP.getGroup(a).eachLayer(arguments.callee),f.trackIndex(a)>=0&&(g=[f.splice(f.trackIndex(a),1)[0]].concat(g))}),d){f.splice(f.trackIndex(d),1,c.name,d?d.name:void 0);for(var h=0;h<g.length;h++)g[h]&&f.splice(f.trackIndex(d),0,g[h])}else a.hideLayer(c),MASCP.getLayer(c).disabled=!0,g.forEach(function(b){a.hideLayer(b),MASCP.getLayer(b).disabled=!0}),f.push(c.name),f=f.concat(g);a.trackOrder=f})},f=function(a){var b,d,e,f=[],g=!1,h={},i=null,j=function(j,l,m,n){var o=this,p=o.reset;null===i&&(o.reset=function(){f=[],p.call(this)},i=!0);var q=function(){window.clearTimeout(h.anim),window.clearTimeout(h.hover);for(var a=0;a<f.length;a++)f[a]!=b&&(f[a].removeAttribute("dragging"),f[a].removeAttribute("transform"),f[a].setAttribute("pointer-events","all"))};f.push(l),l.track=m;var r=function(a){return function(b){b.touches&&1==b.touches.length&&a.call(this,b)}},s=function(h,i,j){if(!k()){var l=n.nearestViewportElement;if(!g){j.setAttribute("dragging","true"),spliceBefore=null,spliceAfter=null;var o=j.nearestViewportElement.createSVGPoint();o.x=h.clientX||window.pageXOffset+h.touches[0].clientX,o.y=h.clientY||window.pageYOffset+h.touches[0].clientY;var p=j.nearestViewportElement.getScreenCTM(),s=p.inverse();o=o.matrixTransform(s);var t=o.x,v=o.y,w=function(a){var b=j.nearestViewportElement.createSVGPoint();b.x=a.clientX||window.pageXOffset+a.touches[0].clientX,b.y=a.clientY||window.pageYOffset+a.touches[0].clientY,b=b.matrixTransform(s);var c=b.x-t,d=b.y-v,e=j.getAttribute("transform")||"";return e=e.replace(/\s?translate\([^\)]+\)/,""),e+=" translate("+c+","+d+") ",e=e.replace(/\s*$/,""),j.setAttribute("transform",e),f.forEach(function(c){var d=c.getBBox();d.y<b.y&&d.y>b.y-d.height&&d.x<b.x&&d.x>b.x-d.width&&u.call(c,a,c.track)}),a.stopPropagation(),a.preventDefault(),!1};c&&(w=r(w));var x=function(b){return!b.relatedTarget||b.relatedTarget!=j&&b.relatedTarget.nearestViewportElement!=j.nearestViewportElement&&b.relatedTarget.nearestViewportElement!=l?(!g||"mouseup"!=b.type&&"touchend"!=b.type||(spliceBefore||spliceAfter)&&a(d,spliceBefore,spliceAfter),l.removeEventListener("touchmove",w,!1),l.removeEventListener("mousemove",w,!1),l.removeEventListener("touchend",arguments.callee,!1),l.removeEventListener("mouseup",arguments.callee,!1),l.removeEventListener("mouseout",arguments.callee,!1),void(g&&(j.setAttributeNS(null,"pointer-events","all"),j.removeAttribute("transform"),q(),g=!1,e=null))):void(g&&f.indexOf(b.relatedTarget)>=0&&q())};j.setAttributeNS(null,"pointer-events","none"),j.addEventListener("touchmove",w,!1),j.addEventListener("touchend",x,!1),l.addEventListener("mousemove",w,!1),l.addEventListener("mouseup",x,!1),l.addEventListener("mouseout",x,!1),g=m,b=j}}},t=function(a){s(a,m,l)},u=function(a,c){var i=c?c:m,j=this?this:l;g&&g!=i&&i!=e&&(e=i,h.hover&&window.clearTimeout(h.hover),h.hover=window.setTimeout(function(){if((g.group||i.group)&&(g.group?i.group:!i.group)){if(g.group.name!=i.group.name)return}else if(g.group||i.group)return;h.anim&&(window.clearInterval(h.anim),h.anim=null),q();for(var a=j,c=[];null!==a&&(a!=b&&f.indexOf(a)>=0&&c.push(a),a=a.nextSibling,a!=b););a=j.previousSibling;for(var e=[];null!==a&&(a!=b&&f.indexOf(a)>=0&&e.push(a),a=a.previousSibling,a!=b););var k=1,l=b.getBBox().height/4;h.anim=window.setInterval(function(){var a,b=0;if(5>k){for(b=0;b<c.length;b++)a=c[b].getAttribute("transform")||"",a=a.replace(/\s?translate\([^\)]+\)/,""),a+=" translate(0,"+k*l+")",c[b].setAttribute("transform",a);for(b=0;c.length>0&&b<e.length;b++)a=e[b].getAttribute("transform")||"",a=a.replace(/\s?translate\([^\)]+\)/,""),a+=" translate(0,"+-1*k*l+")",e[b].setAttribute("transform",a);k+=1}else spliceBefore=i,d=g,window.clearInterval(h.anim),h.anim=null},30)},300))};j.addEventListener("mousedown",t,!1),j.addEventListener("touchstart",r(t),!1)},k=function(){return j.disabled};return j.spliceFunction=a,j},g=function(d){var e=this;e.zoom=1,e.nav_width_base=200+100*(b-1);var f=e.nav_width_base;e.nav_width=e.nav_width_base;var g=d.group(),h=d.group(),i=d.rect(-10,0,f.toString(),"100%"),j=[12*b,10*b];i.setAttribute("rx",j[0].toString()),i.setAttribute("ry",j[1].toString()),c||i.setAttribute("opacity","0.8"),i.style.stroke="#000000",i.style.strokeWidth="2px",i.style.fill="#000000",i.id="nav_back",g.push(i),e.clipping_id="nav_clipping"+(new Date).getTime();var k=document.createElementNS(a,"clipPath");k.id=e.clipping_id;var l=i.cloneNode();l.removeAttribute("id"),l.removeAttribute("opacity"),l.setAttribute("x","0"),l.setAttribute("width",""+(parseInt(l.getAttribute("width"))-10)),l.removeAttribute("style"),l.setAttribute("height","10000"),d.insertBefore(k,d.firstChild),k.appendChild(l);var m=d.crossed_circle(f-(10+11*b),12*b,10*b);m.style.cursor="pointer","undefined"!=typeof matchMedia&&(this.win()||window).matchMedia("print").addListener(function(a){a.matches?(m.setAttribute("display","none"),n.setAttribute("display","none")):(m.setAttribute("display","block"),n.setAttribute("display","none"))}),h.push(m);var n=MASCP.IE?d.svgbutton(10,5,65,25,"Edit"):d.button(10,5,65,25,"Edit");n.id="controls",n.parentNode.setAttribute("clip-path","url(#"+e.clipping_id+")"),g.push(MASCP.IE?n:n.parentNode),n.addEventListener("click",function(){bean.fire(e,"toggleEdit"),bean.fire(e,"click")},!1),g.setAttribute("style","transition: all 0.25s;");var o=n.getAttribute("style"),p=""+(f-(10+11*b))+"px "+12*b+"px;",q=" -webkit-transform-origin: "+p+" -ms-transform-origin: "+p+" -moz-transform-origin: "+p+" transform-origin: "+p,r=function(a,b){var c=" translate3d("+a+"px,0px,0px)";return b&&(c=c+" rotate("+b+")"),"-webkit-transform:"+c+"; -moz-transform:"+c+"; -ms-transform:"+c.replace("3d","").replace(",0px)",")")+"; transform: "+c+";"};n.setAttribute("style",o+" transition: all 0.25s;"),m.setAttribute("style","transition: all 0.25s; "+q);var s=!0,t=function(a,c){s=a===!1||a===!0?a:!s;var d,f=c?"transition: all ease-in-out 0.4s;":"";return s?(e.promote(),g.setAttribute("visibility","visible"),g.setAttribute("style",f+r(0)),n.setAttribute("style",o+" "+f),m._button.removeAttribute("filter"),("ontouchend"in window||window.getComputedStyle(m).getPropertyValue("-ms-transform"))&&(d=m.getAttribute("transform")||" ",d=d.replace(/translate\(.*\)/,""),d=d.replace(/rotate\(.*\)/,""),m.setAttribute("transform",d)),m.setAttribute("style",f+r(0)+q),e.refresh()):(e.demote(),m.setAttribute("style",f+q+r(-.75*e.nav_width_base,"405deg")),"ontouchend"in window||window.getComputedStyle(m).getPropertyValue("-ms-transform")?(d=m.getAttribute("transform")||" ",d=d+" translate("+-.75*e.nav_width_base+",0) rotate(45,"+(e.nav_width_base-(10+11*b))+","+12*b+") ",m.setAttribute("transform",d),g.setAttribute("visibility","hidden")):(g.setAttribute("style",f+r(-1*e.nav_width*e.zoom)),n.setAttribute("style",o+" "+f+r(-1*e.nav_width*e.zoom)))),!0};e.hide=function(a){t.call(this,!1,a)},e.show=function(a){t.call(this,!0,a)},e.visible=function(){return s},e.setZoom=function(a){e.nav_width=e.nav_width_base/a,m.setAttribute("transform","scale("+a+","+a+") ");var c=""+(e.nav_width_base-(10+11*b))+"px "+12*b+"px;";q=" -webkit-transform-origin: "+c+" -ms-transform-origin: "+c+" -moz-transform-origin: "+c+" transform-origin: "+c,m.move(e.nav_width_base-(10+11*b),12*b),i.setAttribute("transform","scale("+a+",1) "),i.setAttribute("ry",j[1].toString()),i.setAttribute("rx",(j[0]/a).toString()),i.setAttribute("x",parseInt(-10/a).toString()),i.setAttribute("width",e.nav_width.toString()),e.zoom=a,t.call(this,s),e.refresh()},m.addEventListener("click",function(){s?e.hide(!0):e.show(!0)},!1)},h=function(a,d){var e,f,g,h=this,i=0;SVGCanvas(a),a.setAttribute("preserveAspectRatio","xMinYMin meet");var j=[];h.reset=function(){for(;a.firstChild;)a.removeChild(a.firstChild);j=[],k=[]};var k=[];h.isEditing=function(){return g},h.refresh=function(){if((e||[]).forEach(function(a){a.setAttribute("visibility",g?"visible":"hidden")}),(f||[]).forEach(function(a){a.setAttribute("visibility",g?"hidden":"visible")}),g?l.call(this,!0):l.call(this,!1),"none"!=a.getAttribute("display")&&"none"!=a.style.display&&!(k.length<1)){var b=a.ownerSVGElement.getElementById("nav_back"),c=b.getScreenCTM().inverse().multiply(a.getScreenCTM()).inverse(),d=b.getBBox().width+b.getBBox().x,h=a.createSVGPoint();h.x=d,h.y=0,i=h.matrixTransform(c).x,k.forEach(function(a){var b=0;try{b=a.getBBox().width}catch(c){}if(b>0){var d=/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/.exec(a.getAttribute("transform")||"");if("undefined"==typeof d)return;d=d[2];var e=i-1.5*parseInt(a.getAttribute("width"),10);a.setAttribute("transform","translate("+e+","+d+")")}})}};var l=function(a){j&&(j||[]).forEach(function(b){b.setAttribute("opacity",a?"1":c?"0.5":"0.1"),b.setAttribute("pointer-events",a?"all":"none"),a?b.parentNode.setAttribute("dragenabled","true"):b.parentNode.removeAttribute("dragenabled")})};bean.add(h,"toggleEdit",function(){g="undefined"==typeof g?!0:!g,d.disabled=!g,l.call(h,g),h.hide(),h.show(),(e||[]).forEach(function(a){a.setAttribute("visibility",g?"visible":"hidden")}),(f||[]).forEach(function(a){a.setAttribute("visibility",g?"hidden":"visible")})}),this.setViewBox=function(b){a.setAttribute("viewBox",b)},a.style.height="100%",a.style.width="100%",a.setAttribute("height","100%"),a.setAttribute("width","100%"),this.renderTrack=function(g,l,m,n){var o=a.group(),p=a.rect(0,l,"100%",m);p.setAttribute("stroke","#000000"),p.setAttribute("stroke-width","2"),p.setAttribute("fill","url(#simple_gradient)"),p.setAttribute("opacity",c?"0.5":"0.1"),p.setAttribute("pointer-events","none"),j=j||[],j.push(p),o.push(p);var q=n&&n["font-scale"]?n["font-scale"]:1,r=4/3*b*m*q,s=a.text(r,l+.5*m,g.fullname||g.name);s.setAttribute("height",m),s.setAttribute("width",m),s.setAttribute("font-size",.6*m*q),s.setAttribute("fill","#ffffff"),s.setAttribute("stroke","#ffffff"),s.setAttribute("stroke-width","0"),s.firstChild.setAttribute("dy","0.5ex"),o.push(s),s.setAttribute("pointer-events","none");var t;if(g.href){a_anchor=a.a(g.href);var u=null,v=[.5*m*q,0,m*q*b];v[1]=-.5*(v[2]-m),t=a.circle(v[0]+.5*v[2],.5*m,.5*v[2]),t.setAttribute("fill","#ffffff"),t.setAttribute("opacity","0.1"),a_anchor.appendChild(t);var w=g.href;"string"==typeof w&&w.match(/^javascript\:/)?u="#plus_icon":"function"==typeof w?(u="#plus_icon",a_anchor.setAttribute("href","#"),a_anchor.removeAttribute("target"),a_anchor.addEventListener("click",function(a){return w.call(),a.preventDefault?a.preventDefault():a.returnResult=!1,a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,!1},!1)):u="#new_link_icon",g.icon&&(u=g.icon);var x=a.use(u,v[0],v[1],v[2],v[2]);x.style.cursor="pointer",a_anchor.appendChild(x),a_anchor.setAttribute("transform","translate("+(i-1.5*v[2])+","+l+")"),a_anchor.setAttribute("width",v[2].toString()),k.push(a_anchor)}if(o.addEventListener("touchstart",function(){o.onmouseover=void 0,o.onmouseout=void 0},!1),o.addEventListener("touchend",function(){o.onmouseover=void 0,o.onmouseout=void 0},!1),d.call(this,p,o,g,a),function(){if(!g.group){var c=.5*m*b;e||(e=[]);var f=a.crossed_circle(1.5*c,0,c);f.setAttribute("transform","translate(0,"+(l+.5*m)+") scale("+q+")"),f.firstChild.setAttribute("fill","url(#red_3d)");for(var h=f.childNodes,i=0,j=h.length;j>i;i++)h[i].setAttribute("stroke-width",(c/4).toString());f.addEventListener("click",function(){d.spliceFunction(g)},!1),o.push(f),e.push(f),f.setAttribute("visibility","hidden")}}(),this.isController(g)){f||(f=[]);var y=.5*m*b,z=a.group();t=a.circle(1.5*y,0,y),t.setAttribute("fill","#ffffff"),t.setAttribute("opacity","0.1"),z.push(t);var A=[1.1*y,-1.25*y,2.25*y,-.5*y,1.1*y,.25*y];A[1]+=.5*(y-0*m),A[3]+=.5*(y-0*m),A[5]+=.5*(y-0*m);var B=a.poly(""+A[0]+","+A[1]+" "+A[2]+","+A[3]+" "+A[4]+","+A[5]);this.isControllerExpanded(g)?z.setAttribute("transform","translate(0,"+(l+.5*m)+") scale("+q+") rotate(90,"+1.5*y+","+A[3]+")"):z.setAttribute("transform","translate(0,"+(l+.5*m)+") scale("+q+")"),B.setAttribute("height",1.75*y),B.setAttribute("font-size",1.5*y),B.setAttribute("fill","#ffffff"),B.setAttribute("pointer-events","none"),z.push(B),z.style.cursor="pointer",z.addEventListener("click",function(a){a.stopPropagation(),bean.fire(g,"_expandevent"),h.isControllerExpanded(g)?z.setAttribute("transform","translate(0,"+(l+.5*m)+") scale("+q+") rotate(90,"+1.5*y+","+A[3]+")"):z.setAttribute("transform","translate(0,"+(l+.5*m)+") scale("+q+")")},!1),o.push(z),f.push(z),z.setAttribute("visibility","hidden")}}};return d}(),"undefined"==typeof MASCP&&(MASCP={}),"undefined"==typeof MASCP.TagVisualisation&&(MASCP.TagVisualisation={}),MASCP.TagVisualisation=function(a,b){this.datasetName=a,this._buildRichTableView(b)},MASCP.TagVisualisation.prototype={__class__:MASCP.TagVisualisation,visualisations:null,datasetName:"",tagColumn:""},MASCP.TagVisualisation.prototype._buildRichTableView=function(a){var b=this.datasetName,c=document.getElementById(b);if(c.getAttributeNS){var d=parseInt(c.getAttributeNS("MASCP.TagVisualisation","tagcolumn"),10);this.tagColumn=d?d:this._getTagColumn()}else this.tagColumn=this._getTagColumn();var e=c.parentNode,f=null;if("BODY"==e.nodeName){f=e;var g=document.createElement("div");c.parentNode.replaceChild(g,c),g.appendChild(c),e=c.parentNode}else f=e.parentNode;this._dataTableContainer=e;var h=this._buildRichTagInfoContainer(e);f.insertBefore(h,e),this._displayElement=h;for(var i=0;i<a.length;i++)this.addVisualisation(new a[i](this));c.old_style=c.style.display,c.style.display="none"},MASCP.TagVisualisation.prototype._getDisplayWidth=function(a){var b;return void 0!==window.getComputedStyle?b=getComputedStyle(a,""):void 0!==document.defaultView.getComputedStyle&&(b=document.defaultView.getComputedStyle(a,"")),void 0!==b?parseInt(b.getPropertyValue("width").replace(/px/,""),10):void 0},MASCP.TagVisualisation.prototype._buildRichTagInfoContainer=function(a){var b=document.createElement("div");return b.setAttribute("id","rich_"+this.datasetName),b.setAttribute("class","rich_as_data "+a.className),b.style.width=a.style.width,b.style.height=a.style.height,b.style.display=a.style.display,b.style.position=a.style.position,b},MASCP.TagVisualisation.prototype.toggleTagView=function(){var a=document.getElementById(this.datasetName);"none"==a.style.display?(a.style.display=a.old_style,this.getDisplayElement().style.display="none"):(a.style.display="none",this.getDisplayElement().style.display="block")},MASCP.TagVisualisation.prototype.getDisplayElement=function(){return this._displayElement},MASCP.TagVisualisation.prototype.addVisualisation=function(a){this.visualisations||(this.visualisations=[]),this.getDisplayElement().appendChild(a.getDisplayElement()),this.visualisations.push(a)},MASCP.TagVisualisation.prototype.getAllTags=function(){for(var a=document.getElementById(this.datasetName),b=a.getElementsByTagName("tbody")[0].getElementsByTagName("tr"),c={},d=0;d<b.length;d++)tagname=b[d].getElementsByTagName("td")[this.tagColumn].childNodes[0].data,c[b[d].id]=tagname;return c},MASCP.TagVisualisation.prototype._getTagColumn=function(){for(var a=document.getElementById(this.datasetName),b=a.getElementsByTagName("thead")[0].getElementsByTagName("tr")[0].getElementsByTagName("th"),c=0;c<b.length;c++)if("tag"==b[c].childNodes[0].data.toLowerCase())return c;return 1},MASCP.TagVisualisation.prototype._getColumnCount=function(){var a=document.getElementById(this.datasetName),b=a.getElementsByTagName("thead")[0].getElementsByTagName("tr")[0].getElementsByTagName("th");return b.length-this._getTagColumn()-1},void 0===typeof MASCP.TagVisualisation.TagCloud&&(MASCP.TagVisualisation.TagCloud={}),MASCP.TagVisualisation.TagCloud=function(a){this._tagVisualiser=a,this._initElements()},MASCP.TagVisualisation.TagCloud.prototype={__class__:MASCP.TagVisualisation.TagCloud},MASCP.TagVisualisation.TagCloud.ELEMENT_CSS_CLASS="rich_tagcloud",MASCP.TagVisualisation.TagCloud.ELEMENT_ID_PREFIX="rich_tagcloud_",MASCP.TagVisualisation.TagCloud.TAG_ELEMENT_CSS_CLASS="rich_tagcloud_tag",MASCP.TagVisualisation.TagCloud.TAG_ELEMENT_ID_PREFIX="rich_tagcloud_tag_",MASCP.TagVisualisation.TagCloud.prototype._initElements=function(){return this._displayElement=document.createElement("div"),this._displayElement.setAttribute("id",MASCP.TagVisualisation.TagCloud.ELEMENT_ID_PREFIX+this._tagVisualiser.datasetName),this._displayElement.setAttribute("class",MASCP.TagVisualisation.TagCloud.ELEMENT_CSS_CLASS),this._displayElement},MASCP.TagVisualisation.TagCloud.prototype.getDisplayElement=function(){return this._displayElement},MASCP.TagVisualisation.TagCloud.prototype.update=function(a){var b,c=this.getDisplayElement(),d=document.getElementById(this._tagVisualiser.datasetName),e={},f={},g=d.getElementsByTagName("tbody")[0].getElementsByTagName("tr"),h=0,i=[];
for(b=0;b<g.length;b++){var j=g[b].getElementsByTagName("td"),k=parseFloat(j[this._tagVisualiser.tagColumn+a].childNodes[0].data);if(0!==j[this._tagVisualiser.tagColumn].childNodes.length){var l=j[this._tagVisualiser.tagColumn].childNodes[0].data;e[l]=k,f[l]=j,h=Math.max(h,k),i[b]=l}}for(i.sort(),b=0;b<i.length;b++){var m=i[b];if(m){var n,o=m.replace(/\s+/,"_");null!==document.getElementById(MASCP.TagVisualisation.TagCloud.TAG_ELEMENT_ID_PREFIX+o)&&(n=document.getElementById(MASCP.TagVisualisation.TagCloud.TAG_ELEMENT_ID_PREFIX+o),n.parentNode.removeChild(n)),n=this.tagFactory(o,m,f[m]),c.appendChild(n);var p=Math.floor(30*Math.log(1.5+e[m]/h));n.style.fontSize=p+"px",n.setAttribute("class",MASCP.TagVisualisation.TagCloud.TAG_ELEMENT_CSS_CLASS)}}if(!c.hasSpacer){var q=document.createElement("div");q.setAttribute("class","spacer"),q.setAttribute("style","width: 100%; height: 0px; clear: both;"),c.appendChild(q),c.hasSpacer=!0}},MASCP.TagVisualisation.TagCloud.prototype.tagFactory=function(a,b,c){var d=document.createElement("span");return d.setAttribute("id",MASCP.TagVisualisation.TagCloud.TAG_ELEMENT_ID_PREFIX+a),d.textContent=b,d},"undefined"!=typeof document&&"registerElement"in document&&!function(){var a=function(){var a=Object.create(HTMLElement.prototype,{sequence:{set:function(a){this.renderer.setSequence(a)},get:function(){return this.renderer.sequence}},trackmargin:{set:function(a){this.renderer.trackGap=a+4},get:function(a){return this.renderer.trackGap-4}},zoom:{set:function(a){this.zoomval=a,"auto"===a?(this.renderer.enablePrintResizing(),this.renderer.fitZoom()):null!==a&&"null"!==a&&(this.renderer.disablePrintResizing(),this.renderer.zoom=parseFloat(a),this.zoomval=parseFloat(a))},get:function(a){return this.renderer.zoom}}});return a.createdCallback=function(){var a=this,b=this.createShadowRoot();b.appendChild(b.ownerDocument.createElement("div")),this.style.display="block",b.firstChild.style.overflow="hidden",a.renderer=new MASCP.CondensedSequenceRenderer(b.firstChild);var c=new GOMap.Diagram.Dragger;b.appendChild(b.ownerDocument.createElement("style")),b.lastChild.textContent="[dragenabled] { cursor: move; cursor: -webkit-grab; cursor: -moz-grab; cursor: grab; }\n[dragging] { cursor: move; cursor: -webkit-grabbing; cursor: -moz-grabbing; cursor: grabbing; }",Object.defineProperty(c,"enabled",{get:function(){return this._enabled},set:function(b){a.renderer._canvas&&(b?a.renderer._canvas.setAttribute("dragenabled","true"):a.renderer._canvas.removeAttribute("dragenabled")),this._enabled=b}}),c.enabled=!0;var d=b.ownerDocument.createElement("div");d.style.height="24px",b.appendChild(d),a.renderer.getVisibleLength=function(){return this.rightVisibleResidue()-this.leftVisibleResidue()},a.renderer.getTotalLength=function(){return this.sequence.length},a.renderer.getLeftPosition=function(){return this.leftVisibleResidue()},a.renderer.setLeftPosition=function(a){return this.setLeftVisibleResidue(a)},Object.defineProperty(this.renderer,"grow_container",{get:function(){return"auto"==a.style.overflow},set:function(){}}),Object.defineProperty(a,"interactive",{get:function(){return!!a.getAttribute("interactive")},set:function(a){e.enabled=a}}),Object.defineProperty(this.renderer,"selecting",{get:function(){return!c.enabled},set:function(a){return c.enabled=!a,a}});var e={enabled:a.interactive},f=new MutationObserver(function(){a.renderer.grow_container?c.enabled=!0:(c.enabled=!1,a.renderer.setLeftVisibleResidue(0)),a.renderer.refresh()});f.observe(a,{attributes:!0,attributeFilter:["style"]}),this.getAttribute("zoom")?this.zoom=this.getAttribute("zoom"):this.setAttribute("zoom","auto"),this.getAttribute("trackmargin")&&(this.trackmargin=parseInt(this.getAttribute("trackmargin"))),this.renderer.bind("sequenceChange",function(){c.applyToElement(a.renderer._canvas),c.enabled=a.renderer.grow_container,GOMap.Diagram.addScrollBar(a.renderer,a.renderer._canvas,d),c.addTouchZoomControls(a.renderer,a.renderer._canvas,e),GOMap.Diagram.addScrollZoomControls.call(e,a.renderer,a.renderer._canvas,.001),a.setAttribute("sequence",a.renderer.sequence),"auto"==a.zoomval&&a.renderer.fitZoom()}),this.renderer.bind("zoomChange",function(){"auto"!==a.zoomval&&a.setAttribute("zoom",a.renderer.zoom)}),a.getAttribute("sequence")&&(a.sequence=a.getAttribute("sequence"))},a.attributeChangedCallback=function(a,b,c){"sequence"==a&&this.sequence!==c&&(this.sequence=c),"zoom"==a&&this.zoomval!==c&&(this.zoom=c),"trackmargin"==a&&this.trackmargin!==c&&(this.trackmargin=parseInt(c)),"interactive"==a&&(this.interactive=!!c)},document.registerElement("gator-viewer",{prototype:a}),a}(),b=function(a,b){var c=new a;return b&&MASCP.Service.BeginCaching(c),c},c=function(a,b){var c=document.createEvent("Events");c.initEvent(b,!1,!0),a.dispatchEvent(c)},d=function(){var d=document.registerElement("gator-uniprot",{prototype:Object.create(a,{createdCallback:{value:function(){a.createdCallback.apply(this),this.getAttribute("caching")&&(this.caching=this.getAttribute("caching")),this.getAttribute("auto")&&(this.auto=this.getAttribute("auto")),this.getAttribute("accession")&&(this.accession=this.getAttribute("accession"))}},attributeChangedCallback:{value:function(b,c,d){a.attributeChangedCallback.call(this,b,c,d),"accession"==b&&this.accession!==d&&(this.accession=d),"auto"==b&&(d&&!this.auto?this.auto=!0:!d&&this.auto&&(this.auto=!1)),"caching"==b&&(d&&!this.caching?this.caching=d:!d&&this.caching&&(this.caching=!1))}},auto:{get:function(){return this.autoRun},set:function(a){this.autoRun=a}},accession:{set:function(a){var b=this;b.acc=a,b.setAttribute("accession",a),b.auto&&b.go()},get:function(){return this.acc}},go:{value:function(){var a=this;MASCP.ready=function(){b(MASCP.UniprotReader,a.caching).retrieve(a.accession,function(b){b||(a.renderer.bind("sequenceChange",function(){a.renderer.unbind("sequenceChange",arguments.callee),c(a,"ready")}),a.renderer.setSequence(this.result.getSequence()))})}}},caching:{set:function(a){a?(this.cachingval=!0,this.setAttribute("caching",!0)):this.removeAttribute("caching")},get:function(){return this.cachingval}}})});return d.prototype}();(function(){var a=document.registerElement("gator-gene",{prototype:Object.create(d,{createdCallback:{value:function(){d.createdCallback.apply(this),this.renderer.hide_axis=!0,this.getAttribute("exonmargin")&&(this.exonmargin=parseInt(this.getAttribute("exonmargin")))}},attributeChangedCallback:{value:function(a,b,c){d.attributeChangedCallback.call(this,a,b,c),"geneid"==a&&this.geneid!==c&&(this.geneid=c),"exonmargin"==a&&this.exonmargin!=c&&(this.exonmargin=parseInt(c),this._genomereader&&(this._genomereader.exon_margin=this.exonmargin,this.renderer.refreshScale(),"auto"==this.getAttribute("zoom")&&this.renderer.fitZoom()))}},accession:{set:function(a){this.acc=a,a?this.setAttribute("accession",a):this.removeAttribute("accession")},get:function(){return this.acc}},go:{value:function(){var a=this;a.renderer.trackOrder=[],a.renderer.reset();var d=a.getAttribute("zoom")||"auto";a.removeAttribute("zoom"),a.renderer.bind("sequenceChange",function(){a.renderer.unbind("sequenceChange",arguments.callee);var e=b(MASCP.GenomeReader,a.caching);e.geneid=a.geneid,e.exon_margin=a.exonmargin,a.nt_mapping&&(e.nt_mapping=a.nt_mapping),a._genomereader=e,e.registerSequenceRenderer(a.renderer),e.bind("requestComplete",function(){a.renderer.hideAxis(),a.setAttribute("zoom",d),c(a,"ready")}),e.retrieve(a.accession||""+a.geneid)}),MASCP.ready=function(){a.renderer.setSequence("M")}}},geneid:{set:function(a){var b=this;b.ncbigene=a,b.setAttribute("geneid",a),b.auto&&b.go()},get:function(){return this.ncbigene}}})});return a.prototype})()}();