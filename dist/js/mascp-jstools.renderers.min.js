if("undefined"==typeof MASCP){MASCP={};var ie=function(){var a,b=3,c=document.createElement("div"),d=c.getElementsByTagName("i");do c.innerHTML="<!--[if gt IE "+ ++b+"]><i></i><![endif]-->";while(d[0]);return b>4?b:a}();ie&&(7===ie&&(MASCP.IE=!0,MASCP.IE7=!0),8===ie&&(MASCP.IE=!0,MASCP.IE8=!0))}MASCP.registerGroup=function(a,b){if(this.groups||(this.groups={}),!this.groups[a]){var c=new MASCP.Group;if(c.name=a,b=b||{},b.hide_member_controllers&&(c.hide_member_controllers=!0),b.hide_group_controller&&(c.hide_group_controller=!0),b.fullname&&(c.fullname=b.fullname),b.color&&(c.color=b.color),b.group){if(c.group=this.getGroup(b.group),!c.group)throw"Cannot register this layer with the given group - the group has not been registered yet";c.group._layers.push(c)}return c._layers=[],c.group_id=(new Date).getMilliseconds(),this.groups[a]=c,bean.fire(MASCP,"groupRegistered",[c]),c}},MASCP.registerLayer=function(a,b){if(this.layers||(this.layers={}),this.layers[a])return this.layers[a].disabled&&(this.layers[a].disabled=!1,bean.fire(MASCP,"layerRegistered",[this.layers[a]])),this.layers[a];var c=new MASCP.Layer;if(c.name=a,b=b||{},b.fullname&&(c.fullname=b.fullname),b.color&&(c.color=b.color),b.group){if(c.group=this.getGroup(b.group),!c.group)throw"Cannot register this layer with the given group - the group has not been registered yet";c.group._layers.push(c)}return b.data&&(c.data=b.data),this.layers[a]=c,b.css&&(layerCss=b.css,layerCss=layerCss.replace(/\.inactive/g,"."+a+"_inactive ."+a),layerCss=layerCss.replace(/\.tracks\s+\.active/g,"."+a+"_active .track ."+a),layerCss=layerCss.replace(/\.active/g,"."+a+"_active ."+a),layerCss=layerCss.replace(/\.overlay/g,"."+a+"_overlay"),jQuery('<style type="text/css">'+layerCss+"</style>").appendTo("head")),c.layer_id=(new Date).getMilliseconds(),bean.fire(MASCP,"layerRegistered",[c]),c},MASCP.Group=function(){},MASCP.Group.prototype.size=function(){for(var a=0,b=0;b<this._layers.length;b++)this._layers[b].disabled||(a+=1);return a},MASCP.Group.prototype.eachLayer=function(a){for(var b=0;b<this._layers.length;b++)this._layers[b].disabled||a.call(this._layers[b],this._layers[b])},MASCP.Layer=function(){},MASCP.SequenceRenderer=function(){var a=function(a){var b=[],c={getTrackOrder:function(){return b},setTrackOrder:function(a){var c=[],d=a;!d instanceof Array&&(d=[a]);for(var e=0;e<d.length;e++){var f=d[e];MASCP.getLayer(f)?c.push(f):MASCP.getGroup(f)&&MASCP.getGroup(d[e]).eachLayer(function(a){d.splice(e+1,0,a.name)})}for(e=(b||[]).length-1;e>=0;e--)c.indexOf(b[e])<0&&(this.hideLayer(b[e]),this.hideGroup(b[e]),jQuery(MASCP.getLayer(b[e])).trigger("removed"),jQuery(MASCP.getGroup(b[e])).trigger("removed"));b=c,this.refresh&&this.refresh(!0)}};a.__defineSetter__&&(a.__defineSetter__("trackOrder",c.setTrackOrder),a.__defineGetter__("trackOrder",c.getTrackOrder)),MASCP.IE&&(a.setTrackOrder=c.setTrackOrder),"function"==typeof Object.defineProperty&&MASCP.IE&&!MASCP.IE8&&Object.defineProperty(a,"trackOrder",{get:c.getTrackOrder,set:c.setTrackOrder})};return function(b){return"undefined"!=typeof b&&(this._container=b,this._container.style.position="relative",jQuery(this).bind("sequenceChange",function(a){jQuery(b).text(""),jQuery(b).append(this._sequence_els),jQuery(b).append(jQuery('<div style="clear: both; float: none; height: 0px; width: 100%;"></div>')),b.style.width=this._sequence_els.length+"em"}),this.setSequence(jQuery(b).text())),a(this),this}}(),MASCP.SequenceRenderer.prototype={sequence:null},MASCP.IE&&(MASCP.SequenceRenderer.prototype.prototype=document.createElement("div")),MASCP.SequenceRenderer.prototype.setSequence=function(a){this.sequence=this._cleanSequence(a);var b=[],c=this;if(this.sequence){for(var d=this.sequence.split(""),e=0;e<d.length;e++){var f=d[e];f.match(/[A-Za-z]/)&&b.push(jQuery("<span>"+f+"</span>")[0])}jQuery(b).each(function(a){this._index=a,this.style.display="block",this.style.cssFloat="left",this.style.styleFloat="left",this.style.height="1.1em",this.style.position="relative",this.addToLayer=MASCP.SequenceRenderer.addElementToLayer,this.addBoxOverlay=MASCP.SequenceRenderer.addBoxOverlayToElement,this.addToLayerWithLink=MASCP.SequenceRenderer.addElementToLayerWithLink,this._renderer=c}),this._sequence_els=b,jQuery(this).trigger("sequenceChange")}},MASCP.SequenceRenderer.prototype.colorResidues=function(a,b){var c=Math.floor(1e3*Math.random()).toString();MASCP.registerLayer(c,{color:b||"#ff0000"});for(var d=this.getAminoAcidsByPosition(a),e=0;e<d.length;e++)d[e].addToLayer(c);return MASCP.getLayer(c)},MASCP.SequenceRenderer.prototype._cleanSequence=function(a){if(!a)return a;var b=a;return b=b.replace(new RegExp(String.fromCharCode(160),"g"),""),b=b.replace(/[\n\t\s\d]+/gim,""),b=b.replace(/\(.*\)/g,"")},MASCP.SequenceRenderer.prototype.getAminoAcidsByPosition=function(a){var b=this._sequence_els;return jQuery.map(a,function(a){return b[a-1]})},MASCP.SequenceRenderer.prototype.getAA=function(a){return this.getAminoAcidsByPosition([a]).shift()},MASCP.SequenceRenderer.prototype.getAminoAcidsByPeptide=function(a){var b=this.sequence.indexOf(a),c=[];return b<0?(c.addToLayer=function(){},c):(c=c.concat(this._sequence_els.slice(b,b+a.length)),c.length?c.addToLayer=function(a,b){return c[0].addBoxOverlay(a,c.length,b)}:c.addToLayer=function(){},c)},MASCP.SequenceRenderer.prototype.showRowNumbers=function(){var a=jQuery('<div style="position: absolute; top: 0px; left: 0px; width: 2em;"></div>');return jQuery(this._sequence_els).each(function(b){b%50===0&&(this.style.marginLeft="3em",a.append(jQuery('<div style="text-align: right; height: 1.1em;">'+(b+1)+"</div>")[0]))}),jQuery(this._container).append(a),this},MASCP.SequenceRenderer.prototype.toggleLayer=function(a,b){var c=a;return"string"!=typeof a?c=a.name:a=MASCP.layers[a],jQuery(this._container).toggleClass(c+"_active"),jQuery(this._container).toggleClass(c+"_inactive"),b||jQuery(a).trigger("visibilityChange",[this,this.isLayerActive(a)]),this},MASCP.SequenceRenderer.prototype.showLayer=function(a,b){var c=MASCP.getLayer(a);if(c&&!c.disabled)return jQuery(this._container).addClass(c.name+"_active"),jQuery(this._container).addClass("active_layer"),jQuery(this._container).removeClass(c.name+"_inactive"),b||jQuery(c).trigger("visibilityChange",[this,!0]),this},MASCP.SequenceRenderer.prototype.hideLayer=function(a,b){var c=MASCP.getLayer(a);if(c&&!c.disabled)return jQuery(this._container).removeClass(c.name+"_active"),jQuery(this._container).removeClass("active_layer"),jQuery(this._container).addClass(c.name+"_inactive"),b||jQuery(c).trigger("visibilityChange",[this,!1]),this},MASCP.SequenceRenderer.prototype.registerLayer=function(a,b){return MASCP.registerLayer(a,b)},MASCP.SequenceRenderer.prototype.setGroupVisibility=function(a,b,c){var d=MASCP.getGroup(a);if(d){var e=(d.name,this);d.eachLayer(function(a){if(MASCP.getGroup(a)!==a)return this.disabled&&b?void e.hideLayer(a.name):void(b===!0?e.showLayer(a.name):b===!1?e.hideLayer(a.name):e.toggleLayer(a.name))}),null===b||c||jQuery(d).trigger("visibilityChange",[e,b])}},MASCP.SequenceRenderer.prototype.hideGroup=function(a,b){this.setGroupVisibility(a,!1,b)},MASCP.SequenceRenderer.prototype.showGroup=function(a,b){this.setGroupVisibility(a,!0,b)},MASCP.SequenceRenderer.prototype.toggleGroup=function(a,b){this.setGroupVisibility(a,b)},MASCP.SequenceRenderer.prototype.isLayerActive=function(a){var b=a;return"string"!=typeof a&&(b=a.name),!a.disabled&&jQuery(this._container).hasClass(b+"_active")},MASCP.SequenceRenderer.prototype._setHighlight=function(a,b){},MASCP.SequenceRenderer.prototype.createLayerController=function(){var a=jQuery('<div style="position: absolute; top: 0px; font-family: Helvetica, Arial, Sans-serif; margin-left: 20px; left: 100%; width: 250px;"></div>'),b=jQuery(this._container);b.append(a),this._controllers||(this._controllers=[]),this._controllers.push(a);var c=this;if(jQuery(MASCP).bind("layerRegistered",function(b){jQuery(a).accordion("destroy"),jQuery(a).accordion({header:"h3",collapsible:!0,autoHeight:!0,active:!1})}),a.add_layer=function(a){var b=jQuery('<div><input type="checkbox"/>'+a.fullname+"</div>");a.group?jQuery(a.group._layer_container).append(b):jQuery(this).append(b),c.createLayerCheckbox(a,jQuery("input",b)[0])},a.add_group=function(a){var b=jQuery('<h3><input style="margin-left: 25px;" type="checkbox"/>'+a.fullname+"</h3>");jQuery(this).append(b);var d=jQuery('<div style="max-height: 200px; overflow: auto;"></div>');jQuery(this).append(d),a._layer_container=d[0],a._controller=b,a._check_intermediate=function(){var d=0;jQuery(a._layers).each(function(a){c.isLayerActive(this.name)&&d++});var e=jQuery("input",b)[0];e.indeterminate=0!==d&&d!=a._layers.length,e.indeterminate||(e.checked=0!==d)},jQuery(jQuery("input",b)[0]).bind("mouseup",function(a){this.indeterminate&&jQuery(this).trigger("change")}),c.createGroupCheckbox(a,jQuery("input",b)[0])},bean.add(MASCP,"layerRegistered",function(b,c){c.group&&c.group.hide_member_controllers||a.add_layer(c)}),bean.add(MASCP,"groupRegistered",function(b,c){c.hide_group_controller||a.add_group(c)}),MASCP.layers)for(var d in MASCP.layers)if(MASCP.layers.hasOwnProperty(d)){var e=MASCP.layers[d];if(e.group&&e.group.hide_member_controllers)continue;a.add_layer(e)}return this},MASCP.SequenceRenderer.prototype.createLayerCheckbox=function(a,b,c){var d=this;if(MASCP.layers[a]){var e=null;if("string"==typeof a&&MASCP.layers?e=MASCP.layers[a]:"object"==typeof a&&(e=a),e){var f=b||jQuery('<input type="checkbox" value="true"/>')[0];f._current_bindings=f._current_bindings||[],c&&this._removeOtherBindings(e,f);for(var g=0;g<f._current_bindings.length;g++)if(f._current_bindings[g].layer==a&&f._current_bindings[g].renderer==d)return;f.removeAttribute("checked"),f.checked=this.isLayerActive(a);var h=null;e&&0===f._current_bindings.length&&(h=function(a,b,c){b==d&&(c?f.checked=c:(f.checked=!1,f.removeAttribute("checked")))},jQuery(e).bind("visibilityChange",h),f.parentNode&&f.parentNode.insertBefore(jQuery('<div style="position: relative; left: 0px; top: 0px; float: left; background-color: '+e.color+'; width: 1em; height: 1em;"></div>')[0],f));var i=function(b){this.checked&&d.showLayer(a,!1),MASCP.getLayer(a).group&&MASCP.getLayer(a).group._check_intermediate&&MASCP.getLayer(a).group._check_intermediate()};return jQuery(f).bind(MASCP.IE?"click":"change",i),f._current_bindings.push({layer:a,renderer:d,input_function:i,object_function:h}),f}}},MASCP.getLayer=function(a){if(MASCP.layers)return"string"==typeof a?MASCP.layers[a]:a},MASCP.getGroup=function(a){if("undefined"!=typeof a&&MASCP.groups)return"string"==typeof a?MASCP.groups[a]:a==MASCP.groups[a.name]?a:null},MASCP.SequenceRenderer.prototype._removeOtherBindings=function(a,b){for(var c=this,d=0;d<b._current_bindings.length;d++)if(b._current_bindings[d].renderer==c){var e=b._current_bindings[d];e.layer&&e.layer!=a.name&&(jQuery(MASCP.getLayer(e.layer)).unbind("visibilityChange",e.object_function),jQuery(b).unbind("change",e.input_function)),e.group&&e.group!=a.name&&(jQuery(MASCP.getGroup(e.group)).unbind("visibilityChange",e.object_function),jQuery(b).unbind("change",e.input_function)),e.group=null,e.layer=null}},MASCP.SequenceRenderer.prototype.createGroupCheckbox=function(a,b,c){var d=this,e=b?jQuery(b):jQuery('<input type="checkbox" value="true"/>'),f=MASCP.getGroup(a);if(f){e[0]._current_bindings=e[0]._current_bindings||[],c&&this._removeOtherBindings(f,e[0]);for(var g=0;g<e[0]._current_bindings.length;g++)if(e[0]._current_bindings[g].group==a&&e[0]._current_bindings[g].renderer==d)return;e[0].removeAttribute("checked");var h=function(b){group_obj=MASCP.getGroup(a),group_obj&&(this.checked?jQuery(group_obj._layers).each(function(a){d.showLayer(this.name,!1)}):jQuery(group_obj._layers).each(function(a){}))};e.bind(MASCP.IE?"click":"change",h);var i=null;return f&&0===e[0]._current_bindings.length&&(i=function(a,b,c){b==d&&(e[0].checked=c,c||e[0].removeAttribute("checked"))},jQuery(MASCP.getGroup(a)).bind("visibilityChange",i),e[0].parentNode&&e[0].parentNode.insertBefore(jQuery('<div style="position: relative; left: 0px; top: 0px; float: left; background-color: '+f.color+'; width: 1em; height: 1em;"></div>')[0],e[0])),e[0]._current_bindings.push({group:a,renderer:d,input_function:h,object_function:i}),e.bind("click",function(a){a.stopPropagation()}),e}},MASCP.SequenceRenderer.prototype.createGroupController=function(a,b){var c=MASCP.getLayer(a),d=MASCP.getGroup(b),e=this;jQuery(c).bind("visibilityChange",function(a,b,c){b==e&&(e.setGroupVisibility(d,c),e.refresh())})},MASCP.SequenceRenderer.addElementToLayer=function(a){return this.addBoxOverlay(a,1),this},MASCP.SequenceRenderer.addElementToLayerWithLink=function(a,b,c){jQuery(this).addClass(a);for(var d=jQuery(this).append(jQuery('<a href="'+b+'" class="'+a+'_overlay" style="display: box; left: 0px; top: 0px; width: 100%; position: absolute; height: 100%;">&nbsp;</a>'))[0];c&&c>0;)this._renderer._sequence_els[this._index+c].addToLayerWithLink(a,b),c-=1;return this._z_indexes&&this._z_indexes[a]&&(d.style.zIndex=this._z_indexes[a]),this},MASCP.SequenceRenderer.addBoxOverlayToElement=function(a,b,c){"undefined"==typeof c&&(c=1),jQuery(this).addClass(a);for(var d=jQuery(this).append(jQuery('<div class="'+a+'_overlay" style="top: 0px; width: 100%; position: absolute; height: 100%; opacity:'+c+';"></div>'))[0];b&&b>1;)this._renderer._sequence_els[this._index+b-1].addBoxOverlay(a,0,c),b-=1;this._z_indexes&&this._z_indexes[a]&&(d.style.zIndex=this._z_indexes[a]);for(var e=["mouseover","mousedown","mousemove","mouseout","click","dblclick","mouseup","mouseenter","mouseleave"],f=0;f<e.length;f++)jQuery(d).bind(e[f],function(){return function(b){jQuery(MASCP.getLayer(a)).trigger(b.type,[b,"SequenceRenderer"])}}(f));return this},MASCP.SequenceRenderer.prototype.reset=function(){jQuery(this._container).attr("class",null);for(var a in MASCP.groups)MASCP.groups.hasOwnProperty(a)&&this.hideGroup(a);for(var b in MASCP.layers)MASCP.layers.hasOwnProperty(b)&&(this.hideLayer(b,!0),MASCP.layers[b].disabled=!0);this.resetAnnotations&&this.resetAnnotations()},MASCP.SequenceRenderer.prototype.withoutRefresh=function(a){var b=this.refresh;this.refresh=function(){},a.apply(this),this.refresh=b},MASCP.SequenceRenderer.prototype.refresh=function(){var a=-2;this._z_indexes||(this._z_indexes={});for(var b=0;b<(this.trackOrder||[]).length;b++)this.isLayerActive(this.trackOrder[b])&&(jQuery("."+this.trackOrder[b]+"_overlay").css("z-index",a),this._z_indexes[this.trackOrder[b]]=a,a-=1)},MASCP.SequenceRenderer.prototype.bind=function(a,b){jQuery(this).bind(a,b)},MASCP.SequenceRenderer.prototype.trigger=function(a){jQuery(this).trigger(a)};var SVGCanvas=SVGCanvas||function(){function a(a,b){var c,d,g,i,k;a.visibility=function(){for(var b="hidden",c=0;c<a.length;c++)if(k=a[c].getAttribute("visibility"),k&&"hidden"!=k){b=k;break}return b},a.currenty=function(){var b;return a[0]&&a[0].getAttribute("transform")&&(b=/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/.exec(a[0].getAttribute("transform")),"undefined"!=typeof b&&(b=b[2])),a[0]?parseInt(b||a[0].getAttribute("y")||0,10):0},a.animate=function(c){if("undefined"==typeof c.y)return void l(c);if(0!==a.length){var d,f={};for(d in c)c.hasOwnProperty(d)&&(f[d]=c[d]);if(j(),a.animating)for(var g=0;g<(e||[]).length;g++)e[g].target_set==a&&(a.animating=!1,e.splice(g,1));var i=a.visibility(),k=f.visibility;if(i==k&&"hidden"==k)return void l(c);var m=a.currenty();if(isNaN(parseInt(m,10)))return void console.log("Have a NaN y value, skipping");var n=parseInt(f.y,10);delete f.y,i==k&&"visible"==k&&(delete f.visibility,k=null,l({visibility:"visible"})),"hidden"==f.visibility&&delete f.visibility,l(f);var o=0;if(n!=m){var p=1*(Math.abs(parseInt((n-m)/(50*b),10)/h)+1),q=(n-m)/p;f.y=m||0;arguments.callee;a.animating=!0,f.y=m+1*q,e.push(function(b){return q<0&&f.y<n&&(f.y=n),q>0&&f.y>n&&(f.y=n),l(f),o+=b||1,f.y!=n?void(f.y=m+q*(o+1)):(a.animating=!1,k&&l({visibility:k}),void e.splice(e.indexOf(arguments.callee),1))}),e[e.length-1].target_set=a}}},a.attr=function(a){return f?this.animate(a):l(a)};var l=function(b){var e,f={};for(e in b)b.hasOwnProperty(e)&&(f[e]=b[e]);a.visibility(),parseInt(f.y,10);i=f.visibility;for(e in f)if(f.hasOwnProperty(e))for(var h=0;h<a.length;h++)if(a[h]){var j=f[e];if("style"==e&&a[h].hasAttribute("style")){var k=a[h].getAttribute("style");k+="; "+f[e],j=k}if("height"==e&&a[h].hasAttribute("transform")){g=a[h].getAttribute("transform");var l=/scale\((-?\d+\.?\d*)\)/.exec(a[h].getAttribute("transform")),m=parseFloat(a[h].getAttribute("height")||1),n=1;null===l?(g+=" scale(1) ",l=1):l=parseFloat(l[1]),n=parseFloat(f[e])/m*l,g=g.replace(/scale\((-?\d+\.?\d*)\)/,"scale("+n+")"),a[h].setAttribute("transform",g)}if((!a[h].hasAttribute("transform")||"y"!=e&&"x"!=e)&&a[h].setAttribute(e,j),"y"==e&&a[h].hasAttribute("d")){var o=a[h].getAttribute("d"),p=/M\s*([\d\.]+) ([\d\.]+)/;if(o=o.replace(p,""),isNaN(parseInt(j,10)))throw"Error "+e+" is "+f[e];a[h].setAttribute("d","M0 "+parseInt(j,10)+" "+o)}if("y"==e&&a[h].hasAttribute("cy")&&a[h].setAttribute("cy",f[e]),"y"==e&&a[h].hasAttribute("transform")){if(g=a[h].getAttribute("transform"),c=/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/.exec(a[h].getAttribute("transform")),null===c)continue;c=c[1],g=g.replace(/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/,"translate("+c+","+j+")"),a[h].setAttribute("transform",g)}if("x"==e&&a[h].hasAttribute("transform")){if(g=a[h].getAttribute("transform"),d=/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/.exec(a[h].getAttribute("transform")),null===d)continue;d=d[2],g=g.replace(/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/,"translate("+j+","+d+")"),a[h].setAttribute("transform",g)}}};return a.hide=function(){this.attr({visibility:"hidden"})},a.show=function(){this.attr({visibility:"visible"})},a.refresh_zoom=function(){for(var b=0;b<a.length;b++)a[b].zoom_level&&"text"==a[b].zoom_level&&(canvas.zoom>3.5?(a[b].setAttribute("display","inline"),a[b].setAttribute("opacity",1)):a[b].setAttribute("display","none")),a[b].zoom_level&&"summary"==a[b].zoom_level&&(canvas.zoom<=3.5?(a[b].setAttribute("display","inline"),a[b].setAttribute("opacity",1)):a[b].setAttribute("display","none"))},a}var b=[],c=1,d="http://www.w3.org/2000/svg",e=null,f=!1,g=null,h=75,i=null,j=function(){null===e?e=[]:(e.forEach(function(a){a._last_step=null}),clearInterval(g)),f||(b.forEach(function(a){jQuery(a).trigger("_anim_begin")}),f=!0);var a=null;g=setInterval(function(){if(!e||0===e.length)return clearInterval(g),g=null,e=null,f=!1,void b.forEach(function(a){jQuery(a).trigger("_anim_end")});var c=[];b.forEach(function(a){c.push(a.suspendRedraw(5e3))});var d=(new Date).getTime();a||(a=(new Date).getTime());for(var k=0;k<(e||[]).length;k++){var l=(new Date).getTime(),m=parseInt((l-a)/h,10);null===i&&m-e[k]._last_step>2&&(i=Math.round(1.6*h)),e[k].apply(null,[m-(e[k]._last_step||m)]),e&&e[k]&&(e[k]._last_step=m)}var n=(new Date).getTime();b.forEach(function(a){a.unsuspendRedraw(c.shift())});var o=n-d;o<h&&null===i&&o>=1?(h=Math.round(1.5*(n-d)),j()):null!==i&&i!=h&&(h=i,j())},h)};return function(e){var f=e.RS||c;e.RS=f,b.push(e),e.makeEl=function(a,b){var c=document.createElementNS(d,a);for(var e in b)b.hasOwnProperty(e)&&c.setAttribute(e,b[e]);return c},e.make_gradient=function(a,b,c,d,e){for(var f=this.makeEl("linearGradient",{id:a,x1:"0%",x2:b,y1:"0%",y2:c}),g=d.length;d.length>0;){var h=Math.round((g-d.length)/g*100),i=d.shift(),j=e.shift();f.appendChild(this.makeEl("stop",{offset:h+"%",style:"stop-color:"+i+";stop-opacity:"+j}))}return f},e.path=function(a){var b=document.createElementNS(d,"path");return b.setAttribute("d",a),b.setAttribute("stroke","#000000"),b.setAttribute("stroke-width","1"),this.appendChild(b),b},e.poly=function(a){var b=document.createElementNS(d,"polygon");return b.setAttribute("points",a),this.appendChild(b),b},e.circle=function(a,b,c){var e=document.createElementNS(d,"circle");return e.setAttribute("cx","string"==typeof a?a:a*f),e.setAttribute("cy","string"==typeof b?b:b*f),e.setAttribute("r","string"==typeof c?c:c*f),this.appendChild(e),e},e.group=function(){var a=document.createElementNS(d,"g");return this.appendChild(a),a.push=function(b){a.appendChild(b)},a},e.line=function(a,b,c,e){var g=document.createElementNS(d,"line");return g.setAttribute("x1","string"==typeof a?a:a*f),g.setAttribute("y1","string"==typeof b?b:b*f),g.setAttribute("x2","string"==typeof c?c:c*f),g.setAttribute("y2","string"==typeof e?e:e*f),this.appendChild(g),g},e.rect=function(a,b,c,e){var g=document.createElementNS(d,"rect");return g.setAttribute("x","string"==typeof a?a:a*f),g.setAttribute("y","string"==typeof b?b:b*f),g.setAttribute("width","string"==typeof c?c:c*f),g.setAttribute("height","string"==typeof e?e:e*f),g.setAttribute("stroke","#000000"),this.appendChild(g),g},e.use=function(a,b,c,e,g){var h=document.createElementNS(d,"use");return h.setAttribute("x","string"==typeof b?b:b*f),h.setAttribute("y","string"==typeof c?c:c*f),h.setAttribute("width","string"==typeof e?e:e*f),h.setAttribute("height","string"==typeof g?g:g*f),h.setAttributeNS("http://www.w3.org/1999/xlink","href",a),this.appendChild(h),h},e.a=function(a){var b=document.createElementNS(d,"a");return b.setAttribute("target","_new"),b.setAttributeNS("http://www.w3.org/1999/xlink","href",a),this.appendChild(b),b},e.button=function(a,b,c,e,f){var g=document.createElementNS(d,"foreignObject");g.setAttribute("x",0),g.setAttribute("y",0),g.setAttribute("width",a+c),g.setAttribute("height",b+e),g.style.position="absolute",this.appendChild(g);var h=document.createElement("button");return h.style.display="block",h.style.position="relative",h.style.top=b+"px",h.style.left=a+"px",h.textContent=f,g.appendChild(h),h},e.svgbutton=function(a,b,c,d,e){var f=this.group(),g=this.rect(a,b,c,d);g.setAttribute("rx","10"),g.setAttribute("ry","10"),g.setAttribute("stroke","#ffffff"),g.setAttribute("stroke-width","2"),g.setAttribute("fill","url(#simple_gradient)"),a=g.x.baseVal.value,b=g.y.baseVal.value,c=g.width.baseVal.value,d=g.height.baseVal.value;var h=this.text(a+c/2,b+d/3,e);h.setAttribute("text-anchor","middle"),h.firstChild.setAttribute("dy","1.5ex"),h.setAttribute("font-size",.5*d),h.setAttribute("fill","#ffffff"),f.push(g),f.push(h),f.background_element=g,f.text_element=h,f.setAttribute("cursor","pointer");var i=function(){g.setAttribute("fill","#999999"),g.setAttribute("stroke","#000000")};f.addEventListener("mousedown",i,!1),f.addEventListener("touchstart",i,!1);var j=function(){g.setAttribute("stroke","#ffffff"),g.setAttribute("fill","url(#simple_gradient)")};return f.addEventListener("mouseup",j,!1),f.addEventListener("mouseout",j,!1),f.addEventListener("touchend",j,!1),f},e.callout=function(a,b,c,e){var g=this.group(),h=this.rect(-.5*(e.width+4),20,e.width+4,e.height+4);h.setAttribute("fill","#000000");var i=this.rect(-.5*(e.width+1),22,e.width+1,e.height);i.setAttribute("fill","#eeeeee"),g.push(h),g.push(i);var j=this.poly("0,500 500,1000 -500,1000");j.setAttribute("fill","#000000"),g.push(j);var k=document.createElementNS(d,"foreignObject");k.setAttribute("x",-.5*(e.width+1)*f),k.setAttribute("y",21*f),k.setAttribute("width",e.width*f),k.setAttribute("height",e.height*f),g.push(k);var l=document.createElementNS("http://www.w3.org/1999/xhtml","html");l.setAttribute("xmlns","http://www.w3.org/1999/xhtml");var m=document.createElementNS("http://www.w3.org/1999/xhtml","body");return m.style.fontSize=15*f+"px",m.style.margin=5*f+"px",l.appendChild(m),m.appendChild(c),k.appendChild(l),g.setAttribute("transform","translate("+a*f+","+(b+20)*f+")"),g},e.growingMarker=function(a,b,c,e){var g=document.createElementNS(d,"svg");g.setAttribute("viewBox","-50 -100 150 300"),g.setAttribute("preserveAspectRatio","xMinYMin meet"),g.setAttribute("x",a),g.setAttribute("y",b);var h=this.marker(50/f,50/f,50/f,c,e);g.appendChild(h),g.contentElement=h.contentElement;var i=this.group();return i.appendChild(g),i},e.marker=function(a,b,c,d,e){var g=0;if("string"==typeof a){var h=new RegExp(/(\d+)(.*)/g).exec(a);g=h[2],a=parseFloat(h[1]),h=new RegExp(/(\d+)(.*)/g).exec(b),b=parseFloat(h[1]),h=new RegExp(/(\d+)(.*)/g).exec(c),c=parseFloat(h[1])}var i={CX:a+g,CY:b+g,R:c+g,MIN_X:a-c+g,MAX_X:a+c+g,MIN_Y:b-c+g,MAX_Y:b+c+g,MID_X1:a-c/2+g,MID_X2:a+c/2+g,MID_Y1:b-c/2+g,MID_Y2:b+c/2+g},j=this.group(),k=e&&e.border?e.border:"rgb(0,0,0)";j.push(this.circle(0,-.5*c,c)),j.lastChild.style.fill=k,j.push(this.circle(0,1.5*c,c)),j.lastChild.style.fill=k;var l=this.poly(-.9*c*f+","+0*c*f+" 0,"+-2.5*c*f+" "+.9*c*f+","+0*c*f);return l.setAttribute("style","fill:"+k+";stroke-width: 0;"),j.push(l),j.setAttribute("transform","translate("+a*f+","+.5*b*f+") scale(1)"),j.setAttribute("height",i.R*f),"string"==typeof d?(j.contentElement=this.text_circle(0,.5*c,1.75*c,d,e),j.push(j.contentElement)):(j.contentElement=this.group(),d&&j.contentElement.push(d),j.push(j.contentElement)),j},e.text_circle=function(a,b,c,d,e){e||(e={});var g=0;if("string"==typeof a){var h=new RegExp(/(\d+)(.*)/g).exec(a);g=h[2],a=parseFloat(h[1]),h=new RegExp(/(\d+)(.*)/g).exec(b),b=parseFloat(h[1]),h=new RegExp(/(\d+)(.*)/g).exec(c),c=parseFloat(h[1])}var i={CX:a+g,CY:b+g,R:c+g,MIN_X:a-c+g,MAX_X:a+c+g,MIN_Y:b-c+g,MAX_Y:b+c+g,MID_X1:a-c/2+g,MID_X2:a+c/2+g,MID_Y1:b-c/2+g,MID_Y2:b+c/2+g},j=this.group(),k=this.circle(0,i.CY,.9*i.R);k.setAttribute("fill","url(#simple_gradient)"),k.setAttribute("stroke",e.border||"#000000"),k.setAttribute("stroke-width",c/10*f),j.push(k);var l=this.text(0,i.CY-.5*i.R,d);return l.setAttribute("font-size",c*f),l.setAttribute("font-weight","bolder"),l.setAttribute("fill","#ffffff"),l.setAttribute("style","font-family: sans-serif; text-anchor: middle;"),l.firstChild.setAttribute("dy","1.5ex"),l.setAttribute("text-anchor","middle"),j.push(l),j.setAttribute("transform","translate("+i.CX*f+", 1) scale(1)"),j.setAttribute("height",i.R/2*f),j},e.crossed_circle=function(a,b,c){var d=0;if("string"==typeof a){var e=new RegExp(/(\d+)(.*)/g).exec(a);d=e[2],a=parseFloat(e[1]),e=new RegExp(/(\d+)(.*)/g).exec(b),b=parseFloat(e[1]),e=new RegExp(/(\d+)(.*)/g).exec(c),c=parseFloat(e[1])}var f={CX:a+d,CY:b+d,R:c+d,MIN_X:a-c+d,MAX_X:a+c+d,MIN_Y:b-c+d,MAX_Y:b+c+d,MID_X1:a-c/2+d,MID_X2:a+c/2+d,MID_Y1:b-c/2+d,MID_Y2:b+c/2+d},g=this.group(),h=this.circle(f.CX,f.CY,f.R);h.setAttribute("fill","#000000"),h.setAttribute("stroke","#ffffff"),h.setAttribute("stroke-width","2"),g._button=h,g.push(h);var i=this.line(f.MID_X1,f.MID_Y1,f.MID_X2,f.MID_Y2);return i.setAttribute("stroke","#ffffff"),i.setAttribute("stroke-width","2"),g.push(i),i=this.line(f.MID_X1,f.MID_Y2,f.MID_X2,f.MID_Y1),i.setAttribute("stroke","#ffffff"),i.setAttribute("stroke-width","2"),g.push(i),g},e.text=function(a,b,c){var e=document.createElementNS(d,"text"),g=document.createElementNS(d,"tspan");return"string"!=typeof c?e.appendChild(c):(e.appendChild(g),g.textContent=c,g.setAttribute("dy","0")),e.style.fontFamily="Helvetica, Verdana, Arial, Sans-serif",e.setAttribute("x","string"==typeof a?a:a*f),e.setAttribute("y","string"==typeof b?b:b*f),this.appendChild(e),e},e.plus=function(a,b,c){var d=this.group();return d.appendChild(this.makeEl("rect",{x:Math.round(.4*c*f).toString(),y:Math.round(.1*c*f).toString(),"stroke-width":"1",width:Math.round(.2*c*f).toString(),height:Math.round(.8*c*f).toString(),stroke:"#ffffff",fill:"#ffffff"})),d.appendChild(this.makeEl("rect",{x:Math.round(.1*c*f).toString(),y:Math.round(.4*c*f).toString(),"stroke-width":"1",width:Math.round(.8*c*f).toString(),height:Math.round(.2*c*f).toString(),stroke:"#ffffff",fill:"#ffffff"})),d.setAttribute("transform","translate("+a*f+","+b*f+")"),d},e.minus=function(a,b,c){var d=this.group();return d.appendChild(this.makeEl("rect",{x:Math.round(.1*c*f).toString(),y:Math.round(.4*c*f).toString(),"stroke-width":"1",width:Math.round(.8*c*f).toString(),height:Math.round(.2*c*f).toString(),stroke:"#ffffff",fill:"#ffffff"})),d.setAttribute("transform","translate("+a*f+","+b*f+")"),d},e.set=function(){var b=[];return a(b,f),b},e.hide=function(){this.setAttribute("display","none")},e.show=function(){this.setAttribute("display","inline")}}}();MASCP.CondensedSequenceRenderer=function(a){this._RS=50,MASCP.SequenceRenderer.apply(this,arguments);var b=this;return MASCP.CondensedSequenceRenderer.Zoom(b),bean.add(MASCP,"layerRegistered",function(a){b.addTrack(a)}),jQuery(this).unbind("sequenceChange"),jQuery(this).bind("sequenceChange",function(){for(var a in MASCP.layers)MASCP.layers.hasOwnProperty(a)&&(MASCP.layers[a].disabled=!0);b.zoom=b.zoom}),this},MASCP.CondensedSequenceRenderer.prototype=new MASCP.SequenceRenderer,function(){var a=document.getElementsByTagName("script"),b=a[a.length-1].src;b=b.replace(/[^\/]+$/,""),MASCP.CondensedSequenceRenderer._BASE_PATH=b}(),function(a){var b=function(){var a=this;this._object&&("undefined"!=typeof svgweb?svgweb.removeChild(this._object,this._object.parentNode):this._object.parentNode.removeChild(this._object),this._canvas=null,this._object=null);var b;if(document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")){var d=document.createElementNS(svgns,"svg");d.setAttribute("width","100%"),d.setAttribute("height","100%"),this._container.appendChild(d),this._canvas=d,b={addEventListener:function(a,b){d.contentDocument={rootElement:d},b.call(d)}}}return b.addEventListener("load",function(){var b=this;SVGCanvas(b);var d=b.makeEl("g"),e=b.makeEl("svg");e.RS=a._RS,SVGCanvas(e),d.appendChild(e),b.appendChild(d);var f=!0;try{e.addEventListener}catch(g){f=!1}var h=(e.makeEl("rect",{x:"-10%",y:"-10%",width:"120%",height:"120%",style:"fill: #ffffff;"}),b.makeEl("rect",{x:"0",y:"0",width:"50",height:"100%",style:"fill: url(#left_fade);"}));b.makeEl("rect",{x:"100%",y:"0",width:"50",height:"100%",transform:"translate(-50,0)",style:"fill: url(#right_fade);"});jQuery(e).bind("pan",function(){e.currentTranslate.x>=0?h.setAttribute("visibility","hidden"):h.setAttribute("visibility","visible")}),jQuery(e).bind("_anim_begin",function(){h.setAttribute("visibility","hidden")}),jQuery(e).bind("_anim_end",function(){jQuery(e).trigger("pan")}),e.currentTranslate.x>=0&&h.setAttribute("visibility","hidden");var i=b.makeEl("g");b.appendChild(i);var j=b.makeEl("svg");i.appendChild(j),e.setCurrentTranslateXY=function(a,b){var c=(d.getAttribute("transform")||"").replace(/translate\([^\)]+\)/,"");c=c+" translate("+a+", "+b+") ",d.setAttribute("transform",c),this.currentTranslate.x=a,this.currentTranslate.y=b},j.setCurrentTranslateXY=function(a,b){var c=(i.getAttribute("transform")||"").replace(/translate\([^\)]+\)/,"");c=c+" translate("+a+", "+b+") ",i.setAttribute("transform",c),this.currentTranslate.x=a,this.currentTranslate.y=b},c.call(a,j);var k=a.navigation,l=k.show,m=k.hide;k.show=function(){l.call(k),e.style.GomapScrollLeftMargin=100*a._RS/a.zoom},k.hide=function(){m.call(k),e.style.GomapScrollLeftMargin=1e3},a._container_canvas=b,b.setAttribute("preserveAspectRatio","xMinYMin meet"),b.setAttribute("width","100%"),b.setAttribute("height","100%"),e.appendChild(e.makeEl("rect",{x:0,y:0,width:"100%",height:"100%","stroke-width":"0",fill:"#ffffff"})),a._object=this,a._canvas=e,a._canvas._canvas_height=0,jQuery(a).trigger("svgready")},!1),b},c=function(a){this.navigation=new MASCP.CondensedSequenceRenderer.Navigation(a,this);var b=this.navigation,c=function(){b.demote()},d=function(){b.promote()};MASCP.IE||(jQuery(this._canvas).bind("panstart",c),jQuery(this._canvas).bind("panend",d),jQuery(this._canvas).bind("_anim_begin",c),jQuery(this._canvas).bind("_anim_end",d))},d=function(a){var b=this._RS,c=this.sequence.split(""),d=this,e=a.set(),f=!1,g=0,h=!0,i=function(){};try{var j=document.createElementNS(svgns,"text");j.setAttribute("textLength",10),i(j.textLength)}catch(k){h=!1}d.select=function(){var a=Array.prototype.slice.call(arguments);a[0],a[1];this.moveHighlight.apply(this,a)};var l;if(h&&"lengthAdjust"in document.createElementNS(svgns,"text")&&"textLength"in document.createElementNS(svgns,"text"))this.sequence.length<=1500?(l=a.text(0,12,document.createTextNode(this.sequence)),
l.setAttribute("textLength",b*this.sequence.length)):(l=a.text(0,12,document.createTextNode(this.sequence.substr(0,1500))),l.setAttribute("textLength",1500*b)),l.style.fontFamily="'Lucida Console', 'Courier New', Monaco, monospace",l.setAttribute("lengthAdjust","spacing"),l.setAttribute("text-anchor","start"),l.setAttribute("dx",5),l.setAttribute("font-size",b),l.setAttribute("fill","#000000"),e.push(l);else{for(var m=0;m<c.length;m++)l=a.text(g,12,c[m]),l.firstChild.setAttribute("dy","1.5ex"),e.push(l),l.style.fontFamily="'Lucida Console', Monaco, monospace",g+=1;e.attr({y:-1e3,width:b,"text-anchor":"start",height:b,"font-size":b,fill:"#000000"})}var n=function(){if(!(d.sequence.length<=1500)){var a=parseInt(d.leftVisibleResidue());a-=50,a<0&&(a=0),a+1500>=d.sequence.length&&(a=d.sequence.length-1500-1),l.replaceChild(document.createTextNode(d.sequence.substr(a,1500)),l.firstChild),l.setAttribute("dx",5+a*b)}};a.addEventListener("panstart",function(){f&&e.attr({display:"none"}),jQuery(a).bind("panend",function(){f&&(e.attr({display:"block"}),n()),jQuery(a).unbind("panend",arguments.callee)})},!1),a.addEventListener("zoomChange",function(){a.zoom>3.5?(d._axis_height=14,e.attr({y:12*b,visibility:"visible"}),f=!0,n()):(d._axis_height=30,e.attr({y:-1e3,visibility:"hidden"}),f=!1),d.refresh()},!1)},e=function(a,b){var c=this._RS,d=0,e=0,f=a.set();f.push(a.path("M0 "+15*c+" l0 "+10*c)),f.push(a.path("M"+b*c+" "+14*c+" l0 "+10*c)),this._axis_height=20,f.attr({"pointer-events":"none"});var g=a.set(),h=a.set(),i=a.set(),j=a.set(),k=10,l=20;for(this.sequence.length>5e3&&(k=100,l=200),e=0;e<b/5;e++)d%k===0?g.push(a.path("M"+d*c+" "+14*c+" l 0 "+7*c)):h.push(a.path("M"+d*c+" "+16*c+" l 0 "+4*c)),d%l===0&&0!==d?i.push(a.text(d,5,""+d)):d%k===0&&0!==d&&j.push(a.text(d,7,""+d)),d+=5;for(e=0;e<i.length;e++)i[e].style.textAnchor="middle",i[e].setAttribute("text-anchor","middle"),i[e].firstChild.setAttribute("dy","1.5ex"),i[e].setAttribute("font-size",7*c+"pt");for(e=0;e<j.length;e++)j[e].style.textAnchor="middle",j[e].setAttribute("text-anchor","middle"),j[e].firstChild.setAttribute("dy","1.5ex"),j[e].setAttribute("font-size",2*c+"pt"),j[e].style.fill="#000000";g.attr({"pointer-events":"none"}),h.attr({"pointer-events":"none"}),i.attr({"pointer-events":"none"}),j.attr({"pointer-events":"none"}),h.attr({stroke:"#555555","stroke-width":.5*c+"pt"}),h.hide(),j.hide(),a.addEventListener("zoomChange",function(){this.zoom>3.6?(h.hide(),g.show(),g.attr({"stroke-width":.05*c+"pt",stroke:"#999999",transform:"scale(1,0.1) translate(0,4500)"}),j.attr({"font-size":2*c+"pt"}),i.attr({"font-size":2*c+"pt"}),f.hide(),this._visibleTracers&&this._visibleTracers()&&this._visibleTracers().show()):this.zoom>1.8?(f.show(),g.show(),f.attr({"stroke-width":.5*c+"pt"}),g.attr({"stroke-width":.5*c+"pt",stroke:"#000000",transform:""}),i.show(),i.attr({"font-size":4*c+"pt",y:7*c}),j.attr({"font-size":4*c+"pt"}),h.attr({"stroke-width":.3*c+"pt"}),h.show(),j.show(),this.tracers&&this.tracers.hide()):(this.tracers&&this.tracers.hide(),f.show(),f.attr({"stroke-width":c+"pt"}),g.show(),g.attr({"stroke-width":c+"pt",transform:"",stroke:"#000000"}),i.show(),i.attr({"font-size":7*c+"pt",y:5*c}),h.hide(),j.hide())},!1)};a.prototype.leftVisibleResidue=function(){var a=this;return Math.floor((a.sequence.length+a.padding+2)*(1-(a._canvas.width.baseVal.value+a._canvas.currentTranslate.x)/a._canvas.width.baseVal.value))-1},a.prototype.rightVisibleResidue=function(){var a=this;return Math.floor(a.leftVisibleResidue()+(a.sequence.length+a.padding+2)*(a._container_canvas.parentNode.getBoundingClientRect().width/a._canvas.width.baseVal.value))},a.prototype.setSequence=function(a){var c=this._cleanSequence(a);if(c==this.sequence&&null!==c)return void jQuery(this).trigger("sequenceChange");if(c){this.sequence=c;var f=this.sequence.split(""),g=f.length;if(0!==g){var h=this,i=[];jQuery(f).each(function(a){var b={};b._index=a,b._renderer=h,h._extendElement(b),b.amino_acid=this,i.push(b)}),this._sequence_els=i;var j=this._RS;jQuery(this).unbind("svgready").bind("svgready",function(a){var b=h._canvas;b.RS=j,b.setAttribute("background","#000000"),b.setAttribute("preserveAspectRatio","xMinYMin meet");var c=b.makeEl("defs");h._container_canvas.appendChild(c),c.appendChild(b.make_gradient("track_shine","0%","100%",["#111111","#aaaaaa","#111111"],[.5,.5,.5])),c.appendChild(b.make_gradient("simple_gradient","0%","100%",["#aaaaaa","#888888"],[1,1])),c.appendChild(b.make_gradient("left_fade","100%","0%",["#ffffff","#ffffff"],[1,0])),c.appendChild(b.make_gradient("right_fade","100%","0%",["#ffffff","#ffffff"],[0,1])),c.appendChild(b.make_gradient("red_3d","0%","100%",["#CF0000","#540000"],[1,1]));var f=b.makeEl("filter",{id:"drop_shadow",filterUnits:"objectBoundingBox",x:"0",y:"0",width:"150%",height:"130%"});f.appendChild(b.makeEl("feGaussianBlur",{"in":"SourceGraphic",stdDeviation:"4",result:"blur_out"})),f.appendChild(b.makeEl("feOffset",{"in":"blur_out",result:"the_shadow",dx:"3",dy:"1"})),f.appendChild(b.makeEl("feBlend",{"in":"SourceGraphic",in2:"the_shadow",mode:"normal"})),c.appendChild(f);var i=b.makeEl("svg",{width:"100%",height:"100%",id:"new_link_icon",viewBox:"0 0 100 100",preserveAspectRatio:"xMinYMin meet"});c.appendChild(i),i.appendChild(b.makeEl("rect",{x:"12.5",y:"37.5","stroke-width":"3",width:"50",height:"50",stroke:"#ffffff",fill:"none"})),i.appendChild(b.makeEl("path",{d:"M 50.0,16.7 L 83.3,16.7 L 83.3,50.0 L 79.2,56.2 L 68.8,39.6 L 43.8,66.7 L 33.3,56.2 L 60.4,31.2 L 43.8,20.8 L 50.0,16.7 z","stroke-width":"3",stroke:"#999999",fill:"#ffffff"}));var k=b.makeEl("svg",{width:"100%",height:"100%",id:"plus_icon",viewBox:"0 0 100 100",preserveAspectRatio:"xMinYMin meet"});k.appendChild(b.plus(0,0,100/b.RS)),c.appendChild(k);var l=b.makeEl("svg",{width:"100%",height:"100%",id:"minus_icon",viewBox:"0 0 100 100",preserveAspectRatio:"xMinYMin meet"});l.appendChild(b.minus(0,0,100/b.RS)),c.appendChild(l),e.call(this,b,g),d.call(this,b),h._layer_containers={},jQuery(h).trigger("sequenceChange")});var k=b.call(this);this._canvas?has_canvas=!0:"undefined"!=typeof svgweb?svgweb.appendChild(k,this._container):this._container.appendChild(k);var l=this;this.EnableHighlights();var m=function(a){l._canvas?a.apply():l.bind("sequenceChange",function(){jQuery(l).unbind("sequenceChange",arguments.callee),a.apply()})};return m.ready=function(a){this.call(this,a)},m}}}}(MASCP.CondensedSequenceRenderer),MASCP.CondensedSequenceRenderer.prototype.createHydropathyLayer=function(a){var b=this._RS,c=this._canvas;if(!c){var d=arguments.callee,e=this;return this._renderer.bind("sequencechange",function(){this._renderer.unbind("sequencechange",arguments.callee),d.call(e,a)}),void log("Delaying rendering, waiting for sequence change")}MASCP.registerLayer("hydropathy",{fullname:"Hydropathy plot",color:"#990000"});for(var f={A:1.8,R:-4.5,N:-3.5,D:-3.5,C:2.5,Q:-3.5,E:-3.5,G:-.4,H:-3.2,I:4.5,L:3.8,K:-3.9,M:1.9,F:2.8,P:-1.6,S:-.8,T:-.7,W:-.9,Y:-1.3,V:4.2},g="m"+b*(a-1)+" 0 ",h=null,i=-100,j=null,k=2.5*b,l=[],m=a;m<this._sequence_els.length-a;m++){for(var n=0,o=-1*a;o<=a;o++)n+=f[this._sequence_els[m+o].amino_acid[0]]/(2*a+1);k*n>i&&(i=k*n),(!j||k*n<j)&&(j=k*n),l[m]=n,g+=h?" l"+b+" "+-1*k*(h+n):" m"+b+" "+-1*k*n,h=n*-1}var p=this._canvas.path("M0 0 m0 "+i+" "+g);p.setAttribute("stroke","#ff0000"),p.setAttribute("stroke-width",.35*b),p.setAttribute("fill","none"),p.setAttribute("visibility","hidden");var q=this._canvas.path("M0 0 m0 "+-1*j+" l"+this._sequence_els.length*b+" 0");return q.setAttribute("stroke-width",.2*b),q.setAttribute("visibility","hidden"),p.setAttribute("pointer-events","none"),q.setAttribute("pointer-events","none"),this._layer_containers.hydropathy.push(p),this._layer_containers.hydropathy.push(q),this._layer_containers.hydropathy.fixed_track_height=(-1*j+i)/b,l},function(){var a=function(a){var b=this._renderer._canvas;if(!b){var c=arguments.callee,d=this;return this._renderer.bind("sequencechange",function(){this._renderer.unbind("sequencechange",arguments.callee),c.call(d,a)}),void log("Delaying rendering, waiting for sequence change")}var e=b.circle(this._index+.3,10,.25);e.setAttribute("visibility","hidden"),e.style.opacity="0.4";var f=b.rect(this._index+.3,10,.05,0);f.style.strokeWidth="0",f.style.fill=MASCP.layers[a].color,f.setAttribute("visibility","hidden"),b.insertBefore(f,b.firstChild.nextSibling);var g=this._renderer;this._renderer._layer_containers[a].tracers||(this._renderer._layer_containers[a].tracers=b.set()),b.tracers||(b.tracers=b.set(),b._visibleTracers=function(){return g._visibleTracers()});var h=b.marker(this._index+.3,10,.5,a.charAt(0).toUpperCase());return h.setAttribute("visibility","hidden"),this._renderer._layer_containers[a].tracers.push(f),this._renderer._layer_containers[a].tracers.push(e),this._renderer._layer_containers[a].push(h),b.tracers.push(f),[f,h,e]},b=function(a,b,c){"undefined"==typeof c&&(c=1);var d=this._renderer._canvas;if(!d){var e=arguments.callee,f=this;return this._renderer.bind("sequencechange",function(){this._renderer.unbind("sequencechange",arguments.callee),e.call(f,a,c,b)}),void log("Delaying rendering, waiting for sequence change")}for(var g=d.rect(-.25+this._index,60,b||1,4),h=parseFloat(g.getAttribute("x")),i=h+parseFloat(g.getAttribute("width")),j=this._renderer._layer_containers[a],k=0;k<j.length;k++){var l=parseFloat(j[k].getAttribute("x")),m=l+parseFloat(j[k].getAttribute("width"));if(l<=h&&h<=m||h<=l&&l<=i)return j[k].setAttribute("x",""+Math.min(l,h)),j[k].setAttribute("width",""+(Math.max(m,i)-Math.min(l,h))),g.parentNode.removeChild(g),j[k]}return this._renderer._layer_containers[a].push(g),g.setAttribute("class",a),g.style.strokeWidth="0px",g.setAttribute("visibility","hidden"),g.style.opacity=c,g.setAttribute("fill",MASCP.layers[a].color),g.position_start=this._index,g.position_end=this._index+b,g},c=function(a,b,c){var d=this._renderer._canvas;if(!d){var e=arguments.callee,f=this;return this._renderer.bind("sequencechange",function(){this._renderer.unbind("sequencechange",arguments.callee),e.call(f,a,b,c)}),void log("Delaying rendering, waiting for sequence change")}var g=d.rect(-.25+this._index,60,c||1,4);return this._renderer._layer_containers[a].push(g),g.style.strokeWidth="0px",g.setAttribute("fill",MASCP.layers[a].color),g.setAttribute("visibility","hidden"),g.setAttribute("class",a),g},d=function(a,b,c){var d=this._renderer._canvas,e=this._renderer;if("string"==typeof b){var f=document.createElement("div");f.innerHTML=e.fillTemplate(b,c),b=f}if(!d){var g=arguments.callee,h=this;return this._renderer.bind("sequencechange",function(){this._renderer.unbind("sequencechange",arguments.callee),g.call(h,a,width,c)}),void log("Delaying rendering, waiting for sequence change")}var i=d.callout(this._index+.5,.01,b,{width:c.width||100,height:c.height||100});return i.setAttribute("height",10*this._renderer._RS),this._renderer._canvas_callout_padding=Math.max(c.height||100,this._renderer._canvas_callout_padding||0),this._renderer._layer_containers[a].push(i),i.clear=function(){var b=e._layer_containers[a];b.indexOf(i)>0&&b.splice(b.indexOf(i),1),i.parentNode.removeChild(i)},i},e={},f=8,g=function(a,b,c){var d=this._renderer._canvas,g=this._renderer;if(!d){var h=arguments.callee,i=this;return this._renderer.bind("sequencechange",function(){this._renderer.unbind("sequencechange",arguments.callee),h.call(i,a,b,c)}),void log("Delaying rendering, waiting for sequence change")}"undefined"==typeof c?c={angle:0,border:"rgb(255,0,0)",content:"A"}:"undefined"==typeof c.angle&&(c.angle=0),e[a]||(e[a]={});var j=this._index+"_"+c.angle;"auto"==c.angle&&(e[a][j]||(e[a][j]={}));var k="undefined"!=typeof e[a][j],l=f,m=this._renderer._RS*l/2,n=e[a][j]?e[a][j]:d.growingMarker(0,m,c.content,c);if("auto"==c.angle&&(n.contents?n.contents.indexOf(c.content)<0&&n.contents.push(c.content):n.contents=[c.content],c.angle=1==n.contents.length?0:-45+90*(n.contents.indexOf(c.content)/(n.contents.length-1)),j=this._index+"_"+c.content,k="undefined"!=typeof e[a][j],n=e[a][j]?e[a][j]:d.growingMarker(0,m,c.content,c)),n.setAttribute("transform","translate("+(this._index+.25-.1)*this._renderer._RS+",0.01) scale(1,1) translate(0) rotate("+c.angle+",0.01,"+m+")"),e[a][j]=n,k||(n._value=0,this._renderer._layer_containers[a].push(n),this._renderer._layer_containers[a].fixed_track_height=f),n._value+=b,!k){var o=d.circle(this._index+.3,10+l,.25);o.setAttribute("visibility","hidden"),o.style.opacity="0.4";var p=d.rect(this._index+.25,10+l,.05,0);p.style.strokeWidth="0px",p.style.fill="#777777",p.setAttribute("visibility","hidden"),d.insertBefore(p,d.firstChild.nextSibling),this._renderer._layer_containers[a].tracers||(this._renderer._layer_containers[a].tracers=d.set()),d.tracers||(d.tracers=d.set(),d._visibleTracers=function(){return g._visibleTracers()}),this._renderer._layer_containers[a].tracers.push(p),this._renderer._layer_containers[a].tracers.push(o),d.tracers.push(p)}return this._renderer.redrawAnnotations(a,l),n};MASCP.CondensedSequenceRenderer.prototype._extendElement=function(e){e.addToLayer=a,e.addBoxOverlay=b,e.addToLayerWithLink=c,e.addAnnotation=g,e.callout=d},MASCP.CondensedSequenceRenderer.prototype.renderTextTrack=function(a,b){var c=a;"string"!=typeof c&&(c=a.name);var d=this._canvas;if(d&&"undefined"!=typeof c){var e=this._RS,f=this,g=parseInt(b.length/this.sequence.length),h=[];if(g>1)for(var i=b.match(new RegExp(".{"+g+"}","g")),j=0;j<i.length;j++)for(var k=i[j].length-1;k>=0;)h[k]||(h[k]=""),h[k]+=i[j].charAt(k),k-=1;else h=[b];var l=this._layer_containers[c],m=0,n=!0,o=function(){};try{var p=document.createElementNS(svgns,"text");p.setAttribute("textLength",10),o(p.textLength)}catch(q){n=!1}"ontouchend"in document&&(n=!1);var r;if(n&&"lengthAdjust"in document.createElementNS(svgns,"text")&&"textLength"in document.createElementNS(svgns,"text")){for(var j=0;j<h.length;j++)r=d.text(0,12,document.createTextNode(h[j])),r.style.fontFamily="'Lucida Console', 'Courier New', Monaco, monospace",r.setAttribute("lengthAdjust","spacing"),r.setAttribute("textLength",e*this.sequence.length),r.setAttribute("text-anchor","start"),r.setAttribute("dx",5),r.setAttribute("dy",(j+.25)*e),r.setAttribute("font-size",e),r.setAttribute("fill","#000000"),h.length>1&&r.setAttribute("rotate","90"),l.push(r);l.fixed_track_height=h.length}else{for(var s=b.split(""),j=0;j<s.length;j++)r=d.text(m,12,s[j]),r.firstChild.setAttribute("dy",1.5*(j%h.length)+"ex"),l.push(r),r.style.fontFamily="'Lucida Console', Monaco, monospace",j%h.length==0&&j>0&&(m+=1);l.attr({y:-1e3,width:e,"text-anchor":"start",height:e,"font-size":e,fill:"#000000"})}d.addEventListener("zoomChange",function(){d.zoom>3.5?f.showLayer(a):f.hideLayer(a),f.refresh()},!1)}},MASCP.CondensedSequenceRenderer.prototype.resetAnnotations=function(){e={}},MASCP.CondensedSequenceRenderer.prototype.removeAnnotations=function(a){var b=a;"string"!=typeof b&&(b=a.name);var c=this._canvas;if(c&&"undefined"!=typeof b){for(var d in e[b])if(e[b].hasOwnProperty(d)){var f=e[b][d],g=this._layer_containers[b];if(g.indexOf(f)>=0&&g.splice(g.indexOf(f),1),c.tracers&&g.tracers){for(var h=0;h<g.tracers.length;h++){var i=g.tracers[h];i.parentNode.removeChild(i),c.tracers.indexOf(i)>=0&&c.tracers.splice(c.tracers.indexOf(i),1)}g.tracers=c.set()}f.parentNode&&f.parentNode.removeChild(f),e[b][d]=null}e[b]=null,delete e[b],delete this._layer_containers[b].fixed_track_height}},MASCP.CondensedSequenceRenderer.prototype.redrawAnnotations=function(a){var b=this._canvas,c=null,d=0,g=b.suspendRedraw(1e4),h=0,i=f,j=0;for(d in e[a])if(e[a].hasOwnProperty(d)){if(e[a][d]._value>h&&(h=e[a][d]._value),c=e[a][d].parentNode,!c)continue;c.removeChild(e[a][d]),e[a][d]._parent=c}for(d in e[a])if(e[a].hasOwnProperty(d)){var k=e[a][d];if(!k.getAttribute)continue;var l=(.3+.6*k._value/h)*(this._RS*i*1);j=.5*(this._RS*i*1-l);var m=k.getAttribute("transform"),n=-.315*l,o=1/3*l;k.firstChild.setAttribute("y",j),m=m.replace(/translate\(\s*(-?\d+\.?\d*)\s*\)/,"translate("+n+")"),m=m.replace(/,\s*(-?\d+\.?\d*)\s*,\s*\d+\.?\d*\s*\)/,","+o+","+j+")"),k.setAttribute("transform",m),k.firstChild.setAttribute("width",l),k.firstChild.setAttribute("height",l)}for(d in e[a])if(e[a].hasOwnProperty(d)){if(c=e[a][d]._parent,!c)continue;c.appendChild(e[a][d])}b.unsuspendRedraw(g)},function(a){var b={};a.fillTemplate=function c(a,d){var e=/\W/.test(a)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):b[a]=b[a]||c(document.getElementById(a).innerHTML);return d?e(d):e}}(MASCP.CondensedSequenceRenderer.prototype)}(),MASCP.CondensedSequenceRenderer.prototype.EnableHighlights=function(){var a=this,b=[],c=function(){var c=a._canvas.rect(0,0,0,"100%");c.setAttribute("fill","#ffdddd");var d=c.parentNode;d.insertBefore(c,d.firstChild.nextSibling),b.push(c)};c(),a.moveHighlight=function(){var a=Array.prototype.slice.call(arguments),d=this._RS,e=0,f=0;for(e=0;e<a.length;e+=2){var g=a[e],h=a[e+1],i=b[f];i||(c(),i=b[f]),i.setAttribute("x",(g-.25)*d),i.setAttribute("width",(h-g)*d),i.setAttribute("visibility","visible"),f+=1}for(e=f;e<b.length;e++)b[e].setAttribute("visibility","hidden")}},MASCP.CondensedSequenceRenderer.prototype._visibleTracers=function(){var a=null;for(var b in MASCP.layers)this.isLayerActive(b)&&this._layer_containers[b].tracers&&(a?a.concat(this._layer_containers[b].tracers):a=this._layer_containers[b].tracers);return a},MASCP.CondensedSequenceRenderer.prototype._resizeContainer=function(){this._RS;if(this._container&&this._canvas){var a=2*(this.zoom||1)*this.sequence.length,b=2*(this.zoom||1)*(this._canvas._canvas_height/this._RS);this._canvas_callout_padding&&(b+=this._canvas_callout_padding),this._canvas.setAttribute("width",a),this._canvas.setAttribute("height",b),this.navigation.setDimensions(a,b),this.grow_container?(this._container_canvas.setAttribute("height",b),this._container.style.height=b+"px"):(this._container_canvas.setAttribute("height","100%"),this._container_canvas.setAttribute("width","100%"),this.navigation.setZoom(this.zoom))}},function(a){var b=function(a,b,c){var d=this;!b._layer_containers[d.name]||b._layer_containers[d.name].length<=0||c||b._layer_containers[d.name].tracers&&b._layer_containers[d.name].tracers.hide()};a.prototype.addTrack=function(a){var c=(this._RS,this);if(!this._canvas)return this.bind("sequencechange",function(){this.addTrack(a),this.unbind("sequencechange",arguments.callee)}),void console.log("No canvas, cannot add track, waiting for sequencechange event");var d=this._layer_containers||[];if(!d[a.name]||null===d[a.name]){d[a.name]=this._canvas.set(),d[a.name].track_height||(d[a.name].track_height=4),jQuery(a).unbind("visibilityChange",b).bind("visibilityChange",b);for(var e=["click","mouseover","mousedown","mousemove","mouseout","mouseup","mouseenter","mouseleave"],f=function(b,c,d){jQuery(a).trigger(b.type,[c,d.position_start,d.position_end])},g=0;g<e.length;g++)jQuery(d[a.name]._event_proxy).bind(e[g],f);jQuery(a).unbind("removed").bind("removed",function(){c.removeTrack(this)})}this._layer_containers=d},a.prototype.removeTrack=function(a){if(this._layer_containers){var b=this._layer_containers||[];b[a.name]&&(b[a.name].forEach(function(a){a.parentNode.removeChild(a)}),this.removeAnnotations(a),this._layer_containers[a.name]=null,a.disabled=!0)}},a.prototype.refresh=function(a){if(this._canvas){var b=this._layer_containers||[],c=this._RS,d=0,e=this.trackOrder||[];this.navigation&&this.navigation.reset();for(var f=0;f<e.length;f++){var g=e[f],h=b[g];if(h){var i;if(this.isLayerActive(g)){if(h.attr({opacity:"1"}),h.tracers){var j=this.isLayerActive(g)&&this.zoom>3.6?"visible":"hidden",k=(1.5+d/this.zoom)*c;h.fixed_track_height&&(k+=.5*h.fixed_track_height*c),a?h.tracers.animate({visibility:j,y:(this._axis_height-1.5)*c,height:k}):h.tracers.attr({visibility:j,y:(this._axis_height-1.5)*c,height:k})}if(h.fixed_track_height){var l=h.fixed_track_height;if(i=this._axis_height+(d-.3*l)/this.zoom,a?h.animate({visibility:"visible",y:i*c}):h.attr({visibility:"visible",y:i*c}),this.navigation){var m=this.grow_container?1/this.zoom:1;this.navigation.renderTrack(MASCP.getLayer(g),i*c,c*l,{"font-scale":h.track_height/l*3*m})}d+=this.zoom*l+this.trackGap}else i=this._axis_height+d/this.zoom,a?h.animate({visibility:"visible",y:i*c,height:c*h.track_height/this.zoom}):h.attr({visibility:"visible",y:i*c,height:c*h.track_height/this.zoom}),this.navigation&&(i-=1*h.track_height/this.zoom,this.navigation.renderTrack(MASCP.getLayer(g),i*c,3*c*h.track_height/this.zoom),d+=h.track_height),d+=h.track_height+this.trackGap;h.refresh_zoom()}else{var n={y:-1*this._axis_height*c,height:c*h.track_height/this.zoom,visibility:"hidden"};if(MASCP.getLayer(g).group){var o=this.navigation.getController(MASCP.getLayer(g).group);o&&this.isLayerActive(o)&&(n.y=b[o.name].currenty())}h.fixed_track_height&&delete n.height,a?h.animate(n):h.attr(n),h.tracers}}}var p=[-1,0,0,0];p[0]=-2*c,p[2]=(this.sequence.split("").length+this.padding+2)*c,p[3]=(this._axis_height+d/this.zoom+this.padding)*c,this._canvas.setAttribute("viewBox",p.join(" ")),this._canvas._canvas_height=p[3];var q=[].concat(p);q[0]=0,q[2]=this.zoom*(2*this.sequence.length)+this.padding,q[3]=2*this.zoom*(this._axis_height+d/this.zoom+this.padding),this.grow_container||this._container_canvas.setAttribute("viewBox",q.join(" ")),this._resizeContainer(),p[0]=0,this.navigation&&(this.navigation.visible()?this._canvas.style.GomapScrollLeftMargin=100*c/this.zoom:this._canvas.style.GomapScrollLeftMargin=1e3,this.navigation.setViewBox(p.join(" "))),this.navigation&&this.navigation.refresh()}}}(MASCP.CondensedSequenceRenderer),MASCP.CondensedSequenceRenderer.Zoom=function(a){var b=null,c=null,d=null,e=null,f=null,g={setZoom:function(g){var h=a.sequence?.15*window.innerWidth/a.sequence.length:.5;if(g<h&&(g=h),g>10&&(g=10),g!=d){var i=this;if(i._canvas){if("center"==i.zoomCenter&&(i.zoomCenter={x:i._RS*(i.leftVisibleResidue()+.5*(i.rightVisibleResidue()-i.leftVisibleResidue()))}),i.zoomCenter&&!e)f=i._canvas.currentTranslate.x||0,e=i.zoomCenter?i.zoomCenter.x:0;else if(e&&!i.zoomCenter)return;b?clearTimeout(b):c=parseFloat(d||1),d=parseFloat(g);var j=i._canvas.parentNode.getAttribute("transform")||"";j=j.replace(/scale\([^\)]+\)/,"");var k=Math.abs(parseFloat(g)/c);if(j="scale("+k+") "+(j||""),i._canvas.parentNode.setAttribute("transform",j),jQuery(i._canvas).trigger("_anim_begin"),e){var l=(c-d)/(25*k)*e;l+=f/k,i._canvas.setCurrentTranslateXY(l,0)}var m=function(){b=null;var a=(Math.abs(parseFloat(d)/c),i._canvas.parentNode.getAttribute("transform")||"");if(a=a.replace(/scale\([^\)]+\)/,""),i._canvas.parentNode.setAttribute("transform",a),jQuery(i._canvas).trigger("_anim_end"),jQuery(i._canvas).one("zoomChange",function(){if("undefined"!=typeof e){var a=(c-d)/25*e;a+=f,i._canvas.shiftPosition?i._canvas.shiftPosition(a,0):i._canvas.setCurrentTranslateXY(a,0)}e=null,f=null}),i._canvas)if(i._canvas.zoom=parseFloat(d),document.createEvent){var g=document.createEvent("Events");g.initEvent("zoomChange",!1,!0),i._canvas.dispatchEvent(g)}else jQuery(i._canvas).trigger("zoomChange");jQuery(i).trigger("zoomChange")};"ontouchend"in document&&i.zoomCenter?(jQuery(i).unbind("gestureend"),jQuery(i).one("gestureend",m),b=1):b=setTimeout(m,100)}}},getZoom:function(){return d||1}};a.__defineSetter__&&(a.__defineSetter__("zoom",g.setZoom),a.__defineGetter__("zoom",g.getZoom)),Object.defineProperty&&!MASCP.IE8&&Object.defineProperty(a,"zoom",{get:g.getZoom,set:g.setZoom})},function(a){var b={getPadding:function(){return this._padding||10},setPadding:function(a){this._padding=a,this.refresh()},getTrackGap:function(){if(!this._track_gap){var a="ontouchend"in document?20:10;this._track_gap=this._track_gap||a}return this._track_gap},setTrackGap:function(a){this._track_gap=a,this.refresh()}};a.prototype.__defineSetter__&&(a.prototype.__defineSetter__("padding",b.setPadding),a.prototype.__defineGetter__("padding",b.getPadding),a.prototype.__defineSetter__("trackGap",b.setTrackGap),a.prototype.__defineGetter__("trackGap",b.getTrackGap)),Object.defineProperty&&!MASCP.IE8&&(Object.defineProperty(a.prototype,"padding",{get:b.getPadding,set:b.setPadding}),Object.defineProperty(a.prototype,"trackGap",{get:b.getTrackGap,set:b.setTrackGap}))}(MASCP.CondensedSequenceRenderer),MASCP.CondensedSequenceRenderer.Navigation=function(){var a=1,b=!1;"ontouchend"in document&&(a=2,b=!0);var c=function(a,b){SVGCanvas(a),f.call(this,a);var c=a.group();a.insertBefore(c,a.lastChild);var e=document.createElementNS(svgns,"svg");g.call(this,e,d.call(this,b)),c.appendChild(e),c.setAttribute("clip-path","url(#nav_clipping)"),this.demote=function(){e.hide()},this.promote=function(){this.visible()?e.show():e.hide()},this.setDimensions=function(b,c){a.setAttribute("width",b),a.setAttribute("height",c)}},d=function(a){var b={},c={},d=a.removeTrack;return a.removeTrack=function(a){d.call(this,a),delete b[a.name],delete c[a.name]},this.isController=function(a){return!!b[a.name]},this.getController=function(a){for(var c in b)if(b.hasOwnProperty(c)&&b[c]==a)return MASCP.getLayer(c);return null},this.isControllerExpanded=function(a){return c[a.name]},a.createGroupController=function(d,e){var f=MASCP.getLayer(d),g=MASCP.getGroup(e);if(f&&g&&!b[f.name]){b[f.name]=g,c[f.name]=!1;var h=this;jQuery(f).bind("removed",function(a,b){h.setGroupVisibility(g)}),jQuery(f).bind("visibilityChange",function(b,d,e){g.size()>0&&(h.setGroupVisibility(g,c[f.name]&&e,!0),a.refresh())}),jQuery(g).bind("visibilityChange",function(a,b,d){d&&(h.showLayer(f,!0),c[f.name]=!0)}),jQuery(f).unbind("_expandevent").bind("_expandevent",function(a){c[f.name]=!c[f.name],h.withoutRefresh(function(){h.setGroupVisibility(g,c[f.name])}),h.refresh(!0)})}},e(function(c,d,e){var f=a.trackOrder;f.trackIndex=function(a){return a?this.indexOf(a.name):this.length},e&&!d&&(d=MASCP.getLayer(f[f.trackIndex(e)+1])),f.splice(f.trackIndex(c),1);var g=[];if(b[c.name]&&MASCP.getGroup(b[c.name]).eachLayer(function(a){MASCP.getGroup(a)===a&&MASCP.getGroup(a).eachLayer(arguments.callee),f.trackIndex(a)>=0&&(g=[f.splice(f.trackIndex(a),1)[0]].concat(g))}),d){f.splice(f.trackIndex(d),1,c.name,d?d.name:void 0);for(var h=0;h<g.length;h++)g[h]&&f.splice(f.trackIndex(d),0,g[h])}else a.hideLayer(c),MASCP.getLayer(c).disabled=!0,g.forEach(function(b){a.hideLayer(b),MASCP.getLayer(b).disabled=!0}),f.push(c.name),f=f.concat(g);a.trackOrder=f})},e=function(a){var c,d,e,f=[],g=!1,h={},i=null,j=function(j,l,m,n){var o=this,p=o.reset;null===i&&(o.reset=function(){f=[],p.call(this)},i=!0);var q=function(){window.clearTimeout(h.anim),window.clearTimeout(h.hover);for(var a=0;a<f.length;a++)f[a]!=c&&(f[a].removeAttribute("transform"),f[a].setAttribute("pointer-events","all"))};f.push(l),l.track=m;var r=function(a){return function(b){b.touches&&1==b.touches.length&&a.call(this,b)}},s=function(h,i,j){if(!k()){var l=n.nearestViewportElement;if(!g){spliceBefore=null,spliceAfter=null;var o=j.nearestViewportElement.createSVGPoint();o.x=h.clientX||window.pageXOffset+h.touches[0].clientX,o.y=h.clientY||window.pageYOffset+h.touches[0].clientY;var p=j.nearestViewportElement.getScreenCTM(),s=p.inverse();o=o.matrixTransform(s);var t=o.x,v=o.y,w=function(a){var b=j.nearestViewportElement.createSVGPoint();b.x=a.clientX||window.pageXOffset+a.touches[0].clientX,b.y=a.clientY||window.pageYOffset+a.touches[0].clientY,b=b.matrixTransform(s);var c=b.x-t,d=b.y-v,e=j.getAttribute("transform")||"";return e=e.replace(/\s?translate\([^\)]+\)/,""),e+=" translate("+c+","+d+") ",e=e.replace(/\s*$/,""),j.setAttribute("transform",e),f.forEach(function(c){var d=c.getBBox();d.y<b.y&&d.y>b.y-d.height&&d.x<b.x&&d.x>b.x-d.width&&u.call(c,a,c.track)}),a.stopPropagation(),a.preventDefault(),!1};b&&(w=r(w));var x=function(b){return!b.relatedTarget||b.relatedTarget!=j&&b.relatedTarget.nearestViewportElement!=j.nearestViewportElement&&b.relatedTarget.nearestViewportElement!=l?(!g||"mouseup"!=b.type&&"touchend"!=b.type||(spliceBefore||spliceAfter)&&a(d,spliceBefore,spliceAfter),l.removeEventListener("touchmove",w,!1),l.removeEventListener("mousemove",w,!1),l.removeEventListener("touchend",arguments.callee,!1),l.removeEventListener("mouseup",arguments.callee,!1),l.removeEventListener("mouseout",arguments.callee,!1),void(g&&(j.setAttributeNS(null,"pointer-events","all"),j.removeAttribute("transform"),q(),g=!1,e=null))):void(g&&f.indexOf(b.relatedTarget)>=0&&q())};j.setAttributeNS(null,"pointer-events","none"),j.addEventListener("touchmove",w,!1),j.addEventListener("touchend",x,!1),l.addEventListener("mousemove",w,!1),l.addEventListener("mouseup",x,!1),l.addEventListener("mouseout",x,!1),g=m,c=j}}},t=function(a){s(a,m,l)},u=function(a,b){var i=b?b:m,j=this?this:l;g&&g!=i&&i!=e&&(e=i,h.hover&&window.clearTimeout(h.hover),h.hover=window.setTimeout(function(){if((g.group||i.group)&&(g.group?i.group:!i.group)){if(g.group.name!=i.group.name)return}else if(g.group||i.group)return;h.anim&&(window.clearInterval(h.anim),h.anim=null),q();for(var a=j,b=[];null!==a&&(a!=c&&f.indexOf(a)>=0&&b.push(a),a=a.nextSibling,a!=c););a=j.previousSibling;for(var e=[];null!==a&&(a!=c&&f.indexOf(a)>=0&&e.push(a),a=a.previousSibling,a!=c););var k=1,l=c.getBBox().height/4;h.anim=window.setInterval(function(){var a,c=0;if(k<5){for(c=0;c<b.length;c++)a=b[c].getAttribute("transform")||"",a=a.replace(/\s?translate\([^\)]+\)/,""),a+=" translate(0,"+k*l+")",b[c].setAttribute("transform",a);for(c=0;b.length>0&&c<e.length;c++)a=e[c].getAttribute("transform")||"",a=a.replace(/\s?translate\([^\)]+\)/,""),a+=" translate(0,"+k*-1*l+")",e[c].setAttribute("transform",a);k+=1}else spliceBefore=i,d=g,window.clearInterval(h.anim),h.anim=null},30)},300))};j.addEventListener("mousedown",t,!1),j.addEventListener("touchstart",r(t),!1)},k=function(){return j.disabled};return j.spliceFunction=a,j},f=function(c){var d=this,e=200+100*(a-1),f=c.group(),g=c.group(),h=c.rect(-10,0,e.toString(),"100%"),i=[12*a,10*a];h.setAttribute("rx",i[0].toString()),h.setAttribute("ry",i[1].toString()),b||h.setAttribute("opacity","0.8"),h.style.stroke="#000000",h.style.strokeWidth="2px",h.style.fill="#000000",h.id="nav_back",f.push(h);var j=document.createElementNS(svgns,"clipPath");j.id="nav_clipping";var k=document.createElementNS(svgns,"use");k.setAttributeNS("http://www.w3.org/1999/xlink","href","#nav_back"),c.insertBefore(j,c.firstChild),j.appendChild(k);var l=c.crossed_circle(e-(10+11*a),12*a,10*a);l.style.cursor="pointer",g.push(l);var m=MASCP.IE?c.svgbutton(10,5,65,25,"Edit"):c.button(10,5,65,25,"Edit");m.id="controls",m.parentNode.setAttribute("clip-path","url(#nav_clipping)"),f.push(MASCP.IE?m:m.parentNode);var n=document.createElementNS(svgns,"foreignObject");n.setAttribute("x","0"),n.setAttribute("y","0"),n.setAttribute("width","100"),n.setAttribute("height","45"),n.setAttribute("clip-path","url(#nav_clipping)"),f.push(n),m.addEventListener("click",function(){jQuery(d).trigger("toggleEdit"),jQuery(d).trigger("click")},!1);var o=!0,p=function(b){o=b===!1||b===!0?b:!o;var c;return o?(d.promote(),f.setAttribute("visibility","visible"),l._button.removeAttribute("filter"),c=l.getAttribute("transform")||" ",c=c.replace(/translate\(.*\)/,""),c=c.replace(/rotate\(.*\)/,""),l.setAttribute("transform",c),n.setAttribute("display","inline"),d.refresh()):(d.demote(),f.setAttribute("visibility","hidden"),l._button.setAttribute("filter","url(#drop_shadow)"),c=l.getAttribute("transform")||" ",c=c+" translate("+-.75*e+",0) rotate(45,"+(e-(10+11*a))+","+12*a+") ",l.setAttribute("transform",c),n.setAttribute("display","none")),!0};d.hide=function(){p.call(this,!1)},d.show=function(){p.call(this,!0)},d.visible=function(){return o},d.setZoom=function(a){l.setAttribute("transform","scale("+a+","+a+") "),
h.setAttribute("transform","scale("+a+",1) "),h.setAttribute("ry",(a*i[1]).toString()),d.refresh()},l.addEventListener("click",function(){o?d.hide():d.show()},!1)},g=function(c,d){var e,f,g,h=this,i=0;SVGCanvas(c),c.setAttribute("preserveAspectRatio","xMinYMin meet");var j=[];h.reset=function(){for(;c.firstChild;)c.removeChild(c.firstChild);j=[],k=[]};var k=[];h.refresh=function(){if((e||[]).forEach(function(a){a.setAttribute("visibility",g?"visible":"hidden")}),(f||[]).forEach(function(a){a.setAttribute("visibility",g?"hidden":"visible")}),g?l.call(this,!0):l.call(this,!1),"none"!=c.getAttribute("display")){var a=document.getElementById("nav_back"),b=a.getScreenCTM().inverse().multiply(c.getScreenCTM()).inverse(),d=document.getElementById("nav_back").getBBox().width+document.getElementById("nav_back").getBBox().x,h=c.createSVGPoint();h.x=d,h.y=0,i=h.matrixTransform(b).x,k.forEach(function(a){var b=0;try{b=a.getBBox().width}catch(c){}if(b>0){var d=/translate\((-?\d+\.?\d*)\s*,?\s*(-?\d+\.?\d*)\)/.exec(a.getAttribute("transform")||"");if("undefined"==typeof d)return;d=d[2];var e=i-1.5*parseInt(a.getAttribute("width"),10);a.setAttribute("transform","translate("+e+","+d+")")}})}};var l=function(a){j&&(j||[]).forEach(function(c){c.setAttribute("opacity",a?"1":b?"0.5":"0.1"),c.setAttribute("pointer-events",a?"all":"none")})};jQuery(h).bind("toggleEdit",function(){g="undefined"==typeof g||!g,d.disabled=!g,l.call(h,g),h.hide(),h.show(),(e||[]).forEach(function(a){a.setAttribute("visibility",g?"visible":"hidden")}),(f||[]).forEach(function(a){a.setAttribute("visibility",g?"hidden":"visible")})}),this.setViewBox=function(a){c.setAttribute("viewBox",a)},c.style.height="100%",c.style.width="100%",c.setAttribute("height","100%"),c.setAttribute("width","100%"),this.renderTrack=function(g,l,m,n){var o=c.group(),p=c.rect(0,l,"100%",m);p.setAttribute("stroke","#000000"),p.setAttribute("stroke-width","2"),p.setAttribute("fill","url(#simple_gradient)"),p.setAttribute("opacity",b?"0.5":"0.1"),p.setAttribute("pointer-events","none"),j=j||[],j.push(p),o.push(p);var q=n&&n["font-scale"]?n["font-scale"]:1,r=4/3*a*m*q,s=c.text(r,l+.5*m,g.fullname);s.setAttribute("height",m),s.setAttribute("width",m),s.setAttribute("font-size",.6*m*q),s.setAttribute("fill","#ffffff"),s.setAttribute("stroke","#ffffff"),s.setAttribute("stroke-width","1"),s.firstChild.setAttribute("dy","0.5ex"),o.push(s),s.setAttribute("pointer-events","none");var t;if(g.href){a_anchor=c.a(g.href);var u=null,v=[.5*m*q,0,m*q*a];v[1]=-.5*(v[2]-m),t=c.circle(v[0]+.5*v[2],.5*m,.5*v[2]),t.setAttribute("fill","#ffffff"),t.setAttribute("opacity","0.1"),a_anchor.appendChild(t);var w=g.href;"string"==typeof w&&w.match(/^javascript\:/)?u="#plus_icon":"function"==typeof w?(u="#plus_icon",a_anchor.setAttribute("href","#"),a_anchor.removeAttribute("target"),a_anchor.addEventListener("click",function(a){return w.call(),a.preventDefault?a.preventDefault():a.returnResult=!1,a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,!1},!1)):u="#new_link_icon",g.icon&&(u=g.icon);var x=c.use(u,v[0],v[1],v[2],v[2]);x.style.cursor="pointer",a_anchor.appendChild(x),a_anchor.setAttribute("transform","translate("+(i-1.5*v[2])+","+l+")"),a_anchor.setAttribute("width",v[2].toString()),k.push(a_anchor)}if(o.addEventListener("touchstart",function(){o.onmouseover=void 0,o.onmouseout=void 0},!1),o.addEventListener("touchend",function(){o.onmouseover=void 0,o.onmouseout=void 0},!1),d.call(this,p,o,g,c),function(){if(!g.group){var b=.5*m*a;e||(e=[]);var f=c.crossed_circle(1.5*b,0,b);f.setAttribute("transform","translate(0,"+(l+.5*m)+") scale("+q+")"),f.firstChild.setAttribute("fill","url(#red_3d)");for(var h=f.childNodes,i=0,j=h.length;i<j;i++)h[i].setAttribute("stroke-width",(b/4).toString());f.addEventListener("click",function(){d.spliceFunction(g)},!1),o.push(f),e.push(f),f.setAttribute("visibility","hidden")}}(),this.isController(g)){f||(f=[]);var y=.5*m*a,z=c.group();t=c.circle(1.5*y,0,y),t.setAttribute("fill","#ffffff"),t.setAttribute("opacity","0.1"),z.push(t);var A=[1.1*y,-1.25*y,2.25*y,-.5*y,1.1*y,.25*y];A[1]+=.5*(y-0*m),A[3]+=.5*(y-0*m),A[5]+=.5*(y-0*m);var B=c.poly(""+A[0]+","+A[1]+" "+A[2]+","+A[3]+" "+A[4]+","+A[5]);this.isControllerExpanded(g)?z.setAttribute("transform","translate(0,"+(l+.5*m)+") scale("+q+") rotate(90,"+1.5*y+","+A[3]+")"):z.setAttribute("transform","translate(0,"+(l+.5*m)+") scale("+q+")"),B.setAttribute("height",1.75*y),B.setAttribute("font-size",1.5*y),B.setAttribute("fill","#ffffff"),B.setAttribute("pointer-events","none"),z.push(B),z.style.cursor="pointer",z.addEventListener("click",function(a){a.stopPropagation(),jQuery(g).trigger("_expandevent"),h.isControllerExpanded(g)?z.setAttribute("transform","translate(0,"+(l+.5*m)+") scale("+q+") rotate(90,"+1.5*y+","+A[3]+")"):z.setAttribute("transform","translate(0,"+(l+.5*m)+") scale("+q+")")},!1),o.push(z),f.push(z),z.setAttribute("visibility","hidden")}}};return c}(),"undefined"==typeof MASCP&&(MASCP={}),"undefined"==typeof MASCP.TagVisualisation&&(MASCP.TagVisualisation={}),MASCP.TagVisualisation=function(a,b){this.datasetName=a,this._buildRichTableView(b)},MASCP.TagVisualisation.prototype={__class__:MASCP.TagVisualisation,visualisations:null,datasetName:"",tagColumn:""},MASCP.TagVisualisation.prototype._buildRichTableView=function(a){var b=this.datasetName,c=document.getElementById(b);if(c.getAttributeNS){var d=parseInt(c.getAttributeNS("MASCP.TagVisualisation","tagcolumn"),10);this.tagColumn=d?d:this._getTagColumn()}else this.tagColumn=this._getTagColumn();var e=c.parentNode,f=null;if("BODY"==e.nodeName){f=e;var g=document.createElement("div");c.parentNode.replaceChild(g,c),g.appendChild(c),e=c.parentNode}else f=e.parentNode;this._dataTableContainer=e;var h=this._buildRichTagInfoContainer(e);f.insertBefore(h,e),this._displayElement=h;for(var i=0;i<a.length;i++)this.addVisualisation(new a[i](this));c.old_style=c.style.display,c.style.display="none"},MASCP.TagVisualisation.prototype._getDisplayWidth=function(a){var b;return void 0!==window.getComputedStyle?b=getComputedStyle(a,""):void 0!==document.defaultView.getComputedStyle&&(b=document.defaultView.getComputedStyle(a,"")),void 0!==b?parseInt(b.getPropertyValue("width").replace(/px/,""),10):void 0},MASCP.TagVisualisation.prototype._buildRichTagInfoContainer=function(a){var b=document.createElement("div");return b.setAttribute("id","rich_"+this.datasetName),b.setAttribute("class","rich_as_data "+a.className),b.style.width=a.style.width,b.style.height=a.style.height,b.style.display=a.style.display,b.style.position=a.style.position,b},MASCP.TagVisualisation.prototype.toggleTagView=function(){var a=document.getElementById(this.datasetName);"none"==a.style.display?(a.style.display=a.old_style,this.getDisplayElement().style.display="none"):(a.style.display="none",this.getDisplayElement().style.display="block")},MASCP.TagVisualisation.prototype.getDisplayElement=function(){return this._displayElement},MASCP.TagVisualisation.prototype.addVisualisation=function(a){this.visualisations||(this.visualisations=[]),this.getDisplayElement().appendChild(a.getDisplayElement()),this.visualisations.push(a)},MASCP.TagVisualisation.prototype.getAllTags=function(){for(var a=document.getElementById(this.datasetName),b=a.getElementsByTagName("tbody")[0].getElementsByTagName("tr"),c={},d=0;d<b.length;d++)tagname=b[d].getElementsByTagName("td")[this.tagColumn].childNodes[0].data,c[b[d].id]=tagname;return c},MASCP.TagVisualisation.prototype._getTagColumn=function(){for(var a=document.getElementById(this.datasetName),b=a.getElementsByTagName("thead")[0].getElementsByTagName("tr")[0].getElementsByTagName("th"),c=0;c<b.length;c++)if("tag"==b[c].childNodes[0].data.toLowerCase())return c;return 1},MASCP.TagVisualisation.prototype._getColumnCount=function(){var a=document.getElementById(this.datasetName),b=a.getElementsByTagName("thead")[0].getElementsByTagName("tr")[0].getElementsByTagName("th");return b.length-this._getTagColumn()-1},void 0===typeof MASCP.TagVisualisation.TagCloud&&(MASCP.TagVisualisation.TagCloud={}),MASCP.TagVisualisation.TagCloud=function(a){this._tagVisualiser=a,this._initElements()},MASCP.TagVisualisation.TagCloud.prototype={__class__:MASCP.TagVisualisation.TagCloud},MASCP.TagVisualisation.TagCloud.ELEMENT_CSS_CLASS="rich_tagcloud",MASCP.TagVisualisation.TagCloud.ELEMENT_ID_PREFIX="rich_tagcloud_",MASCP.TagVisualisation.TagCloud.TAG_ELEMENT_CSS_CLASS="rich_tagcloud_tag",MASCP.TagVisualisation.TagCloud.TAG_ELEMENT_ID_PREFIX="rich_tagcloud_tag_",MASCP.TagVisualisation.TagCloud.prototype._initElements=function(){return this._displayElement=document.createElement("div"),this._displayElement.setAttribute("id",MASCP.TagVisualisation.TagCloud.ELEMENT_ID_PREFIX+this._tagVisualiser.datasetName),this._displayElement.setAttribute("class",MASCP.TagVisualisation.TagCloud.ELEMENT_CSS_CLASS),this._displayElement},MASCP.TagVisualisation.TagCloud.prototype.getDisplayElement=function(){return this._displayElement},MASCP.TagVisualisation.TagCloud.prototype.update=function(a){var b,c=this.getDisplayElement(),d=document.getElementById(this._tagVisualiser.datasetName),e={},f={},g=d.getElementsByTagName("tbody")[0].getElementsByTagName("tr"),h=0,i=[];for(b=0;b<g.length;b++){var j=g[b].getElementsByTagName("td"),k=parseFloat(j[this._tagVisualiser.tagColumn+a].childNodes[0].data);if(0!==j[this._tagVisualiser.tagColumn].childNodes.length){var l=j[this._tagVisualiser.tagColumn].childNodes[0].data;e[l]=k,f[l]=j,h=Math.max(h,k),i[b]=l}}for(i.sort(),b=0;b<i.length;b++){var m=i[b];if(m){var n,o=m.replace(/\s+/,"_");null!==document.getElementById(MASCP.TagVisualisation.TagCloud.TAG_ELEMENT_ID_PREFIX+o)&&(n=document.getElementById(MASCP.TagVisualisation.TagCloud.TAG_ELEMENT_ID_PREFIX+o),n.parentNode.removeChild(n)),n=this.tagFactory(o,m,f[m]),c.appendChild(n);var p=Math.floor(30*Math.log(1.5+e[m]/h));n.style.fontSize=p+"px",n.setAttribute("class",MASCP.TagVisualisation.TagCloud.TAG_ELEMENT_CSS_CLASS)}}if(!c.hasSpacer){var q=document.createElement("div");q.setAttribute("class","spacer"),q.setAttribute("style","width: 100%; height: 0px; clear: both;"),c.appendChild(q),c.hasSpacer=!0}},MASCP.TagVisualisation.TagCloud.prototype.tagFactory=function(a,b,c){var d=document.createElement("span");return d.setAttribute("id",MASCP.TagVisualisation.TagCloud.TAG_ELEMENT_ID_PREFIX+a),d.textContent=b,d};